import{bv as m}from"./index.51407d32.js";import{l as v}from"./index.80337ce4.js";import{b as T}from"./base.12718b58.js";import{L as h,m as O,s as c,c as l,a as w}from"./data.270c8dc4.js";const P=5e3;function a(e,t){t=Object.assign({method:"GET",headers:{"Content-type":"application/x-www-form-urlencoded"},credentials:"include",mode:"cors",cache:"no-cache"},t);const{method:s,handle:d,body:o}=t;if(s==="GET"&&o.constructor===Object){const r=[];Object.keys(o).forEach(i=>r.push(i+"="+encodeURIComponent(o[i]))),e.search(/\?/)===-1?e+="?"+r.join("&"):e+="&"+r.join("&"),delete t.body}else s==="POST"&&o.constructor===Object&&(t.body=v.stringify(o));return Promise.race([new Promise((r,i)=>{setTimeout(()=>{i(new Error("request timeout"))},P)}),new Promise((r,i)=>{fetch(T+e,t).then(async u=>{if(!/^(2|3)\d{2}$/.test(String(u.status))){switch(u.status){case 401:window.$notification.warning({duration:2e3,content:"\u8B66\u544A",meta:"\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55\uFF01"}),m.push({name:"login"});break;case 403:console.log("\u767B\u5F55\u9519\u8BEF");break}return Promise.reject(u)}if(d){const g=u.json();r(g)}else r(u.text())}).catch(u=>{i(u)})})])}function j(){h.value||f().then(()=>{b(),p(),y()})}function k(e,t){a("/user/login",{method:"POST",handle:!1,body:{account:e,password:t}}).then(async()=>{await f(),await b(),await p(),await y(),h.value=!0,m.push({name:"panel"})})}function B(){return a("/user/logout",{method:"GET",handle:!1,body:{}})}function f(){return a("/user/count",{method:"GET",handle:!1,body:{}}).then(e=>{O.value=Number(e)})}function y(){return G(20,1,w)}function G(e,t,n,s){return a("/user/list",{method:"POST",handle:!0,body:{num:e,pg:t}}).then(d=>{n.value=[];for(const o of d.movies){let r={id:o.id,name:o.name,description:o.description,duration:o.duration,director:o.director};n.value.push(r)}typeof s!="undefined"&&(s.value=d.pgCount)})}function N(e,t,n,s){a("/user/search",{method:"POST",handle:!0,body:{keyword:e,num:t,pg:n}}).then(d=>{s.value=[];for(const o of d.movies){let r={id:o.id,name:o.name,description:o.description,duration:o.duration,director:o.director};s.value.push(r)}})}function b(){return a("/user/source/all",{method:"GET",handle:!0,body:{}}).then(e=>{c.value=[];for(const t of e){let n={id:t.id,name:t.name,getting:t.get,complete:t.ok,url:t.url,create:!1};c.value.push(n)}})}function p(){return a("/user/category/all",{method:"GET",handle:!0,body:{}}).then(e=>{l.value=[];for(const t of e){let n={id:t.id,name:t.name,classNum:t.classNum,movieNum:t.movieNum,create:!1};l.value.push(n)}})}function M(e){return a("/user/del",{method:"POST",handle:!1,body:{id:e}})}function A(e){return a("/user/category/del",{method:"POST",handle:!1,body:{id:e}})}function L(e){return a("/user/source/del",{method:"POST",handle:!1,body:{id:e}})}function U(e){return a("/user/category/add",{method:"POST",handle:!1,body:{name:e}})}function D(e,t){return a("/user/source/add",{method:"POST",handle:!1,body:{name:e,url:t}})}function x(e,t){let n=t?"/user/stop/"+e:"/user/start/"+e;return a(n,{method:"GET",handle:!1,body:{}})}function I(e){return a("/user/updateAccount",{method:"POST",handle:!1,body:{account:e}})}function _(e){return a("/user/updatePassword",{method:"POST",handle:!1,body:{password:e}})}export{D as C,L as D,b as G,x as H,B as L,I as U,p as a,U as b,A as c,G as d,M as e,N as f,j as g,_ as h,k as i};
