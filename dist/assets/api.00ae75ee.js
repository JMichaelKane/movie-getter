import{bv as f}from"./index.fcb4a06d.js";import{l as v}from"./index.80337ce4.js";import{b as T}from"./base.12718b58.js";import{L as h,m as O,s as c,a as w,c as l,b as P}from"./data.4c87e88c.js";const S=5e3;function o(e,t){t=Object.assign({method:"GET",headers:{"Content-type":"application/x-www-form-urlencoded"},credentials:"include",mode:"cors",cache:"no-cache"},t);const{method:s,handle:i,body:a}=t;if(s==="GET"&&a.constructor===Object){const n=[];Object.keys(a).forEach(u=>n.push(u+"="+encodeURIComponent(a[u]))),e.search(/\?/)===-1?e+="?"+n.join("&"):e+="&"+n.join("&"),delete t.body}else s==="POST"&&a.constructor===Object&&(t.body=v.stringify(a));return Promise.race([new Promise((n,u)=>{setTimeout(()=>{u(new Error("request timeout"))},S)}),new Promise((n,u)=>{fetch(T+e,t).then(async d=>{if(!/^(2|3)\d{2}$/.test(String(d.status))){switch(d.status){case 401:window.$notification.warning({duration:2e3,content:"\u8B66\u544A",meta:"\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55\uFF01"}),f.push({name:"login"});break;case 403:console.log("\u767B\u5F55\u9519\u8BEF");break}return Promise.reject(d)}if(i){const g=d.json();n(g)}else n(d.text())}).catch(d=>{u(d)})})])}function B(){h.value||m().then(()=>{b(),p(),y()})}function N(e,t){o("/user/login",{method:"POST",handle:!1,body:{account:e,password:t}}).then(async()=>{await m(),await b(),await p(),await y(),h.value=!0,f.push({name:"panel"})})}function D(){return o("/user/logout",{method:"GET",handle:!1,body:{}})}function m(){return o("/user/count",{method:"GET",handle:!1,body:{}}).then(e=>{O.value=Number(e)})}function y(){return G(20,1,P)}function G(e,t,r,s){return o("/user/list",{method:"POST",handle:!0,body:{num:e,pg:t}}).then(i=>{r.value=[];for(const a of i.movies){let n={id:a.id,name:a.name,description:a.description,duration:a.duration,director:a.director};r.value.push(n)}typeof s!="undefined"&&(s.value=i.pgCount)})}function M(e,t,r,s,i){o("/user/search",{method:"POST",handle:!0,body:{keyword:e,num:t,pg:r}}).then(a=>{s.value=[];for(const n of a.movies){let u={id:n.id,name:n.name,description:n.description,duration:n.duration,director:n.director};s.value.push(u)}typeof i!="undefined"&&(i.value=a.pgCount)})}function b(){return o("/user/source/all",{method:"GET",handle:!0,body:{}}).then(e=>{c.value=[];for(const t of e){let r={id:t.id,name:t.name,getting:t.get,complete:t.ok,url:t.url,create:!1};c.value.push(r),E(t.id)}})}function p(){return o("/user/category/all",{method:"GET",handle:!0,body:{}}).then(e=>{if(l.value=[],e)for(const t of e){let r={id:t.id,name:t.name,classNum:t.classNum,movieNum:t.movieNum,create:!1};l.value.push(r)}})}function A(e){return o("/user/del",{method:"POST",handle:!1,body:{id:e}})}function L(e){return o("/user/category/del",{method:"POST",handle:!1,body:{id:e}})}function U(e){return o("/user/source/del",{method:"POST",handle:!1,body:{id:e}})}function _(e){return o("/user/category/add",{method:"POST",handle:!1,body:{name:e}})}function x(e,t){return o("/user/source/add",{method:"POST",handle:!1,body:{name:e,url:t}})}function I(e,t){let r=t?"/user/stop/"+e:"/user/start/"+e;return o(r,{method:"GET",handle:!1,body:{}})}function H(e){return o("/user/updateAccount",{method:"POST",handle:!1,body:{account:e}})}function $(e){return o("/user/updatePassword",{method:"POST",handle:!1,body:{password:e}})}function E(e){return o("/user/source/all_class/"+String(e),{method:"GET",handle:!0,body:{}}).then(t=>{w.set(e,t)})}export{x as C,U as D,b as G,I as H,D as L,H as U,p as a,_ as b,L as c,A as d,G as e,M as f,B as g,$ as h,N as i};
