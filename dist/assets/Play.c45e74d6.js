import{f as pt,V as Qe,W as et,$ as nt,_ as ht,X as it,b7 as at,a0 as Et,a6 as Lt,r as vt,v as At,bs as Dt,br as Ot,o as Rt,K as mt,b9 as It,Z as Ct,a4 as Pt,b8 as Mt,a2 as kt}from"./index.095942f3.js";import{d as wt,c as _t,a as xt,b as Bt,_ as Ft}from"./base.358617d7.js";import"./get-slot.40f09d44.js";const Ut=pt({__name:"PlayMsg",props:["name","director","actor","description"],setup(Pe){const Le=Pe;return(N,P)=>{const h=Lt;return Qe(),et("div",null,[nt(h,{title:Le.name,size:"medium"},{default:ht(()=>[it("div",null,"\u5BFC\u6F14\uFF1A"+at(Le.director),1),it("div",null,"\u4E3B\u6F14\uFF1A"+at(Le.actor),1),it("div",null,"\u7B80\u4ECB\uFF1A"+at(Et(wt)(Le.description)),1)]),_:1},8,["title"])])}}});var Tt={exports:{}};(function(Pe,Le){typeof window!="undefined"&&function(P,h){Pe.exports=h()}(_t,function(){return function(N){var P={};function h(O){if(P[O])return P[O].exports;var T=P[O]={i:O,l:!1,exports:{}};return N[O].call(T.exports,T,T.exports,h),T.l=!0,T.exports}return h.m=N,h.c=P,h.d=function(O,T,i){h.o(O,T)||Object.defineProperty(O,T,{enumerable:!0,get:i})},h.r=function(O){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})},h.t=function(O,T){if(T&1&&(O=h(O)),T&8||T&4&&typeof O=="object"&&O&&O.__esModule)return O;var i=Object.create(null);if(h.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:O}),T&2&&typeof O!="string")for(var C in O)h.d(i,C,function(R){return O[R]}.bind(null,C));return i},h.n=function(O){var T=O&&O.__esModule?function(){return O.default}:function(){return O};return h.d(T,"a",T),T},h.o=function(O,T){return Object.prototype.hasOwnProperty.call(O,T)},h.p="/dist/",h(h.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(N,P,h){var O=Object.prototype.hasOwnProperty,T="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(T=!1));function C(c,m,y){this.fn=c,this.context=m,this.once=y||!1}function R(c,m,y,S,b){if(typeof y!="function")throw new TypeError("The listener must be a function");var p=new C(y,S||c,b),n=T?T+m:m;return c._events[n]?c._events[n].fn?c._events[n]=[c._events[n],p]:c._events[n].push(p):(c._events[n]=p,c._eventsCount++),c}function A(c,m){--c._eventsCount===0?c._events=new i:delete c._events[m]}function g(){this._events=new i,this._eventsCount=0}g.prototype.eventNames=function(){var m=[],y,S;if(this._eventsCount===0)return m;for(S in y=this._events)O.call(y,S)&&m.push(T?S.slice(1):S);return Object.getOwnPropertySymbols?m.concat(Object.getOwnPropertySymbols(y)):m},g.prototype.listeners=function(m){var y=T?T+m:m,S=this._events[y];if(!S)return[];if(S.fn)return[S.fn];for(var b=0,p=S.length,n=new Array(p);b<p;b++)n[b]=S[b].fn;return n},g.prototype.listenerCount=function(m){var y=T?T+m:m,S=this._events[y];return S?S.fn?1:S.length:0},g.prototype.emit=function(m,y,S,b,p,n){var e=T?T+m:m;if(!this._events[e])return!1;var r=this._events[e],t=arguments.length,l,s;if(r.fn){switch(r.once&&this.removeListener(m,r.fn,void 0,!0),t){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,y),!0;case 3:return r.fn.call(r.context,y,S),!0;case 4:return r.fn.call(r.context,y,S,b),!0;case 5:return r.fn.call(r.context,y,S,b,p),!0;case 6:return r.fn.call(r.context,y,S,b,p,n),!0}for(s=1,l=new Array(t-1);s<t;s++)l[s-1]=arguments[s];r.fn.apply(r.context,l)}else{var a=r.length,o;for(s=0;s<a;s++)switch(r[s].once&&this.removeListener(m,r[s].fn,void 0,!0),t){case 1:r[s].fn.call(r[s].context);break;case 2:r[s].fn.call(r[s].context,y);break;case 3:r[s].fn.call(r[s].context,y,S);break;case 4:r[s].fn.call(r[s].context,y,S,b);break;default:if(!l)for(o=1,l=new Array(t-1);o<t;o++)l[o-1]=arguments[o];r[s].fn.apply(r[s].context,l)}}return!0},g.prototype.on=function(m,y,S){return R(this,m,y,S,!1)},g.prototype.once=function(m,y,S){return R(this,m,y,S,!0)},g.prototype.removeListener=function(m,y,S,b){var p=T?T+m:m;if(!this._events[p])return this;if(!y)return A(this,p),this;var n=this._events[p];if(n.fn)n.fn===y&&(!b||n.once)&&(!S||n.context===S)&&A(this,p);else{for(var e=0,r=[],t=n.length;e<t;e++)(n[e].fn!==y||b&&!n[e].once||S&&n[e].context!==S)&&r.push(n[e]);r.length?this._events[p]=r.length===1?r[0]:r:A(this,p)}return this},g.prototype.removeAllListeners=function(m){var y;return m?(y=T?T+m:m,this._events[y]&&A(this,y)):(this._events=new i,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prefixed=T,g.EventEmitter=g,N.exports=g},"./node_modules/url-toolkit/src/url-toolkit.js":function(N,P,h){(function(O){var T=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,i=/^([^\/?#]*)([^]*)$/,C=/(?:\/|^)\.(?=\/)/g,R=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,A={buildAbsoluteURL:function(g,c,m){if(m=m||{},g=g.trim(),c=c.trim(),!c){if(!m.alwaysNormalize)return g;var y=A.parseURL(g);if(!y)throw new Error("Error trying to parse base URL.");return y.path=A.normalizePath(y.path),A.buildURLFromParts(y)}var S=A.parseURL(c);if(!S)throw new Error("Error trying to parse relative URL.");if(S.scheme)return m.alwaysNormalize?(S.path=A.normalizePath(S.path),A.buildURLFromParts(S)):c;var b=A.parseURL(g);if(!b)throw new Error("Error trying to parse base URL.");if(!b.netLoc&&b.path&&b.path[0]!=="/"){var p=i.exec(b.path);b.netLoc=p[1],b.path=p[2]}b.netLoc&&!b.path&&(b.path="/");var n={scheme:b.scheme,netLoc:S.netLoc,path:null,params:S.params,query:S.query,fragment:S.fragment};if(!S.netLoc&&(n.netLoc=b.netLoc,S.path[0]!=="/"))if(!S.path)n.path=b.path,S.params||(n.params=b.params,S.query||(n.query=b.query));else{var e=b.path,r=e.substring(0,e.lastIndexOf("/")+1)+S.path;n.path=A.normalizePath(r)}return n.path===null&&(n.path=m.alwaysNormalize?A.normalizePath(S.path):S.path),A.buildURLFromParts(n)},parseURL:function(g){var c=T.exec(g);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(g){for(g=g.split("").reverse().join("").replace(C,"");g.length!==(g=g.replace(R,"")).length;);return g.split("").reverse().join("")},buildURLFromParts:function(g){return g.scheme+g.netLoc+g.path+g.params+g.query+g.fragment}};N.exports=A})()},"./node_modules/webworkify-webpack/index.js":function(N,P,h){function O(m){var y={};function S(p){if(y[p])return y[p].exports;var n=y[p]={i:p,l:!1,exports:{}};return m[p].call(n.exports,n,n.exports,S),n.l=!0,n.exports}S.m=m,S.c=y,S.i=function(p){return p},S.d=function(p,n,e){S.o(p,n)||Object.defineProperty(p,n,{configurable:!1,enumerable:!0,get:e})},S.r=function(p){Object.defineProperty(p,"__esModule",{value:!0})},S.n=function(p){var n=p&&p.__esModule?function(){return p.default}:function(){return p};return S.d(n,"a",n),n},S.o=function(p,n){return Object.prototype.hasOwnProperty.call(p,n)},S.p="/",S.oe=function(p){throw console.error(p),p};var b=S(S.s=ENTRY_MODULE);return b.default||b}var T="[\\.|\\-|\\+|\\w|/|@]+",i="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+T+").*?\\)";function C(m){return(m+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function R(m){return!isNaN(1*m)}function A(m,y,S){var b={};b[S]=[];var p=y.toString(),n=p.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return b;for(var e=n[1],r=new RegExp("(\\\\n|\\W)"+C(e)+i,"g"),t;t=r.exec(p);)t[3]!=="dll-reference"&&b[S].push(t[3]);for(r=new RegExp("\\("+C(e)+'\\("(dll-reference\\s('+T+'))"\\)\\)'+i,"g");t=r.exec(p);)m[t[2]]||(b[S].push(t[1]),m[t[2]]=h(t[1]).m),b[t[2]]=b[t[2]]||[],b[t[2]].push(t[4]);for(var l=Object.keys(b),s=0;s<l.length;s++)for(var a=0;a<b[l[s]].length;a++)R(b[l[s]][a])&&(b[l[s]][a]=1*b[l[s]][a]);return b}function g(m){var y=Object.keys(m);return y.reduce(function(S,b){return S||m[b].length>0},!1)}function c(m,y){for(var S={main:[y]},b={main:[]},p={main:{}};g(S);)for(var n=Object.keys(S),e=0;e<n.length;e++){var r=n[e],t=S[r],l=t.pop();if(p[r]=p[r]||{},!(p[r][l]||!m[r][l])){p[r][l]=!0,b[r]=b[r]||[],b[r].push(l);for(var s=A(m,m[r][l],r),a=Object.keys(s),o=0;o<a.length;o++)S[a[o]]=S[a[o]]||[],S[a[o]]=S[a[o]].concat(s[a[o]])}}return b}N.exports=function(m,y){y=y||{};var S={main:h.m},b=y.all?{main:Object.keys(S.main)}:c(S,m),p="";Object.keys(b).filter(function(l){return l!=="main"}).forEach(function(l){for(var s=0;b[l][s];)s++;b[l].push(s),S[l][s]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",p=p+"var "+l+" = ("+O.toString().replace("ENTRY_MODULE",JSON.stringify(s))+")({"+b[l].map(function(a){return""+JSON.stringify(a)+": "+S[l][a].toString()}).join(",")+`});
`}),p=p+"new (("+O.toString().replace("ENTRY_MODULE",JSON.stringify(m))+")({"+b.main.map(function(l){return""+JSON.stringify(l)+": "+S.main[l].toString()}).join(",")+"}))(self);";var n=new window.Blob([p],{type:"text/javascript"});if(y.bare)return n;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,r=e.createObjectURL(n),t=new window.Worker(r);return t.objectURL=r,t}},"./src/config.ts":function(N,P,h){h.r(P),h.d(P,"hlsDefaultConfig",function(){return o}),h.d(P,"mergeConfig",function(){return x}),h.d(P,"enableStreamingMode",function(){return f});var O=h("./src/controller/abr-controller.ts"),T=h("./src/controller/audio-stream-controller.ts"),i=h("./src/controller/audio-track-controller.ts"),C=h("./src/controller/subtitle-stream-controller.ts"),R=h("./src/controller/subtitle-track-controller.ts"),A=h("./src/controller/buffer-controller.ts"),g=h("./src/controller/timeline-controller.ts"),c=h("./src/controller/cap-level-controller.ts"),m=h("./src/controller/fps-controller.ts"),y=h("./src/controller/eme-controller.ts"),S=h("./src/controller/cmcd-controller.ts"),b=h("./src/utils/xhr-loader.ts"),p=h("./src/utils/fetch-loader.ts"),n=h("./src/utils/cues.ts"),e=h("./src/utils/mediakeys-helper.ts"),r=h("./src/utils/logger.ts");function t(){return t=Object.assign||function(u){for(var d=1;d<arguments.length;d++){var v=arguments[d];for(var L in v)Object.prototype.hasOwnProperty.call(v,L)&&(u[L]=v[L])}return u},t.apply(this,arguments)}function l(u,d){var v=Object.keys(u);if(Object.getOwnPropertySymbols){var L=Object.getOwnPropertySymbols(u);d&&(L=L.filter(function(D){return Object.getOwnPropertyDescriptor(u,D).enumerable})),v.push.apply(v,L)}return v}function s(u){for(var d=1;d<arguments.length;d++){var v=arguments[d]!=null?arguments[d]:{};d%2?l(Object(v),!0).forEach(function(L){a(u,L,v[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(v)):l(Object(v)).forEach(function(L){Object.defineProperty(u,L,Object.getOwnPropertyDescriptor(v,L))})}return u}function a(u,d,v){return d in u?Object.defineProperty(u,d,{value:v,enumerable:!0,configurable:!0,writable:!0}):u[d]=v,u}var o=s(s({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:b.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:O.default,bufferController:A.default,capLevelController:c.default,fpsController:m.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},E()),{},{subtitleStreamController:C.SubtitleStreamController,subtitleTrackController:R.default,timelineController:g.TimelineController,audioStreamController:T.default,audioTrackController:i.default,emeController:y.default,cmcdController:S.default});function E(){return{cueHandler:n.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function x(u,d){if((d.liveSyncDurationCount||d.liveMaxLatencyDurationCount)&&(d.liveSyncDuration||d.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(d.liveMaxLatencyDurationCount!==void 0&&(d.liveSyncDurationCount===void 0||d.liveMaxLatencyDurationCount<=d.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(d.liveMaxLatencyDuration!==void 0&&(d.liveSyncDuration===void 0||d.liveMaxLatencyDuration<=d.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},u,d)}function f(u){var d=u.loader;if(d!==p.default&&d!==b.default)r.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),u.progressive=!1;else{var v=Object(p.fetchSupported)();v&&(u.loader=p.default,u.progressive=!0,u.enableSoftwareAES=!0,r.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(N,P,h){h.r(P);var O=h("./src/polyfills/number.ts"),T=h("./src/utils/ewma-bandwidth-estimator.ts"),i=h("./src/events.ts"),C=h("./src/utils/buffer-helper.ts"),R=h("./src/errors.ts"),A=h("./src/types/loader.ts"),g=h("./src/utils/logger.ts");function c(S,b){for(var p=0;p<b.length;p++){var n=b[p];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(S,n.key,n)}}function m(S,b,p){return b&&c(S.prototype,b),p&&c(S,p),S}var y=function(){function S(p){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=p;var n=p.config;this.bwEstimator=new T.default(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var b=S.prototype;return b.registerListeners=function(){var n=this.hls;n.on(i.Events.FRAG_LOADING,this.onFragLoading,this),n.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(i.Events.ERROR,this.onError,this)},b.unregisterListeners=function(){var n=this.hls;n.off(i.Events.FRAG_LOADING,this.onFragLoading,this),n.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(i.Events.ERROR,this.onError,this)},b.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},b.onFragLoading=function(n,e){var r=e.frag;if(r.type===A.PlaylistLevelType.MAIN&&!this.timer){var t;this.fragCurrent=r,this.partCurrent=(t=e.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)}},b.onLevelLoaded=function(n,e){var r=this.hls.config;e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},b._abandonRulesCheck=function(){var n=this.fragCurrent,e=this.partCurrent,r=this.hls,t=r.autoLevelEnabled,l=r.config,s=r.media;if(!(!n||!s)){var a=e?e.stats:n.stats,o=e?e.duration:n.duration;if(a.aborted){g.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!t||s.paused||!s.playbackRate||!s.readyState)){var E=performance.now()-a.loading.start,x=Math.abs(s.playbackRate);if(!(E<=500*o/x)){var f=r.levels,u=r.minAutoLevel,d=f[n.level],v=a.total||Math.max(a.loaded,Math.round(o*d.maxBitrate/8)),L=Math.max(1,a.bwEstimate?a.bwEstimate/8:a.loaded*1e3/E),D=(v-a.loaded)/L,I=s.currentTime,k=(C.BufferHelper.bufferInfo(s,I,l.maxBufferHole).end-I)/x;if(!(k>=2*o/x||D<=k)){var w=Number.POSITIVE_INFINITY,_;for(_=n.level-1;_>u;_--){var F=f[_].maxBitrate;if(w=o*F/(8*.8*L),w<k)break}if(!(w>=D)){var U=this.bwEstimator.getEstimate();g.logger.warn("Fragment "+n.sn+(e?" part "+e.index:"")+" of level "+n.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+_+`
      Current BW estimate: `+(Object(O.isFiniteNumber)(U)?(U/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+D.toFixed(3)+` s
      Estimated load time for the next fragment: `+w.toFixed(3)+` s
      Time to underbuffer: `+k.toFixed(3)+" s"),r.nextLoadLevel=_,this.bwEstimator.sample(E,a.loaded),this.clearTimer(),n.loader&&(this.fragCurrent=this.partCurrent=null,n.loader.abort()),r.trigger(i.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:e,stats:a})}}}}}},b.onFragLoaded=function(n,e){var r=e.frag,t=e.part;if(r.type===A.PlaylistLevelType.MAIN&&Object(O.isFiniteNumber)(r.sn)){var l=t?t.stats:r.stats,s=t?t.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[r.level],o=(a.loaded?a.loaded.bytes:0)+l.loaded,E=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:E},a.realBitrate=Math.round(8*o/E)}if(r.bitrateTest){var x={stats:l,frag:r,part:t,id:r.type};this.onFragBuffered(i.Events.FRAG_BUFFERED,x),r.bitrateTest=!1}}},b.onFragBuffered=function(n,e){var r=e.frag,t=e.part,l=t?t.stats:r.stats;if(!l.aborted&&!(r.type!==A.PlaylistLevelType.MAIN||r.sn==="initSegment")){var s=l.parsing.end-l.loading.start;this.bwEstimator.sample(s,l.loaded),l.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},b.onError=function(n,e){switch(e.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},b.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},b.getNextABRAutoLevel=function(){var n=this.fragCurrent,e=this.partCurrent,r=this.hls,t=r.maxAutoLevel,l=r.config,s=r.minAutoLevel,a=r.media,o=e?e.duration:n?n.duration:0,E=a?a.currentTime:0,x=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,f=this.bwEstimator?this.bwEstimator.getEstimate():l.abrEwmaDefaultEstimate,u=(C.BufferHelper.bufferInfo(a,E,l.maxBufferHole).end-E)/x,d=this.findBestLevel(f,s,t,u,l.abrBandWidthFactor,l.abrBandWidthUpFactor);if(d>=0)return d;g.logger.trace((u?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=o?Math.min(o,l.maxStarvationDelay):l.maxStarvationDelay,L=l.abrBandWidthFactor,D=l.abrBandWidthUpFactor;if(!u){var I=this.bitrateTestDelay;if(I){var k=o?Math.min(o,l.maxLoadingDelay):l.maxLoadingDelay;v=k-I,g.logger.trace("bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),L=D=1}}return d=this.findBestLevel(f,s,t,u+v,L,D),Math.max(d,0)},b.findBestLevel=function(n,e,r,t,l,s){for(var a,o=this.fragCurrent,E=this.partCurrent,x=this.lastLoadedFragLevel,f=this.hls.levels,u=f[x],d=!!(u!=null&&(a=u.details)!==null&&a!==void 0&&a.live),v=u==null?void 0:u.codecSet,L=E?E.duration:o?o.duration:0,D=r;D>=e;D--){var I=f[D];if(!(!I||v&&I.codecSet!==v)){var k=I.details,w=(E?k==null?void 0:k.partTarget:k==null?void 0:k.averagetargetduration)||L,_=void 0;D<=x?_=l*n:_=s*n;var F=f[D].maxBitrate,U=F*w/_;if(g.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+D+"/"+Math.round(_)+"/"+F+"/"+w+"/"+t+"/"+U),_>F&&(!U||d&&!this.bitrateTestDelay||U<t))return D}}return-1},m(S,[{key:"nextAutoLevel",get:function(){var n=this._nextAutoLevel,e=this.bwEstimator;if(n!==-1&&(!e||!e.canEstimate()))return n;var r=this.getNextABRAutoLevel();return n!==-1&&(r=Math.min(n,r)),r},set:function(n){this._nextAutoLevel=n}}]),S}();P.default=y},"./src/controller/audio-stream-controller.ts":function(N,P,h){h.r(P);var O=h("./src/polyfills/number.ts"),T=h("./src/controller/base-stream-controller.ts"),i=h("./src/events.ts"),C=h("./src/utils/buffer-helper.ts"),R=h("./src/controller/fragment-tracker.ts"),A=h("./src/types/level.ts"),g=h("./src/types/loader.ts"),c=h("./src/loader/fragment.ts"),m=h("./src/demux/chunk-cache.ts"),y=h("./src/demux/transmuxer-interface.ts"),S=h("./src/types/transmuxer.ts"),b=h("./src/controller/fragment-finders.ts"),p=h("./src/utils/discontinuities.ts"),n=h("./src/errors.ts"),e=h("./src/utils/logger.ts");function r(){return r=Object.assign||function(o){for(var E=1;E<arguments.length;E++){var x=arguments[E];for(var f in x)Object.prototype.hasOwnProperty.call(x,f)&&(o[f]=x[f])}return o},r.apply(this,arguments)}function t(o,E){o.prototype=Object.create(E.prototype),o.prototype.constructor=o,l(o,E)}function l(o,E){return l=Object.setPrototypeOf||function(f,u){return f.__proto__=u,f},l(o,E)}var s=100,a=function(o){t(E,o);function E(f,u){var d;return d=o.call(this,f,u,"[audio-stream-controller]")||this,d.videoBuffer=null,d.videoTrackCC=-1,d.waitingVideoCC=-1,d.audioSwitch=!1,d.trackId=-1,d.waitingData=null,d.mainDetails=null,d.bufferFlushed=!1,d._registerListeners(),d}var x=E.prototype;return x.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},x._registerListeners=function(){var u=this.hls;u.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(i.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),u.on(i.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(i.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.on(i.Events.ERROR,this.onError,this),u.on(i.Events.BUFFER_RESET,this.onBufferReset,this),u.on(i.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(i.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.on(i.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x._unregisterListeners=function(){var u=this.hls;u.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(i.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),u.off(i.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(i.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.off(i.Events.ERROR,this.onError,this),u.off(i.Events.BUFFER_RESET,this.onBufferReset,this),u.off(i.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(i.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.off(i.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x.onInitPtsFound=function(u,d){var v=d.frag,L=d.id,D=d.initPTS;if(L==="main"){var I=v.cc;this.initPTS[v.cc]=D,this.log("InitPTS for cc: "+I+" found from main: "+D),this.videoTrackCC=I,this.state===T.State.WAITING_INIT_PTS&&this.tick()}},x.startLoad=function(u){if(!this.levels){this.startPosition=u,this.state=T.State.STOPPED;return}var d=this.lastCurrentTime;this.stopLoad(),this.setInterval(s),this.fragLoadError=0,d>0&&u===-1?(this.log("Override startPosition with lastCurrentTime @"+d.toFixed(3)),this.state=T.State.IDLE):(this.loadedmetadata=!1,this.state=T.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()},x.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_TRACK:{var u,d=this.levels,v=this.trackId,L=d==null||(u=d[v])===null||u===void 0?void 0:u.details;if(L){if(this.waitForCdnTuneIn(L))break;this.state=T.State.WAITING_INIT_PTS}break}case T.State.FRAG_LOADING_WAITING_RETRY:{var D,I=performance.now(),k=this.retryDate;(!k||I>=k||(D=this.media)!==null&&D!==void 0&&D.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=T.State.IDLE);break}case T.State.WAITING_INIT_PTS:{var w=this.waitingData;if(w){var _=w.frag,F=w.part,U=w.cache,W=w.complete;if(this.initPTS[_.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.FRAG_LOADING;var V=U.flush(),X={frag:_,part:F,payload:V,networkDetails:null};this._handleFragmentLoadProgress(X),W&&o.prototype._handleFragmentLoadComplete.call(this,X)}else if(this.videoTrackCC!==this.waitingVideoCC)e.logger.log("Waiting fragment cc ("+_.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Y=this.getLoadPosition(),J=C.BufferHelper.bufferInfo(this.mediaBuffer,Y,this.config.maxBufferHole),q=Object(b.fragmentWithinToleranceTest)(J.end,this.config.maxFragLookUpTolerance,_);q<0&&(e.logger.log("Waiting fragment cc ("+_.cc+") @ "+_.start+" cancelled because another fragment at "+J.end+" is needed"),this.clearWaitingFragment())}}else this.state=T.State.IDLE}}this.onTickEnd()},x.clearWaitingFragment=function(){var u=this.waitingData;u&&(this.fragmentTracker.removeFragment(u.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.IDLE)},x.onTickEnd=function(){var u=this.media;if(!(!u||!u.readyState)){var d=this.mediaBuffer?this.mediaBuffer:u,v=d.buffered;!this.loadedmetadata&&v.length&&(this.loadedmetadata=!0),this.lastCurrentTime=u.currentTime}},x.doTickIdle=function(){var u,d,v=this.hls,L=this.levels,D=this.media,I=this.trackId,k=v.config;if(!(!L||!L[I])&&!(!D&&(this.startFragRequested||!k.startFragPrefetch))){var w=L[I],_=w.details;if(!_||_.live&&this.levelLastLoaded!==I||this.waitForCdnTuneIn(_)){this.state=T.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,c.ElementaryStreamTypes.AUDIO,g.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,g.PlaylistLevelType.AUDIO);if(F!==null){var U=F.len,W=this.getMaxBufferLength(),V=this.audioSwitch;if(!(U>=W&&!V)){if(!V&&this._streamEnded(F,_)){v.trigger(i.Events.BUFFER_EOS,{type:"audio"}),this.state=T.State.ENDED;return}var X=_.fragments,Y=X[0].start,J=F.end;if(V){var q=this.getLoadPosition();J=q,_.PTSKnown&&q<Y&&(F.end>Y||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),D.currentTime=Y+.05)}var $=this.getNextFragment(J,_);if(!$){this.bufferFlushed=!0;return}((u=$.decryptdata)===null||u===void 0?void 0:u.keyFormat)==="identity"&&!((d=$.decryptdata)!==null&&d!==void 0&&d.key)?this.loadKey($,_):this.loadFragment($,_,J)}}}},x.getMaxBufferLength=function(){var u=o.prototype.getMaxBufferLength.call(this),d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,g.PlaylistLevelType.MAIN);return d===null?u:Math.max(u,d.len)},x.onMediaDetaching=function(){this.videoBuffer=null,o.prototype.onMediaDetaching.call(this)},x.onAudioTracksUpdated=function(u,d){var v=d.audioTracks;this.resetTransmuxer(),this.levels=v.map(function(L){return new A.Level(L)})},x.onAudioTrackSwitching=function(u,d){var v=!!d.url;this.trackId=d.id;var L=this.fragCurrent;L!=null&&L.loader&&L.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),v?this.setInterval(s):this.resetTransmuxer(),v?(this.audioSwitch=!0,this.state=T.State.IDLE):this.state=T.State.STOPPED,this.tick()},x.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},x.onLevelLoaded=function(u,d){this.mainDetails=d.details},x.onAudioTrackLoaded=function(u,d){var v,L=this.levels,D=d.details,I=d.id;if(!L){this.warn("Audio tracks were reset while loading level "+I);return}this.log("Track "+I+" loaded ["+D.startSN+","+D.endSN+"],duration:"+D.totalduration);var k=L[I],w=0;if(D.live||(v=k.details)!==null&&v!==void 0&&v.live){var _=this.mainDetails;if(D.fragments[0]||(D.deltaUpdateFailed=!0),D.deltaUpdateFailed||!_)return;!k.details&&D.hasProgramDateTime&&_.hasProgramDateTime?(Object(p.alignMediaPlaylistByPDT)(D,_),w=D.fragments[0].start):w=this.alignPlaylists(D,k.details)}k.details=D,this.levelLastLoaded=I,!this.startFragRequested&&(this.mainDetails||!D.live)&&this.setStartPosition(k.details,w),this.state===T.State.WAITING_TRACK&&!this.waitForCdnTuneIn(D)&&(this.state=T.State.IDLE),this.tick()},x._handleFragmentLoadProgress=function(u){var d,v=u.frag,L=u.part,D=u.payload,I=this.config,k=this.trackId,w=this.levels;if(!w){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+v.sn+" of level "+v.level+" will not be buffered");return}var _=w[k];console.assert(_,"Audio track is defined on fragment load progress");var F=_.details;console.assert(F,"Audio track details are defined on fragment load progress");var U=I.defaultAudioCodec||_.audioCodec||"mp4a.40.2",W=this.transmuxer;W||(W=this.transmuxer=new y.default(this.hls,g.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var V=this.initPTS[v.cc],X=(d=v.initSegment)===null||d===void 0?void 0:d.data;if(V!==void 0){var Y=!1,J=L?L.index:-1,q=J!==-1,$=new S.ChunkMetadata(v.level,v.sn,v.stats.chunkCount,D.byteLength,J,q);W.push(D,X,U,"",v,L,F.totalduration,Y,$,V)}else{e.logger.log("Unknown video PTS for cc "+v.cc+", waiting for video PTS before demuxing audio frag "+v.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+k);var ne=this.waitingData=this.waitingData||{frag:v,part:L,cache:new m.default,complete:!1},ee=ne.cache;ee.push(new Uint8Array(D)),this.waitingVideoCC=this.videoTrackCC,this.state=T.State.WAITING_INIT_PTS}},x._handleFragmentLoadComplete=function(u){if(this.waitingData){this.waitingData.complete=!0;return}o.prototype._handleFragmentLoadComplete.call(this,u)},x.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},x.onBufferCreated=function(u,d){var v=d.tracks.audio;v&&(this.mediaBuffer=v.buffer),d.tracks.video&&(this.videoBuffer=d.tracks.video.buffer)},x.onFragBuffered=function(u,d){var v=d.frag,L=d.part;if(v.type===g.PlaylistLevelType.AUDIO){if(this.fragContextChanged(v)){this.warn("Fragment "+v.sn+(L?" p: "+L.index:"")+" of level "+v.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}v.sn!=="initSegment"&&(this.fragPrevious=v,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(i.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(v,L)}},x.onError=function(u,d){switch(d.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(g.PlaylistLevelType.AUDIO,d);break;case n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case n.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==T.State.ERROR&&this.state!==T.State.STOPPED&&(this.state=d.fatal?T.State.ERROR:T.State.IDLE,this.warn(d.details+" while loading frag, switching to "+this.state+" state"));break;case n.ErrorDetails.BUFFER_FULL_ERROR:if(d.parent==="audio"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var v=!0,L=this.getFwdBufferInfo(this.mediaBuffer,g.PlaylistLevelType.AUDIO);L&&L.len>.5&&(v=!this.reduceMaxBufferLength(L.len)),v&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},x.onBufferFlushed=function(u,d){var v=d.type;v===c.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},x._handleTransmuxComplete=function(u){var d,v="audio",L=this.hls,D=u.remuxResult,I=u.chunkMeta,k=this.getCurrentContext(I);if(!k){this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(I.level);return}var w=k.frag,_=k.part,F=D.audio,U=D.text,W=D.id3,V=D.initSegment;if(!this.fragContextChanged(w)){if(this.state=T.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),V!=null&&V.tracks&&(this._bufferInitSegment(V.tracks,w,I),L.trigger(i.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:v,tracks:V.tracks})),F){var X=F.startPTS,Y=F.endPTS,J=F.startDTS,q=F.endDTS;_&&(_.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:X,endPTS:Y,startDTS:J,endDTS:q}),w.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,X,Y,J,q),this.bufferFragmentData(F,w,_,I)}if(W!=null&&(d=W.samples)!==null&&d!==void 0&&d.length){var $=r({frag:w,id:v},W);L.trigger(i.Events.FRAG_PARSING_METADATA,$)}if(U){var ne=r({frag:w,id:v},U);L.trigger(i.Events.FRAG_PARSING_USERDATA,ne)}}},x._bufferInitSegment=function(u,d,v){if(this.state===T.State.PARSING){u.video&&delete u.video;var L=u.audio;if(!!L){L.levelCodec=L.codec,L.id="audio",this.log("Init audio buffer, container:"+L.container+", codecs[parsed]=["+L.codec+"]"),this.hls.trigger(i.Events.BUFFER_CODECS,u);var D=L.initSegment;if(D!=null&&D.byteLength){var I={type:"audio",frag:d,part:null,chunkMeta:v,parent:d.type,data:D};this.hls.trigger(i.Events.BUFFER_APPENDING,I)}this.tick()}}},x.loadFragment=function(u,d,v){var L=this.fragmentTracker.getState(u);this.fragCurrent=u,(this.audioSwitch||L===R.FragmentState.NOT_LOADED||L===R.FragmentState.PARTIAL)&&(u.sn==="initSegment"?this._loadInitSegment(u):d.live&&!Object(O.isFiniteNumber)(this.initPTS[u.cc])?(this.log("Waiting for video PTS in continuity counter "+u.cc+" of live stream before loading audio fragment "+u.sn+" of level "+this.trackId),this.state=T.State.WAITING_INIT_PTS):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,u,d,v)))},x.completeAudioSwitch=function(){var u=this.hls,d=this.media,v=this.trackId;d&&(this.log("Switching audio track : flushing all audio"),o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,u.trigger(i.Events.AUDIO_TRACK_SWITCHED,{id:v})},E}(T.default);P.default=a},"./src/controller/audio-track-controller.ts":function(N,P,h){h.r(P);var O=h("./src/events.ts"),T=h("./src/errors.ts"),i=h("./src/controller/base-playlist-controller.ts"),C=h("./src/types/loader.ts");function R(y,S){for(var b=0;b<S.length;b++){var p=S[b];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}function A(y,S,b){return S&&R(y.prototype,S),b&&R(y,b),y}function g(y,S){y.prototype=Object.create(S.prototype),y.prototype.constructor=y,c(y,S)}function c(y,S){return c=Object.setPrototypeOf||function(p,n){return p.__proto__=n,p},c(y,S)}var m=function(y){g(S,y);function S(p){var n;return n=y.call(this,p,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var b=S.prototype;return b.registerListeners=function(){var n=this.hls;n.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(O.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(O.Events.ERROR,this.onError,this)},b.unregisterListeners=function(){var n=this.hls;n.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(O.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(O.Events.ERROR,this.onError,this)},b.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,y.prototype.destroy.call(this)},b.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},b.onManifestParsed=function(n,e){this.tracks=e.audioTracks||[]},b.onAudioTrackLoaded=function(n,e){var r=e.id,t=e.details,l=this.tracksInGroup[r];if(!l){this.warn("Invalid audio track id "+r);return}var s=l.details;l.details=e.details,this.log("audioTrack "+r+" loaded ["+t.startSN+"-"+t.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,s))},b.onLevelLoading=function(n,e){this.switchLevel(e.level)},b.onLevelSwitching=function(n,e){this.switchLevel(e.level)},b.switchLevel=function(n){var e=this.hls.levels[n];if(!!(e!=null&&e.audioGroupIds)){var r=e.audioGroupIds[e.urlId];if(this.groupId!==r){this.groupId=r;var t=this.tracks.filter(function(s){return!r||s.groupId===r});this.selectDefaultTrack&&!t.some(function(s){return s.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=t;var l={audioTracks:t};this.log("Updating audio tracks, "+t.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(O.Events.AUDIO_TRACKS_UPDATED,l),this.selectInitialTrack()}}},b.onError=function(n,e){y.prototype.onError.call(this,n,e),!(e.fatal||!e.context)&&e.context.type===C.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},b.setAudioTrack=function(n){var e=this.tracksInGroup;if(n<0||n>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var r=e[this.trackId];this.log("Now switching to audio-track index "+n);var t=e[n],l=t.id,s=t.groupId,a=s===void 0?"":s,o=t.name,E=t.type,x=t.url;if(this.trackId=n,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(O.Events.AUDIO_TRACK_SWITCHING,{id:l,groupId:a,name:o,type:E,url:x}),!(t.details&&!t.details.live)){var f=this.switchParams(t.url,r==null?void 0:r.details);this.loadPlaylist(f)}},b.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,r=this.findTrackId(e)||this.findTrackId();r!==-1?this.setAudioTrack(r):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},b.findTrackId=function(n){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var t=e[r];if((!this.selectDefaultTrack||t.default)&&(!n||n===t.name))return t.id}return-1},b.loadPlaylist=function(n){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,t=e.groupId,l=e.url;if(n)try{l=n.addDirectives(l)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(O.Events.AUDIO_TRACK_LOADING,{url:l,id:r,groupId:t,deliveryDirectives:n||null})}},A(S,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),S}(i.default);P.default=m},"./src/controller/base-playlist-controller.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return A});var O=h("./src/polyfills/number.ts"),T=h("./src/types/level.ts"),i=h("./src/controller/level-helper.ts"),C=h("./src/utils/logger.ts"),R=h("./src/errors.ts"),A=function(){function g(m,y){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=C.logger.log.bind(C.logger,y+":"),this.warn=C.logger.warn.bind(C.logger,y+":"),this.hls=m}var c=g.prototype;return c.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},c.onError=function(y,S){S.fatal&&S.type===R.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},c.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},c.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},c.stopLoad=function(){this.canLoad=!1,this.clearTimer()},c.switchParams=function(y,S){var b=S==null?void 0:S.renditionReports;if(b)for(var p=0;p<b.length;p++){var n=b[p],e=""+n.URI;if(e===y.substr(-e.length)){var r=parseInt(n["LAST-MSN"]),t=parseInt(n["LAST-PART"]);if(S&&this.hls.config.lowLatencyMode){var l=Math.min(S.age-S.partTarget,S.targetduration);t!==void 0&&l>S.partTarget&&(t+=1)}if(Object(O.isFiniteNumber)(r))return new T.HlsUrlParameters(r,Object(O.isFiniteNumber)(t)?t:void 0,T.HlsSkip.No)}}},c.loadPlaylist=function(y){},c.shouldLoadTrack=function(y){return this.canLoad&&y&&!!y.url&&(!y.details||y.details.live)},c.playlistLoaded=function(y,S,b){var p=this,n=S.details,e=S.stats,r=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(n.advancedDateTime=Date.now()-r,n.live||b!=null&&b.live){if(n.reloaded(b),b&&this.log("live playlist "+y+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),b&&n.fragments.length>0&&Object(i.mergeDetails)(b,n),!this.canLoad||!n.live)return;var t,l=void 0,s=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var a=this.hls.config.lowLatencyMode,o=n.lastPartSn,E=n.endSN,x=n.lastPartIndex,f=x!==-1,u=o===E,d=a?0:x;f?(l=u?E+1:o,s=u?d:x+1):l=E+1;var v=n.age,L=v+n.ageHeader,D=Math.min(L-n.partTarget,n.targetduration*1.5);if(D>0){if(b&&D>b.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+b.tuneInGoal+" to: "+D+" with playlist age: "+n.age),D=0;else{var I=Math.floor(D/n.targetduration);if(l+=I,s!==void 0){var k=Math.round(D%n.targetduration/n.partTarget);s+=k}this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+v.toFixed(2)+"s goal: "+D+" skip sn "+I+" to part "+s)}n.tuneInGoal=D}if(t=this.getDeliveryDirectives(n,S.deliveryDirectives,l,s),a||!u){this.loadPlaylist(t);return}}else t=this.getDeliveryDirectives(n,S.deliveryDirectives,l,s);var w=Object(i.computeReloadInterval)(n,e);l!==void 0&&n.canBlockReload&&(w-=n.partTarget||1),this.log("reload live playlist "+y+" in "+Math.round(w)+" ms"),this.timer=self.setTimeout(function(){return p.loadPlaylist(t)},w)}else this.clearTimer()},c.getDeliveryDirectives=function(y,S,b,p){var n=Object(T.getSkipValue)(y,b);return S!=null&&S.skip&&y.deltaUpdateFailed&&(b=S.msn,p=S.part,n=T.HlsSkip.No),new T.HlsUrlParameters(b,p,n)},c.retryLoadingOrFail=function(y){var S=this,b=this.hls.config,p=this.retryCount<b.levelLoadingMaxRetry;if(p){var n;if(this.retryCount++,y.details.indexOf("LoadTimeOut")>-1&&(n=y.context)!==null&&n!==void 0&&n.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+y.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*b.levelLoadingRetryDelay,b.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return S.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+y.details+'"')}}else this.warn('cannot recover from error "'+y.details+'"'),this.clearTimer(),y.fatal=!0;return p},g}()},"./src/controller/base-stream-controller.ts":function(N,P,h){h.r(P),h.d(P,"State",function(){return E}),h.d(P,"default",function(){return x});var O=h("./src/polyfills/number.ts"),T=h("./src/task-loop.ts"),i=h("./src/controller/fragment-tracker.ts"),C=h("./src/utils/buffer-helper.ts"),R=h("./src/utils/logger.ts"),A=h("./src/events.ts"),g=h("./src/errors.ts"),c=h("./src/types/transmuxer.ts"),m=h("./src/utils/mp4-tools.ts"),y=h("./src/utils/discontinuities.ts"),S=h("./src/controller/fragment-finders.ts"),b=h("./src/controller/level-helper.ts"),p=h("./src/loader/fragment-loader.ts"),n=h("./src/crypt/decrypter.ts"),e=h("./src/utils/time-ranges.ts"),r=h("./src/types/loader.ts");function t(f,u){for(var d=0;d<u.length;d++){var v=u[d];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}function l(f,u,d){return u&&t(f.prototype,u),d&&t(f,d),f}function s(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function a(f,u){f.prototype=Object.create(u.prototype),f.prototype.constructor=f,o(f,u)}function o(f,u){return o=Object.setPrototypeOf||function(v,L){return v.__proto__=L,v},o(f,u)}var E={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},x=function(f){a(u,f);function u(v,L,D){var I;return I=f.call(this)||this,I.hls=void 0,I.fragPrevious=null,I.fragCurrent=null,I.fragmentTracker=void 0,I.transmuxer=null,I._state=E.STOPPED,I.media=void 0,I.mediaBuffer=void 0,I.config=void 0,I.bitrateTest=!1,I.lastCurrentTime=0,I.nextLoadPosition=0,I.startPosition=0,I.loadedmetadata=!1,I.fragLoadError=0,I.retryDate=0,I.levels=null,I.fragmentLoader=void 0,I.levelLastLoaded=null,I.startFragRequested=!1,I.decrypter=void 0,I.initPTS=[],I.onvseeking=null,I.onvended=null,I.logPrefix="",I.log=void 0,I.warn=void 0,I.logPrefix=D,I.log=R.logger.log.bind(R.logger,D+":"),I.warn=R.logger.warn.bind(R.logger,D+":"),I.hls=v,I.fragmentLoader=new p.default(v.config),I.fragmentTracker=L,I.config=v.config,I.decrypter=new n.default(v,v.config),v.on(A.Events.KEY_LOADED,I.onKeyLoaded,s(I)),I}var d=u.prototype;return d.doTick=function(){this.onTickEnd()},d.onTickEnd=function(){},d.startLoad=function(L){},d.stopLoad=function(){this.fragmentLoader.abort();var L=this.fragCurrent;L&&this.fragmentTracker.removeFragment(L),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=E.STOPPED},d._streamEnded=function(L,D){var I=this.fragCurrent,k=this.fragmentTracker;if(!D.live&&I&&I.sn>=D.endSN&&!L.nextStart){var w=D.partList;if(w!=null&&w.length){var _=w[w.length-1],F=C.BufferHelper.isBuffered(this.media,_.start+_.duration/2);return F}var U=k.getState(I);return U===i.FragmentState.PARTIAL||U===i.FragmentState.OK}return!1},d.onMediaAttached=function(L,D){var I=this.media=this.mediaBuffer=D.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var k=this.config;this.levels&&k.autoStartLoad&&this.state===E.STOPPED&&this.startLoad(k.startPosition)},d.onMediaDetaching=function(){var L=this.media;L!=null&&L.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),L&&(L.removeEventListener("seeking",this.onvseeking),L.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},d.onMediaSeeking=function(){var L=this.config,D=this.fragCurrent,I=this.media,k=this.mediaBuffer,w=this.state,_=I?I.currentTime:0,F=C.BufferHelper.bufferInfo(k||I,_,L.maxBufferHole);if(this.log("media seeking to "+(Object(O.isFiniteNumber)(_)?_.toFixed(3):_)+", state: "+w),w===E.ENDED)this.resetLoadingState();else if(D&&!F.len){var U=L.maxFragLookUpTolerance,W=D.start-U,V=D.start+D.duration+U,X=_>V;(_<W||X)&&(X&&D.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),D.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=_),!this.loadedmetadata&&!F.len&&(this.nextLoadPosition=this.startPosition=_),this.tickImmediate()},d.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},d.onKeyLoaded=function(L,D){if(!(this.state!==E.KEY_LOADING||D.frag!==this.fragCurrent||!this.levels)){this.state=E.IDLE;var I=this.levels[D.frag.level].details;I&&this.loadFragment(D.frag,I,D.frag.start)}},d.onHandlerDestroying=function(){this.stopLoad(),f.prototype.onHandlerDestroying.call(this)},d.onHandlerDestroyed=function(){this.state=E.STOPPED,this.hls.off(A.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,f.prototype.onHandlerDestroyed.call(this)},d.loadKey=function(L,D){this.log("Loading key for "+L.sn+" of ["+D.startSN+"-"+D.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level),this.state=E.KEY_LOADING,this.fragCurrent=L,this.hls.trigger(A.Events.KEY_LOADING,{frag:L})},d.loadFragment=function(L,D,I){this._loadFragForPlayback(L,D,I)},d._loadFragForPlayback=function(L,D,I){var k=this,w=function(F){if(k.fragContextChanged(L)){k.warn("Fragment "+L.sn+(F.part?" p: "+F.part.index:"")+" of level "+L.level+" was dropped during download."),k.fragmentTracker.removeFragment(L);return}L.stats.chunkCount++,k._handleFragmentLoadProgress(F)};this._doFragLoad(L,D,I,w).then(function(_){if(!!_){k.fragLoadError=0;var F=k.state;if(k.fragContextChanged(L)){(F===E.FRAG_LOADING||F===E.BACKTRACKING||!k.fragCurrent&&F===E.PARSING)&&(k.fragmentTracker.removeFragment(L),k.state=E.IDLE);return}if("payload"in _&&(k.log("Loaded fragment "+L.sn+" of level "+L.level),k.hls.trigger(A.Events.FRAG_LOADED,_),k.state===E.BACKTRACKING)){k.fragmentTracker.backtrack(L,_),k.resetFragmentLoading(L);return}k._handleFragmentLoadComplete(_)}}).catch(function(_){k.warn(_),k.resetFragmentLoading(L)})},d.flushMainBuffer=function(L,D,I){if(I===void 0&&(I=null),!!(L-D)){var k={startOffset:L,endOffset:D,type:I};this.fragLoadError=0,this.hls.trigger(A.Events.BUFFER_FLUSHING,k)}},d._loadInitSegment=function(L){var D=this;this._doFragLoad(L).then(function(I){if(!I||D.fragContextChanged(L)||!D.levels)throw new Error("init load aborted");return I}).then(function(I){var k=D.hls,w=I.payload,_=L.decryptdata;if(w&&w.byteLength>0&&_&&_.key&&_.iv&&_.method==="AES-128"){var F=self.performance.now();return D.decrypter.webCryptoDecrypt(new Uint8Array(w),_.key.buffer,_.iv.buffer).then(function(U){var W=self.performance.now();return k.trigger(A.Events.FRAG_DECRYPTED,{frag:L,payload:U,stats:{tstart:F,tdecrypt:W}}),I.payload=U,I})}return I}).then(function(I){var k=D.fragCurrent,w=D.hls,_=D.levels;if(!_)throw new Error("init load aborted, missing levels");var F=_[L.level].details;console.assert(F,"Level details are defined when init segment is loaded");var U=L.stats;D.state=E.IDLE,D.fragLoadError=0,L.data=new Uint8Array(I.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),I.frag===k&&w.trigger(A.Events.FRAG_BUFFERED,{stats:U,frag:k,part:null,id:L.type}),D.tick()}).catch(function(I){D.warn(I),D.resetFragmentLoading(L)})},d.fragContextChanged=function(L){var D=this.fragCurrent;return!L||!D||L.level!==D.level||L.sn!==D.sn||L.urlId!==D.urlId},d.fragBufferedComplete=function(L,D){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+L.type+" sn: "+L.sn+(D?" part: "+D.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level+" "+e.default.toString(C.BufferHelper.getBuffered(I))),this.state=E.IDLE,this.tick()},d._handleFragmentLoadComplete=function(L){var D=this.transmuxer;if(!!D){var I=L.frag,k=L.part,w=L.partsLoaded,_=!w||w.length===0||w.some(function(U){return!U}),F=new c.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,k?k.index:-1,!_);D.flush(F)}},d._handleFragmentLoadProgress=function(L){},d._doFragLoad=function(L,D,I,k){var w=this;if(I===void 0&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(L.start,I||0),this.config.lowLatencyMode&&D){var _=D.partList;if(_&&k){I>L.end&&D.fragmentHint&&(L=D.fragmentHint);var F=this.getNextPart(_,L,I);if(F>-1){var U=_[F];return this.log("Loading part sn: "+L.sn+" p: "+U.index+" cc: "+L.cc+" of playlist ["+D.startSN+"-"+D.endSN+"] parts [0-"+F+"-"+(_.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=E.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:L,part:_[F],targetBufferTime:I}),this.doFragPartsLoad(L,_,F,k).catch(function(W){return w.handleFragLoadError(W)})}else if(!L.url||this.loadedEndOfParts(_,I))return Promise.resolve(null)}}return this.log("Loading fragment "+L.sn+" cc: "+L.cc+" "+(D?"of ["+D.startSN+"-"+D.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(I.toFixed(3))),Object(O.isFiniteNumber)(L.sn)&&!this.bitrateTest&&(this.nextLoadPosition=L.start+L.duration),this.state=E.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:L,targetBufferTime:I}),this.fragmentLoader.load(L,k).catch(function(W){return w.handleFragLoadError(W)})},d.doFragPartsLoad=function(L,D,I,k){var w=this;return new Promise(function(_,F){var U=[],W=function V(X){var Y=D[X];w.fragmentLoader.loadPart(L,Y,k).then(function(J){U[Y.index]=J;var q=J.part;w.hls.trigger(A.Events.FRAG_LOADED,J);var $=D[X+1];if($&&$.fragment===L)V(X+1);else return _({frag:L,part:q,partsLoaded:U})}).catch(F)};W(I)})},d.handleFragLoadError=function(L){var D=L.data;return D&&D.details===g.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(D.frag,D.part):this.hls.trigger(A.Events.ERROR,D),null},d._handleTransmuxerFlush=function(L){var D=this.getCurrentContext(L);if(!D||this.state!==E.PARSING){this.fragCurrent||(this.state=E.IDLE);return}var I=D.frag,k=D.part,w=D.level,_=self.performance.now();I.stats.parsing.end=_,k&&(k.stats.parsing.end=_),this.updateLevelTiming(I,k,w,L.partial)},d.getCurrentContext=function(L){var D=this.levels,I=L.level,k=L.sn,w=L.part;if(!D||!D[I])return this.warn("Levels object was unset while buffering fragment "+k+" of level "+I+". The current chunk will not be buffered."),null;var _=D[I],F=w>-1?Object(b.getPartWith)(_,k,w):null,U=F?F.fragment:Object(b.getFragmentWithSN)(_,k,this.fragCurrent);return U?{frag:U,part:F,level:_}:null},d.bufferFragmentData=function(L,D,I,k){if(!(!L||this.state!==E.PARSING)){var w=L.data1,_=L.data2,F=w;if(w&&_&&(F=Object(m.appendUint8Array)(w,_)),!(!F||!F.length)){var U={type:L.type,frag:D,part:I,chunkMeta:k,parent:D.type,data:F};this.hls.trigger(A.Events.BUFFER_APPENDING,U),L.dropped&&L.independent&&!I&&this.flushBufferGap(D)}}},d.flushBufferGap=function(L){var D=this.media;if(!!D){if(!C.BufferHelper.isBuffered(D,D.currentTime)){this.flushMainBuffer(0,L.start);return}var I=D.currentTime,k=C.BufferHelper.bufferInfo(D,I,0),w=L.duration,_=Math.min(this.config.maxFragLookUpTolerance*2,w*.25),F=Math.max(Math.min(L.start-_,k.end-_),I+_);L.start-F>_&&this.flushMainBuffer(F,L.start)}},d.getFwdBufferInfo=function(L,D){var I=this.config,k=this.getLoadPosition();if(!Object(O.isFiniteNumber)(k))return null;var w=C.BufferHelper.bufferInfo(L,k,I.maxBufferHole);if(w.len===0&&w.nextStart!==void 0){var _=this.fragmentTracker.getBufferedFrag(k,D);if(_&&w.nextStart<_.end)return C.BufferHelper.bufferInfo(L,k,Math.max(w.nextStart,I.maxBufferHole))}return w},d.getMaxBufferLength=function(L){var D=this.config,I;return L?I=Math.max(8*D.maxBufferSize/L,D.maxBufferLength):I=D.maxBufferLength,Math.min(I,D.maxMaxBufferLength)},d.reduceMaxBufferLength=function(L){var D=this.config,I=L||D.maxBufferLength;return D.maxMaxBufferLength>=I?(D.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+D.maxMaxBufferLength+"s"),!0):!1},d.getNextFragment=function(L,D){var I,k,w=D.fragments,_=w.length;if(!_)return null;var F=this.config,U=w[0].start,W;if(D.live){var V=F.initialLiveManifestSize;if(_<V)return this.warn("Not enough fragments to start playback (have: "+_+", need: "+V+")"),null;!D.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(W=this.getInitialLiveFragment(D,w),this.startPosition=W?this.hls.liveSyncPosition||W.start:L)}else L<=U&&(W=w[0]);if(!W){var X=F.lowLatencyMode?D.partEnd:D.fragmentEnd;W=this.getFragmentAtPosition(L,X,D)}return(I=W)!==null&&I!==void 0&&I.initSegment&&!((k=W)!==null&&k!==void 0&&k.initSegment.data)&&!this.bitrateTest&&(W=W.initSegment),W},d.getNextPart=function(L,D,I){for(var k=-1,w=!1,_=!0,F=0,U=L.length;F<U;F++){var W=L[F];if(_=_&&!W.independent,k>-1&&I<W.start)break;var V=W.loaded;!V&&(w||W.independent||_)&&W.fragment===D&&(k=F),w=V}return k},d.loadedEndOfParts=function(L,D){var I=L[L.length-1];return I&&D>I.start&&I.loaded},d.getInitialLiveFragment=function(L,D){var I=this.fragPrevious,k=null;if(I){if(L.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),k=Object(S.findFragmentByPDT)(D,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!k){var w=I.sn+1;if(w>=L.startSN&&w<=L.endSN){var _=D[w-L.startSN];I.cc===_.cc&&(k=_,this.log("Live playlist, switching playlist, load frag with next SN: "+k.sn))}k||(k=Object(S.findFragWithCC)(D,I.cc),k&&this.log("Live playlist, switching playlist, load frag with same CC: "+k.sn))}}else{var F=this.hls.liveSyncPosition;F!==null&&(k=this.getFragmentAtPosition(F,this.bitrateTest?L.fragmentEnd:L.edge,L))}return k},d.getFragmentAtPosition=function(L,D,I){var k=this.config,w=this.fragPrevious,_=I.fragments,F=I.endSN,U=I.fragmentHint,W=k.maxFragLookUpTolerance,V=!!(k.lowLatencyMode&&I.partList&&U);V&&U&&!this.bitrateTest&&(_=_.concat(U),F=U.sn);var X;if(L<D){var Y=L>D-W?0:W;X=Object(S.findFragmentByPTS)(w,_,L,Y)}else X=_[_.length-1];if(X){var J=X.sn-I.startSN,q=w&&X.level===w.level,$=_[J+1],ne=this.fragmentTracker.getState(X);if(ne===i.FragmentState.BACKTRACKED){X=null;for(var ee=J;_[ee]&&this.fragmentTracker.getState(_[ee])===i.FragmentState.BACKTRACKED;)w?X=_[ee--]:X=_[--ee];X||(X=$)}else w&&X.sn===w.sn&&!V&&q&&(X.sn<F&&this.fragmentTracker.getState($)!==i.FragmentState.OK?(this.log("SN "+X.sn+" just loaded, load next one: "+$.sn),X=$):X=null)}return X},d.synchronizeToLiveEdge=function(L){var D=this.config,I=this.media;if(!!I){var k=this.hls.liveSyncPosition,w=I.currentTime,_=L.fragments[0].start,F=L.edge,U=w>=_-D.maxFragLookUpTolerance&&w<=F;if(k!==null&&I.duration>k&&(w<k||!U)){var W=D.liveMaxLatencyDuration!==void 0?D.liveMaxLatencyDuration:D.liveMaxLatencyDurationCount*L.targetduration;(!U&&I.readyState<4||w<F-W)&&(this.loadedmetadata||(this.nextLoadPosition=k),I.readyState&&(this.warn("Playback: "+w.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+k.toFixed(3)),I.currentTime=k))}}},d.alignPlaylists=function(L,D){var I=this.levels,k=this.levelLastLoaded,w=this.fragPrevious,_=k!==null?I[k]:null,F=L.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var U=L.fragments[0].start,W=!D,V=L.alignedSliding&&Object(O.isFiniteNumber)(U);if(W||!V&&!U){Object(y.alignStream)(w,_,L);var X=L.fragments[0].start;return this.log("Live playlist sliding: "+X.toFixed(2)+" start-sn: "+(D?D.startSN:"na")+"->"+L.startSN+" prev-sn: "+(w?w.sn:"na")+" fragments: "+F),X}return U},d.waitForCdnTuneIn=function(L){var D=3;return L.live&&L.canBlockReload&&L.tuneInGoal>Math.max(L.partHoldBack,L.partTarget*D)},d.setStartPosition=function(L,D){var I=this.startPosition;if(I<D&&(I=-1),I===-1||this.lastCurrentTime===-1){var k=L.startTimeOffset;Object(O.isFiniteNumber)(k)?(I=D+k,k<0&&(I+=L.totalduration),I=Math.min(Math.max(D,I),D+L.totalduration),this.log("Start time offset "+k+" found in playlist, adjust startPosition to "+I),this.startPosition=I):L.live?I=this.hls.liveSyncPosition||D:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},d.getLoadPosition=function(){var L=this.media,D=0;return this.loadedmetadata&&L?D=L.currentTime:this.nextLoadPosition&&(D=this.nextLoadPosition),D},d.handleFragLoadAborted=function(L,D){this.transmuxer&&L.sn!=="initSegment"&&L.stats.aborted&&(this.warn("Fragment "+L.sn+(D?" part"+D.index:"")+" of level "+L.level+" was aborted"),this.resetFragmentLoading(L))},d.resetFragmentLoading=function(L){(!this.fragCurrent||!this.fragContextChanged(L))&&(this.state=E.IDLE)},d.onFragmentOrKeyLoadError=function(L,D){if(!D.fatal){var I=D.frag;if(!(!I||I.type!==L)){var k=this.fragCurrent;console.assert(k&&I.sn===k.sn&&I.level===k.level&&I.urlId===k.urlId,"Frag load error must match current frag to retry");var w=this.config;if(this.fragLoadError+1<=w.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var _=Math.min(Math.pow(2,this.fragLoadError)*w.fragLoadingRetryDelay,w.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+L+" "+I.level+" failed to load, retrying in "+_+"ms"),this.retryDate=self.performance.now()+_,this.fragLoadError++,this.state=E.FRAG_LOADING_WAITING_RETRY}else D.levelRetry?(L===r.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=E.IDLE):(R.logger.error(D.details+" reaches max retry, redispatch as fatal ..."),D.fatal=!0,this.hls.stopLoad(),this.state=E.ERROR)}}},d.afterBufferFlushed=function(L,D,I){if(!!L){var k=C.BufferHelper.getBuffered(L);this.fragmentTracker.detectEvictedFragments(D,k,I),this.state===E.ENDED&&this.resetLoadingState()}},d.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=E.IDLE},d.resetLiveStartWhenNotLoaded=function(L){if(!this.loadedmetadata){this.startFragRequested=!1;var D=this.levels?this.levels[L].details:null;if(D!=null&&D.live)return this.startPosition=-1,this.setStartPosition(D,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},d.updateLevelTiming=function(L,D,I,k){var w=this,_=I.details;console.assert(!!_,"level.details must be defined");var F=Object.keys(L.elementaryStreams).reduce(function(U,W){var V=L.elementaryStreams[W];if(V){var X=V.endPTS-V.startPTS;if(X<=0)return w.warn("Could not parse fragment "+L.sn+" "+W+" duration reliably ("+X+") resetting transmuxer to fallback to playlist timing"),w.resetTransmuxer(),U||!1;var Y=k?0:Object(b.updateFragPTSDTS)(_,L,V.startPTS,V.endPTS,V.startDTS,V.endDTS);return w.hls.trigger(A.Events.LEVEL_PTS_UPDATED,{details:_,level:I,drift:Y,type:W,frag:L,start:V.startPTS,end:V.endPTS}),!0}return U},!1);F?(this.state=E.PARSED,this.hls.trigger(A.Events.FRAG_PARSED,{frag:L,part:D})):this.resetLoadingState()},d.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},l(u,[{key:"state",get:function(){return this._state},set:function(L){var D=this._state;D!==L&&(this._state=L,this.log(D+"->"+L))}}]),u}(T.default)},"./src/controller/buffer-controller.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return S});var O=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),i=h("./src/utils/logger.ts"),C=h("./src/errors.ts"),R=h("./src/utils/buffer-helper.ts"),A=h("./src/utils/mediasource-helper.ts"),g=h("./src/loader/fragment.ts"),c=h("./src/controller/buffer-operation-queue.ts"),m=Object(A.getMediaSource)(),y=/([ha]vc.)(?:\.[^.,]+)+/,S=function(){function b(n){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=e.hls,t=e.media,l=e.mediaSource;i.logger.log("[buffer-controller]: Media source opened"),t&&(e.updateMediaElementDuration(),r.trigger(T.Events.MEDIA_ATTACHED,{media:t})),l&&l.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){i.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){i.logger.log("[buffer-controller]: Media source ended")},this.hls=n,this._initSourceBuffer(),this.registerListeners()}var p=b.prototype;return p.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},p.destroy=function(){this.unregisterListeners(),this.details=null},p.registerListeners=function(){var e=this.hls;e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.Events.BUFFER_RESET,this.onBufferReset,this),e.on(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.Events.BUFFER_EOS,this.onBufferEos,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.Events.FRAG_PARSED,this.onFragParsed,this),e.on(T.Events.FRAG_CHANGED,this.onFragChanged,this)},p.unregisterListeners=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.Events.BUFFER_RESET,this.onBufferReset,this),e.off(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.Events.BUFFER_EOS,this.onBufferEos,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.Events.FRAG_PARSED,this.onFragParsed,this),e.off(T.Events.FRAG_CHANGED,this.onFragChanged,this)},p._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new c.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},p.onManifestParsed=function(e,r){var t=2;(r.audio&&!r.video||!r.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,i.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},p.onMediaAttaching=function(e,r){var t=this.media=r.media;if(t&&m){var l=this.mediaSource=new m;l.addEventListener("sourceopen",this._onMediaSourceOpen),l.addEventListener("sourceended",this._onMediaSourceEnded),l.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(l),this._objectUrl=t.src}},p.onMediaDetaching=function(){var e=this.media,r=this.mediaSource,t=this._objectUrl;if(r){if(i.logger.log("[buffer-controller]: media source detaching"),r.readyState==="open")try{r.endOfStream()}catch(l){i.logger.warn("[buffer-controller]: onMediaDetaching: "+l.message+" while calling endOfStream")}this.onBufferReset(),r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):i.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.Events.MEDIA_DETACHED,void 0)},p.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(r){var t=e.sourceBuffer[r];try{t&&(e.removeBufferListeners(r),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[r]=void 0)}catch(l){i.logger.warn("[buffer-controller]: Failed to reset the "+r+" buffer",l)}}),this._initSourceBuffer()},p.onBufferCodecs=function(e,r){var t=this,l=this.getSourceBufferTypes().length;Object.keys(r).forEach(function(s){if(l){var a=t.tracks[s];if(a&&typeof a.buffer.changeType=="function"){var o=r[s],E=o.codec,x=o.levelCodec,f=o.container,u=(a.levelCodec||a.codec).replace(y,"$1"),d=(x||E).replace(y,"$1");if(u!==d){var v=f+";codecs="+(x||E);t.appendChangeType(s,v)}}}else t.pendingTracks[s]=r[s]}),!l&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},p.appendChangeType=function(e,r){var t=this,l=this.operationQueue,s={execute:function(){var o=t.sourceBuffer[e];o&&(i.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+r),o.changeType(r)),l.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(o){i.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",o)}};l.append(s,e)},p.onBufferAppending=function(e,r){var t=this,l=this.hls,s=this.operationQueue,a=this.tracks,o=r.data,E=r.type,x=r.frag,f=r.part,u=r.chunkMeta,d=u.buffering[E],v=self.performance.now();d.start=v;var L=x.stats.buffering,D=f?f.stats.buffering:null;L.start===0&&(L.start=v),D&&D.start===0&&(D.start=v);var I=a.audio,k=E==="audio"&&u.id===1&&(I==null?void 0:I.container)==="audio/mpeg",w={execute:function(){if(d.executeStart=self.performance.now(),k){var F=t.sourceBuffer[E];if(F){var U=x.start-F.timestampOffset;Math.abs(U)>=.1&&(i.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+x.start+" (delta: "+U+") sn: "+x.sn+")"),F.timestampOffset=x.start)}}t.appendExecutor(o,E)},onStart:function(){},onComplete:function(){var F=self.performance.now();d.executeEnd=d.end=F,L.first===0&&(L.first=F),D&&D.first===0&&(D.first=F);var U=t.sourceBuffer,W={};for(var V in U)W[V]=R.BufferHelper.getBuffered(U[V]);t.appendError=0,t.hls.trigger(T.Events.BUFFER_APPENDED,{type:E,frag:x,part:f,chunkMeta:u,parent:x.type,timeRanges:W})},onError:function(F){i.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",F);var U={type:C.ErrorTypes.MEDIA_ERROR,parent:x.type,details:C.ErrorDetails.BUFFER_APPEND_ERROR,err:F,fatal:!1};F.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=C.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,U.details=C.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>l.config.appendErrorMaxRetry&&(i.logger.error("[buffer-controller]: Failed "+l.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0)),l.trigger(T.Events.ERROR,U)}};s.append(w,E)},p.onBufferFlushing=function(e,r){var t=this,l=this.operationQueue,s=function(o){return{execute:t.removeExecutor.bind(t,o,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(T.Events.BUFFER_FLUSHED,{type:o})},onError:function(x){i.logger.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",x)}}};r.type?l.append(s(r.type),r.type):this.getSourceBufferTypes().forEach(function(a){l.append(s(a),a)})},p.onFragParsed=function(e,r){var t=this,l=r.frag,s=r.part,a=[],o=s?s.elementaryStreams:l.elementaryStreams;o[g.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(o[g.ElementaryStreamTypes.AUDIO]&&a.push("audio"),o[g.ElementaryStreamTypes.VIDEO]&&a.push("video"));var E=function(){var f=self.performance.now();l.stats.buffering.end=f,s&&(s.stats.buffering.end=f);var u=s?s.stats:l.stats;t.hls.trigger(T.Events.FRAG_BUFFERED,{frag:l,part:s,stats:u,id:l.type})};a.length===0&&i.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+l.type+" level: "+l.level+" sn: "+l.sn),this.blockBuffers(E,a)},p.onFragChanged=function(e,r){this.flushBackBuffer()},p.onBufferEos=function(e,r){var t=this,l=this.getSourceBufferTypes().reduce(function(s,a){var o=t.sourceBuffer[a];return(!r.type||r.type===a)&&o&&!o.ended&&(o.ended=!0,i.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS")),s&&!!(!o||o.ended)},!0);l&&this.blockBuffers(function(){var s=t.mediaSource;!s||s.readyState!=="open"||s.endOfStream()})},p.onLevelUpdated=function(e,r){var t=r.details;!t.fragments.length||(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},p.flushBackBuffer=function(){var e=this.hls,r=this.details,t=this.media,l=this.sourceBuffer;if(!(!t||r===null)){var s=this.getSourceBufferTypes();if(!!s.length){var a=r.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(O.isFiniteNumber)(a)||a<0)){var o=t.currentTime,E=r.levelTargetDuration,x=Math.max(a,E),f=Math.floor(o/E)*E-x;s.forEach(function(u){var d=l[u];if(d){var v=R.BufferHelper.getBuffered(d);v.length>0&&f>v.start(0)&&(e.trigger(T.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),r.live&&e.trigger(T.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f}),e.trigger(T.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:u}))}})}}}},p.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,r=this.hls,t=this.media,l=this.mediaSource,s=e.fragments[0].start+e.totalduration,a=t.duration,o=Object(O.isFiniteNumber)(l.duration)?l.duration:0;e.live&&r.config.liveDurationInfinity?(i.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),l.duration=1/0,this.updateSeekableRange(e)):(s>o&&s>a||!Object(O.isFiniteNumber)(a))&&(i.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),l.duration=s)}},p.updateSeekableRange=function(e){var r=this.mediaSource,t=e.fragments,l=t.length;if(l&&e.live&&r!==null&&r!==void 0&&r.setLiveSeekableRange){var s=Math.max(0,t[0].start),a=Math.max(s,s+e.totalduration);r.setLiveSeekableRange(s,a)}},p.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,r=this.operationQueue,t=this.pendingTracks,l=Object.keys(t).length;if(l&&!e||l===2){this.createSourceBuffers(t),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0){this.hls.trigger(T.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}s.forEach(function(a){r.executeNext(a)})}},p.createSourceBuffers=function(e){var r=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var l=0;for(var s in e)if(!r[s]){var a=e[s];if(!a)throw Error("source buffer exists for track "+s+", however track does not");var o=a.levelCodec||a.codec,E=a.container+";codecs="+o;i.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var x=r[s]=t.addSourceBuffer(E),f=s;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[s]={buffer:x,codec:o,container:a.container,levelCodec:a.levelCodec,id:a.id},l++}catch(u){i.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+u.message),this.hls.trigger(T.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,mimeType:E})}}l&&this.hls.trigger(T.Events.BUFFER_CREATED,{tracks:this.tracks})},p._onSBUpdateStart=function(e){var r=this.operationQueue,t=r.current(e);t.onStart()},p._onSBUpdateEnd=function(e){var r=this.operationQueue,t=r.current(e);t.onComplete(),r.shiftAndExecuteNext(e)},p._onSBUpdateError=function(e,r){i.logger.error("[buffer-controller]: "+e+" SourceBuffer error",r),this.hls.trigger(T.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(r)},p.removeExecutor=function(e,r,t){var l=this.media,s=this.mediaSource,a=this.operationQueue,o=this.sourceBuffer,E=o[e];if(!l||!s||!E){i.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(e);return}var x=Object(O.isFiniteNumber)(l.duration)?l.duration:1/0,f=Object(O.isFiniteNumber)(s.duration)?s.duration:1/0,u=Math.max(0,r),d=Math.min(t,x,f);d>u?(i.logger.log("[buffer-controller]: Removing ["+u+","+d+"] from the "+e+" SourceBuffer"),console.assert(!E.updating,e+" sourceBuffer must not be updating"),E.remove(u,d)):a.shiftAndExecuteNext(e)},p.appendExecutor=function(e,r){var t=this.operationQueue,l=this.sourceBuffer,s=l[r];if(!s){i.logger.warn("[buffer-controller]: Attempting to append to the "+r+" SourceBuffer, but it does not exist"),t.shiftAndExecuteNext(r);return}s.ended=!1,console.assert(!s.updating,r+" sourceBuffer must not be updating"),s.appendBuffer(e)},p.blockBuffers=function(e,r){var t=this;if(r===void 0&&(r=this.getSourceBufferTypes()),!r.length){i.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(e);return}var l=this.operationQueue,s=r.map(function(a){return l.appendBlocker(a)});Promise.all(s).then(function(){e(),r.forEach(function(a){var o=t.sourceBuffer[a];(!o||!o.updating)&&l.shiftAndExecuteNext(a)})})},p.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},p.addBufferListener=function(e,r,t){var l=this.sourceBuffer[e];if(!!l){var s=t.bind(this,e);this.listeners[e].push({event:r,listener:s}),l.addEventListener(r,s)}},p.removeBufferListeners=function(e){var r=this.sourceBuffer[e];!r||this.listeners[e].forEach(function(t){r.removeEventListener(t.event,t.listener)})},b}()},"./src/controller/buffer-operation-queue.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return T});var O=h("./src/utils/logger.ts"),T=function(){function i(R){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=R}var C=i.prototype;return C.append=function(A,g){var c=this.queues[g];c.push(A),c.length===1&&this.buffers[g]&&this.executeNext(g)},C.insertAbort=function(A,g){var c=this.queues[g];c.unshift(A),this.executeNext(g)},C.appendBlocker=function(A){var g,c=new Promise(function(y){g=y}),m={execute:g,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(m,A),c},C.executeNext=function(A){var g=this.buffers,c=this.queues,m=g[A],y=c[A];if(y.length){var S=y[0];try{S.execute()}catch(b){O.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),S.onError(b),(!m||!m.updating)&&(y.shift(),this.executeNext(A))}}},C.shiftAndExecuteNext=function(A){this.queues[A].shift(),this.executeNext(A)},C.current=function(A){return this.queues[A][0]},i}()},"./src/controller/cap-level-controller.ts":function(N,P,h){h.r(P);var O=h("./src/events.ts");function T(R,A){for(var g=0;g<A.length;g++){var c=A[g];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(R,c.key,c)}}function i(R,A,g){return A&&T(R.prototype,A),g&&T(R,g),R}var C=function(){function R(g){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=g,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var A=R.prototype;return A.setStreamController=function(c){this.streamController=c},A.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},A.registerListeners=function(){var c=this.hls;c.on(O.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.unregisterListener=function(){var c=this.hls;c.off(O.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.onFpsDropLevelCapping=function(c,m){R.isLevelAllowed(m.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(m.droppedLevel)},A.onMediaAttaching=function(c,m){this.media=m.media instanceof HTMLVideoElement?m.media:null},A.onManifestParsed=function(c,m){var y=this.hls;this.restrictedLevels=[],this.firstLevel=m.firstLevel,y.config.capLevelToPlayerSize&&m.video&&this.startCapping()},A.onBufferCodecs=function(c,m){var y=this.hls;y.config.capLevelToPlayerSize&&m.video&&this.startCapping()},A.onMediaDetaching=function(){this.stopCapping()},A.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var c=this.hls.levels;if(c.length){var m=this.hls;m.autoLevelCapping=this.getMaxLevel(c.length-1),m.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=m.autoLevelCapping}}},A.getMaxLevel=function(c){var m=this,y=this.hls.levels;if(!y.length)return-1;var S=y.filter(function(b,p){return R.isLevelAllowed(p,m.restrictedLevels)&&p<=c});return this.clientRect=null,R.getMaxLevelByMediaSize(S,this.mediaWidth,this.mediaHeight)},A.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},A.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},A.getDimensions=function(){if(this.clientRect)return this.clientRect;var c=this.media,m={width:0,height:0};if(c){var y=c.getBoundingClientRect();m.width=y.width,m.height=y.height,!m.width&&!m.height&&(m.width=y.right-y.left||c.width||0,m.height=y.bottom-y.top||c.height||0)}return this.clientRect=m,m},R.isLevelAllowed=function(c,m){return m===void 0&&(m=[]),m.indexOf(c)===-1},R.getMaxLevelByMediaSize=function(c,m,y){if(!c||!c.length)return-1;for(var S=function(r,t){return t?r.width!==t.width||r.height!==t.height:!0},b=c.length-1,p=0;p<c.length;p+=1){var n=c[p];if((n.width>=m||n.height>=y)&&S(n,c[p+1])){b=p;break}}return b},i(R,[{key:"mediaWidth",get:function(){return this.getDimensions().width*R.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*R.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var c=1;try{c=self.devicePixelRatio}catch{}return c}}]),R}();P.default=C},"./src/controller/cmcd-controller.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return S});var O=h("./src/events.ts"),T=h("./src/types/cmcd.ts"),i=h("./src/utils/buffer-helper.ts"),C=h("./src/utils/logger.ts");function R(b,p){for(var n=0;n<p.length;n++){var e=p[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}}function A(b,p,n){return p&&R(b.prototype,p),n&&R(b,n),b}function g(b,p){var n=typeof Symbol!="undefined"&&b[Symbol.iterator]||b["@@iterator"];if(n)return(n=n.call(b)).next.bind(n);if(Array.isArray(b)||(n=c(b))||p&&b&&typeof b.length=="number"){n&&(b=n);var e=0;return function(){return e>=b.length?{done:!0}:{done:!1,value:b[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c(b,p){if(!!b){if(typeof b=="string")return m(b,p);var n=Object.prototype.toString.call(b).slice(8,-1);if(n==="Object"&&b.constructor&&(n=b.constructor.name),n==="Map"||n==="Set")return Array.from(b);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(b,p)}}function m(b,p){(p==null||p>b.length)&&(p=b.length);for(var n=0,e=new Array(p);n<p;n++)e[n]=b[n];return e}function y(){return y=Object.assign||function(b){for(var p=1;p<arguments.length;p++){var n=arguments[p];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(b[e]=n[e])}return b},y.apply(this,arguments)}var S=function(){function b(n){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(l){try{e.apply(l,{ot:T.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(s){C.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=function(l){try{var s=l.frag,a=e.hls.levels[s.level],o=e.getObjectType(s),E={d:s.duration*1e3,ot:o};(o===T.CMCDObjectType.VIDEO||o===T.CMCDObjectType.AUDIO||o==T.CMCDObjectType.MUXED)&&(E.br=a.bitrate/1e3,E.tb=e.getTopBandwidth(o)/1e3,E.bl=e.getBufferLength(o)),e.apply(l,E)}catch(x){C.logger.warn("Could not generate segment CMCD data.",x)}},this.hls=n;var r=this.config=n.config,t=r.cmcd;t!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||b.uuid(),this.cid=t.contentId,this.useHeaders=t.useHeaders===!0,this.registerListeners())}var p=b.prototype;return p.registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this)},p.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},p.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},p.onMediaAttached=function(e,r){this.media=r.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},p.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},p.onBufferCreated=function(e,r){var t,l;this.audioBuffer=(t=r.tracks.audio)===null||t===void 0?void 0:t.buffer,this.videoBuffer=(l=r.tracks.video)===null||l===void 0?void 0:l.buffer},p.createData=function(){var e;return{v:T.CMCDVersion,sf:T.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},p.apply=function(e,r){r===void 0&&(r={}),y(r,this.createData());var t=r.ot===T.CMCDObjectType.INIT||r.ot===T.CMCDObjectType.VIDEO||r.ot===T.CMCDObjectType.MUXED;if(this.starved&&t&&(r.bs=!0,r.su=!0,this.starved=!1),r.su==null&&(r.su=this.buffering),this.useHeaders){var l=b.toHeaders(r);if(!Object.keys(l).length)return;e.headers||(e.headers={}),y(e.headers,l)}else{var s=b.toQuery(r);if(!s)return;e.url=b.appendQueryToUri(e.url,s)}},p.getObjectType=function(e){var r=e.type;if(r==="subtitle")return T.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return T.CMCDObjectType.INIT;if(r==="audio")return T.CMCDObjectType.AUDIO;if(r==="main")return this.hls.audioTracks.length?T.CMCDObjectType.VIDEO:T.CMCDObjectType.MUXED},p.getTopBandwidth=function(e){var r=0,t,l=this.hls;if(e===T.CMCDObjectType.AUDIO)t=l.audioTracks;else{var s=l.maxAutoLevel,a=s>-1?s+1:l.levels.length;t=l.levels.slice(0,a)}for(var o=g(t),E;!(E=o()).done;){var x=E.value;x.bitrate>r&&(r=x.bitrate)}return r>0?r:NaN},p.getBufferLength=function(e){var r=this.hls.media,t=e===T.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!t||!r)return NaN;var l=i.BufferHelper.bufferInfo(t,r.currentTime,this.config.maxBufferHole);return l.len*1e3},p.createPlaylistLoader=function(){var e=this.config.pLoader,r=this.applyPlaylistData,t=e||this.config.loader;return function(){function l(a){this.loader=void 0,this.loader=new t(a)}var s=l.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(o,E,x){r(o),this.loader.load(o,E,x)},A(l,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),l}()},p.createFragmentLoader=function(){var e=this.config.fLoader,r=this.applyFragmentData,t=e||this.config.loader;return function(){function l(a){this.loader=void 0,this.loader=new t(a)}var s=l.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(o,E,x){r(o),this.loader.load(o,E,x)},A(l,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),l}()},b.uuid=function(){var e=URL.createObjectURL(new Blob),r=e.toString();return URL.revokeObjectURL(e),r.substr(r.lastIndexOf("/")+1)},b.serialize=function(e){for(var r=[],t=function(k){return!Number.isNaN(k)&&k!=null&&k!==""&&k!==!1},l=function(k){return Math.round(k)},s=function(k){return l(k/100)*100},a=function(k){return encodeURIComponent(k)},o={br:l,d:l,bl:s,dl:s,mtp:s,nor:a,rtp:s,tb:l},E=Object.keys(e||{}).sort(),x=g(E),f;!(f=x()).done;){var u=f.value,d=e[u];if(!!t(d)&&!(u==="v"&&d===1)&&!(u=="pr"&&d===1)){var v=o[u];v&&(d=v(d));var L=typeof d,D=void 0;u==="ot"||u==="sf"||u==="st"?D=u+"="+d:L==="boolean"?D=u:L==="number"?D=u+"="+d:D=u+"="+JSON.stringify(d),r.push(D)}}return r.join(",")},b.toHeaders=function(e){for(var r=Object.keys(e),t={},l=["Object","Request","Session","Status"],s=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,E=r;o<E.length;o++){var x=E[o],f=a[x]!=null?a[x]:1;s[f][x]=e[x]}for(var u=0;u<s.length;u++){var d=b.serialize(s[u]);d&&(t["CMCD-"+l[u]]=d)}return t},b.toQuery=function(e){return"CMCD="+encodeURIComponent(b.serialize(e))},b.appendQueryToUri=function(e,r){if(!r)return e;var t=e.includes("?")?"&":"?";return""+e+t+r},b}()},"./src/controller/eme-controller.ts":function(N,P,h){h.r(P);var O=h("./src/events.ts"),T=h("./src/errors.ts"),i=h("./src/utils/logger.ts"),C=h("./src/utils/mediakeys-helper.ts");function R(S,b){for(var p=0;p<b.length;p++){var n=b[p];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(S,n.key,n)}}function A(S,b,p){return b&&R(S.prototype,b),p&&R(S,p),S}var g=3,c=function(b,p,n){var e={audioCapabilities:[],videoCapabilities:[]};return b.forEach(function(r){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+r+'"',robustness:n.audioRobustness||""})}),p.forEach(function(r){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+r+'"',robustness:n.videoRobustness||""})}),[e]},m=function(b,p,n,e){switch(b){case C.KeySystems.WIDEVINE:return c(p,n,e);default:throw new Error("Unknown key-system: "+b)}},y=function(){function S(p){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=p,this._config=p.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var b=S.prototype;return b.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},b._registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this)},b._unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(O.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this)},b.getLicenseServerUrl=function(n){switch(n){case C.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},b._attemptKeySystemAccess=function(n,e,r){var t=this,l=m(n,e,r,this._drmSystemOptions);i.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(n,l);this.mediaKeysPromise=s.then(function(a){return t._onMediaKeySystemAccessObtained(n,a)}),s.catch(function(a){i.logger.error('Failed to obtain key-system "'+n+'" access:',a)})},b._onMediaKeySystemAccessObtained=function(n,e){var r=this;i.logger.log('Access for key-system "'+n+'" obtained');var t={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:n};this._mediaKeysList.push(t);var l=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(s){return t.mediaKeys=s,i.logger.log('Media-keys created for key-system "'+n+'"'),r._onMediaKeysCreated(),s});return l.catch(function(s){i.logger.error("Failed to create media-keys:",s)}),l},b._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),n._onNewMediaKeySession(e.mediaKeysSession))})},b._onNewMediaKeySession=function(n){var e=this;i.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(r){e._onKeySessionMessage(n,r.message)},!1)},b._onKeySessionMessage=function(n,e){i.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(r){i.logger.log("Received license data (length: "+(r&&r.byteLength)+"), updating key-session"),n.update(r)})},b.onMediaEncrypted=function(n){var e=this;if(i.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){i.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var r=function(l){!e._media||(e._attemptSetMediaKeys(l),e._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(r).catch(r)},b._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){i.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}i.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},b._generateRequestWithPreferredKeySession=function(n,e){var r=this,t=this._mediaKeysList[0];if(!t){i.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(t.mediaKeysSessionInitialized){i.logger.warn("Key-Session already initialized but requested again");return}var l=t.mediaKeysSession;if(!l){i.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){i.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}i.logger.log('Generating key-session request for "'+n+'" init data type'),t.mediaKeysSessionInitialized=!0,l.generateRequest(n,e).then(function(){i.logger.debug("Key-session generation succeeded")}).catch(function(s){i.logger.error("Error generating key-session request:",s),r.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},b._createLicenseXhr=function(n,e,r){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,t,n,e,r);var l=this._licenseXhrSetup;if(l)try{l.call(this.hls,t,n),l=void 0}catch(s){i.logger.error(s)}try{t.readyState||t.open("POST",n,!0),l&&l.call(this.hls,t,n)}catch(s){throw new Error("issue setting up KeySystem license XHR "+s)}return t},b._onLicenseRequestReadyStageChange=function(n,e,r,t){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,i.logger.log("License request succeeded");var l=n.response,s=this._licenseResponseCallback;if(s)try{l=s.call(this.hls,n,e)}catch(o){i.logger.error(o)}t(l)}else{if(i.logger.error("License Request XHR failed ("+e+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>g){this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var a=g-this._requestLicenseFailureCount+1;i.logger.warn("Retrying license request, "+a+" attempts left"),this._requestLicense(r,t)}break}},b._generateLicenseRequestChallenge=function(n,e){switch(n.mediaKeySystemDomain){case C.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},b._requestLicense=function(n,e){i.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r){i.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var t=this.getLicenseServerUrl(r.mediaKeySystemDomain),l=this._createLicenseXhr(t,n,e);i.logger.log("Sending license request to URL: "+t);var s=this._generateLicenseRequestChallenge(r,n);l.send(s)}catch(a){i.logger.error("Failure requesting DRM license: "+a),this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},b.onMediaAttached=function(n,e){if(!!this._emeEnabled){var r=e.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},b.onMediaDetached=function(){var n=this._media,e=this._mediaKeysList;!n||(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(r){if(r.mediaKeysSession)return r.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},b.onManifestParsed=function(n,e){if(!!this._emeEnabled){var r=e.levels.map(function(l){return l.audioCodec}).filter(function(l){return!!l}),t=e.levels.map(function(l){return l.videoCodec}).filter(function(l){return!!l});this._attemptKeySystemAccess(C.KeySystems.WIDEVINE,r,t)}},A(S,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),S}();P.default=y},"./src/controller/fps-controller.ts":function(N,P,h){h.r(P);var O=h("./src/events.ts"),T=h("./src/utils/logger.ts"),i=function(){function C(A){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=A,this.registerListeners()}var R=C.prototype;return R.setStreamController=function(g){this.streamController=g},R.registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function(g,c){var m=this.hls.config;if(m.capLevelOnFPSDrop){var y=c.media instanceof self.HTMLVideoElement?c.media:null;this.media=y,y&&typeof y.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),m.fpsDroppedMonitoringPeriod)}},R.checkFPS=function(g,c,m){var y=performance.now();if(c){if(this.lastTime){var S=y-this.lastTime,b=m-this.lastDroppedFrames,p=c-this.lastDecodedFrames,n=1e3*b/S,e=this.hls;if(e.trigger(O.Events.FPS_DROP,{currentDropped:b,currentDecoded:p,totalDroppedFrames:m}),n>0&&b>e.config.fpsDroppedMonitoringThreshold*p){var r=e.currentLevel;T.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+r),r>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=r)&&(r=r-1,e.trigger(O.Events.FPS_DROP_LEVEL_CAPPING,{level:r,droppedLevel:e.currentLevel}),e.autoLevelCapping=r,this.streamController.nextLevelSwitch())}}this.lastTime=y,this.lastDroppedFrames=m,this.lastDecodedFrames=c}},R.checkFPSInterval=function(){var g=this.media;if(g)if(this.isVideoPlaybackQualityAvailable){var c=g.getVideoPlaybackQuality();this.checkFPS(g,c.totalVideoFrames,c.droppedVideoFrames)}else this.checkFPS(g,g.webkitDecodedFrameCount,g.webkitDroppedFrameCount)},C}();P.default=i},"./src/controller/fragment-finders.ts":function(N,P,h){h.r(P),h.d(P,"findFragmentByPDT",function(){return i}),h.d(P,"findFragmentByPTS",function(){return C}),h.d(P,"fragmentWithinToleranceTest",function(){return R}),h.d(P,"pdtWithinToleranceTest",function(){return A}),h.d(P,"findFragWithCC",function(){return g});var O=h("./src/polyfills/number.ts"),T=h("./src/utils/binary-search.ts");function i(c,m,y){if(m===null||!Array.isArray(c)||!c.length||!Object(O.isFiniteNumber)(m))return null;var S=c[0].programDateTime;if(m<(S||0))return null;var b=c[c.length-1].endProgramDateTime;if(m>=(b||0))return null;y=y||0;for(var p=0;p<c.length;++p){var n=c[p];if(A(m,y,n))return n}return null}function C(c,m,y,S){y===void 0&&(y=0),S===void 0&&(S=0);var b=null;if(c?b=m[c.sn-m[0].sn+1]||null:y===0&&m[0].start===0&&(b=m[0]),b&&R(y,S,b)===0)return b;var p=T.default.search(m,R.bind(null,y,S));return p||b}function R(c,m,y){c===void 0&&(c=0),m===void 0&&(m=0);var S=Math.min(m,y.duration+(y.deltaPTS?y.deltaPTS:0));return y.start+y.duration-S<=c?1:y.start-S>c&&y.start?-1:0}function A(c,m,y){var S=Math.min(m,y.duration+(y.deltaPTS?y.deltaPTS:0))*1e3,b=y.endProgramDateTime||0;return b-S>c}function g(c,m){return T.default.search(c,function(y){return y.cc<m?1:y.cc>m?-1:0})}},"./src/controller/fragment-tracker.ts":function(N,P,h){h.r(P),h.d(P,"FragmentState",function(){return i}),h.d(P,"FragmentTracker",function(){return C});var O=h("./src/events.ts"),T=h("./src/types/loader.ts"),i;(function(g){g.NOT_LOADED="NOT_LOADED",g.BACKTRACKED="BACKTRACKED",g.APPENDING="APPENDING",g.PARTIAL="PARTIAL",g.OK="OK"})(i||(i={}));var C=function(){function g(m){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=m,this._registerListeners()}var c=g.prototype;return c._registerListeners=function(){var y=this.hls;y.on(O.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.on(O.Events.FRAG_LOADED,this.onFragLoaded,this)},c._unregisterListeners=function(){var y=this.hls;y.off(O.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.off(O.Events.FRAG_LOADED,this.onFragLoaded,this)},c.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},c.getAppendedFrag=function(y,S){if(S===T.PlaylistLevelType.MAIN){var b=this.activeFragment,p=this.activeParts;if(!b)return null;if(p)for(var n=p.length;n--;){var e=p[n],r=e?e.end:b.appendedPTS;if(e.start<=y&&r!==void 0&&y<=r)return n>9&&(this.activeParts=p.slice(n-9)),e}else if(b.start<=y&&b.appendedPTS!==void 0&&y<=b.appendedPTS)return b}return this.getBufferedFrag(y,S)},c.getBufferedFrag=function(y,S){for(var b=this.fragments,p=Object.keys(b),n=p.length;n--;){var e=b[p[n]];if((e==null?void 0:e.body.type)===S&&e.buffered){var r=e.body;if(r.start<=y&&y<=r.end)return r}}return null},c.detectEvictedFragments=function(y,S,b){var p=this;Object.keys(this.fragments).forEach(function(n){var e=p.fragments[n];if(!!e){if(!e.buffered){e.body.type===b&&p.removeFragment(e.body);return}var r=e.range[y];!r||r.time.some(function(t){var l=!p.isTimeBuffered(t.startPTS,t.endPTS,S);return l&&p.removeFragment(e.body),l})}})},c.detectPartialFragments=function(y){var S=this,b=this.timeRanges,p=y.frag,n=y.part;if(!(!b||p.sn==="initSegment")){var e=A(p),r=this.fragments[e];!r||(Object.keys(b).forEach(function(t){var l=p.elementaryStreams[t];if(!!l){var s=b[t],a=n!==null||l.partial===!0;r.range[t]=S.getBufferedTimes(p,n,a,s)}}),r.backtrack=r.loaded=null,Object.keys(r.range).length?r.buffered=!0:this.removeFragment(r.body))}},c.fragBuffered=function(y){var S=A(y),b=this.fragments[S];b&&(b.backtrack=b.loaded=null,b.buffered=!0)},c.getBufferedTimes=function(y,S,b,p){for(var n={time:[],partial:b},e=S?S.start:y.start,r=S?S.end:y.end,t=y.minEndPTS||r,l=y.maxStartPTS||e,s=0;s<p.length;s++){var a=p.start(s)-this.bufferPadding,o=p.end(s)+this.bufferPadding;if(l>=a&&t<=o){n.time.push({startPTS:Math.max(e,p.start(s)),endPTS:Math.min(r,p.end(s))});break}else if(e<o&&r>a)n.partial=!0,n.time.push({startPTS:Math.max(e,p.start(s)),endPTS:Math.min(r,p.end(s))});else if(r<=a)break}return n},c.getPartialFragment=function(y){var S=null,b,p,n,e=0,r=this.bufferPadding,t=this.fragments;return Object.keys(t).forEach(function(l){var s=t[l];!s||R(s)&&(p=s.body.start-r,n=s.body.end+r,y>=p&&y<=n&&(b=Math.min(y-p,n-y),e<=b&&(S=s.body,e=b)))}),S},c.getState=function(y){var S=A(y),b=this.fragments[S];return b?b.buffered?R(b)?i.PARTIAL:i.OK:b.backtrack?i.BACKTRACKED:i.APPENDING:i.NOT_LOADED},c.backtrack=function(y,S){var b=A(y),p=this.fragments[b];if(!p||p.backtrack)return null;var n=p.backtrack=S||p.loaded;return p.loaded=null,n},c.getBacktrackData=function(y){var S=A(y),b=this.fragments[S];if(b){var p,n=b.backtrack;if(n!=null&&(p=n.payload)!==null&&p!==void 0&&p.byteLength)return n;this.removeFragment(y)}return null},c.isTimeBuffered=function(y,S,b){for(var p,n,e=0;e<b.length;e++){if(p=b.start(e)-this.bufferPadding,n=b.end(e)+this.bufferPadding,y>=p&&S<=n)return!0;if(S<=p)return!1}return!1},c.onFragLoaded=function(y,S){var b=S.frag,p=S.part;if(!(b.sn==="initSegment"||b.bitrateTest||p)){var n=A(b);this.fragments[n]={body:b,loaded:S,backtrack:null,buffered:!1,range:Object.create(null)}}},c.onBufferAppended=function(y,S){var b=this,p=S.frag,n=S.part,e=S.timeRanges;if(p.type===T.PlaylistLevelType.MAIN)if(this.activeFragment=p,n){var r=this.activeParts;r||(this.activeParts=r=[]),r.push(n)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(t){var l=e[t];if(b.detectEvictedFragments(t,l),!n)for(var s=0;s<l.length;s++)p.appendedPTS=Math.max(l.end(s),p.appendedPTS||0)})},c.onFragBuffered=function(y,S){this.detectPartialFragments(S)},c.hasFragment=function(y){var S=A(y);return!!this.fragments[S]},c.removeFragmentsInRange=function(y,S,b){var p=this;Object.keys(this.fragments).forEach(function(n){var e=p.fragments[n];if(!!e&&e.buffered){var r=e.body;r.type===b&&r.start<S&&r.end>y&&p.removeFragment(r)}})},c.removeFragment=function(y){var S=A(y);y.stats.loaded=0,y.clearElementaryStreamInfo(),delete this.fragments[S]},c.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},g}();function R(g){var c,m;return g.buffered&&(((c=g.range.video)===null||c===void 0?void 0:c.partial)||((m=g.range.audio)===null||m===void 0?void 0:m.partial))}function A(g){return g.type+"_"+g.level+"_"+g.urlId+"_"+g.sn}},"./src/controller/gap-controller.ts":function(N,P,h){h.r(P),h.d(P,"STALL_MINIMUM_DURATION_MS",function(){return R}),h.d(P,"MAX_START_GAP_JUMP",function(){return A}),h.d(P,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return g}),h.d(P,"SKIP_BUFFER_RANGE_START",function(){return c}),h.d(P,"default",function(){return m});var O=h("./src/utils/buffer-helper.ts"),T=h("./src/errors.ts"),i=h("./src/events.ts"),C=h("./src/utils/logger.ts"),R=250,A=2,g=.1,c=.05,m=function(){function y(b,p,n,e){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=b,this.media=p,this.fragmentTracker=n,this.hls=e}var S=y.prototype;return S.destroy=function(){this.hls=this.fragmentTracker=this.media=null},S.poll=function(p){var n=this.config,e=this.media,r=this.stalled,t=e.currentTime,l=e.seeking,s=this.seeking&&!l,a=!this.seeking&&l;if(this.seeking=l,t!==p){if(this.moved=!0,r!==null){if(this.stallReported){var o=self.performance.now()-r;C.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(o)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((a||s)&&(this.stalled=null),!(e.paused||e.ended||e.playbackRate===0||!O.BufferHelper.getBuffered(e).length)){var E=O.BufferHelper.bufferInfo(e,t,0),x=E.len>0,f=E.nextStart||0;if(!(!x&&!f)){if(l){var u=E.len>A,d=!f||f-t>A&&!this.fragmentTracker.getPartialFragment(t);if(u||d)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var v,L=Math.max(f,E.start||0)-t,D=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,I=D==null||(v=D.details)===null||v===void 0?void 0:v.live,k=I?D.details.targetduration*2:A;if(L>0&&L<=k){this._trySkipBufferHole(null);return}}var w=self.performance.now();if(r===null){this.stalled=w;return}var _=w-r;!l&&_>=R&&this._reportStall(E.len);var F=O.BufferHelper.bufferInfo(e,t,n.maxBufferHole);this._tryFixBufferStall(F,_)}}},S._tryFixBufferStall=function(p,n){var e=this.config,r=this.fragmentTracker,t=this.media,l=t.currentTime,s=r.getPartialFragment(l);if(s){var a=this._trySkipBufferHole(s);if(a)return}p.len>e.maxBufferHole&&n>e.highBufferWatchdogPeriod*1e3&&(C.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},S._reportStall=function(p){var n=this.hls,e=this.media,r=this.stallReported;r||(this.stallReported=!0,C.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+p+")"),n.trigger(i.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:p}))},S._trySkipBufferHole=function(p){for(var n=this.config,e=this.hls,r=this.media,t=r.currentTime,l=0,s=O.BufferHelper.getBuffered(r),a=0;a<s.length;a++){var o=s.start(a);if(t+n.maxBufferHole>=l&&t<o){var E=Math.max(o+c,r.currentTime+g);return C.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+E),this.moved=!0,this.stalled=null,r.currentTime=E,p&&e.trigger(i.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+E,frag:p}),E}l=s.end(a)}return 0},S._tryNudgeBuffer=function(){var p=this.config,n=this.hls,e=this.media,r=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<p.nudgeMaxRetry){var l=r+t*p.nudgeOffset;C.logger.warn("Nudging 'currentTime' from "+r+" to "+l),e.currentTime=l,n.trigger(i.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else C.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+p.nudgeMaxRetry+" nudges"),n.trigger(i.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},y}()},"./src/controller/id3-track-controller.ts":function(N,P,h){h.r(P);var O=h("./src/events.ts"),T=h("./src/utils/texttrack-utils.ts"),i=h("./src/demux/id3.ts"),C=.25,R=function(){function A(c){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=c,this._registerListeners()}var g=A.prototype;return g.destroy=function(){this._unregisterListeners()},g._registerListeners=function(){var m=this.hls;m.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),m.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},g._unregisterListeners=function(){var m=this.hls;m.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),m.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},g.onMediaAttached=function(m,y){this.media=y.media},g.onMediaDetaching=function(){!this.id3Track||(Object(T.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},g.getID3Track=function(m){if(!!this.media){for(var y=0;y<m.length;y++){var S=m[y];if(S.kind==="metadata"&&S.label==="id3")return Object(T.sendAddTrackEvent)(S,this.media),S}return this.media.addTextTrack("metadata","id3")}},g.onFragParsingMetadata=function(m,y){if(!!this.media){var S=y.frag,b=y.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var p=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,n=0;n<b.length;n++){var e=i.getID3Frames(b[n].data);if(e){var r=b[n].pts,t=n<b.length-1?b[n+1].pts:S.end,l=t-r;l<=0&&(t=r+C);for(var s=0;s<e.length;s++){var a=e[s];if(!i.isTimeStampFrame(a)){var o=new p(r,t,"");o.value=a,this.id3Track.addCue(o)}}}}}},g.onBufferFlushing=function(m,y){var S=y.startOffset,b=y.endOffset,p=y.type;if(!p||p==="audio"){var n=this.id3Track;n&&Object(T.removeCuesInRange)(n,S,b)}},A}();P.default=R},"./src/controller/latency-controller.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return A});var O=h("./src/errors.ts"),T=h("./src/events.ts"),i=h("./src/utils/logger.ts");function C(g,c){for(var m=0;m<c.length;m++){var y=c[m];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(g,y.key,y)}}function R(g,c,m){return c&&C(g.prototype,c),m&&C(g,m),g}var A=function(){function g(m){var y=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return y.timeupdate()},this.hls=m,this.config=m.config,this.registerListeners()}var c=g.prototype;return c.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},c.registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(T.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(T.Events.ERROR,this.onError)},c.onMediaAttached=function(y,S){this.media=S.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},c.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},c.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},c.onLevelUpdated=function(y,S){var b=S.details;this.levelDetails=b,b.advanced&&this.timeupdate(),!b.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},c.onError=function(y,S){S.details===O.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,i.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},c.timeupdate=function(){var y=this.media,S=this.levelDetails;if(!(!y||!S)){this.currentTime=y.currentTime;var b=this.computeLatency();if(b!==null){this._latency=b;var p=this.config,n=p.lowLatencyMode,e=p.maxLiveSyncPlaybackRate;if(!(!n||e===1)){var r=this.targetLatency;if(r!==null){var t=b-r,l=Math.min(this.maxLatency,r+S.targetduration),s=t<l;if(S.live&&s&&t>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,e)),o=Math.round(2/(1+Math.exp(-.75*t-this.edgeStalled))*20)/20;y.playbackRate=Math.min(a,Math.max(1,o))}else y.playbackRate!==1&&y.playbackRate!==0&&(y.playbackRate=1)}}}}},c.estimateLiveEdge=function(){var y=this.levelDetails;return y===null?null:y.edge+y.age},c.computeLatency=function(){var y=this.estimateLiveEdge();return y===null?null:y-this.currentTime},R(g,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var y=this.config,S=this.levelDetails;return y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:S?y.liveMaxLatencyDurationCount*S.targetduration:0}},{key:"targetLatency",get:function(){var y=this.levelDetails;if(y===null)return null;var S=y.holdBack,b=y.partHoldBack,p=y.targetduration,n=this.config,e=n.liveSyncDuration,r=n.liveSyncDurationCount,t=n.lowLatencyMode,l=this.hls.userConfig,s=t&&b||S;(l.liveSyncDuration||l.liveSyncDurationCount||s===0)&&(s=e!==void 0?e:r*p);var a=p,o=1;return s+Math.min(this.stallCount*o,a)}},{key:"liveSyncPosition",get:function(){var y=this.estimateLiveEdge(),S=this.targetLatency,b=this.levelDetails;if(y===null||S===null||b===null)return null;var p=b.edge,n=y-S-this.edgeStalled,e=p-b.totalduration,r=p-(this.config.lowLatencyMode&&b.partTarget||b.targetduration);return Math.min(Math.max(e,n),r)}},{key:"drift",get:function(){var y=this.levelDetails;return y===null?1:y.drift}},{key:"edgeStalled",get:function(){var y=this.levelDetails;if(y===null)return 0;var S=(this.config.lowLatencyMode&&y.partTarget||y.targetduration)*3;return Math.max(y.age-S,0)}},{key:"forwardBufferLength",get:function(){var y=this.media,S=this.levelDetails;if(!y||!S)return 0;var b=y.buffered.length;return b?y.buffered.end(b-1):S.edge-this.currentTime}}]),g}()},"./src/controller/level-controller.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return n});var O=h("./src/types/level.ts"),T=h("./src/events.ts"),i=h("./src/errors.ts"),C=h("./src/utils/codecs.ts"),R=h("./src/controller/level-helper.ts"),A=h("./src/controller/base-playlist-controller.ts"),g=h("./src/types/loader.ts");function c(){return c=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},c.apply(this,arguments)}function m(e,r){for(var t=0;t<r.length;t++){var l=r[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function y(e,r,t){return r&&m(e.prototype,r),t&&m(e,t),e}function S(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,b(e,r)}function b(e,r){return b=Object.setPrototypeOf||function(l,s){return l.__proto__=s,l},b(e,r)}var p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function(e){S(r,e);function r(l){var s;return s=e.call(this,l,"[level-controller]")||this,s._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}var t=r.prototype;return t._registerListeners=function(){var s=this.hls;s.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(T.Events.ERROR,this.onError,this)},t._unregisterListeners=function(){var s=this.hls;s.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(T.Events.ERROR,this.onError,this)},t.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},t.startLoad=function(){var s=this._levels;s.forEach(function(a){a.loadError=0}),e.prototype.startLoad.call(this)},t.onManifestLoaded=function(s,a){var o=[],E=[],x=[],f,u={},d,v=!1,L=!1,D=!1;if(a.levels.forEach(function(_){var F=_.attrs;v=v||!!(_.width&&_.height),L=L||!!_.videoCodec,D=D||!!_.audioCodec,p&&_.audioCodec&&_.audioCodec.indexOf("mp4a.40.34")!==-1&&(_.audioCodec=void 0);var U=_.bitrate+"-"+_.attrs.RESOLUTION+"-"+_.attrs.CODECS;d=u[U],d?d.url.push(_.url):(d=new O.Level(_),u[U]=d,o.push(d)),F&&(F.AUDIO&&Object(R.addGroupId)(d,"audio",F.AUDIO),F.SUBTITLES&&Object(R.addGroupId)(d,"text",F.SUBTITLES))}),(v||L)&&D&&(o=o.filter(function(_){var F=_.videoCodec,U=_.width,W=_.height;return!!F||!!(U&&W)})),o=o.filter(function(_){var F=_.audioCodec,U=_.videoCodec;return(!F||Object(C.isCodecSupportedInMp4)(F,"audio"))&&(!U||Object(C.isCodecSupportedInMp4)(U,"video"))}),a.audioTracks&&(E=a.audioTracks.filter(function(_){return!_.audioCodec||Object(C.isCodecSupportedInMp4)(_.audioCodec,"audio")}),Object(R.assignTrackIdsByGroup)(E)),a.subtitles&&(x=a.subtitles,Object(R.assignTrackIdsByGroup)(x)),o.length>0){f=o[0].bitrate,o.sort(function(_,F){return _.bitrate-F.bitrate}),this._levels=o;for(var I=0;I<o.length;I++)if(o[I].bitrate===f){this._firstLevel=I,this.log("manifest loaded, "+o.length+" level(s) found, first bitrate: "+f);break}var k=D&&!L,w={levels:o,audioTracks:E,subtitleTracks:x,firstLevel:this._firstLevel,stats:a.stats,audio:D,video:L,altAudio:!k&&E.some(function(_){return!!_.url})};this.hls.trigger(T.Events.MANIFEST_PARSED,w),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(T.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},t.onError=function(s,a){if(e.prototype.onError.call(this,s,a),!a.fatal){var o=a.context,E=this._levels[this.currentLevelIndex];if(o&&(o.type===g.PlaylistContextType.AUDIO_TRACK&&E.audioGroupIds&&o.groupId===E.audioGroupIds[E.urlId]||o.type===g.PlaylistContextType.SUBTITLE_TRACK&&E.textGroupIds&&o.groupId===E.textGroupIds[E.urlId])){this.redundantFailover(this.currentLevelIndex);return}var x=!1,f=!0,u;switch(a.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var d=this._levels[a.frag.level];d?(d.fragmentError++,d.fragmentError>this.hls.config.fragLoadingMaxRetry&&(u=a.frag.level)):u=a.frag.level}break;case i.ErrorDetails.LEVEL_LOAD_ERROR:case i.ErrorDetails.LEVEL_LOAD_TIMEOUT:o&&(o.deliveryDirectives&&(f=!1),u=o.level),x=!0;break;case i.ErrorDetails.REMUX_ALLOC_ERROR:u=a.level,x=!0;break}u!==void 0&&this.recoverLevel(a,u,x,f)}},t.recoverLevel=function(s,a,o,E){var x=s.details,f=this._levels[a];if(f.loadError++,o){var u=this.retryLoadingOrFail(s);if(u)s.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(E){var d=f.url.length;if(d>1&&f.loadError<d)s.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){var v=a===0?this._levels.length-1:a-1;this.currentLevelIndex!==v&&this._levels[v].loadError===0&&(this.warn(x+": switch to "+v),s.levelRetry=!0,this.hls.nextAutoLevel=v)}}},t.redundantFailover=function(s){var a=this._levels[s],o=a.url.length;if(o>1){var E=(a.urlId+1)%o;this.warn("Switching to redundant URL-id "+E),this._levels.forEach(function(x){x.urlId=E}),this.level=s}},t.onFragLoaded=function(s,a){var o=a.frag;if(o!==void 0&&o.type===g.PlaylistLevelType.MAIN){var E=this._levels[o.level];E!==void 0&&(E.fragmentError=0,E.loadError=0)}},t.onLevelLoaded=function(s,a){var o,E=a.level,x=a.details,f=this._levels[E];if(!f){var u;this.warn("Invalid level index "+E),(u=a.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(x.deltaUpdateFailed=!0);return}E===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0,this.retryCount=0),this.playlistLoaded(E,a,f.details)):(o=a.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(x.deltaUpdateFailed=!0)},t.onAudioTrackSwitched=function(s,a){var o=this.hls.levels[this.currentLevelIndex];if(!!o&&o.audioGroupIds){for(var E=-1,x=this.hls.audioTracks[a.id].groupId,f=0;f<o.audioGroupIds.length;f++)if(o.audioGroupIds[f]===x){E=f;break}E!==o.urlId&&(o.urlId=E,this.startLoad())}},t.loadPlaylist=function(s){var a=this.currentLevelIndex,o=this._levels[a];if(this.canLoad&&o&&o.url.length>0){var E=o.urlId,x=o.url[E];if(s)try{x=s.addDirectives(x)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Attempt loading level index "+a+(s?" at sn "+s.msn+" part "+s.part:"")+" with URL-id "+E+" "+x),this.clearTimer(),this.hls.trigger(T.Events.LEVEL_LOADING,{url:x,level:a,id:E,deliveryDirectives:s||null})}},t.removeLevel=function(s,a){var o=function(f,u){return u!==a},E=this._levels.filter(function(x,f){return f!==s?!0:x.url.length>1&&a!==void 0?(x.url=x.url.filter(o),x.audioGroupIds&&(x.audioGroupIds=x.audioGroupIds.filter(o)),x.textGroupIds&&(x.textGroupIds=x.textGroupIds.filter(o)),x.urlId=0,!0):!1}).map(function(x,f){var u=x.details;return u!=null&&u.fragments&&u.fragments.forEach(function(d){d.level=f}),x});this._levels=E,this.hls.trigger(T.Events.LEVELS_UPDATED,{levels:E})},y(r,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(s){var a,o=this._levels;if(o.length!==0&&!(this.currentLevelIndex===s&&(a=o[s])!==null&&a!==void 0&&a.details)){if(s<0||s>=o.length){var E=s<0;if(this.hls.trigger(T.Events.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.LEVEL_SWITCH_ERROR,level:s,fatal:E,reason:"invalid level idx"}),E)return;s=Math.min(s,o.length-1)}this.clearTimer();var x=this.currentLevelIndex,f=o[x],u=o[s];this.log("switching to level "+s+" from "+x),this.currentLevelIndex=s;var d=c({},u,{level:s,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete d._urlId,this.hls.trigger(T.Events.LEVEL_SWITCHING,d);var v=u.details;if(!v||v.live){var L=this.switchParams(u.uri,f==null?void 0:f.details);this.loadPlaylist(L)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(s){this._firstLevel=s}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var s=this.hls.config.startLevel;return s!==void 0?s:this._firstLevel}else return this._startLevel},set:function(s){this._startLevel=s}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}}]),r}(A.default)},"./src/controller/level-helper.ts":function(N,P,h){h.r(P),h.d(P,"addGroupId",function(){return i}),h.d(P,"assignTrackIdsByGroup",function(){return C}),h.d(P,"updatePTS",function(){return R}),h.d(P,"updateFragPTSDTS",function(){return g}),h.d(P,"mergeDetails",function(){return c}),h.d(P,"mapPartIntersection",function(){return m}),h.d(P,"mapFragmentIntersection",function(){return y}),h.d(P,"adjustSliding",function(){return S}),h.d(P,"addSliding",function(){return b}),h.d(P,"computeReloadInterval",function(){return p}),h.d(P,"getFragmentWithSN",function(){return n}),h.d(P,"getPartWith",function(){return e});var O=h("./src/polyfills/number.ts"),T=h("./src/utils/logger.ts");function i(r,t,l){switch(t){case"audio":r.audioGroupIds||(r.audioGroupIds=[]),r.audioGroupIds.push(l);break;case"text":r.textGroupIds||(r.textGroupIds=[]),r.textGroupIds.push(l);break}}function C(r){var t={};r.forEach(function(l){var s=l.groupId||"";l.id=t[s]=t[s]||0,t[s]++})}function R(r,t,l){var s=r[t],a=r[l];A(s,a)}function A(r,t){var l=t.startPTS;if(Object(O.isFiniteNumber)(l)){var s=0,a;t.sn>r.sn?(s=l-r.start,a=r):(s=r.start-l,a=t),a.duration!==s&&(a.duration=s)}else if(t.sn>r.sn){var o=r.cc===t.cc;o&&r.minEndPTS?t.start=r.start+(r.minEndPTS-r.start):t.start=r.start+r.duration}else t.start=Math.max(r.start-t.duration,0)}function g(r,t,l,s,a,o){var E=s-l;E<=0&&(T.logger.warn("Fragment should have a positive duration",t),s=l+t.duration,o=a+t.duration);var x=l,f=s,u=t.startPTS,d=t.endPTS;if(Object(O.isFiniteNumber)(u)){var v=Math.abs(u-l);Object(O.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(v,t.deltaPTS):t.deltaPTS=v,x=Math.max(l,u),l=Math.min(l,u),a=Math.min(a,t.startDTS),f=Math.min(s,d),s=Math.max(s,d),o=Math.max(o,t.endDTS)}t.duration=s-l;var L=l-t.start;t.appendedPTS=s,t.start=t.startPTS=l,t.maxStartPTS=x,t.startDTS=a,t.endPTS=s,t.minEndPTS=f,t.endDTS=o;var D=t.sn;if(!r||D<r.startSN||D>r.endSN)return 0;var I,k=D-r.startSN,w=r.fragments;for(w[k]=t,I=k;I>0;I--)A(w[I],w[I-1]);for(I=k;I<w.length-1;I++)A(w[I],w[I+1]);return r.fragmentHint&&A(w[w.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,L}function c(r,t){for(var l=null,s=r.fragments,a=s.length-1;a>=0;a--){var o=s[a].initSegment;if(o){l=o;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;var E=0,x;if(y(r,t,function(I,k){I.relurl&&(E=I.cc-k.cc),Object(O.isFiniteNumber)(I.startPTS)&&Object(O.isFiniteNumber)(I.endPTS)&&(k.start=k.startPTS=I.startPTS,k.startDTS=I.startDTS,k.appendedPTS=I.appendedPTS,k.maxStartPTS=I.maxStartPTS,k.endPTS=I.endPTS,k.endDTS=I.endDTS,k.minEndPTS=I.minEndPTS,k.duration=I.endPTS-I.startPTS,k.duration&&(x=k),t.PTSKnown=t.alignedSliding=!0),k.elementaryStreams=I.elementaryStreams,k.loader=I.loader,k.stats=I.stats,k.urlId=I.urlId,I.initSegment&&(k.initSegment=I.initSegment,l=I.initSegment)}),l){var f=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;f.forEach(function(I){var k;(!I.initSegment||I.initSegment.relurl===((k=l)===null||k===void 0?void 0:k.relurl))&&(I.initSegment=l)})}if(t.skippedSegments&&(t.deltaUpdateFailed=t.fragments.some(function(I){return!I}),t.deltaUpdateFailed)){T.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=t.skippedSegments;u--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}var d=t.fragments;if(E){T.logger.warn("discontinuity sliding from playlist, take drift into account");for(var v=0;v<d.length;v++)d[v].cc+=E}t.skippedSegments&&(t.startCC=t.fragments[0].cc),m(r.partList,t.partList,function(I,k){k.elementaryStreams=I.elementaryStreams,k.stats=I.stats}),x?g(t,x,x.startPTS,x.endPTS,x.startDTS,x.endDTS):S(r,t),d.length&&(t.totalduration=t.edge-d[0].start),t.driftStartTime=r.driftStartTime,t.driftStart=r.driftStart;var L=t.advancedDateTime;if(t.advanced&&L){var D=t.edge;t.driftStart||(t.driftStartTime=L,t.driftStart=D),t.driftEndTime=L,t.driftEnd=D}else t.driftEndTime=r.driftEndTime,t.driftEnd=r.driftEnd,t.advancedDateTime=r.advancedDateTime}function m(r,t,l){if(r&&t)for(var s=0,a=0,o=r.length;a<=o;a++){var E=r[a],x=t[a+s];E&&x&&E.index===x.index&&E.fragment.sn===x.fragment.sn?l(E,x):s--}}function y(r,t,l){for(var s=t.skippedSegments,a=Math.max(r.startSN,t.startSN)-t.startSN,o=(r.fragmentHint?1:0)+(s?t.endSN:Math.min(r.endSN,t.endSN))-t.startSN,E=t.startSN-r.startSN,x=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,f=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,u=a;u<=o;u++){var d=f[E+u],v=x[u];s&&!v&&u<s&&(v=t.fragments[u]=d),d&&v&&l(d,v)}}function S(r,t){var l=t.startSN+t.skippedSegments-r.startSN,s=r.fragments;l<0||l>=s.length||b(t,s[l].start)}function b(r,t){if(t){for(var l=r.fragments,s=r.skippedSegments;s<l.length;s++)l[s].start+=t;r.fragmentHint&&(r.fragmentHint.start+=t)}}function p(r,t){var l=1e3*r.levelTargetDuration,s=l/2,a=r.age,o=a>0&&a<l*3,E=t.loading.end-t.loading.start,x,f=r.availabilityDelay;if(r.updated===!1)if(o){var u=333*r.misses;x=Math.max(Math.min(s,E*2),u),r.availabilityDelay=(r.availabilityDelay||0)+x}else x=s;else o?(f=Math.min(f||l/2,a),r.availabilityDelay=f,x=f+l-a):x=l-E;return Math.round(x)}function n(r,t,l){if(!r||!r.details)return null;var s=r.details,a=s.fragments[t-s.startSN];return a||(a=s.fragmentHint,a&&a.sn===t)?a:t<s.startSN&&l&&l.sn===t?l:null}function e(r,t,l){if(!r||!r.details)return null;var s=r.details.partList;if(s)for(var a=s.length;a--;){var o=s[a];if(o.index===l&&o.fragment.sn===t)return o}return null}},"./src/controller/stream-controller.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return s});var O=h("./src/polyfills/number.ts"),T=h("./src/controller/base-stream-controller.ts"),i=h("./src/is-supported.ts"),C=h("./src/events.ts"),R=h("./src/utils/buffer-helper.ts"),A=h("./src/controller/fragment-tracker.ts"),g=h("./src/types/loader.ts"),c=h("./src/loader/fragment.ts"),m=h("./src/demux/transmuxer-interface.ts"),y=h("./src/types/transmuxer.ts"),S=h("./src/controller/gap-controller.ts"),b=h("./src/errors.ts"),p=h("./src/utils/logger.ts");function n(a,o){for(var E=0;E<o.length;E++){var x=o[E];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(a,x.key,x)}}function e(a,o,E){return o&&n(a.prototype,o),E&&n(a,E),a}function r(a,o){a.prototype=Object.create(o.prototype),a.prototype.constructor=a,t(a,o)}function t(a,o){return t=Object.setPrototypeOf||function(x,f){return x.__proto__=f,x},t(a,o)}var l=100,s=function(a){r(o,a);function o(x,f){var u;return u=a.call(this,x,f,"[stream-controller]")||this,u.audioCodecSwap=!1,u.gapController=null,u.level=-1,u._forceStartLoad=!1,u.altAudio=!1,u.audioOnly=!1,u.fragPlaying=null,u.onvplaying=null,u.onvseeked=null,u.fragLastKbps=0,u.stalled=!1,u.couldBacktrack=!1,u.audioCodecSwitch=!1,u.videoBuffer=null,u._registerListeners(),u}var E=o.prototype;return E._registerListeners=function(){var f=this.hls;f.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.on(C.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),f.on(C.Events.ERROR,this.onError,this),f.on(C.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.on(C.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),f.on(C.Events.BUFFER_CREATED,this.onBufferCreated,this),f.on(C.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.on(C.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),f.on(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E._unregisterListeners=function(){var f=this.hls;f.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.off(C.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),f.off(C.Events.ERROR,this.onError,this),f.off(C.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.off(C.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),f.off(C.Events.BUFFER_CREATED,this.onBufferCreated,this),f.off(C.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.off(C.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),f.off(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},E.startLoad=function(f){if(this.levels){var u=this.lastCurrentTime,d=this.hls;if(this.stopLoad(),this.setInterval(l),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var v=d.startLevel;v===-1&&(d.config.testBandwidth?(v=0,this.bitrateTest=!0):v=d.nextAutoLevel),this.level=d.nextLoadLevel=v,this.loadedmetadata=!1}u>0&&f===-1&&(this.log("Override startPosition with lastCurrentTime @"+u.toFixed(3)),f=u),this.state=T.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=f,this.tick()}else this._forceStartLoad=!0,this.state=T.State.STOPPED},E.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},E.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_LEVEL:{var f,u=this.levels,d=this.level,v=u==null||(f=u[d])===null||f===void 0?void 0:f.details;if(v&&(!v.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(v))break;this.state=T.State.IDLE;break}break}case T.State.FRAG_LOADING_WAITING_RETRY:{var L,D=self.performance.now(),I=this.retryDate;(!I||D>=I||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=T.State.IDLE)}break}this.onTickEnd()},E.onTickEnd=function(){a.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},E.doTickIdle=function(){var f,u,d=this.hls,v=this.levelLastLoaded,L=this.levels,D=this.media,I=d.config,k=d.nextLoadLevel;if(!(v===null||!D&&(this.startFragRequested||!I.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!L||!L[k])){var w=L[k];this.level=d.nextLoadLevel=k;var _=w.details;if(!_||this.state===T.State.WAITING_LEVEL||_.live&&this.levelLastLoaded!==k){this.state=T.State.WAITING_LEVEL;return}var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:D,g.PlaylistLevelType.MAIN);if(F!==null){var U=F.len,W=this.getMaxBufferLength(w.maxBitrate);if(!(U>=W)){if(this._streamEnded(F,_)){var V={};this.altAudio&&(V.type="video"),this.hls.trigger(C.Events.BUFFER_EOS,V),this.state=T.State.ENDED;return}var X=F.end,Y=this.getNextFragment(X,_);if(this.couldBacktrack&&!this.fragPrevious&&Y&&Y.sn!=="initSegment"){var J=Y.sn-_.startSN;J>1&&(Y=_.fragments[J-1],this.fragmentTracker.removeFragment(Y))}if(Y&&this.fragmentTracker.getState(Y)===A.FragmentState.OK&&this.nextLoadPosition>X){var q=this.audioOnly&&!this.altAudio?c.ElementaryStreamTypes.AUDIO:c.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(D,q,g.PlaylistLevelType.MAIN),Y=this.getNextFragment(this.nextLoadPosition,_)}!Y||(Y.initSegment&&!Y.initSegment.data&&!this.bitrateTest&&(Y=Y.initSegment),((f=Y.decryptdata)===null||f===void 0?void 0:f.keyFormat)==="identity"&&!((u=Y.decryptdata)!==null&&u!==void 0&&u.key)?this.loadKey(Y,_):this.loadFragment(Y,_,X))}}}},E.loadFragment=function(f,u,d){var v,L=this.fragmentTracker.getState(f);if(this.fragCurrent=f,L===A.FragmentState.BACKTRACKED){var D=this.fragmentTracker.getBacktrackData(f);if(D){this._handleFragmentLoadProgress(D),this._handleFragmentLoadComplete(D);return}else L=A.FragmentState.NOT_LOADED}L===A.FragmentState.NOT_LOADED||L===A.FragmentState.PARTIAL?f.sn==="initSegment"?this._loadInitSegment(f):this.bitrateTest?(f.bitrateTest=!0,this.log("Fragment "+f.sn+" of level "+f.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(f)):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,f,u,d)):L===A.FragmentState.APPENDING?this.reduceMaxBufferLength(f.duration)&&this.fragmentTracker.removeFragment(f):((v=this.media)===null||v===void 0?void 0:v.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},E.getAppendedFrag=function(f){var u=this.fragmentTracker.getAppendedFrag(f,g.PlaylistLevelType.MAIN);return u&&"fragment"in u?u.fragment:u},E.getBufferedFrag=function(f){return this.fragmentTracker.getBufferedFrag(f,g.PlaylistLevelType.MAIN)},E.followingBufferedFrag=function(f){return f?this.getBufferedFrag(f.end+.5):null},E.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},E.nextLevelSwitch=function(){var f=this.levels,u=this.media;if(u!=null&&u.readyState){var d,v=this.getAppendedFrag(u.currentTime);if(v&&v.start>1&&this.flushMainBuffer(0,v.start-1),!u.paused&&f){var L=this.hls.nextLoadLevel,D=f[L],I=this.fragLastKbps;I&&this.fragCurrent?d=this.fragCurrent.duration*D.maxBitrate/(1e3*I)+1:d=0}else d=0;var k=this.getBufferedFrag(u.currentTime+d);if(k){var w=this.followingBufferedFrag(k);if(w){this.abortCurrentFrag();var _=w.maxStartPTS?w.maxStartPTS:w.start,F=w.duration,U=Math.max(k.end,_+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,F*.5),F*.75));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},E.abortCurrentFrag=function(){var f=this.fragCurrent;this.fragCurrent=null,f!=null&&f.loader&&f.loader.abort(),this.state===T.State.KEY_LOADING&&(this.state=T.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},E.flushMainBuffer=function(f,u){a.prototype.flushMainBuffer.call(this,f,u,this.altAudio?"video":null)},E.onMediaAttached=function(f,u){a.prototype.onMediaAttached.call(this,f,u);var d=u.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),d.addEventListener("playing",this.onvplaying),d.addEventListener("seeked",this.onvseeked),this.gapController=new S.default(this.config,d,this.fragmentTracker,this.hls)},E.onMediaDetaching=function(){var f=this.media;f&&(f.removeEventListener("playing",this.onvplaying),f.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),a.prototype.onMediaDetaching.call(this)},E.onMediaPlaying=function(){this.tick()},E.onMediaSeeked=function(){var f=this.media,u=f?f.currentTime:null;Object(O.isFiniteNumber)(u)&&this.log("Media seeked to "+u.toFixed(3)),this.tick()},E.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(C.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},E.onManifestParsed=function(f,u){var d=!1,v=!1,L;u.levels.forEach(function(D){L=D.audioCodec,L&&(L.indexOf("mp4a.40.2")!==-1&&(d=!0),L.indexOf("mp4a.40.5")!==-1&&(v=!0))}),this.audioCodecSwitch=d&&v&&!Object(i.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=u.levels,this.startFragRequested=!1},E.onLevelLoading=function(f,u){var d=this.levels;if(!(!d||this.state!==T.State.IDLE)){var v=d[u.level];(!v.details||v.details.live&&this.levelLastLoaded!==u.level||this.waitForCdnTuneIn(v.details))&&(this.state=T.State.WAITING_LEVEL)}},E.onLevelLoaded=function(f,u){var d,v=this.levels,L=u.level,D=u.details,I=D.totalduration;if(!v){this.warn("Levels were reset while loading level "+L);return}this.log("Level "+L+" loaded ["+D.startSN+","+D.endSN+"], cc ["+D.startCC+", "+D.endCC+"] duration:"+I);var k=this.fragCurrent;k&&(this.state===T.State.FRAG_LOADING||this.state===T.State.FRAG_LOADING_WAITING_RETRY)&&k.level!==u.level&&k.loader&&(this.state=T.State.IDLE,k.loader.abort());var w=v[L],_=0;if(D.live||(d=w.details)!==null&&d!==void 0&&d.live){if(D.fragments[0]||(D.deltaUpdateFailed=!0),D.deltaUpdateFailed)return;_=this.alignPlaylists(D,w.details)}if(w.details=D,this.levelLastLoaded=L,this.hls.trigger(C.Events.LEVEL_UPDATED,{details:D,level:L}),this.state===T.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(D))return;this.state=T.State.IDLE}this.startFragRequested?D.live&&this.synchronizeToLiveEdge(D):this.setStartPosition(D,_),this.tick()},E._handleFragmentLoadProgress=function(f){var u,d=f.frag,v=f.part,L=f.payload,D=this.levels;if(!D){this.warn("Levels were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered");return}var I=D[d.level],k=I.details;if(!k){this.warn("Dropping fragment "+d.sn+" of level "+d.level+" after level details were reset");return}var w=I.videoCodec,_=k.PTSKnown||!k.live,F=(u=d.initSegment)===null||u===void 0?void 0:u.data,U=this._getAudioCodec(I),W=this.transmuxer=this.transmuxer||new m.default(this.hls,g.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),V=v?v.index:-1,X=V!==-1,Y=new y.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,L.byteLength,V,X),J=this.initPTS[d.cc];W.push(L,F,U,w,d,v,k.totalduration,_,Y,J)},E.onAudioTrackSwitching=function(f,u){var d=this.altAudio,v=!!u.url,L=u.id;if(!v){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var D=this.fragCurrent;D!=null&&D.loader&&(this.log("Switching to main audio track, cancel main fragment load"),D.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var I=this.hls;d&&I.trigger(C.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),I.trigger(C.Events.AUDIO_TRACK_SWITCHED,{id:L})}},E.onAudioTrackSwitched=function(f,u){var d=u.id,v=!!this.hls.audioTracks[d].url;if(v){var L=this.videoBuffer;L&&this.mediaBuffer!==L&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=L)}this.altAudio=v,this.tick()},E.onBufferCreated=function(f,u){var d=u.tracks,v,L,D=!1;for(var I in d){var k=d[I];if(k.id==="main"){if(L=I,v=k,I==="video"){var w=d[I];w&&(this.videoBuffer=w.buffer)}}else D=!0}D&&v?(this.log("Alternate track found, use "+L+".buffered to schedule main fragment loading"),this.mediaBuffer=v.buffer):this.mediaBuffer=this.media},E.onFragBuffered=function(f,u){var d=u.frag,v=u.part;if(!(d&&d.type!==g.PlaylistLevelType.MAIN)){if(this.fragContextChanged(d)){this.warn("Fragment "+d.sn+(v?" p: "+v.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state),this.state===T.State.PARSED&&(this.state=T.State.IDLE);return}var L=v?v.stats:d.stats;this.fragLastKbps=Math.round(8*L.total/(L.buffering.end-L.loading.first)),d.sn!=="initSegment"&&(this.fragPrevious=d),this.fragBufferedComplete(d,v)}},E.onError=function(f,u){switch(u.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(g.PlaylistLevelType.MAIN,u);break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==T.State.ERROR&&(u.fatal?(this.warn(""+u.details),this.state=T.State.ERROR):!u.levelRetry&&this.state===T.State.WAITING_LEVEL&&(this.state=T.State.IDLE));break;case b.ErrorDetails.BUFFER_FULL_ERROR:if(u.parent==="main"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var d=!0,v=this.getFwdBufferInfo(this.media,g.PlaylistLevelType.MAIN);v&&v.len>.5&&(d=!this.reduceMaxBufferLength(v.len)),d&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},E.checkBuffer=function(){var f=this.media,u=this.gapController;if(!(!f||!u||!f.readyState)){var d=R.BufferHelper.getBuffered(f);!this.loadedmetadata&&d.length?(this.loadedmetadata=!0,this.seekToStartPos()):u.poll(this.lastCurrentTime),this.lastCurrentTime=f.currentTime}},E.onFragLoadEmergencyAborted=function(){this.state=T.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},E.onBufferFlushed=function(f,u){var d=u.type;if(d!==c.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var v=(d===c.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(v,d,g.PlaylistLevelType.MAIN)}},E.onLevelsUpdated=function(f,u){this.levels=u.levels},E.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},E.seekToStartPos=function(){var f=this.media,u=f.currentTime,d=this.startPosition;if(d>=0&&u<d){if(f.seeking){p.logger.log("could not seek to "+d+", already seeking at "+u);return}var v=R.BufferHelper.getBuffered(f),L=v.length?v.start(0):0,D=L-d;D>0&&(D<this.config.maxBufferHole||D<this.config.maxFragLookUpTolerance)&&(p.logger.log("adjusting start position by "+D+" to match buffer start"),d+=D,this.startPosition=d),this.log("seek to target start position "+d+" from current time "+u),f.currentTime=d}},E._getAudioCodec=function(f){var u=this.config.defaultAudioCodec||f.audioCodec;return this.audioCodecSwap&&u&&(this.log("Swapping audio codec"),u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5"),u},E._loadBitrateTestFrag=function(f){var u=this;this._doFragLoad(f).then(function(d){var v=u.hls;if(!(!d||v.nextLoadLevel||u.fragContextChanged(f))){u.fragLoadError=0,u.state=T.State.IDLE,u.startFragRequested=!1,u.bitrateTest=!1;var L=f.stats;L.parsing.start=L.parsing.end=L.buffering.start=L.buffering.end=self.performance.now(),v.trigger(C.Events.FRAG_LOADED,d)}})},E._handleTransmuxComplete=function(f){var u,d="main",v=this.hls,L=f.remuxResult,D=f.chunkMeta,I=this.getCurrentContext(D);if(!I){this.warn("The loading context changed while buffering fragment "+D.sn+" of level "+D.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(D.level);return}var k=I.frag,w=I.part,_=I.level,F=L.video,U=L.text,W=L.id3,V=L.initSegment,X=this.altAudio?void 0:L.audio;if(!this.fragContextChanged(k)){if(this.state=T.State.PARSING,V){V.tracks&&(this._bufferInitSegment(_,V.tracks,k,D),v.trigger(C.Events.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:d,tracks:V.tracks}));var Y=V.initPTS,J=V.timescale;Object(O.isFiniteNumber)(Y)&&(this.initPTS[k.cc]=Y,v.trigger(C.Events.INIT_PTS_FOUND,{frag:k,id:d,initPTS:Y,timescale:J}))}if(F&&L.independent!==!1){if(_.details){var q=F.startPTS,$=F.endPTS,ne=F.startDTS,ee=F.endDTS;if(w)w.elementaryStreams[F.type]={startPTS:q,endPTS:$,startDTS:ne,endDTS:ee};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var Z=this.getLoadPosition()+this.config.maxBufferHole;if(Z<q){this.backtrack(k);return}k.setElementaryStreamInfo(F.type,k.start,$,k.start,ee,!0)}k.setElementaryStreamInfo(F.type,q,$,ne,ee),this.bufferFragmentData(F,k,w,D)}}else if(L.independent===!1){this.backtrack(k);return}if(X){var ie=X.startPTS,ae=X.endPTS,se=X.startDTS,ue=X.endDTS;w&&(w.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:ie,endPTS:ae,startDTS:se,endDTS:ue}),k.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,ie,ae,se,ue),this.bufferFragmentData(X,k,w,D)}if(W!=null&&(u=W.samples)!==null&&u!==void 0&&u.length){var fe={frag:k,id:d,samples:W.samples};v.trigger(C.Events.FRAG_PARSING_METADATA,fe)}if(U){var de={frag:k,id:d,samples:U.samples};v.trigger(C.Events.FRAG_PARSING_USERDATA,de)}}},E._bufferInitSegment=function(f,u,d,v){var L=this;if(this.state===T.State.PARSING){this.audioOnly=!!u.audio&&!u.video,this.altAudio&&!this.audioOnly&&delete u.audio;var D=u.audio,I=u.video,k=u.audiovideo;if(D){var w=f.audioCodec,_=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(w&&(w.indexOf("mp4a.40.5")!==-1?w="mp4a.40.2":w="mp4a.40.5"),D.metadata.channelCount!==1&&_.indexOf("firefox")===-1&&(w="mp4a.40.5")),_.indexOf("android")!==-1&&D.container!=="audio/mpeg"&&(w="mp4a.40.2",this.log("Android: force audio codec to "+w)),f.audioCodec&&f.audioCodec!==w&&this.log('Swapping manifest audio codec "'+f.audioCodec+'" for "'+w+'"'),D.levelCodec=w,D.id="main",this.log("Init audio buffer, container:"+D.container+", codecs[selected/level/parsed]=["+(w||"")+"/"+(f.audioCodec||"")+"/"+D.codec+"]")}I&&(I.levelCodec=f.videoCodec,I.id="main",this.log("Init video buffer, container:"+I.container+", codecs[level/parsed]=["+(f.videoCodec||"")+"/"+I.codec+"]")),k&&this.log("Init audiovideo buffer, container:"+k.container+", codecs[level/parsed]=["+(f.attrs.CODECS||"")+"/"+k.codec+"]"),this.hls.trigger(C.Events.BUFFER_CODECS,u),Object.keys(u).forEach(function(F){var U=u[F],W=U.initSegment;W!=null&&W.byteLength&&L.hls.trigger(C.Events.BUFFER_APPENDING,{type:F,data:W,frag:d,part:null,chunkMeta:v,parent:d.type})}),this.tick()}},E.backtrack=function(f){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(f);var u=this.fragmentTracker.backtrack(f);this.fragPrevious=null,this.nextLoadPosition=f.start,u?this.resetFragmentLoading(f):this.state=T.State.BACKTRACKING},E.checkFragmentChanged=function(){var f=this.media,u=null;if(f&&f.readyState>1&&f.seeking===!1){var d=f.currentTime;if(R.BufferHelper.isBuffered(f,d)?u=this.getAppendedFrag(d):R.BufferHelper.isBuffered(f,d+.1)&&(u=this.getAppendedFrag(d+.1)),u){var v=this.fragPlaying,L=u.level;(!v||u.sn!==v.sn||v.level!==L||u.urlId!==v.urlId)&&(this.hls.trigger(C.Events.FRAG_CHANGED,{frag:u}),(!v||v.level!==L)&&this.hls.trigger(C.Events.LEVEL_SWITCHED,{level:L}),this.fragPlaying=u)}}},e(o,[{key:"nextLevel",get:function(){var f=this.nextBufferedFrag;return f?f.level:-1}},{key:"currentLevel",get:function(){var f=this.media;if(f){var u=this.getAppendedFrag(f.currentTime);if(u)return u.level}return-1}},{key:"nextBufferedFrag",get:function(){var f=this.media;if(f){var u=this.getAppendedFrag(f.currentTime);return this.followingBufferedFrag(u)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),o}(T.default)},"./src/controller/subtitle-stream-controller.ts":function(N,P,h){h.r(P),h.d(P,"SubtitleStreamController",function(){return e});var O=h("./src/events.ts"),T=h("./src/utils/buffer-helper.ts"),i=h("./src/controller/fragment-finders.ts"),C=h("./src/utils/discontinuities.ts"),R=h("./src/controller/level-helper.ts"),A=h("./src/controller/fragment-tracker.ts"),g=h("./src/controller/base-stream-controller.ts"),c=h("./src/types/loader.ts"),m=h("./src/types/level.ts");function y(r,t){for(var l=0;l<t.length;l++){var s=t[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(r,s.key,s)}}function S(r,t,l){return t&&y(r.prototype,t),l&&y(r,l),r}function b(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,p(r,t)}function p(r,t){return p=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},p(r,t)}var n=500,e=function(r){b(t,r);function t(s,a){var o;return o=r.call(this,s,a,"[subtitle-stream-controller]")||this,o.levels=[],o.currentTrackId=-1,o.tracksBuffered=[],o.mainDetails=null,o._registerListeners(),o}var l=t.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var a=this.hls;a.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(O.Events.ERROR,this.onError,this),a.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(O.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.on(O.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(O.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l._unregisterListeners=function(){var a=this.hls;a.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(O.Events.ERROR,this.onError,this),a.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(O.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.off(O.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(O.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l.startLoad=function(){this.stopLoad(),this.state=g.State.IDLE,this.setInterval(n),this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onLevelLoaded=function(a,o){this.mainDetails=o.details},l.onSubtitleFragProcessed=function(a,o){var E=o.frag,x=o.success;if(this.fragPrevious=E,this.state=g.State.IDLE,!!x){var f=this.tracksBuffered[this.currentTrackId];if(!!f){for(var u,d=E.start,v=0;v<f.length;v++)if(d>=f[v].start&&d<=f[v].end){u=f[v];break}var L=E.start+E.duration;u?u.end=L:(u={start:d,end:L},f.push(u)),this.fragmentTracker.fragBuffered(E)}}},l.onBufferFlushing=function(a,o){var E=o.startOffset,x=o.endOffset;if(E===0&&x!==Number.POSITIVE_INFINITY){var f=this.currentTrackId,u=this.levels;if(!u.length||!u[f]||!u[f].details)return;var d=u[f].details,v=d.targetduration,L=x-v;if(L<=0)return;o.endOffsetSubtitles=Math.max(0,L),this.tracksBuffered.forEach(function(D){for(var I=0;I<D.length;){if(D[I].end<=L){D.shift();continue}else if(D[I].start<L)D[I].start=L;else break;I++}}),this.fragmentTracker.removeFragmentsInRange(E,L,c.PlaylistLevelType.SUBTITLE)}},l.onError=function(a,o){var E,x=o.frag;!x||x.type!==c.PlaylistLevelType.SUBTITLE||((E=this.fragCurrent)!==null&&E!==void 0&&E.loader&&this.fragCurrent.loader.abort(),this.state=g.State.IDLE)},l.onSubtitleTracksUpdated=function(a,o){var E=this,x=o.subtitleTracks;this.tracksBuffered=[],this.levels=x.map(function(f){return new m.Level(f)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(f){E.tracksBuffered[f.id]=[]}),this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(a,o){if(this.currentTrackId=o.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var E=this.levels[this.currentTrackId];E!=null&&E.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,E&&this.setInterval(n)},l.onSubtitleTrackLoaded=function(a,o){var E,x=o.details,f=o.id,u=this.currentTrackId,d=this.levels;if(!!d.length){var v=d[u];if(!(f>=d.length||f!==u||!v)){if(this.mediaBuffer=this.mediaBufferTimeRanges,x.live||(E=v.details)!==null&&E!==void 0&&E.live){var L=this.mainDetails;if(x.deltaUpdateFailed||!L)return;var D=L.fragments[0];if(!v.details)x.hasProgramDateTime&&L.hasProgramDateTime?Object(C.alignMediaPlaylistByPDT)(x,L):D&&Object(R.addSliding)(x,D.start);else{var I=this.alignPlaylists(x,v.details);I===0&&D&&Object(R.addSliding)(x,D.start)}}if(v.details=x,this.levelLastLoaded=f,this.tick(),x.live&&!this.fragCurrent&&this.media&&this.state===g.State.IDLE){var k=Object(i.findFragmentByPTS)(null,x.fragments,this.media.currentTime,0);k||(this.warn("Subtitle playlist not aligned with playback"),v.details=void 0)}}}},l._handleFragmentLoadComplete=function(a){var o=a.frag,E=a.payload,x=o.decryptdata,f=this.hls;if(!this.fragContextChanged(o)&&E&&E.byteLength>0&&x&&x.key&&x.iv&&x.method==="AES-128"){var u=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(E),x.key.buffer,x.iv.buffer).then(function(d){var v=performance.now();f.trigger(O.Events.FRAG_DECRYPTED,{frag:o,payload:d,stats:{tstart:u,tdecrypt:v}})})}},l.doTick=function(){if(!this.media){this.state=g.State.IDLE;return}if(this.state===g.State.IDLE){var a,o=this.currentTrackId,E=this.levels;if(!E.length||!E[o]||!E[o].details)return;var x=E[o].details,f=x.targetduration,u=this.config,d=this.media,v=T.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,d.currentTime-f,u.maxBufferHole),L=v.end,D=v.len,I=this.getMaxBufferLength()+f;if(D>I)return;console.assert(x,"Subtitle track details are defined on idle subtitle stream controller tick");var k=x.fragments,w=k.length,_=x.edge,F,U=this.fragPrevious;if(L<_){var W=u.maxFragLookUpTolerance;F=Object(i.findFragmentByPTS)(U,k,L,W),!F&&U&&U.start<k[0].start&&(F=k[0])}else F=k[w-1];(a=F)!==null&&a!==void 0&&a.encrypted?this.loadKey(F,x):F&&this.fragmentTracker.getState(F)===A.FragmentState.NOT_LOADED&&this.loadFragment(F,x,L)}},l.loadFragment=function(a,o,E){this.fragCurrent=a,r.prototype.loadFragment.call(this,a,o,E)},S(t,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),t}(g.default)},"./src/controller/subtitle-track-controller.ts":function(N,P,h){h.r(P);var O=h("./src/events.ts"),T=h("./src/utils/texttrack-utils.ts"),i=h("./src/controller/base-playlist-controller.ts"),C=h("./src/types/loader.ts");function R(S,b){for(var p=0;p<b.length;p++){var n=b[p];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(S,n.key,n)}}function A(S,b,p){return b&&R(S.prototype,b),p&&R(S,p),S}function g(S,b){S.prototype=Object.create(b.prototype),S.prototype.constructor=S,c(S,b)}function c(S,b){return c=Object.setPrototypeOf||function(n,e){return n.__proto__=e,n},c(S,b)}var m=function(S){g(b,S);function b(n){var e;return e=S.call(this,n,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e.subtitleDisplay=!0,e.registerListeners(),e}var p=b.prototype;return p.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,S.prototype.destroy.call(this)},p.registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.Events.ERROR,this.onError,this)},p.onMediaAttached=function(e,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},p.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},p.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=y(this.media.textTracks);e.forEach(function(r){Object(T.clearCurrentCues)(r)}),this.subtitleTrack=-1,this.media=null}},p.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},p.onManifestParsed=function(e,r){this.tracks=r.subtitleTracks},p.onSubtitleTrackLoaded=function(e,r){var t=r.id,l=r.details,s=this.trackId,a=this.tracksInGroup[s];if(!a){this.warn("Invalid subtitle track id "+t);return}var o=a.details;a.details=r.details,this.log("subtitle track "+t+" loaded ["+l.startSN+"-"+l.endSN+"]"),t===this.trackId&&(this.retryCount=0,this.playlistLoaded(t,r,o))},p.onLevelLoading=function(e,r){this.switchLevel(r.level)},p.onLevelSwitching=function(e,r){this.switchLevel(r.level)},p.switchLevel=function(e){var r=this.hls.levels[e];if(!!(r!=null&&r.textGroupIds)){var t=r.textGroupIds[r.urlId];if(this.groupId!==t){var l=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter(function(E){return!t||E.groupId===t});this.tracksInGroup=s;var a=this.findTrackId(l==null?void 0:l.name)||this.findTrackId();this.groupId=t;var o={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+t+'" group-id'),this.hls.trigger(O.Events.SUBTITLE_TRACKS_UPDATED,o),a!==-1&&this.setSubtitleTrack(a,l)}}},p.findTrackId=function(e){for(var r=this.tracksInGroup,t=0;t<r.length;t++){var l=r[t];if((!this.selectDefaultTrack||l.default)&&(!e||e===l.name))return l.id}return-1},p.onError=function(e,r){S.prototype.onError.call(this,e,r),!(r.fatal||!r.context)&&r.context.type===C.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},p.loadPlaylist=function(e){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var t=r.id,l=r.groupId,s=r.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Loading subtitle playlist for id "+t),this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADING,{url:s,id:t,groupId:l,deliveryDirectives:e||null})}},p.toggleTrackModes=function(e){var r=this,t=this.media,l=this.subtitleDisplay,s=this.trackId;if(!!t){var a=y(t.textTracks),o=a.filter(function(f){return f.groupId===r.groupId});if(e===-1)[].slice.call(a).forEach(function(f){f.mode="disabled"});else{var E=o[s];E&&(E.mode="disabled")}var x=o[e];x&&(x.mode=l?"showing":"hidden")}},p.setSubtitleTrack=function(e,r){var t,l=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(t=l[e])!==null&&t!==void 0&&t.details)||e<-1||e>=l.length)){this.clearTimer();var s=l[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,s){var a=s.id,o=s.groupId,E=o===void 0?"":o,x=s.name,f=s.type,u=s.url;this.hls.trigger(O.Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:E,name:x,type:f,url:u});var d=this.switchParams(s.url,r==null?void 0:r.details);this.loadPlaylist(d)}else this.hls.trigger(O.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},p.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,r=y(this.media.textTracks),t=0;t<r.length;t++)if(r[t].mode==="hidden")e=t;else if(r[t].mode==="showing"){e=t;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},A(b,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,r)}}]),b}(i.default);function y(S){for(var b=[],p=0;p<S.length;p++){var n=S[p];n.kind==="subtitles"&&n.label&&b.push(S[p])}return b}P.default=m},"./src/controller/timeline-controller.ts":function(N,P,h){h.r(P),h.d(P,"TimelineController",function(){return y});var O=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),i=h("./src/utils/cea-608-parser.ts"),C=h("./src/utils/output-filter.ts"),R=h("./src/utils/webvtt-parser.ts"),A=h("./src/utils/texttrack-utils.ts"),g=h("./src/utils/imsc1-ttml-parser.ts"),c=h("./src/types/loader.ts"),m=h("./src/utils/logger.ts"),y=function(){function n(r){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=p(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new C.default(this,"textTrack1"),l=new C.default(this,"textTrack2"),s=new C.default(this,"textTrack3"),a=new C.default(this,"textTrack4");this.cea608Parser1=new i.default(1,t,l),this.cea608Parser2=new i.default(3,s,a)}r.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(T.Events.FRAG_LOADING,this.onFragLoading,this),r.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=n.prototype;return e.destroy=function(){var t=this.hls;t.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(T.Events.FRAG_LOADING,this.onFragLoading,this),t.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,l,s,a,o){for(var E=!1,x=o.length;x--;){var f=o[x],u=b(f[0],f[1],l,s);if(u>=0&&(f[0]=Math.min(f[0],l),f[1]=Math.max(f[1],s),E=!0,u/(s-l)>.5))return}if(E||o.push([l,s]),this.config.renderTextTracksNatively){var d=this.captionsTracks[t];this.Cues.newCue(d,l,s,a)}else{var v=this.Cues.newCue(null,l,s,a);this.hls.trigger(T.Events.CUES_PARSED,{type:"captions",cues:v,track:t})}},e.onInitPtsFound=function(t,l){var s=this,a=l.frag,o=l.id,E=l.initPTS,x=l.timescale,f=this.unparsedVttFrags;o==="main"&&(this.initPTS[a.cc]=E,this.timescale[a.cc]=x),f.length&&(this.unparsedVttFrags=[],f.forEach(function(u){s.onFragLoaded(T.Events.FRAG_LOADED,u)}))},e.getExistingTrack=function(t){var l=this.media;if(l)for(var s=0;s<l.textTracks.length;s++){var a=l.textTracks[s];if(a[t])return a}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var l=this.captionsProperties,s=this.captionsTracks,a=this.media,o=l[t],E=o.label,x=o.languageCode,f=this.getExistingTrack(t);if(f)s[t]=f,Object(A.clearCurrentCues)(s[t]),Object(A.sendAddTrackEvent)(s[t],a);else{var u=this.createTextTrack("captions",E,x);u&&(u[t]=!0,s[t]=u)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var l=this.captionsProperties[t];if(!!l){var s=l.label,a={_id:t,label:s,kind:"captions",default:l.media?!!l.media.default:!1,closedCaptions:l.media};this.nonNativeCaptionsTracks[t]=a,this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[a]})}}},e.createTextTrack=function(t,l,s){var a=this.media;if(!!a)return a.addTextTrack(t,l,s)},e.onMediaAttaching=function(t,l){this.media=l.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(l){Object(A.clearCurrentCues)(t[l]),delete t[l]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=p(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(!!t){var l=t.textTracks;if(l)for(var s=0;s<l.length;s++)Object(A.clearCurrentCues)(l[s])}},e.onSubtitleTracksUpdated=function(t,l){var s=this;this.textTracks=[];var a=l.subtitleTracks||[],o=a.some(function(u){return u.textCodec===g.IMSC1_CODEC});if(this.config.enableWebVTT||o&&this.config.enableIMSC1){var E=this.tracks&&a&&this.tracks.length===a.length;if(this.tracks=a||[],this.config.renderTextTracksNatively){var x=this.media?this.media.textTracks:[];this.tracks.forEach(function(u,d){var v;if(d<x.length){for(var L=null,D=0;D<x.length;D++)if(S(x[D],u)){L=x[D];break}L&&(v=L)}v?Object(A.clearCurrentCues)(v):(v=s.createTextTrack("subtitles",u.name,u.lang),v&&(v.mode="disabled")),v&&(v.groupId=u.groupId,s.textTracks.push(v))})}else if(!E&&this.tracks&&this.tracks.length){var f=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}});this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:f})}}},e.onManifestLoaded=function(t,l){var s=this;this.config.enableCEA708Captions&&l.captions&&l.captions.forEach(function(a){var o=/(?:CC|SERVICE)([1-4])/.exec(a.instreamId);if(!!o){var E="textTrack"+o[1],x=s.captionsProperties[E];!x||(x.label=a.name,a.lang&&(x.languageCode=a.lang),x.media=a)}})},e.onFragLoading=function(t,l){var s=this.cea608Parser1,a=this.cea608Parser2,o=this.lastSn,E=this.lastPartIndex;if(!(!this.enabled||!(s&&a))&&l.frag.type===c.PlaylistLevelType.MAIN){var x,f,u=l.frag.sn,d=(x=l==null||(f=l.part)===null||f===void 0?void 0:f.index)!=null?x:-1;u===o+1||u===o&&d===E+1||(s.reset(),a.reset()),this.lastSn=u,this.lastPartIndex=d}},e.onFragLoaded=function(t,l){var s=l.frag,a=l.payload,o=this.initPTS,E=this.unparsedVttFrags;if(s.type===c.PlaylistLevelType.SUBTITLE)if(a.byteLength){if(!Object(O.isFiniteNumber)(o[s.cc])){E.push(l),o.length&&this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Missing initial subtitle PTS")});return}var x=s.decryptdata,f="stats"in l;if(x==null||x.key==null||x.method!=="AES-128"||f){var u=this.tracks[s.level],d=this.vttCCs;d[s.cc]||(d[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),u&&u.textCodec===g.IMSC1_CODEC?this._parseIMSC1(s,a):this._parseVTTs(s,a,d)}}else this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,l){var s=this,a=this.hls;Object(g.parseIMSC1)(l,this.initPTS[t.cc],this.timescale[t.cc],function(o){s._appendCues(o,t.level),a.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(o){m.logger.log("Failed to parse IMSC1: "+o),a.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:o})})},e._parseVTTs=function(t,l,s){var a=this,o=this.hls;Object(R.parseWebVTT)(l,this.initPTS[t.cc],this.timescale[t.cc],s,t.cc,t.start,function(E){a._appendCues(E,t.level),o.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(E){a._fallbackToIMSC1(t,l),m.logger.log("Failed to parse VTT cue: "+E),o.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:E})})},e._fallbackToIMSC1=function(t,l){var s=this,a=this.tracks[t.level];a.textCodec||Object(g.parseIMSC1)(l,this.initPTS[t.cc],this.timescale[t.cc],function(){a.textCodec=g.IMSC1_CODEC,s._parseIMSC1(t,l)},function(){a.textCodec="wvtt"})},e._appendCues=function(t,l){var s=this.hls;if(this.config.renderTextTracksNatively){var a=this.textTracks[l];if(a.mode==="disabled")return;t.forEach(function(x){return Object(A.addCueToTrack)(a,x)})}else{var o=this.tracks[l],E=o.default?"default":"subtitles"+l;s.trigger(T.Events.CUES_PARSED,{type:"subtitles",cues:t,track:E})}},e.onFragDecrypted=function(t,l){var s=l.frag;if(s.type===c.PlaylistLevelType.SUBTITLE){if(!Object(O.isFiniteNumber)(this.initPTS[s.cc])){this.unparsedVttFrags.push(l);return}this.onFragLoaded(T.Events.FRAG_LOADED,l)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,l){var s=this.cea608Parser1,a=this.cea608Parser2;if(!(!this.enabled||!(s&&a)))for(var o=0;o<l.samples.length;o++){var E=l.samples[o].bytes;if(E){var x=this.extractCea608Data(E);s.addData(l.samples[o].pts,x[0]),a.addData(l.samples[o].pts,x[1])}}},e.onBufferFlushing=function(t,l){var s=l.startOffset,a=l.endOffset,o=l.endOffsetSubtitles,E=l.type,x=this.media;if(!(!x||x.currentTime<a)){if(!E||E==="video"){var f=this.captionsTracks;Object.keys(f).forEach(function(d){return Object(A.removeCuesInRange)(f[d],s,a)})}if(this.config.renderTextTracksNatively&&s===0&&o!==void 0){var u=this.textTracks;Object.keys(u).forEach(function(d){return Object(A.removeCuesInRange)(u[d],s,o)})}}},e.extractCea608Data=function(t){for(var l=t[0]&31,s=2,a=[[],[]],o=0;o<l;o++){var E=t[s++],x=127&t[s++],f=127&t[s++],u=(4&E)!==0,d=3&E;x===0&&f===0||u&&(d===0||d===1)&&(a[d].push(x),a[d].push(f))}return a},n}();function S(n,e){return n&&n.label===e.name&&!(n.textTrack1||n.textTrack2)}function b(n,e,r,t){return Math.min(e,t)-Math.max(n,r)}function p(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return O});var O=function(){function T(C,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=C,this.aesIV=R}var i=T.prototype;return i.decrypt=function(R,A){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},A,R)},T}()},"./src/crypt/aes-decryptor.ts":function(N,P,h){h.r(P),h.d(P,"removePadding",function(){return T}),h.d(P,"default",function(){return i});var O=h("./src/utils/typed-array.ts");function T(C){var R=C.byteLength,A=R&&new DataView(C.buffer).getUint8(R-1);return A?Object(O.sliceUint8)(C,0,R-A):C}var i=function(){function C(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=C.prototype;return R.uint8ArrayToUint32Array_=function(g){for(var c=new DataView(g),m=new Uint32Array(4),y=0;y<4;y++)m[y]=c.getUint32(y*4);return m},R.initTable=function(){var g=this.sBox,c=this.invSBox,m=this.subMix,y=m[0],S=m[1],b=m[2],p=m[3],n=this.invSubMix,e=n[0],r=n[1],t=n[2],l=n[3],s=new Uint32Array(256),a=0,o=0,E=0;for(E=0;E<256;E++)E<128?s[E]=E<<1:s[E]=E<<1^283;for(E=0;E<256;E++){var x=o^o<<1^o<<2^o<<3^o<<4;x=x>>>8^x&255^99,g[a]=x,c[x]=a;var f=s[a],u=s[f],d=s[u],v=s[x]*257^x*16843008;y[a]=v<<24|v>>>8,S[a]=v<<16|v>>>16,b[a]=v<<8|v>>>24,p[a]=v,v=d*16843009^u*65537^f*257^a*16843008,e[x]=v<<24|v>>>8,r[x]=v<<16|v>>>16,t[x]=v<<8|v>>>24,l[x]=v,a?(a=f^s[s[s[d^f]]],o^=s[s[o]]):a=o=1}},R.expandKey=function(g){for(var c=this.uint8ArrayToUint32Array_(g),m=!0,y=0;y<c.length&&m;)m=c[y]===this.key[y],y++;if(!m){this.key=c;var S=this.keySize=c.length;if(S!==4&&S!==6&&S!==8)throw new Error("Invalid aes key size="+S);var b=this.ksRows=(S+6+1)*4,p,n,e=this.keySchedule=new Uint32Array(b),r=this.invKeySchedule=new Uint32Array(b),t=this.sBox,l=this.rcon,s=this.invSubMix,a=s[0],o=s[1],E=s[2],x=s[3],f,u;for(p=0;p<b;p++){if(p<S){f=e[p]=c[p];continue}u=f,p%S===0?(u=u<<8|u>>>24,u=t[u>>>24]<<24|t[u>>>16&255]<<16|t[u>>>8&255]<<8|t[u&255],u^=l[p/S|0]<<24):S>6&&p%S===4&&(u=t[u>>>24]<<24|t[u>>>16&255]<<16|t[u>>>8&255]<<8|t[u&255]),e[p]=f=(e[p-S]^u)>>>0}for(n=0;n<b;n++)p=b-n,n&3?u=e[p]:u=e[p-4],n<4||p<=4?r[n]=u:r[n]=a[t[u>>>24]]^o[t[u>>>16&255]]^E[t[u>>>8&255]]^x[t[u&255]],r[n]=r[n]>>>0}},R.networkToHostOrderSwap=function(g){return g<<24|(g&65280)<<8|(g&16711680)>>8|g>>>24},R.decrypt=function(g,c,m){for(var y=this.keySize+6,S=this.invKeySchedule,b=this.invSBox,p=this.invSubMix,n=p[0],e=p[1],r=p[2],t=p[3],l=this.uint8ArrayToUint32Array_(m),s=l[0],a=l[1],o=l[2],E=l[3],x=new Int32Array(g),f=new Int32Array(x.length),u,d,v,L,D,I,k,w,_,F,U,W,V,X,Y=this.networkToHostOrderSwap;c<x.length;){for(_=Y(x[c]),F=Y(x[c+1]),U=Y(x[c+2]),W=Y(x[c+3]),D=_^S[0],I=W^S[1],k=U^S[2],w=F^S[3],V=4,X=1;X<y;X++)u=n[D>>>24]^e[I>>16&255]^r[k>>8&255]^t[w&255]^S[V],d=n[I>>>24]^e[k>>16&255]^r[w>>8&255]^t[D&255]^S[V+1],v=n[k>>>24]^e[w>>16&255]^r[D>>8&255]^t[I&255]^S[V+2],L=n[w>>>24]^e[D>>16&255]^r[I>>8&255]^t[k&255]^S[V+3],D=u,I=d,k=v,w=L,V=V+4;u=b[D>>>24]<<24^b[I>>16&255]<<16^b[k>>8&255]<<8^b[w&255]^S[V],d=b[I>>>24]<<24^b[k>>16&255]<<16^b[w>>8&255]<<8^b[D&255]^S[V+1],v=b[k>>>24]<<24^b[w>>16&255]<<16^b[D>>8&255]<<8^b[I&255]^S[V+2],L=b[w>>>24]<<24^b[D>>16&255]<<16^b[I>>8&255]<<8^b[k&255]^S[V+3],f[c]=Y(u^s),f[c+1]=Y(L^a),f[c+2]=Y(v^o),f[c+3]=Y(d^E),s=_,a=F,o=U,E=W,c=c+4}return f.buffer},C}()},"./src/crypt/decrypter.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return c});var O=h("./src/crypt/aes-crypto.ts"),T=h("./src/crypt/fast-aes-key.ts"),i=h("./src/crypt/aes-decryptor.ts"),C=h("./src/utils/logger.ts"),R=h("./src/utils/mp4-tools.ts"),A=h("./src/utils/typed-array.ts"),g=16,c=function(){function m(S,b,p){var n=p===void 0?{}:p,e=n.removePKCS7Padding,r=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=S,this.config=b,this.removePKCS7Padding=r,r)try{var t=self.crypto;t&&(this.subtle=t.subtle||t.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var y=m.prototype;return y.destroy=function(){this.observer=null},y.isSync=function(){return this.config.enableSoftwareAES},y.flush=function(){var b=this.currentResult;if(!b){this.reset();return}var p=new Uint8Array(b);return this.reset(),this.removePKCS7Padding?Object(i.removePadding)(p):p},y.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},y.decrypt=function(b,p,n,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(b),p,n);var r=this.flush();r&&e(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(b),p,n).then(e)},y.softwareDecrypt=function(b,p,n){var e=this.currentIV,r=this.currentResult,t=this.remainderData;this.logOnce("JS AES decrypt"),t&&(b=Object(R.appendUint8Array)(t,b),this.remainderData=null);var l=this.getValidChunk(b);if(!l.length)return null;e&&(n=e);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new i.default),s.expandKey(p);var a=r;return this.currentResult=s.decrypt(l.buffer,0,n),this.currentIV=Object(A.sliceUint8)(l,-16).buffer,a||null},y.webCryptoDecrypt=function(b,p,n){var e=this,r=this.subtle;return(this.key!==p||!this.fastAesKey)&&(this.key=p,this.fastAesKey=new T.default(r,p)),this.fastAesKey.expandKey().then(function(t){if(!r)return Promise.reject(new Error("web crypto not initialized"));var l=new O.default(r,n);return l.decrypt(b.buffer,t)}).catch(function(t){return e.onWebCryptoError(t,b,p,n)})},y.onWebCryptoError=function(b,p,n,e){return C.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",b),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(p,n,e)},y.getValidChunk=function(b){var p=b,n=b.length-b.length%g;return n!==b.length&&(p=Object(A.sliceUint8)(b,0,n),this.remainderData=Object(A.sliceUint8)(b,n)),p},y.logOnce=function(b){!this.logEnabled||(C.logger.log("[decrypter.ts]: "+b),this.logEnabled=!1)},m}()},"./src/crypt/fast-aes-key.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return O});var O=function(){function T(C,R){this.subtle=void 0,this.key=void 0,this.subtle=C,this.key=R}var i=T.prototype;return i.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},T}()},"./src/demux/aacdemuxer.ts":function(N,P,h){h.r(P);var O=h("./src/demux/base-audio-demuxer.ts"),T=h("./src/demux/adts.ts"),i=h("./src/utils/logger.ts"),C=h("./src/demux/id3.ts");function R(c,m){c.prototype=Object.create(m.prototype),c.prototype.constructor=c,A(c,m)}function A(c,m){return A=Object.setPrototypeOf||function(S,b){return S.__proto__=b,S},A(c,m)}var g=function(c){R(m,c);function m(S,b){var p;return p=c.call(this)||this,p.observer=void 0,p.config=void 0,p.observer=S,p.config=b,p}var y=m.prototype;return y.resetInitSegment=function(b,p,n){c.prototype.resetInitSegment.call(this,b,p,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:b,duration:n,inputTimeScale:9e4,dropped:0}},m.probe=function(b){if(!b)return!1;for(var p=C.getID3Data(b,0)||[],n=p.length,e=b.length;n<e;n++)if(T.probe(b,n))return i.logger.log("ADTS sync word found !"),!0;return!1},y.canParse=function(b,p){return T.canParse(b,p)},y.appendFrame=function(b,p,n){T.initTrackConfig(b,this.observer,p,n,b.manifestCodec);var e=T.appendFrame(b,p,n,this.initPTS,this.frameIndex);if(e&&e.missing===0)return e},m}(O.default);g.minProbeByteLength=9,P.default=g},"./src/demux/adts.ts":function(N,P,h){h.r(P),h.d(P,"getAudioConfig",function(){return C}),h.d(P,"isHeaderPattern",function(){return R}),h.d(P,"getHeaderLength",function(){return A}),h.d(P,"getFullFrameLength",function(){return g}),h.d(P,"canGetFrameLength",function(){return c}),h.d(P,"isHeader",function(){return m}),h.d(P,"canParse",function(){return y}),h.d(P,"probe",function(){return S}),h.d(P,"initTrackConfig",function(){return b}),h.d(P,"getFrameDuration",function(){return p}),h.d(P,"parseFrameHeader",function(){return n}),h.d(P,"appendFrame",function(){return e});var O=h("./src/utils/logger.ts"),T=h("./src/errors.ts"),i=h("./src/events.ts");function C(r,t,l,s){var a,o,E,x,f=navigator.userAgent.toLowerCase(),u=s,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((t[l+2]&192)>>>6)+1;var v=(t[l+2]&60)>>>2;if(v>d.length-1){r.trigger(i.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+v});return}return E=(t[l+2]&1)<<2,E|=(t[l+3]&192)>>>6,O.logger.log("manifest codec:"+s+", ADTS type:"+a+", samplingIndex:"+v),/firefox/i.test(f)?v>=6?(a=5,x=new Array(4),o=v-3):(a=2,x=new Array(2),o=v):f.indexOf("android")!==-1?(a=2,x=new Array(2),o=v):(a=5,x=new Array(4),s&&(s.indexOf("mp4a.40.29")!==-1||s.indexOf("mp4a.40.5")!==-1)||!s&&v>=6?o=v-3:((s&&s.indexOf("mp4a.40.2")!==-1&&(v>=6&&E===1||/vivaldi/i.test(f))||!s&&E===1)&&(a=2,x=new Array(2)),o=v)),x[0]=a<<3,x[0]|=(v&14)>>1,x[1]|=(v&1)<<7,x[1]|=E<<3,a===5&&(x[1]|=(o&14)>>1,x[2]=(o&1)<<7,x[2]|=2<<2,x[3]=0),{config:x,samplerate:d[v],channelCount:E,codec:"mp4a.40."+a,manifestCodec:u}}function R(r,t){return r[t]===255&&(r[t+1]&246)===240}function A(r,t){return r[t+1]&1?7:9}function g(r,t){return(r[t+3]&3)<<11|r[t+4]<<3|(r[t+5]&224)>>>5}function c(r,t){return t+5<r.length}function m(r,t){return t+1<r.length&&R(r,t)}function y(r,t){return c(r,t)&&R(r,t)&&g(r,t)<=r.length-t}function S(r,t){if(m(r,t)){var l=A(r,t);if(t+l>=r.length)return!1;var s=g(r,t);if(s<=l)return!1;var a=t+s;return a===r.length||m(r,a)}return!1}function b(r,t,l,s,a){if(!r.samplerate){var o=C(t,l,s,a);if(!o)return;r.config=o.config,r.samplerate=o.samplerate,r.channelCount=o.channelCount,r.codec=o.codec,r.manifestCodec=o.manifestCodec,O.logger.log("parsed codec:"+r.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function p(r){return 1024*9e4/r}function n(r,t,l,s,a){var o=A(r,t),E=g(r,t);if(E-=o,E>0){var x=l+s*a;return{headerLength:o,frameLength:E,stamp:x}}}function e(r,t,l,s,a){var o=p(r.samplerate),E=n(t,l,s,a,o);if(E){var x=E.frameLength,f=E.headerLength,u=E.stamp,d=f+x,v=Math.max(0,l+d-t.length),L;v?(L=new Uint8Array(d-f),L.set(t.subarray(l+f,t.length),0)):L=t.subarray(l+f,l+d);var D={unit:L,pts:u};return v||r.samples.push(D),{sample:D,length:d,missing:v}}}},"./src/demux/base-audio-demuxer.ts":function(N,P,h){h.r(P),h.d(P,"initPTSFn",function(){return g});var O=h("./src/polyfills/number.ts"),T=h("./src/demux/id3.ts"),i=h("./src/demux/dummy-demuxed-track.ts"),C=h("./src/utils/mp4-tools.ts"),R=h("./src/utils/typed-array.ts"),A=function(){function c(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var m=c.prototype;return m.resetInitSegment=function(S,b,p){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},m.resetTimeStamp=function(){},m.resetContiguity=function(){},m.canParse=function(S,b){return!1},m.appendFrame=function(S,b,p){},m.demux=function(S,b){this.cachedData&&(S=Object(C.appendUint8Array)(this.cachedData,S),this.cachedData=null);var p=T.getID3Data(S,0),n=p?p.length:0,e,r,t=this._audioTrack,l=this._id3Track,s=p?T.getTimeStamp(p):void 0,a=S.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=g(s,b)),p&&p.length>0&&l.samples.push({pts:this.initPTS,dts:this.initPTS,data:p}),r=this.initPTS;n<a;){if(this.canParse(S,n)){var o=this.appendFrame(t,S,n);o?(this.frameIndex++,r=o.sample.pts,n+=o.length,e=n):n=a}else T.canParse(S,n)?(p=T.getID3Data(S,n),l.samples.push({pts:r,dts:r,data:p}),n+=p.length,e=n):n++;if(n===a&&e!==a){var E=Object(R.sliceUint8)(S,e);this.cachedData?this.cachedData=Object(C.appendUint8Array)(this.cachedData,E):this.cachedData=E}}return{audioTrack:t,avcTrack:Object(i.dummyTrack)(),id3Track:l,textTrack:Object(i.dummyTrack)()}},m.demuxSampleAes=function(S,b,p){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},m.flush=function(S){var b=this.cachedData;return b&&(this.cachedData=null,this.demux(b,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(i.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(i.dummyTrack)()}},m.destroy=function(){},c}(),g=function(m,y){return Object(O.isFiniteNumber)(m)?m*90:y*9e4};P.default=A},"./src/demux/chunk-cache.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return O});var O=function(){function i(){this.chunks=[],this.dataLength=0}var C=i.prototype;return C.push=function(A){this.chunks.push(A),this.dataLength+=A.length},C.flush=function(){var A=this.chunks,g=this.dataLength,c;if(A.length)A.length===1?c=A[0]:c=T(A,g);else return new Uint8Array(0);return this.reset(),c},C.reset=function(){this.chunks.length=0,this.dataLength=0},i}();function T(i,C){for(var R=new Uint8Array(C),A=0,g=0;g<i.length;g++){var c=i[g];R.set(c,A),A+=c.length}return R}},"./src/demux/dummy-demuxed-track.ts":function(N,P,h){h.r(P),h.d(P,"dummyTrack",function(){return O});function O(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(N,P,h){h.r(P);var O=h("./src/utils/logger.ts"),T=function(){function i(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var C=i.prototype;return C.loadWord=function(){var A=this.data,g=this.bytesAvailable,c=A.byteLength-g,m=new Uint8Array(4),y=Math.min(4,g);if(y===0)throw new Error("no bytes available");m.set(A.subarray(c,c+y)),this.word=new DataView(m.buffer).getUint32(0),this.bitsAvailable=y*8,this.bytesAvailable-=y},C.skipBits=function(A){var g;this.bitsAvailable>A?(this.word<<=A,this.bitsAvailable-=A):(A-=this.bitsAvailable,g=A>>3,A-=g>>3,this.bytesAvailable-=g,this.loadWord(),this.word<<=A,this.bitsAvailable-=A)},C.readBits=function(A){var g=Math.min(this.bitsAvailable,A),c=this.word>>>32-g;return A>32&&O.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=g,this.bitsAvailable>0?this.word<<=g:this.bytesAvailable>0&&this.loadWord(),g=A-g,g>0&&this.bitsAvailable?c<<g|this.readBits(g):c},C.skipLZ=function(){var A;for(A=0;A<this.bitsAvailable;++A)if((this.word&2147483648>>>A)!==0)return this.word<<=A,this.bitsAvailable-=A,A;return this.loadWord(),A+this.skipLZ()},C.skipUEG=function(){this.skipBits(1+this.skipLZ())},C.skipEG=function(){this.skipBits(1+this.skipLZ())},C.readUEG=function(){var A=this.skipLZ();return this.readBits(A+1)-1},C.readEG=function(){var A=this.readUEG();return 1&A?1+A>>>1:-1*(A>>>1)},C.readBoolean=function(){return this.readBits(1)===1},C.readUByte=function(){return this.readBits(8)},C.readUShort=function(){return this.readBits(16)},C.readUInt=function(){return this.readBits(32)},C.skipScalingList=function(A){for(var g=8,c=8,m,y=0;y<A;y++)c!==0&&(m=this.readEG(),c=(g+m+256)%256),g=c===0?g:c},C.readSPS=function(){var A=0,g=0,c=0,m=0,y,S,b,p=this.readUByte.bind(this),n=this.readBits.bind(this),e=this.readUEG.bind(this),r=this.readBoolean.bind(this),t=this.skipBits.bind(this),l=this.skipEG.bind(this),s=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);p();var o=p();if(n(5),t(3),p(),s(),o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128){var E=e();if(E===3&&t(1),s(),s(),t(1),r())for(S=E!==3?8:12,b=0;b<S;b++)r()&&(b<6?a(16):a(64))}s();var x=e();if(x===0)e();else if(x===1)for(t(1),l(),l(),y=e(),b=0;b<y;b++)l();s(),t(1);var f=e(),u=e(),d=n(1);d===0&&t(1),t(1),r()&&(A=e(),g=e(),c=e(),m=e());var v=[1,1];if(r()&&r()){var L=p();switch(L){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:{v=[p()<<8|p(),p()<<8|p()];break}}}return{width:Math.ceil((f+1)*16-A*2-g*2),height:(2-d)*(u+1)*16-(d?2:4)*(c+m),pixelRatio:v}},C.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},i}();P.default=T},"./src/demux/id3.ts":function(N,P,h){h.r(P),h.d(P,"isHeader",function(){return O}),h.d(P,"isFooter",function(){return T}),h.d(P,"getID3Data",function(){return i}),h.d(P,"canParse",function(){return R}),h.d(P,"getTimeStamp",function(){return A}),h.d(P,"isTimeStampFrame",function(){return g}),h.d(P,"getID3Frames",function(){return m}),h.d(P,"decodeFrame",function(){return y}),h.d(P,"utf8ArrayToStr",function(){return e}),h.d(P,"testables",function(){return r});var O=function(a,o){return o+10<=a.length&&a[o]===73&&a[o+1]===68&&a[o+2]===51&&a[o+3]<255&&a[o+4]<255&&a[o+6]<128&&a[o+7]<128&&a[o+8]<128&&a[o+9]<128},T=function(a,o){return o+10<=a.length&&a[o]===51&&a[o+1]===68&&a[o+2]===73&&a[o+3]<255&&a[o+4]<255&&a[o+6]<128&&a[o+7]<128&&a[o+8]<128&&a[o+9]<128},i=function(a,o){for(var E=o,x=0;O(a,o);){x+=10;var f=C(a,o+6);x+=f,T(a,o+10)&&(x+=10),o+=x}if(x>0)return a.subarray(E,E+x)},C=function(a,o){var E=0;return E=(a[o]&127)<<21,E|=(a[o+1]&127)<<14,E|=(a[o+2]&127)<<7,E|=a[o+3]&127,E},R=function(a,o){return O(a,o)&&C(a,o+6)+10<=a.length-o},A=function(a){for(var o=m(a),E=0;E<o.length;E++){var x=o[E];if(g(x))return n(x)}},g=function(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"},c=function(a){var o=String.fromCharCode(a[0],a[1],a[2],a[3]),E=C(a,4),x=10;return{type:o,size:E,data:a.subarray(x,x+E)}},m=function(a){for(var o=0,E=[];O(a,o);){var x=C(a,o+6);o+=10;for(var f=o+x;o+8<f;){var u=c(a.subarray(o)),d=y(u);d&&E.push(d),o+=u.size+10}T(a,o)&&(o+=10)}return E},y=function(a){return a.type==="PRIV"?S(a):a.type[0]==="W"?p(a):b(a)},S=function(a){if(!(a.size<2)){var o=e(a.data,!0),E=new Uint8Array(a.data.subarray(o.length+1));return{key:a.type,info:o,data:E.buffer}}},b=function(a){if(!(a.size<2)){if(a.type==="TXXX"){var o=1,E=e(a.data.subarray(o),!0);o+=E.length+1;var x=e(a.data.subarray(o));return{key:a.type,info:E,data:x}}var f=e(a.data.subarray(1));return{key:a.type,data:f}}},p=function(a){if(a.type==="WXXX"){if(a.size<2)return;var o=1,E=e(a.data.subarray(o),!0);o+=E.length+1;var x=e(a.data.subarray(o));return{key:a.type,info:E,data:x}}var f=e(a.data);return{key:a.type,data:f}},n=function(a){if(a.data.byteLength===8){var o=new Uint8Array(a.data),E=o[3]&1,x=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return x/=45,E&&(x+=4772185884e-2),Math.round(x)}},e=function(a,o){o===void 0&&(o=!1);var E=l();if(E){var x=E.decode(a);if(o){var f=x.indexOf("\0");return f!==-1?x.substring(0,f):x}return x.replace(/\0/g,"")}for(var u=a.length,d,v,L,D="",I=0;I<u;){if(d=a[I++],d===0&&o)return D;if(d===0||d===3)continue;switch(d>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:D+=String.fromCharCode(d);break;case 12:case 13:v=a[I++],D+=String.fromCharCode((d&31)<<6|v&63);break;case 14:v=a[I++],L=a[I++],D+=String.fromCharCode((d&15)<<12|(v&63)<<6|(L&63)<<0);break}}return D},r={decodeTextFrame:b},t;function l(){return!t&&typeof self.TextDecoder!="undefined"&&(t=new self.TextDecoder("utf-8")),t}},"./src/demux/mp3demuxer.ts":function(N,P,h){h.r(P);var O=h("./src/demux/base-audio-demuxer.ts"),T=h("./src/demux/id3.ts"),i=h("./src/utils/logger.ts"),C=h("./src/demux/mpegaudio.ts");function R(c,m){c.prototype=Object.create(m.prototype),c.prototype.constructor=c,A(c,m)}function A(c,m){return A=Object.setPrototypeOf||function(S,b){return S.__proto__=b,S},A(c,m)}var g=function(c){R(m,c);function m(){return c.apply(this,arguments)||this}var y=m.prototype;return y.resetInitSegment=function(b,p,n){c.prototype.resetInitSegment.call(this,b,p,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:b,duration:n,inputTimeScale:9e4,dropped:0}},m.probe=function(b){if(!b)return!1;for(var p=T.getID3Data(b,0)||[],n=p.length,e=b.length;n<e;n++)if(C.probe(b,n))return i.logger.log("MPEG Audio sync word found !"),!0;return!1},y.canParse=function(b,p){return C.canParse(b,p)},y.appendFrame=function(b,p,n){if(this.initPTS!==null)return C.appendFrame(b,p,n,this.initPTS,this.frameIndex)},m}(O.default);g.minProbeByteLength=4,P.default=g},"./src/demux/mp4demuxer.ts":function(N,P,h){h.r(P);var O=h("./src/utils/mp4-tools.ts"),T=h("./src/demux/dummy-demuxed-track.ts"),i=function(){function C(A,g){this.remainderData=null,this.config=void 0,this.config=g}var R=C.prototype;return R.resetTimeStamp=function(){},R.resetInitSegment=function(){},R.resetContiguity=function(){},C.probe=function(g){return Object(O.findBox)({data:g,start:0,end:Math.min(g.length,16384)},["moof"]).length>0},R.demux=function(g){var c=g,m=Object(T.dummyTrack)();if(this.config.progressive){this.remainderData&&(c=Object(O.appendUint8Array)(this.remainderData,g));var y=Object(O.segmentValidRange)(c);this.remainderData=y.remainder,m.samples=y.valid||new Uint8Array}else m.samples=c;return{audioTrack:Object(T.dummyTrack)(),avcTrack:m,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},R.flush=function(){var g=Object(T.dummyTrack)();return g.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(T.dummyTrack)(),avcTrack:g,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},R.demuxSampleAes=function(g,c,m){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},R.destroy=function(){},C}();i.minProbeByteLength=1024,P.default=i},"./src/demux/mpegaudio.ts":function(N,P,h){h.r(P),h.d(P,"appendFrame",function(){return A}),h.d(P,"parseHeader",function(){return g}),h.d(P,"isHeaderPattern",function(){return c}),h.d(P,"isHeader",function(){return m}),h.d(P,"canParse",function(){return y}),h.d(P,"probe",function(){return S});var O=null,T=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],i=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],C=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],R=[0,1,1,4];function A(b,p,n,e,r){if(!(n+24>p.length)){var t=g(p,n);if(t&&n+t.frameLength<=p.length){var l=t.samplesPerFrame*9e4/t.sampleRate,s=e+r*l,a={unit:p.subarray(n,n+t.frameLength),pts:s,dts:s};return b.config=[],b.channelCount=t.channelCount,b.samplerate=t.sampleRate,b.samples.push(a),{sample:a,length:t.frameLength,missing:0}}}}function g(b,p){var n=b[p+1]>>3&3,e=b[p+1]>>1&3,r=b[p+2]>>4&15,t=b[p+2]>>2&3;if(n!==1&&r!==0&&r!==15&&t!==3){var l=b[p+2]>>1&1,s=b[p+3]>>6,a=n===3?3-e:e===3?3:4,o=T[a*14+r-1]*1e3,E=n===3?0:n===2?1:2,x=i[E*3+t],f=s===3?1:2,u=C[n][e],d=R[e],v=u*8*d,L=Math.floor(u*o/x+l)*d;if(O===null){var D=navigator.userAgent||"",I=D.match(/Chrome\/(\d+)/i);O=I?parseInt(I[1]):0}var k=!!O&&O<=87;return k&&e===2&&o>=224e3&&s===0&&(b[p+3]=b[p+3]|128),{sampleRate:x,channelCount:f,frameLength:L,samplesPerFrame:v}}}function c(b,p){return b[p]===255&&(b[p+1]&224)===224&&(b[p+1]&6)!==0}function m(b,p){return p+1<b.length&&c(b,p)}function y(b,p){var n=4;return c(b,p)&&n<=b.length-p}function S(b,p){if(p+1<b.length&&c(b,p)){var n=4,e=g(b,p),r=n;e!=null&&e.frameLength&&(r=e.frameLength);var t=p+r;return t===b.length||m(b,t)}return!1}},"./src/demux/sample-aes.ts":function(N,P,h){h.r(P);var O=h("./src/crypt/decrypter.ts"),T=h("./src/demux/tsdemuxer.ts"),i=function(){function C(A,g,c){this.keyData=void 0,this.decrypter=void 0,this.keyData=c,this.decrypter=new O.default(A,g,{removePKCS7Padding:!1})}var R=C.prototype;return R.decryptBuffer=function(g,c){this.decrypter.decrypt(g,this.keyData.key.buffer,this.keyData.iv.buffer,c)},R.decryptAacSample=function(g,c,m,y){var S=g[c].unit,b=S.subarray(16,S.length-S.length%16),p=b.buffer.slice(b.byteOffset,b.byteOffset+b.length),n=this;this.decryptBuffer(p,function(e){var r=new Uint8Array(e);S.set(r,16),y||n.decryptAacSamples(g,c+1,m)})},R.decryptAacSamples=function(g,c,m){for(;;c++){if(c>=g.length){m();return}if(!(g[c].unit.length<32)){var y=this.decrypter.isSync();if(this.decryptAacSample(g,c,m,y),!y)return}}},R.getAvcEncryptedData=function(g){for(var c=Math.floor((g.length-48)/160)*16+16,m=new Int8Array(c),y=0,S=32;S<g.length-16;S+=160,y+=16)m.set(g.subarray(S,S+16),y);return m},R.getAvcDecryptedUnit=function(g,c){for(var m=new Uint8Array(c),y=0,S=32;S<g.length-16;S+=160,y+=16)g.set(m.subarray(y,y+16),S);return g},R.decryptAvcSample=function(g,c,m,y,S,b){var p=Object(T.discardEPB)(S.data),n=this.getAvcEncryptedData(p),e=this;this.decryptBuffer(n.buffer,function(r){S.data=e.getAvcDecryptedUnit(p,r),b||e.decryptAvcSamples(g,c,m+1,y)})},R.decryptAvcSamples=function(g,c,m,y){if(g instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;c++,m=0){if(c>=g.length){y();return}for(var S=g[c].units;!(m>=S.length);m++){var b=S[m];if(!(b.data.length<=48||b.type!==1&&b.type!==5)){var p=this.decrypter.isSync();if(this.decryptAvcSample(g,c,m,y,b,p),!p)return}}}},C}();P.default=i},"./src/demux/transmuxer-interface.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return m});var O=h("./node_modules/webworkify-webpack/index.js"),T=h("./src/events.ts"),i=h("./src/demux/transmuxer.ts"),C=h("./src/utils/logger.ts"),R=h("./src/errors.ts"),A=h("./src/utils/mediasource-helper.ts"),g=h("./node_modules/eventemitter3/index.js"),c=Object(A.getMediaSource)()||{isTypeSupported:function(){return!1}},m=function(){function y(b,p,n,e){var r=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=b,this.id=p,this.onTransmuxComplete=n,this.onFlush=e;var t=b.config,l=function(x,f){f=f||{},f.frag=r.frag,f.id=r.id,b.trigger(x,f)};this.observer=new g.EventEmitter,this.observer.on(T.Events.FRAG_DECRYPTED,l),this.observer.on(T.Events.ERROR,l);var s={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},a=navigator.vendor;if(t.enableWorker&&typeof Worker!="undefined"){C.logger.log("demuxing in webworker");var o;try{o=this.worker=O("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(E){b.trigger(T.Events.ERROR,{type:R.ErrorTypes.OTHER_ERROR,details:R.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(E.message+"  ("+E.filename+":"+E.lineno+")")})},o.postMessage({cmd:"init",typeSupported:s,vendor:a,id:p,config:JSON.stringify(t)})}catch(E){C.logger.warn("Error in worker:",E),C.logger.error("Error while initializing DemuxerWorker, fallback to inline"),o&&self.URL.revokeObjectURL(o.objectURL),this.transmuxer=new i.default(this.observer,s,t,a,p),this.worker=null}}else this.transmuxer=new i.default(this.observer,s,t,a,p)}var S=y.prototype;return S.destroy=function(){var p=this.worker;if(p)p.removeEventListener("message",this.onwmsg),p.terminate(),this.worker=null;else{var n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},S.push=function(p,n,e,r,t,l,s,a,o,E){var x,f,u=this;o.transmuxing.start=self.performance.now();var d=this.transmuxer,v=this.worker,L=l?l.start:t.start,D=t.decryptdata,I=this.frag,k=!(I&&t.cc===I.cc),w=!(I&&o.level===I.level),_=I?o.sn-I.sn:-1,F=this.part?o.part-this.part.index:1,U=!w&&(_===1||_===0&&F===1),W=self.performance.now();(w||_||t.stats.parsing.start===0)&&(t.stats.parsing.start=W),l&&(F||!U)&&(l.stats.parsing.start=W);var V=!(I&&((x=t.initSegment)===null||x===void 0?void 0:x.url)===((f=I.initSegment)===null||f===void 0?void 0:f.url)),X=new i.TransmuxState(k,U,a,w,L,V);if(!U||k||V){C.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+o.sn+" p: "+o.part+" level: "+o.level+" id: "+o.id+`
        discontinuity: `+k+`
        trackSwitch: `+w+`
        contiguous: `+U+`
        accurateTimeOffset: `+a+`
        timeOffset: `+L+`
        initSegmentChange: `+V);var Y=new i.TransmuxConfig(e,r,n,s,E);this.configureTransmuxer(Y)}if(this.frag=t,this.part=l,v)v.postMessage({cmd:"demux",data:p,decryptdata:D,chunkMeta:o,state:X},p instanceof ArrayBuffer?[p]:[]);else if(d){var J=d.push(p,D,o,X);Object(i.isPromise)(J)?J.then(function(q){u.handleTransmuxComplete(q)}):this.handleTransmuxComplete(J)}},S.flush=function(p){var n=this;p.transmuxing.start=self.performance.now();var e=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:p});else if(e){var t=e.flush(p);Object(i.isPromise)(t)?t.then(function(l){n.handleFlushResult(l,p)}):this.handleFlushResult(t,p)}},S.handleFlushResult=function(p,n){var e=this;p.forEach(function(r){e.handleTransmuxComplete(r)}),this.onFlush(n)},S.onWorkerMessage=function(p){var n=p.data,e=this.hls;switch(n.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(n.data);break}case"flush":{this.onFlush(n.data);break}default:{n.data=n.data||{},n.data.frag=this.frag,n.data.id=this.id,e.trigger(n.event,n.data);break}}},S.configureTransmuxer=function(p){var n=this.worker,e=this.transmuxer;n?n.postMessage({cmd:"configure",config:p}):e&&e.configure(p)},S.handleTransmuxComplete=function(p){p.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(p)},y}()},"./src/demux/transmuxer-worker.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return R});var O=h("./src/demux/transmuxer.ts"),T=h("./src/events.ts"),i=h("./src/utils/logger.ts"),C=h("./node_modules/eventemitter3/index.js");function R(y){var S=new C.EventEmitter,b=function(n,e){y.postMessage({event:n,data:e})};S.on(T.Events.FRAG_DECRYPTED,b),S.on(T.Events.ERROR,b),y.addEventListener("message",function(p){var n=p.data;switch(n.cmd){case"init":{var e=JSON.parse(n.config);y.transmuxer=new O.default(S,n.typeSupported,e,n.vendor,n.id),Object(i.enableLogs)(e.debug),b("init",null);break}case"configure":{y.transmuxer.configure(n.config);break}case"demux":{var r=y.transmuxer.push(n.data,n.decryptdata,n.chunkMeta,n.state);Object(O.isPromise)(r)?r.then(function(s){A(y,s)}):A(y,r);break}case"flush":{var t=n.chunkMeta,l=y.transmuxer.flush(t);Object(O.isPromise)(l)?l.then(function(s){c(y,s,t)}):c(y,l,t);break}}})}function A(y,S){if(!m(S.remuxResult)){var b=[],p=S.remuxResult,n=p.audio,e=p.video;n&&g(b,n),e&&g(b,e),y.postMessage({event:"transmuxComplete",data:S},b)}}function g(y,S){S.data1&&y.push(S.data1.buffer),S.data2&&y.push(S.data2.buffer)}function c(y,S,b){S.forEach(function(p){A(y,p)}),y.postMessage({event:"flush",data:b})}function m(y){return!y.audio&&!y.video&&!y.text&&!y.id3&&!y.initSegment}},"./src/demux/transmuxer.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return r}),h.d(P,"isPromise",function(){return s}),h.d(P,"TransmuxConfig",function(){return a}),h.d(P,"TransmuxState",function(){return o});var O=h("./src/events.ts"),T=h("./src/errors.ts"),i=h("./src/crypt/decrypter.ts"),C=h("./src/demux/aacdemuxer.ts"),R=h("./src/demux/mp4demuxer.ts"),A=h("./src/demux/tsdemuxer.ts"),g=h("./src/demux/mp3demuxer.ts"),c=h("./src/remux/mp4-remuxer.ts"),m=h("./src/remux/passthrough-remuxer.ts"),y=h("./src/demux/chunk-cache.ts"),S=h("./src/utils/mp4-tools.ts"),b=h("./src/utils/logger.ts"),p;try{p=self.performance.now.bind(self.performance)}catch{b.logger.debug("Unable to use Performance API on this environment"),p=self.Date.now}var n=[{demux:A.default,remux:c.default},{demux:R.default,remux:m.default},{demux:C.default,remux:c.default},{demux:g.default,remux:c.default}],e=1024;n.forEach(function(E){var x=E.demux;e=Math.max(e,x.minProbeByteLength)});var r=function(){function E(f,u,d,v,L){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new y.default,this.observer=f,this.typeSupported=u,this.config=d,this.vendor=v,this.id=L}var x=E.prototype;return x.configure=function(u){this.transmuxConfig=u,this.decrypter&&this.decrypter.reset()},x.push=function(u,d,v,L){var D=this,I=v.transmuxing;I.executeStart=p();var k=new Uint8Array(u),w=this.cache,_=this.config,F=this.currentTransmuxState,U=this.transmuxConfig;L&&(this.currentTransmuxState=L);var W=t(k,d);if(W&&W.method==="AES-128"){var V=this.getDecrypter();if(_.enableSoftwareAES){var X=V.softwareDecrypt(k,W.key.buffer,W.iv.buffer);if(!X)return I.executeEnd=p(),l(v);k=new Uint8Array(X)}else return this.decryptionPromise=V.webCryptoDecrypt(k,W.key.buffer,W.iv.buffer).then(function(pe){var ye=D.push(pe,null,v);return D.decryptionPromise=null,ye}),this.decryptionPromise}var Y=L||F,J=Y.contiguous,q=Y.discontinuity,$=Y.trackSwitch,ne=Y.accurateTimeOffset,ee=Y.timeOffset,Z=Y.initSegmentChange,ie=U.audioCodec,ae=U.videoCodec,se=U.defaultInitPts,ue=U.duration,fe=U.initSegmentData;if((q||$||Z)&&this.resetInitSegment(fe,ie,ae,ue),(q||Z)&&this.resetInitialTimestamp(se),J||this.resetContiguity(),this.needsProbing(k,q,$)){if(w.dataLength){var de=w.flush();k=Object(S.appendUint8Array)(de,k)}this.configureTransmuxer(k,U)}var he=this.transmux(k,W,ee,ne,v),me=this.currentTransmuxState;return me.contiguous=!0,me.discontinuity=!1,me.trackSwitch=!1,I.executeEnd=p(),he},x.flush=function(u){var d=this,v=u.transmuxing;v.executeStart=p();var L=this.decrypter,D=this.cache,I=this.currentTransmuxState,k=this.decryptionPromise;if(k)return k.then(function(){return d.flush(u)});var w=[],_=I.timeOffset;if(L){var F=L.flush();F&&w.push(this.push(F,null,u))}var U=D.dataLength;D.reset();var W=this.demuxer,V=this.remuxer;if(!W||!V)return U>=e&&this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),v.executeEnd=p(),[l(u)];var X=W.flush(_);return s(X)?X.then(function(Y){return d.flushRemux(w,Y,u),w}):(this.flushRemux(w,X,u),w)},x.flushRemux=function(u,d,v){var L=d.audioTrack,D=d.avcTrack,I=d.id3Track,k=d.textTrack,w=this.currentTransmuxState,_=w.accurateTimeOffset,F=w.timeOffset;b.logger.log("[transmuxer.ts]: Flushed fragment "+v.sn+(v.part>-1?" p: "+v.part:"")+" of level "+v.level);var U=this.remuxer.remux(L,D,I,k,F,_,!0,this.id);u.push({remuxResult:U,chunkMeta:v}),v.transmuxing.executeEnd=p()},x.resetInitialTimestamp=function(u){var d=this.demuxer,v=this.remuxer;!d||!v||(d.resetTimeStamp(u),v.resetTimeStamp(u))},x.resetContiguity=function(){var u=this.demuxer,d=this.remuxer;!u||!d||(u.resetContiguity(),d.resetNextTimestamp())},x.resetInitSegment=function(u,d,v,L){var D=this.demuxer,I=this.remuxer;!D||!I||(D.resetInitSegment(d,v,L),I.resetInitSegment(u,d,v))},x.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},x.transmux=function(u,d,v,L,D){var I;return d&&d.method==="SAMPLE-AES"?I=this.transmuxSampleAes(u,d,v,L,D):I=this.transmuxUnencrypted(u,v,L,D),I},x.transmuxUnencrypted=function(u,d,v,L){var D=this.demuxer.demux(u,d,!1,!this.config.progressive),I=D.audioTrack,k=D.avcTrack,w=D.id3Track,_=D.textTrack,F=this.remuxer.remux(I,k,w,_,d,v,!1,this.id);return{remuxResult:F,chunkMeta:L}},x.transmuxSampleAes=function(u,d,v,L,D){var I=this;return this.demuxer.demuxSampleAes(u,d,v).then(function(k){var w=I.remuxer.remux(k.audioTrack,k.avcTrack,k.id3Track,k.textTrack,v,L,!1,I.id);return{remuxResult:w,chunkMeta:D}})},x.configureTransmuxer=function(u,d){for(var v=this.config,L=this.observer,D=this.typeSupported,I=this.vendor,k=d.audioCodec,w=d.defaultInitPts,_=d.duration,F=d.initSegmentData,U=d.videoCodec,W,V=0,X=n.length;V<X;V++)if(n[V].demux.probe(u)){W=n[V];break}W||(b.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),W={demux:R.default,remux:m.default});var Y=this.demuxer,J=this.remuxer,q=W.remux,$=W.demux;(!J||!(J instanceof q))&&(this.remuxer=new q(L,v,D,I)),(!Y||!(Y instanceof $))&&(this.demuxer=new $(L,v,D),this.probe=$.probe),this.resetInitSegment(F,k,U,_),this.resetInitialTimestamp(w)},x.needsProbing=function(u,d,v){return!this.demuxer||!this.remuxer||d||v},x.getDecrypter=function(){var u=this.decrypter;return u||(u=this.decrypter=new i.default(this.observer,this.config)),u},E}();function t(E,x){var f=null;return E.byteLength>0&&x!=null&&x.key!=null&&x.iv!==null&&x.method!=null&&(f=x),f}var l=function(x){return{remuxResult:{},chunkMeta:x}};function s(E){return"then"in E&&E.then instanceof Function}var a=function(x,f,u,d,v){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=x,this.videoCodec=f,this.initSegmentData=u,this.duration=d,this.defaultInitPts=v},o=function(x,f,u,d,v,L){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=x,this.contiguous=f,this.accurateTimeOffset=u,this.trackSwitch=d,this.timeOffset=v,this.initSegmentChange=L}},"./src/demux/tsdemuxer.ts":function(N,P,h){h.r(P),h.d(P,"discardEPB",function(){return l});var O=h("./src/demux/adts.ts"),T=h("./src/demux/mpegaudio.ts"),i=h("./src/demux/exp-golomb.ts"),C=h("./src/demux/id3.ts"),R=h("./src/demux/sample-aes.ts"),A=h("./src/events.ts"),g=h("./src/utils/mp4-tools.ts"),c=h("./src/utils/logger.ts"),m=h("./src/errors.ts"),y={video:1,audio:2,id3:3,text:4},S=function(){function s(o,E,x){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=o,this.config=E,this.typeSupported=x}s.probe=function(E){var x=s.syncOffset(E);return x<0?!1:(x&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+x+", junk ahead ?"),!0)},s.syncOffset=function(E){for(var x=Math.min(1e3,E.length-564),f=0;f<x;){if(E[f]===71&&E[f+188]===71&&E[f+2*188]===71)return f;f++}return-1},s.createTrack=function(E,x){return{container:E==="video"||E==="audio"?"video/mp2t":void 0,type:E,id:y[E],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:E==="audio"?x:void 0}};var a=s.prototype;return a.resetInitSegment=function(E,x,f){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=s.createTrack("video",f),this._audioTrack=s.createTrack("audio",f),this._id3Track=s.createTrack("id3",f),this._txtTrack=s.createTrack("text",f),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=E,this.videoCodec=x,this._duration=f},a.resetTimeStamp=function(){},a.resetContiguity=function(){var E=this._audioTrack,x=this._avcTrack,f=this._id3Track;E&&(E.pesData=null),x&&(x.pesData=null),f&&(f.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},a.demux=function(E,x,f,u){f===void 0&&(f=!1),u===void 0&&(u=!1),f||(this.sampleAes=null);var d,v=this._avcTrack,L=this._audioTrack,D=this._id3Track,I=v.pid,k=v.pesData,w=L.pid,_=D.pid,F=L.pesData,U=D.pesData,W=!1,V=this.pmtParsed,X=this._pmtId,Y=E.length;if(this.remainderData&&(E=Object(g.appendUint8Array)(this.remainderData,E),Y=E.length,this.remainderData=null),Y<188&&!u)return this.remainderData=E,{audioTrack:L,avcTrack:v,id3Track:D,textTrack:this._txtTrack};var J=Math.max(0,s.syncOffset(E));Y-=(Y+J)%188,Y<E.byteLength&&!u&&(this.remainderData=new Uint8Array(E.buffer,Y,E.buffer.byteLength-Y));for(var q=0,$=J;$<Y;$+=188)if(E[$]===71){var ne=!!(E[$+1]&64),ee=((E[$+1]&31)<<8)+E[$+2],Z=(E[$+3]&48)>>4,ie=void 0;if(Z>1){if(ie=$+5+E[$+4],ie===$+188)continue}else ie=$+4;switch(ee){case I:ne&&(k&&(d=e(k))&&this.parseAVCPES(d,!1),k={data:[],size:0}),k&&(k.data.push(E.subarray(ie,$+188)),k.size+=$+188-ie);break;case w:ne&&(F&&(d=e(F))&&(L.isAAC?this.parseAACPES(d):this.parseMPEGPES(d)),F={data:[],size:0}),F&&(F.data.push(E.subarray(ie,$+188)),F.size+=$+188-ie);break;case _:ne&&(U&&(d=e(U))&&this.parseID3PES(d),U={data:[],size:0}),U&&(U.data.push(E.subarray(ie,$+188)),U.size+=$+188-ie);break;case 0:ne&&(ie+=E[ie]+1),X=this._pmtId=p(E,ie);break;case X:{ne&&(ie+=E[ie]+1);var ae=n(E,ie,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,f);I=ae.avc,I>0&&(v.pid=I),w=ae.audio,w>0&&(L.pid=w,L.isAAC=ae.isAAC),_=ae.id3,_>0&&(D.pid=_),W&&!V&&(c.logger.log("reparse from beginning"),W=!1,$=J-188),V=this.pmtParsed=!0;break}case 17:case 8191:break;default:W=!0;break}}else q++;q>0&&this.observer.emit(A.Events.ERROR,A.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+q+" TS packet/s that do not start with 0x47"}),v.pesData=k,L.pesData=F,D.pesData=U;var se={audioTrack:L,avcTrack:v,id3Track:D,textTrack:this._txtTrack};return u&&this.extractRemainingSamples(se),se},a.flush=function(){var E=this.remainderData;this.remainderData=null;var x;return E?x=this.demux(E,-1,!1,!0):x={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(x),this.sampleAes?this.decrypt(x,this.sampleAes):x},a.extractRemainingSamples=function(E){var x=E.audioTrack,f=E.avcTrack,u=E.id3Track,d=f.pesData,v=x.pesData,L=u.pesData,D;d&&(D=e(d))?(this.parseAVCPES(D,!0),f.pesData=null):f.pesData=d,v&&(D=e(v))?(x.isAAC?this.parseAACPES(D):this.parseMPEGPES(D),x.pesData=null):(v!=null&&v.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),x.pesData=v),L&&(D=e(L))?(this.parseID3PES(D),u.pesData=null):u.pesData=L},a.demuxSampleAes=function(E,x,f){var u=this.demux(E,f,!0,!this.config.progressive),d=this.sampleAes=new R.default(this.observer,this.config,x);return this.decrypt(u,d)},a.decrypt=function(E,x){return new Promise(function(f){var u=E.audioTrack,d=E.avcTrack;u.samples&&u.isAAC?x.decryptAacSamples(u.samples,0,function(){d.samples?x.decryptAvcSamples(d.samples,0,0,function(){f(E)}):f(E)}):d.samples&&x.decryptAvcSamples(d.samples,0,0,function(){f(E)})})},a.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},a.parseAVCPES=function(E,x){var f=this,u=this._avcTrack,d=this.parseAVCNALu(E.data),v=this.avcSample,L,D=!1;E.data=null,v&&d.length&&!u.audFound&&(r(v,u),v=this.avcSample=b(!1,E.pts,E.dts,"")),d.forEach(function(I){switch(I.type){case 1:{L=!0,v||(v=f.avcSample=b(!0,E.pts,E.dts,"")),v.frame=!0;var k=I.data;if(D&&k.length>4){var w=new i.default(k).readSliceType();(w===2||w===4||w===7||w===9)&&(v.key=!0)}break}case 5:L=!0,v||(v=f.avcSample=b(!0,E.pts,E.dts,"")),v.key=!0,v.frame=!0;break;case 6:{L=!0;var _=new i.default(l(I.data));_.readUByte();for(var F=0,U=0,W=!1,V=0;!W&&_.bytesAvailable>1;){F=0;do V=_.readUByte(),F+=V;while(V===255);U=0;do V=_.readUByte(),U+=V;while(V===255);if(F===4&&_.bytesAvailable!==0){W=!0;var X=_.readUByte();if(X===181){var Y=_.readUShort();if(Y===49){var J=_.readUInt();if(J===1195456820){var q=_.readUByte();if(q===3){for(var $=_.readUByte(),ne=_.readUByte(),ee=31&$,Z=[$,ne],ie=0;ie<ee;ie++)Z.push(_.readUByte()),Z.push(_.readUByte()),Z.push(_.readUByte());t(f._txtTrack.samples,{type:3,pts:E.pts,bytes:Z})}}}}}else if(F===5&&_.bytesAvailable!==0){if(W=!0,U>16){for(var ae=[],se=0;se<16;se++)ae.push(_.readUByte().toString(16)),(se===3||se===5||se===7||se===9)&&ae.push("-");for(var ue=U-16,fe=new Uint8Array(ue),de=0;de<ue;de++)fe[de]=_.readUByte();t(f._txtTrack.samples,{pts:E.pts,payloadType:F,uuid:ae.join(""),userData:Object(C.utf8ArrayToStr)(fe),userDataBytes:fe})}}else if(U<_.bytesAvailable)for(var he=0;he<U;he++)_.readUByte()}break}case 7:if(L=!0,D=!0,!u.sps){var me=new i.default(I.data),pe=me.readSPS();u.width=pe.width,u.height=pe.height,u.pixelRatio=pe.pixelRatio,u.sps=[I.data],u.duration=f._duration;for(var ye=I.data.subarray(1,4),ge="avc1.",xe=0;xe<3;xe++){var ce=ye[xe].toString(16);ce.length<2&&(ce="0"+ce),ge+=ce}u.codec=ge}break;case 8:L=!0,u.pps||(u.pps=[I.data]);break;case 9:L=!1,u.audFound=!0,v&&r(v,u),v=f.avcSample=b(!1,E.pts,E.dts,"");break;case 12:L=!1;break;default:L=!1,v&&(v.debug+="unknown NAL "+I.type+" ");break}if(v&&L){var Me=v.units;Me.push(I)}}),x&&v&&(r(v,u),this.avcSample=null)},a.getLastNalUnit=function(){var E,x=this.avcSample,f;if(!x||x.units.length===0){var u=this._avcTrack.samples;x=u[u.length-1]}if((E=x)!==null&&E!==void 0&&E.units){var d=x.units;f=d[d.length-1]}return f},a.parseAVCNALu=function(E){var x=E.byteLength,f=this._avcTrack,u=f.naluState||0,d=u,v=[],L=0,D,I,k,w=-1,_=0;for(u===-1&&(w=0,_=E[0]&31,u=0,L=1);L<x;){if(D=E[L++],!u){u=D?0:1;continue}if(u===1){u=D?0:2;continue}if(!D)u=3;else if(D===1){if(w>=0){var F={data:E.subarray(w,L-u-1),type:_};v.push(F)}else{var U=this.getLastNalUnit();if(U&&(d&&L<=4-d&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-d)),I=L-u-1,I>0)){var W=new Uint8Array(U.data.byteLength+I);W.set(U.data,0),W.set(E.subarray(0,I),U.data.byteLength),U.data=W,U.state=0}}L<x?(k=E[L]&31,w=L,_=k,u=0):u=-1}else u=0}if(w>=0&&u>=0){var V={data:E.subarray(w,x),type:_,state:u};v.push(V)}if(v.length===0){var X=this.getLastNalUnit();if(X){var Y=new Uint8Array(X.data.byteLength+E.byteLength);Y.set(X.data,0),Y.set(E,X.data.byteLength),X.data=Y}}return f.naluState=u,v},a.parseAACPES=function(E){var x=0,f=this._audioTrack,u=this.aacOverFlow,d=E.data;if(u){this.aacOverFlow=null;var v=u.sample.unit.byteLength,L=Math.min(u.missing,v),D=v-L;u.sample.unit.set(d.subarray(0,L),D),f.samples.push(u.sample),x=u.missing}var I,k;for(I=x,k=d.length;I<k-1&&!O.isHeader(d,I);I++);if(I!==x){var w,_;if(I<k-1?(w="AAC PES did not start with ADTS header,offset:"+I,_=!1):(w="no ADTS header found in AAC PES",_=!0),c.logger.warn("parsing error:"+w),this.observer.emit(A.Events.ERROR,A.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:_,reason:w}),_)return}O.initTrackConfig(f,this.observer,d,I,this.audioCodec);var F;if(E.pts!==void 0)F=E.pts;else if(u){var U=O.getFrameDuration(f.samplerate);F=u.sample.pts+U}else{c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var W=0;I<k;)if(O.isHeader(d,I)){if(I+5<k){var V=O.appendFrame(f,d,I,F,W);if(V)if(V.missing)this.aacOverFlow=V;else{I+=V.length,W++;continue}}break}else I++},a.parseMPEGPES=function(E){var x=E.data,f=x.length,u=0,d=0,v=E.pts;if(v===void 0){c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;d<f;)if(T.isHeader(x,d)){var L=T.appendFrame(this._audioTrack,x,d,v,u);if(L)d+=L.length,u++;else break}else d++},a.parseID3PES=function(E){if(E.pts===void 0){c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(E)},s}();S.minProbeByteLength=188;function b(s,a,o,E){return{key:s,frame:!1,pts:a,dts:o,units:[],debug:E,length:0}}function p(s,a){return(s[a+10]&31)<<8|s[a+11]}function n(s,a,o,E){var x={audio:-1,avc:-1,id3:-1,isAAC:!0},f=(s[a+1]&15)<<8|s[a+2],u=a+3+f-4,d=(s[a+10]&15)<<8|s[a+11];for(a+=12+d;a<u;){var v=(s[a+1]&31)<<8|s[a+2];switch(s[a]){case 207:if(!E){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:x.audio===-1&&(x.audio=v);break;case 21:x.id3===-1&&(x.id3=v);break;case 219:if(!E){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:x.avc===-1&&(x.avc=v);break;case 3:case 4:o?x.audio===-1&&(x.audio=v,x.isAAC=!1):c.logger.log("MPEG audio found, not supported in this browser");break;case 36:c.logger.warn("Unsupported HEVC stream type found");break}a+=((s[a+3]&15)<<8|s[a+4])+5}return x}function e(s){var a=0,o,E,x,f,u,d=s.data;if(!s||s.size===0)return null;for(;d[0].length<19&&d.length>1;){var v=new Uint8Array(d[0].length+d[1].length);v.set(d[0]),v.set(d[1],d[0].length),d[0]=v,d.splice(1,1)}o=d[0];var L=(o[0]<<16)+(o[1]<<8)+o[2];if(L===1){if(E=(o[4]<<8)+o[5],E&&E>s.size-6)return null;var D=o[7];D&192&&(f=(o[9]&14)*536870912+(o[10]&255)*4194304+(o[11]&254)*16384+(o[12]&255)*128+(o[13]&254)/2,D&64?(u=(o[14]&14)*536870912+(o[15]&255)*4194304+(o[16]&254)*16384+(o[17]&255)*128+(o[18]&254)/2,f-u>60*9e4&&(c.logger.warn(Math.round((f-u)/9e4)+"s delta between PTS and DTS, align them"),f=u)):u=f),x=o[8];var I=x+9;if(s.size<=I)return null;s.size-=I;for(var k=new Uint8Array(s.size),w=0,_=d.length;w<_;w++){o=d[w];var F=o.byteLength;if(I)if(I>F){I-=F;continue}else o=o.subarray(I),F-=I,I=0;k.set(o,a),a+=F}return E&&(E-=x+3),{data:k,pts:f,dts:u,len:E}}return null}function r(s,a){if(s.units.length&&s.frame){if(s.pts===void 0){var o=a.samples,E=o.length;if(E){var x=o[E-1];s.pts=x.pts,s.dts=x.dts}else{a.dropped++;return}}a.samples.push(s)}s.debug.length&&c.logger.log(s.pts+"/"+s.dts+":"+s.debug)}function t(s,a){var o=s.length;if(o>0){if(a.pts>=s[o-1].pts)s.push(a);else for(var E=o-1;E>=0;E--)if(a.pts<s[E].pts){s.splice(E,0,a);break}}else s.push(a)}function l(s){for(var a=s.byteLength,o=[],E=1;E<a-2;)s[E]===0&&s[E+1]===0&&s[E+2]===3?(o.push(E+2),E+=2):E++;if(o.length===0)return s;var x=a-o.length,f=new Uint8Array(x),u=0;for(E=0;E<x;u++,E++)u===o[0]&&(u++,o.shift()),f[E]=s[u];return f}P.default=S},"./src/errors.ts":function(N,P,h){h.r(P),h.d(P,"ErrorTypes",function(){return O}),h.d(P,"ErrorDetails",function(){return T});var O;(function(i){i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError"})(O||(O={}));var T;(function(i){i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.UNKNOWN="unknown"})(T||(T={}))},"./src/events.ts":function(N,P,h){h.r(P),h.d(P,"Events",function(){return O});var O;(function(T){T.MEDIA_ATTACHING="hlsMediaAttaching",T.MEDIA_ATTACHED="hlsMediaAttached",T.MEDIA_DETACHING="hlsMediaDetaching",T.MEDIA_DETACHED="hlsMediaDetached",T.BUFFER_RESET="hlsBufferReset",T.BUFFER_CODECS="hlsBufferCodecs",T.BUFFER_CREATED="hlsBufferCreated",T.BUFFER_APPENDING="hlsBufferAppending",T.BUFFER_APPENDED="hlsBufferAppended",T.BUFFER_EOS="hlsBufferEos",T.BUFFER_FLUSHING="hlsBufferFlushing",T.BUFFER_FLUSHED="hlsBufferFlushed",T.MANIFEST_LOADING="hlsManifestLoading",T.MANIFEST_LOADED="hlsManifestLoaded",T.MANIFEST_PARSED="hlsManifestParsed",T.LEVEL_SWITCHING="hlsLevelSwitching",T.LEVEL_SWITCHED="hlsLevelSwitched",T.LEVEL_LOADING="hlsLevelLoading",T.LEVEL_LOADED="hlsLevelLoaded",T.LEVEL_UPDATED="hlsLevelUpdated",T.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",T.LEVELS_UPDATED="hlsLevelsUpdated",T.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",T.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",T.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",T.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",T.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",T.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",T.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",T.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",T.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",T.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",T.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",T.CUES_PARSED="hlsCuesParsed",T.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",T.INIT_PTS_FOUND="hlsInitPtsFound",T.FRAG_LOADING="hlsFragLoading",T.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",T.FRAG_LOADED="hlsFragLoaded",T.FRAG_DECRYPTED="hlsFragDecrypted",T.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",T.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",T.FRAG_PARSING_METADATA="hlsFragParsingMetadata",T.FRAG_PARSED="hlsFragParsed",T.FRAG_BUFFERED="hlsFragBuffered",T.FRAG_CHANGED="hlsFragChanged",T.FPS_DROP="hlsFpsDrop",T.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",T.ERROR="hlsError",T.DESTROYING="hlsDestroying",T.KEY_LOADING="hlsKeyLoading",T.KEY_LOADED="hlsKeyLoaded",T.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",T.BACK_BUFFER_REACHED="hlsBackBufferReached"})(O||(O={}))},"./src/hls.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return t});var O=h("./node_modules/url-toolkit/src/url-toolkit.js"),T=h("./src/loader/playlist-loader.ts"),i=h("./src/loader/key-loader.ts"),C=h("./src/controller/id3-track-controller.ts"),R=h("./src/controller/latency-controller.ts"),A=h("./src/controller/level-controller.ts"),g=h("./src/controller/fragment-tracker.ts"),c=h("./src/controller/stream-controller.ts"),m=h("./src/is-supported.ts"),y=h("./src/utils/logger.ts"),S=h("./src/config.ts"),b=h("./node_modules/eventemitter3/index.js"),p=h("./src/events.ts"),n=h("./src/errors.ts");function e(l,s){for(var a=0;a<s.length;a++){var o=s[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(l,o.key,o)}}function r(l,s,a){return s&&e(l.prototype,s),a&&e(l,a),l}var t=function(){l.isSupported=function(){return Object(m.isSupported)()};function l(a){a===void 0&&(a={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new b.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var o=this.config=Object(S.mergeConfig)(l.DefaultConfig,a);this.userConfig=a,Object(y.enableLogs)(o.debug),this._autoLevelCapping=-1,o.progressive&&Object(S.enableStreamingMode)(o);var E=o.abrController,x=o.bufferController,f=o.capLevelController,u=o.fpsController,d=this.abrController=new E(this),v=this.bufferController=new x(this),L=this.capLevelController=new f(this),D=new u(this),I=new T.default(this),k=new i.default(this),w=new C.default(this),_=this.levelController=new A.default(this),F=new g.FragmentTracker(this),U=this.streamController=new c.default(this,F);L.setStreamController(U),D.setStreamController(U);var W=[_,U];this.networkControllers=W;var V=[I,k,d,v,L,D,w,F];this.audioTrackController=this.createController(o.audioTrackController,null,W),this.createController(o.audioStreamController,F,W),this.subtitleTrackController=this.createController(o.subtitleTrackController,null,W),this.createController(o.subtitleStreamController,F,W),this.createController(o.timelineController,null,V),this.emeController=this.createController(o.emeController,null,V),this.cmcdController=this.createController(o.cmcdController,null,V),this.latencyController=this.createController(R.default,null,V),this.coreComponents=V}var s=l.prototype;return s.createController=function(o,E,x){if(o){var f=E?new o(this,E):new o(this);return x&&x.push(f),f}return null},s.on=function(o,E,x){x===void 0&&(x=this),this._emitter.on(o,E,x)},s.once=function(o,E,x){x===void 0&&(x=this),this._emitter.once(o,E,x)},s.removeAllListeners=function(o){this._emitter.removeAllListeners(o)},s.off=function(o,E,x,f){x===void 0&&(x=this),this._emitter.off(o,E,x,f)},s.listeners=function(o){return this._emitter.listeners(o)},s.emit=function(o,E,x){return this._emitter.emit(o,E,x)},s.trigger=function(o,E){if(this.config.debug)return this.emit(o,o,E);try{return this.emit(o,o,E)}catch(x){y.logger.error("An internal error happened while handling event "+o+'. Error message: "'+x.message+'". Here is a stacktrace:',x),this.trigger(p.Events.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:o,error:x})}return!1},s.listenerCount=function(o){return this._emitter.listenerCount(o)},s.destroy=function(){y.logger.log("destroy"),this.trigger(p.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(o){return o.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(o){return o.destroy()}),this.coreComponents.length=0},s.attachMedia=function(o){y.logger.log("attachMedia"),this._media=o,this.trigger(p.Events.MEDIA_ATTACHING,{media:o})},s.detachMedia=function(){y.logger.log("detachMedia"),this.trigger(p.Events.MEDIA_DETACHING,void 0),this._media=null},s.loadSource=function(o){this.stopLoad();var E=this.media,x=this.url,f=this.url=O.buildAbsoluteURL(self.location.href,o,{alwaysNormalize:!0});y.logger.log("loadSource:"+f),E&&x&&x!==f&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(E)),this.trigger(p.Events.MANIFEST_LOADING,{url:o})},s.startLoad=function(o){o===void 0&&(o=-1),y.logger.log("startLoad("+o+")"),this.networkControllers.forEach(function(E){E.startLoad(o)})},s.stopLoad=function(){y.logger.log("stopLoad"),this.networkControllers.forEach(function(o){o.stopLoad()})},s.swapAudioCodec=function(){y.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){y.logger.log("recoverMediaError");var o=this._media;this.detachMedia(),o&&this.attachMedia(o)},s.removeLevel=function(o,E){E===void 0&&(E=0),this.levelController.removeLevel(o,E)},r(l,[{key:"levels",get:function(){var o=this.levelController.levels;return o||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(o){y.logger.log("set currentLevel:"+o),this.loadLevel=o,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(o){y.logger.log("set nextLevel:"+o),this.levelController.manualLevel=o,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(o){y.logger.log("set loadLevel:"+o),this.levelController.manualLevel=o}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(o){this.levelController.nextLoadLevel=o}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(o){y.logger.log("set firstLevel:"+o),this.levelController.firstLevel=o}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(o){y.logger.log("set startLevel:"+o),o!==-1&&(o=Math.max(o,this.minAutoLevel)),this.levelController.startLevel=o}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(o){var E=!!o;E!==this.config.capLevelToPlayerSize&&(E?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=E)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(o){this._autoLevelCapping!==o&&(y.logger.log("set autoLevelCapping:"+o),this._autoLevelCapping=o)}},{key:"bandwidthEstimate",get:function(){var o=this.abrController.bwEstimator;return o?o.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var o=this.levels,E=this.config.minAutoBitrate;if(!o)return 0;for(var x=o.length,f=0;f<x;f++)if(o[f].maxBitrate>E)return f;return 0}},{key:"maxAutoLevel",get:function(){var o=this.levels,E=this.autoLevelCapping,x;return E===-1&&o&&o.length?x=o.length-1:x=E,x}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(o){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,o)}},{key:"audioTracks",get:function(){var o=this.audioTrackController;return o?o.audioTracks:[]}},{key:"audioTrack",get:function(){var o=this.audioTrackController;return o?o.audioTrack:-1},set:function(o){var E=this.audioTrackController;E&&(E.audioTrack=o)}},{key:"subtitleTracks",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTrack:-1},set:function(o){var E=this.subtitleTrackController;E&&(E.subtitleTrack=o)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var o=this.subtitleTrackController;return o?o.subtitleDisplay:!1},set:function(o){var E=this.subtitleTrackController;E&&(E.subtitleDisplay=o)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(o){this.config.lowLatencyMode=o}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return p.Events}},{key:"ErrorTypes",get:function(){return n.ErrorTypes}},{key:"ErrorDetails",get:function(){return n.ErrorDetails}},{key:"DefaultConfig",get:function(){return l.defaultConfig?l.defaultConfig:S.hlsDefaultConfig},set:function(o){l.defaultConfig=o}}]),l}();t.defaultConfig=void 0},"./src/is-supported.ts":function(N,P,h){h.r(P),h.d(P,"isSupported",function(){return i}),h.d(P,"changeTypeSupported",function(){return C});var O=h("./src/utils/mediasource-helper.ts");function T(){return self.SourceBuffer||self.WebKitSourceBuffer}function i(){var R=Object(O.getMediaSource)();if(!R)return!1;var A=T(),g=R&&typeof R.isTypeSupported=="function"&&R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),c=!A||A.prototype&&typeof A.prototype.appendBuffer=="function"&&typeof A.prototype.remove=="function";return!!g&&!!c}function C(){var R,A=T();return typeof(A==null||(R=A.prototype)===null||R===void 0?void 0:R.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return S}),h.d(P,"LoadError",function(){return p});var O=h("./src/polyfills/number.ts"),T=h("./src/errors.ts");function i(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,c(n,e)}function C(n){var e=typeof Map=="function"?new Map:void 0;return C=function(t){if(t===null||!g(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(t))return e.get(t);e.set(t,l)}function l(){return R(t,arguments,m(this).constructor)}return l.prototype=Object.create(t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),c(l,t)},C(n)}function R(n,e,r){return A()?R=Reflect.construct:R=function(l,s,a){var o=[null];o.push.apply(o,s);var E=Function.bind.apply(l,o),x=new E;return a&&c(x,a.prototype),x},R.apply(null,arguments)}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function g(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function c(n,e){return c=Object.setPrototypeOf||function(t,l){return t.__proto__=l,t},c(n,e)}function m(n){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},m(n)}var y=Math.pow(2,17),S=function(){function n(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}var e=n.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,l){var s=this,a=t.url;if(!a)return Promise.reject(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(a?"part list":"url")));this.abort();var o=this.config,E=o.fLoader,x=o.loader;return new Promise(function(f,u){s.loader&&s.loader.destroy();var d=s.loader=t.loader=E?new E(o):new x(o),v=b(t),L={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:y};t.stats=d.stats,d.load(v,L,{onSuccess:function(I,k,w,_){s.resetLoader(t,d),f({frag:t,part:null,payload:I.data,networkDetails:_})},onError:function(I,k,w){s.resetLoader(t,d),u(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:I,networkDetails:w}))},onAbort:function(I,k,w){s.resetLoader(t,d),u(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:w}))},onTimeout:function(I,k,w){s.resetLoader(t,d),u(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:w}))},onProgress:function(I,k,w,_){l&&l({frag:t,part:null,payload:w,networkDetails:_})}})})},e.loadPart=function(t,l,s){var a=this;this.abort();var o=this.config,E=o.fLoader,x=o.loader;return new Promise(function(f,u){a.loader&&a.loader.destroy();var d=a.loader=t.loader=E?new E(o):new x(o),v=b(t,l),L={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:y};l.stats=d.stats,d.load(v,L,{onSuccess:function(I,k,w,_){a.resetLoader(t,d),a.updateStatsFromPart(t,l);var F={frag:t,part:l,payload:I.data,networkDetails:_};s(F),f(F)},onError:function(I,k,w){a.resetLoader(t,d),u(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:l,response:I,networkDetails:w}))},onAbort:function(I,k,w){t.stats.aborted=l.stats.aborted,a.resetLoader(t,d),u(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:l,networkDetails:w}))},onTimeout:function(I,k,w){a.resetLoader(t,d),u(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:l,networkDetails:w}))}})})},e.updateStatsFromPart=function(t,l){var s=t.stats,a=l.stats,o=a.total;if(s.loaded+=a.loaded,o){var E=Math.round(t.duration/l.duration),x=Math.min(Math.round(s.loaded/o),E),f=E-x,u=f*Math.round(s.loaded/x);s.total=s.loaded+u}else s.total=Math.max(s.loaded,s.total);var d=s.loading,v=a.loading;d.start?d.first+=v.first-v.start:(d.start=v.start,d.first=v.first),d.end=v.end},e.resetLoader=function(t,l){t.loader=null,this.loader===l&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),l.destroy()},n}();function b(n,e){e===void 0&&(e=null);var r=e||n,t={frag:n,part:e,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},l=r.byteRangeStartOffset,s=r.byteRangeEndOffset;return Object(O.isFiniteNumber)(l)&&Object(O.isFiniteNumber)(s)&&(t.rangeStart=l,t.rangeEnd=s),t}var p=function(n){i(e,n);function e(r){for(var t,l=arguments.length,s=new Array(l>1?l-1:0),a=1;a<l;a++)s[a-1]=arguments[a];return t=n.call.apply(n,[this].concat(s))||this,t.data=void 0,t.data=r,t}return e}(C(Error))},"./src/loader/fragment.ts":function(N,P,h){h.r(P),h.d(P,"ElementaryStreamTypes",function(){return y}),h.d(P,"BaseSegment",function(){return S}),h.d(P,"Fragment",function(){return b}),h.d(P,"Part",function(){return p});var O=h("./src/polyfills/number.ts"),T=h("./node_modules/url-toolkit/src/url-toolkit.js"),i=h("./src/utils/logger.ts"),C=h("./src/loader/level-key.ts"),R=h("./src/loader/load-stats.ts");function A(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,g(n,e)}function g(n,e){return g=Object.setPrototypeOf||function(t,l){return t.__proto__=l,t},g(n,e)}function c(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function m(n,e,r){return e&&c(n.prototype,e),r&&c(n,r),n}var y;(function(n){n.AUDIO="audio",n.VIDEO="video",n.AUDIOVIDEO="audiovideo"})(y||(y={}));var S=function(){function n(r){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(t={},t[y.AUDIO]=null,t[y.VIDEO]=null,t[y.AUDIOVIDEO]=null,t),this.baseurl=r}var e=n.prototype;return e.setByteRange=function(t,l){var s=t.split("@",2),a=[];s.length===1?a[0]=l?l.byteRangeEndOffset:0:a[0]=parseInt(s[1]),a[1]=parseInt(s[0])+a[0],this._byteRange=a},m(n,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(T.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),n}(),b=function(n){A(e,n);function e(t,l){var s;return s=n.call(this,l)||this,s._decryptdata=null,s.rawProgramDateTime=null,s.programDateTime=null,s.tagList=[],s.duration=0,s.sn=0,s.levelkey=void 0,s.type=void 0,s.loader=null,s.level=-1,s.cc=0,s.startPTS=void 0,s.endPTS=void 0,s.appendedPTS=void 0,s.startDTS=void 0,s.endDTS=void 0,s.start=0,s.deltaPTS=void 0,s.maxStartPTS=void 0,s.minEndPTS=void 0,s.stats=new R.LoadStats,s.urlId=0,s.data=void 0,s.bitrateTest=!1,s.title=null,s.initSegment=null,s.type=t,s}var r=e.prototype;return r.createInitializationVector=function(l){for(var s=new Uint8Array(16),a=12;a<16;a++)s[a]=l>>8*(15-a)&255;return s},r.setDecryptDataFromLevelKey=function(l,s){var a=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&(a=C.LevelKey.fromURI(l.uri),a.method=l.method,a.iv=this.createInitializationVector(s),a.keyFormat="identity"),a},r.setElementaryStreamInfo=function(l,s,a,o,E,x){x===void 0&&(x=!1);var f=this.elementaryStreams,u=f[l];if(!u){f[l]={startPTS:s,endPTS:a,startDTS:o,endDTS:E,partial:x};return}u.startPTS=Math.min(u.startPTS,s),u.endPTS=Math.max(u.endPTS,a),u.startDTS=Math.min(u.startDTS,o),u.endDTS=Math.max(u.endDTS,E)},r.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[y.AUDIO]=null,l[y.VIDEO]=null,l[y.AUDIOVIDEO]=null},m(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&i.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(O.isFiniteNumber)(this.programDateTime))return null;var l=Object(O.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+l*1e3}},{key:"encrypted",get:function(){var l;return!!((l=this.decryptdata)!==null&&l!==void 0&&l.keyFormat&&this.decryptdata.uri)}}]),e}(S),p=function(n){A(e,n);function e(r,t,l,s,a){var o;o=n.call(this,l)||this,o.fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new R.LoadStats,o.duration=r.decimalFloatingPoint("DURATION"),o.gap=r.bool("GAP"),o.independent=r.bool("INDEPENDENT"),o.relurl=r.enumeratedString("URI"),o.fragment=t,o.index=s;var E=r.enumeratedString("BYTERANGE");return E&&o.setByteRange(E,a),a&&(o.fragOffset=a.fragOffset+a.duration),o}return m(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(S)},"./src/loader/key-loader.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return C});var O=h("./src/events.ts"),T=h("./src/errors.ts"),i=h("./src/utils/logger.ts"),C=function(){function R(g){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=g,this._registerListeners()}var A=R.prototype;return A._registerListeners=function(){this.hls.on(O.Events.KEY_LOADING,this.onKeyLoading,this)},A._unregisterListeners=function(){this.hls.off(O.Events.KEY_LOADING,this.onKeyLoading)},A.destroy=function(){this._unregisterListeners();for(var c in this.loaders){var m=this.loaders[c];m&&m.destroy()}this.loaders={}},A.onKeyLoading=function(c,m){var y=m.frag,S=y.type,b=this.loaders[S];if(!y.decryptdata){i.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var p=y.decryptdata.uri;if(p!==this.decrypturl||this.decryptkey===null){var n=this.hls.config;if(b&&(i.logger.warn("abort previous key loader for type:"+S),b.abort()),!p){i.logger.warn("key uri is falsy");return}var e=n.loader,r=y.loader=this.loaders[S]=new e(n);this.decrypturl=p,this.decryptkey=null;var t={url:p,frag:y,responseType:"arraybuffer"},l={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(t,l,s)}else this.decryptkey&&(y.decryptdata.key=this.decryptkey,this.hls.trigger(O.Events.KEY_LOADED,{frag:y}))},A.loadsuccess=function(c,m,y){var S=y.frag;if(!S.decryptdata){i.logger.error("after key load, decryptdata unset");return}this.decryptkey=S.decryptdata.key=new Uint8Array(c.data),S.loader=null,delete this.loaders[S.type],this.hls.trigger(O.Events.KEY_LOADED,{frag:S})},A.loaderror=function(c,m){var y=m.frag,S=y.loader;S&&S.abort(),delete this.loaders[y.type],this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:y,response:c})},A.loadtimeout=function(c,m){var y=m.frag,S=y.loader;S&&S.abort(),delete this.loaders[y.type],this.hls.trigger(O.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:y})},R}()},"./src/loader/level-details.ts":function(N,P,h){h.r(P),h.d(P,"LevelDetails",function(){return R});var O=h("./src/polyfills/number.ts");function T(A,g){for(var c=0;c<g.length;c++){var m=g[c];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(A,m.key,m)}}function i(A,g,c){return g&&T(A.prototype,g),c&&T(A,c),A}var C=10,R=function(){function A(c){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=c}var g=A.prototype;return g.reloaded=function(m){if(!m){this.advanced=!0,this.updated=!0;return}var y=this.lastPartSn-m.lastPartSn,S=this.lastPartIndex-m.lastPartIndex;this.updated=this.endSN!==m.endSN||!!S||!!y,this.advanced=this.endSN>m.endSN||y>0||y===0&&S>0,this.updated||this.advanced?this.misses=Math.floor(m.misses*.6):this.misses=m.misses+1,this.availabilityDelay=m.availabilityDelay},i(A,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(O.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||C}},{key:"drift",get:function(){var m=this.driftEndTime-this.driftStartTime;if(m>0){var y=this.driftEnd-this.driftStart;return y*1e3/m}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var m;return(m=this.fragments)!==null&&m!==void 0&&m.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),A}()},"./src/loader/level-key.ts":function(N,P,h){h.r(P),h.d(P,"LevelKey",function(){return C});var O=h("./node_modules/url-toolkit/src/url-toolkit.js");function T(R,A){for(var g=0;g<A.length;g++){var c=A[g];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(R,c.key,c)}}function i(R,A,g){return A&&T(R.prototype,A),g&&T(R,g),R}var C=function(){R.fromURL=function(g,c){return new R(g,c)},R.fromURI=function(g){return new R(g)};function R(A,g){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,g?this._uri=Object(O.buildAbsoluteURL)(A,g,{alwaysNormalize:!0}):this._uri=A}return i(R,[{key:"uri",get:function(){return this._uri}}]),R}()},"./src/loader/load-stats.ts":function(N,P,h){h.r(P),h.d(P,"LoadStats",function(){return O});var O=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return e});var O=h("./src/polyfills/number.ts"),T=h("./node_modules/url-toolkit/src/url-toolkit.js"),i=h("./src/loader/fragment.ts"),C=h("./src/loader/level-details.ts"),R=h("./src/loader/level-key.ts"),A=h("./src/utils/attr-list.ts"),g=h("./src/utils/logger.ts"),c=h("./src/utils/codecs.ts"),m=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,y=/#EXT-X-MEDIA:(.*)/g,S=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),b=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),p=/\.(mp4|m4s|m4v|m4a)$/i;function n(a){var o,E;return p.test((o=(E=T.parseURL(a))===null||E===void 0?void 0:E.path)!=null?o:"")}var e=function(){function a(){}return a.findGroup=function(E,x){for(var f=0;f<E.length;f++){var u=E[f];if(u.id===x)return u}},a.convertAVC1ToAVCOTI=function(E){var x=E.split(".");if(x.length>2){var f=x.shift()+".";return f+=parseInt(x.shift()).toString(16),f+=("000"+parseInt(x.shift()).toString(16)).substr(-4),f}return E},a.resolve=function(E,x){return T.buildAbsoluteURL(x,E,{alwaysNormalize:!0})},a.parseMasterPlaylist=function(E,x){var f=[],u={},d=!1;m.lastIndex=0;for(var v;(v=m.exec(E))!=null;)if(v[1]){var L=new A.AttrList(v[1]),D={attrs:L,bitrate:L.decimalInteger("AVERAGE-BANDWIDTH")||L.decimalInteger("BANDWIDTH"),name:L.NAME,url:a.resolve(v[2],x)},I=L.decimalResolution("RESOLUTION");I&&(D.width=I.width,D.height=I.height),r((L.CODECS||"").split(/[ ,]+/).filter(function(w){return w}),D),D.videoCodec&&D.videoCodec.indexOf("avc1")!==-1&&(D.videoCodec=a.convertAVC1ToAVCOTI(D.videoCodec)),f.push(D)}else if(v[3]){var k=new A.AttrList(v[3]);k["DATA-ID"]&&(d=!0,u[k["DATA-ID"]]=k)}return{levels:f,sessionData:d?u:null}},a.parseMasterPlaylistMedia=function(E,x,f,u){u===void 0&&(u=[]);var d,v=[],L=0;for(y.lastIndex=0;(d=y.exec(E))!==null;){var D=new A.AttrList(d[1]);if(D.TYPE===f){var I={attrs:D,bitrate:0,id:L++,groupId:D["GROUP-ID"],instreamId:D["INSTREAM-ID"],name:D.NAME||D.LANGUAGE||"",type:f,default:D.bool("DEFAULT"),autoselect:D.bool("AUTOSELECT"),forced:D.bool("FORCED"),lang:D.LANGUAGE,url:D.URI?a.resolve(D.URI,x):""};if(u.length){var k=a.findGroup(u,I.groupId)||u[0];t(I,k,"audioCodec"),t(I,k,"textCodec")}v.push(I)}}return v},a.parseLevelPlaylist=function(E,x,f,u,d){var v=new C.LevelDetails(x),L=v.fragments,D=null,I=0,k=0,w=0,_=0,F=null,U=new i.Fragment(u,x),W,V,X,Y=-1,J=!1;for(S.lastIndex=0,v.m3u8=E;(W=S.exec(E))!==null;){J&&(J=!1,U=new i.Fragment(u,x),U.start=w,U.sn=I,U.cc=_,U.level=f,D&&(U.initSegment=D,U.rawProgramDateTime=D.rawProgramDateTime));var q=W[1];if(q){U.duration=parseFloat(q);var $=(" "+W[2]).slice(1);U.title=$||null,U.tagList.push($?["INF",q,$]:["INF",q])}else if(W[3])Object(O.isFiniteNumber)(U.duration)&&(U.start=w,X&&(U.levelkey=X),U.sn=I,U.level=f,U.cc=_,U.urlId=d,L.push(U),U.relurl=(" "+W[3]).slice(1),s(U,F),F=U,w+=U.duration,I++,k=0,J=!0);else if(W[4]){var ne=(" "+W[4]).slice(1);F?U.setByteRange(ne,F):U.setByteRange(ne)}else if(W[5])U.rawProgramDateTime=(" "+W[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),Y===-1&&(Y=L.length);else{if(W=W[0].match(b),!W){g.logger.warn("No matches on slow regex match for level playlist!");continue}for(V=1;V<W.length&&typeof W[V]=="undefined";V++);var ee=(" "+W[V]).slice(1),Z=(" "+W[V+1]).slice(1),ie=W[V+2]?(" "+W[V+2]).slice(1):"";switch(ee){case"PLAYLIST-TYPE":v.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":I=v.startSN=parseInt(Z);break;case"SKIP":{var ae=new A.AttrList(Z),se=ae.decimalInteger("SKIPPED-SEGMENTS");if(Object(O.isFiniteNumber)(se)){v.skippedSegments=se;for(var ue=se;ue--;)L.unshift(null);I+=se}var fe=ae.enumeratedString("RECENTLY-REMOVED-DATERANGES");fe&&(v.recentlyRemovedDateranges=fe.split("	"));break}case"TARGETDURATION":v.targetduration=parseFloat(Z);break;case"VERSION":v.version=parseInt(Z);break;case"EXTM3U":break;case"ENDLIST":v.live=!1;break;case"#":(Z||ie)&&U.tagList.push(ie?[Z,ie]:[Z]);break;case"DIS":_++;case"GAP":U.tagList.push([ee]);break;case"BITRATE":U.tagList.push([ee,Z]);break;case"DISCONTINUITY-SEQ":_=parseInt(Z);break;case"KEY":{var de,he=new A.AttrList(Z),me=he.enumeratedString("METHOD"),pe=he.URI,ye=he.hexadecimalInteger("IV"),ge=he.enumeratedString("KEYFORMATVERSIONS"),xe=he.enumeratedString("KEYID"),ce=(de=he.enumeratedString("KEYFORMAT"))!=null?de:"identity",Me=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Me.indexOf(ce)>-1){g.logger.warn("Keyformat "+ce+" is not supported from the manifest");continue}else if(ce!=="identity")continue;me&&(X=R.LevelKey.fromURL(x,pe),pe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(me)>=0&&(X.method=me,X.keyFormat=ce,xe&&(X.keyID=xe),ge&&(X.keyFormatVersions=ge),X.iv=ye));break}case"START":{var we=new A.AttrList(Z),Ie=we.decimalFloatingPoint("TIME-OFFSET");Object(O.isFiniteNumber)(Ie)&&(v.startTimeOffset=Ie);break}case"MAP":{var be=new A.AttrList(Z);U.relurl=be.URI,be.BYTERANGE&&U.setByteRange(be.BYTERANGE),U.level=f,U.sn="initSegment",X&&(U.levelkey=X),U.initSegment=null,D=U,J=!0;break}case"SERVER-CONTROL":{var Se=new A.AttrList(Z);v.canBlockReload=Se.bool("CAN-BLOCK-RELOAD"),v.canSkipUntil=Se.optionalFloat("CAN-SKIP-UNTIL",0),v.canSkipDateRanges=v.canSkipUntil>0&&Se.bool("CAN-SKIP-DATERANGES"),v.partHoldBack=Se.optionalFloat("PART-HOLD-BACK",0),v.holdBack=Se.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Re=new A.AttrList(Z);v.partTarget=Re.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Ae=v.partList;Ae||(Ae=v.partList=[]);var Te=k>0?Ae[Ae.length-1]:void 0,De=k++,_e=new i.Part(new A.AttrList(Z),U,x,De,Te);Ae.push(_e),U.duration+=_e.duration;break}case"PRELOAD-HINT":{var Be=new A.AttrList(Z);v.preloadHint=Be;break}case"RENDITION-REPORT":{var ke=new A.AttrList(Z);v.renditionReports=v.renditionReports||[],v.renditionReports.push(ke);break}default:g.logger.warn("line parsed but not handled: "+W);break}}}F&&!F.relurl?(L.pop(),w-=F.duration,v.partList&&(v.fragmentHint=F)):v.partList&&(s(U,F),U.cc=_,v.fragmentHint=U);var Fe=L.length,Ce=L[0],Oe=L[Fe-1];if(w+=v.skippedSegments*v.targetduration,w>0&&Fe&&Oe){v.averagetargetduration=w/Fe;var Ne=Oe.sn;v.endSN=Ne!=="initSegment"?Ne:0,Ce&&(v.startCC=Ce.cc,Ce.initSegment||v.fragments.every(function(We){return We.relurl&&n(We.relurl)})&&(g.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),U=new i.Fragment(u,x),U.relurl=Oe.relurl,U.level=f,U.sn="initSegment",Ce.initSegment=U,v.needSidxRanges=!0))}else v.endSN=0,v.startCC=0;return v.fragmentHint&&(w+=v.fragmentHint.duration),v.totalduration=w,v.endCC=_,Y>0&&l(L,Y),v},a}();function r(a,o){["video","audio","text"].forEach(function(E){var x=a.filter(function(u){return Object(c.isCodecType)(u,E)});if(x.length){var f=x.filter(function(u){return u.lastIndexOf("avc1",0)===0||u.lastIndexOf("mp4a",0)===0});o[E+"Codec"]=f.length>0?f[0]:x[0],a=a.filter(function(u){return x.indexOf(u)===-1})}}),o.unknownCodecs=a}function t(a,o,E){var x=o[E];x&&(a[E]=x)}function l(a,o){for(var E=a[o],x=o;x--;){var f=a[x];if(!f)return;f.programDateTime=E.programDateTime-f.duration*1e3,E=f}}function s(a,o){a.rawProgramDateTime?a.programDateTime=Date.parse(a.rawProgramDateTime):o!=null&&o.programDateTime&&(a.programDateTime=o.endProgramDateTime),Object(O.isFiniteNumber)(a.programDateTime)||(a.programDateTime=null,a.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(N,P,h){h.r(P);var O=h("./src/polyfills/number.ts"),T=h("./src/events.ts"),i=h("./src/errors.ts"),C=h("./src/utils/logger.ts"),R=h("./src/utils/mp4-tools.ts"),A=h("./src/loader/m3u8-parser.ts"),g=h("./src/types/loader.ts"),c=h("./src/utils/attr-list.ts");function m(b){var p=b.type;switch(p){case g.PlaylistContextType.AUDIO_TRACK:return g.PlaylistLevelType.AUDIO;case g.PlaylistContextType.SUBTITLE_TRACK:return g.PlaylistLevelType.SUBTITLE;default:return g.PlaylistLevelType.MAIN}}function y(b,p){var n=b.url;return(n===void 0||n.indexOf("data:")===0)&&(n=p.url),n}var S=function(){function b(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var p=b.prototype;return p.registerListeners=function(){var e=this.hls;e.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},p.unregisterListeners=function(){var e=this.hls;e.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},p.createInternalLoader=function(e){var r=this.hls.config,t=r.pLoader,l=r.loader,s=t||l,a=new s(r);return e.loader=a,this.loaders[e.type]=a,a},p.getInternalLoader=function(e){return this.loaders[e.type]},p.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},p.destroyInternalLoaders=function(){for(var e in this.loaders){var r=this.loaders[e];r&&r.destroy(),this.resetInternalLoader(e)}},p.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},p.onManifestLoading=function(e,r){var t=r.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:g.PlaylistContextType.MANIFEST,url:t,deliveryDirectives:null})},p.onLevelLoading=function(e,r){var t=r.id,l=r.level,s=r.url,a=r.deliveryDirectives;this.load({id:t,groupId:null,level:l,responseType:"text",type:g.PlaylistContextType.LEVEL,url:s,deliveryDirectives:a})},p.onAudioTrackLoading=function(e,r){var t=r.id,l=r.groupId,s=r.url,a=r.deliveryDirectives;this.load({id:t,groupId:l,level:null,responseType:"text",type:g.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:a})},p.onSubtitleTrackLoading=function(e,r){var t=r.id,l=r.groupId,s=r.url,a=r.deliveryDirectives;this.load({id:t,groupId:l,level:null,responseType:"text",type:g.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:a})},p.load=function(e){var r,t=this.hls.config,l=this.getInternalLoader(e);if(l){var s=l.context;if(s&&s.url===e.url){C.logger.trace("[playlist-loader]: playlist request ongoing");return}C.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}var a,o,E,x;switch(e.type){case g.PlaylistContextType.MANIFEST:a=t.manifestLoadingMaxRetry,o=t.manifestLoadingTimeOut,E=t.manifestLoadingRetryDelay,x=t.manifestLoadingMaxRetryTimeout;break;case g.PlaylistContextType.LEVEL:case g.PlaylistContextType.AUDIO_TRACK:case g.PlaylistContextType.SUBTITLE_TRACK:a=0,o=t.levelLoadingTimeOut;break;default:a=t.levelLoadingMaxRetry,o=t.levelLoadingTimeOut,E=t.levelLoadingRetryDelay,x=t.levelLoadingMaxRetryTimeout;break}if(l=this.createInternalLoader(e),(r=e.deliveryDirectives)!==null&&r!==void 0&&r.part){var f;if(e.type===g.PlaylistContextType.LEVEL&&e.level!==null?f=this.hls.levels[e.level].details:e.type===g.PlaylistContextType.AUDIO_TRACK&&e.id!==null?f=this.hls.audioTracks[e.id].details:e.type===g.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(f=this.hls.subtitleTracks[e.id].details),f){var u=f.partTarget,d=f.targetduration;u&&d&&(o=Math.min(Math.max(u*3,d*.8)*1e3,o))}}var v={timeout:o,maxRetry:a,retryDelay:E,maxRetryDelay:x,highWaterMark:0},L={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(e,v,L)},p.loadsuccess=function(e,r,t,l){if(l===void 0&&(l=null),t.isSidxRequest){this.handleSidxRequest(e,t),this.handlePlaylistLoaded(e,r,t,l);return}this.resetInternalLoader(t.type);var s=e.data;if(s.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,t,"no EXTM3U delimiter",l);return}r.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,r,t,l):this.handleMasterPlaylist(e,r,t,l)},p.loaderror=function(e,r,t){t===void 0&&(t=null),this.handleNetworkError(r,t,!1,e)},p.loadtimeout=function(e,r,t){t===void 0&&(t=null),this.handleNetworkError(r,t,!0)},p.handleMasterPlaylist=function(e,r,t,l){var s=this.hls,a=e.data,o=y(e,t),E=A.default.parseMasterPlaylist(a,o),x=E.levels,f=E.sessionData;if(!x.length){this.handleManifestParsingError(e,t,"no level found in manifest",l);return}var u=x.map(function(k){return{id:k.attrs.AUDIO,audioCodec:k.audioCodec}}),d=x.map(function(k){return{id:k.attrs.SUBTITLES,textCodec:k.textCodec}}),v=A.default.parseMasterPlaylistMedia(a,o,"AUDIO",u),L=A.default.parseMasterPlaylistMedia(a,o,"SUBTITLES",d),D=A.default.parseMasterPlaylistMedia(a,o,"CLOSED-CAPTIONS");if(v.length){var I=v.some(function(k){return!k.url});!I&&x[0].audioCodec&&!x[0].attrs.AUDIO&&(C.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new c.AttrList({}),bitrate:0,url:""}))}s.trigger(T.Events.MANIFEST_LOADED,{levels:x,audioTracks:v,subtitles:L,captions:D,url:o,stats:r,networkDetails:l,sessionData:f})},p.handleTrackOrLevelPlaylist=function(e,r,t,l){var s=this.hls,a=t.id,o=t.level,E=t.type,x=y(e,t),f=Object(O.isFiniteNumber)(a)?a:0,u=Object(O.isFiniteNumber)(o)?o:f,d=m(t),v=A.default.parseLevelPlaylist(e.data,x,u,d,f);if(!v.fragments.length){s.trigger(T.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:x,reason:"no fragments found in level",level:typeof t.level=="number"?t.level:void 0});return}if(E===g.PlaylistContextType.MANIFEST){var L={attrs:new c.AttrList({}),bitrate:0,details:v,name:"",url:x};s.trigger(T.Events.MANIFEST_LOADED,{levels:[L],audioTracks:[],url:x,stats:r,networkDetails:l,sessionData:null})}if(r.parsing.end=performance.now(),v.needSidxRanges){var D,I=(D=v.fragments[0].initSegment)===null||D===void 0?void 0:D.url;this.load({url:I,isSidxRequest:!0,type:E,level:o,levelDetails:v,id:a,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}t.levelDetails=v,this.handlePlaylistLoaded(e,r,t,l)},p.handleSidxRequest=function(e,r){var t=Object(R.parseSegmentIndex)(new Uint8Array(e.data));if(!!t){var l=t.references,s=r.levelDetails;l.forEach(function(a,o){var E=a.info,x=s.fragments[o];x.byteRange.length===0&&x.setByteRange(String(1+E.end-E.start)+"@"+String(E.start)),x.initSegment&&x.initSegment.setByteRange(String(t.moovEndOffset)+"@0")})}},p.handleManifestParsingError=function(e,r,t,l){this.hls.trigger(T.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:r.type===g.PlaylistContextType.MANIFEST,url:e.url,reason:t,response:e,context:r,networkDetails:l})},p.handleNetworkError=function(e,r,t,l){t===void 0&&(t=!1),C.logger.warn("[playlist-loader]: A network "+(t?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=i.ErrorDetails.UNKNOWN,a=!1,o=this.getInternalLoader(e);switch(e.type){case g.PlaylistContextType.MANIFEST:s=t?i.ErrorDetails.MANIFEST_LOAD_TIMEOUT:i.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case g.PlaylistContextType.LEVEL:s=t?i.ErrorDetails.LEVEL_LOAD_TIMEOUT:i.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case g.PlaylistContextType.AUDIO_TRACK:s=t?i.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;case g.PlaylistContextType.SUBTITLE_TRACK:s=t?i.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:i.ErrorDetails.SUBTITLE_LOAD_ERROR,a=!1;break}o&&this.resetInternalLoader(e.type);var E={type:i.ErrorTypes.NETWORK_ERROR,details:s,fatal:a,url:e.url,loader:o,context:e,networkDetails:r};l&&(E.response=l),this.hls.trigger(T.Events.ERROR,E)},p.handlePlaylistLoaded=function(e,r,t,l){var s=t.type,a=t.level,o=t.id,E=t.groupId,x=t.loader,f=t.levelDetails,u=t.deliveryDirectives;if(!(f!=null&&f.targetduration)){this.handleManifestParsingError(e,t,"invalid target duration",l);return}if(!!x)switch(f.live&&(x.getCacheAge&&(f.ageHeader=x.getCacheAge()||0),(!x.getCacheAge||isNaN(f.ageHeader))&&(f.ageHeader=0)),s){case g.PlaylistContextType.MANIFEST:case g.PlaylistContextType.LEVEL:this.hls.trigger(T.Events.LEVEL_LOADED,{details:f,level:a||0,id:o||0,stats:r,networkDetails:l,deliveryDirectives:u});break;case g.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(T.Events.AUDIO_TRACK_LOADED,{details:f,id:o||0,groupId:E||"",stats:r,networkDetails:l,deliveryDirectives:u});break;case g.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(T.Events.SUBTITLE_TRACK_LOADED,{details:f,id:o||0,groupId:E||"",stats:r,networkDetails:l,deliveryDirectives:u});break}},b}();P.default=S},"./src/polyfills/number.ts":function(N,P,h){h.r(P),h.d(P,"isFiniteNumber",function(){return O}),h.d(P,"MAX_SAFE_INTEGER",function(){return T});var O=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},T=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(N,P,h){h.r(P);var O=function(){function T(){}return T.getSilentFrame=function(C,R){switch(C){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},T}();P.default=O},"./src/remux/mp4-generator.ts":function(N,P,h){h.r(P);var O=Math.pow(2,32)-1,T=function(){function i(){}return i.init=function(){i.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var R;for(R in i.types)i.types.hasOwnProperty(R)&&(i.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var A=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),g=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);i.HDLR_TYPES={video:A,audio:g};var c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),m=new Uint8Array([0,0,0,0,0,0,0,0]);i.STTS=i.STSC=i.STCO=m,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var y=new Uint8Array([105,115,111,109]),S=new Uint8Array([97,118,99,49]),b=new Uint8Array([0,0,0,1]);i.FTYP=i.box(i.types.ftyp,y,b,y,S),i.DINF=i.box(i.types.dinf,i.box(i.types.dref,c))},i.box=function(R){for(var A=8,g=arguments.length,c=new Array(g>1?g-1:0),m=1;m<g;m++)c[m-1]=arguments[m];for(var y=c.length,S=y;y--;)A+=c[y].byteLength;var b=new Uint8Array(A);for(b[0]=A>>24&255,b[1]=A>>16&255,b[2]=A>>8&255,b[3]=A&255,b.set(R,4),y=0,A=8;y<S;y++)b.set(c[y],A),A+=c[y].byteLength;return b},i.hdlr=function(R){return i.box(i.types.hdlr,i.HDLR_TYPES[R])},i.mdat=function(R){return i.box(i.types.mdat,R)},i.mdhd=function(R,A){A*=R;var g=Math.floor(A/(O+1)),c=Math.floor(A%(O+1));return i.box(i.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,g>>24,g>>16&255,g>>8&255,g&255,c>>24,c>>16&255,c>>8&255,c&255,85,196,0,0]))},i.mdia=function(R){return i.box(i.types.mdia,i.mdhd(R.timescale,R.duration),i.hdlr(R.type),i.minf(R))},i.mfhd=function(R){return i.box(i.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255]))},i.minf=function(R){return R.type==="audio"?i.box(i.types.minf,i.box(i.types.smhd,i.SMHD),i.DINF,i.stbl(R)):i.box(i.types.minf,i.box(i.types.vmhd,i.VMHD),i.DINF,i.stbl(R))},i.moof=function(R,A,g){return i.box(i.types.moof,i.mfhd(R),i.traf(g,A))},i.moov=function(R){for(var A=R.length,g=[];A--;)g[A]=i.trak(R[A]);return i.box.apply(null,[i.types.moov,i.mvhd(R[0].timescale,R[0].duration)].concat(g).concat(i.mvex(R)))},i.mvex=function(R){for(var A=R.length,g=[];A--;)g[A]=i.trex(R[A]);return i.box.apply(null,[i.types.mvex].concat(g))},i.mvhd=function(R,A){A*=R;var g=Math.floor(A/(O+1)),c=Math.floor(A%(O+1)),m=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,g>>24,g>>16&255,g>>8&255,g&255,c>>24,c>>16&255,c>>8&255,c&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return i.box(i.types.mvhd,m)},i.sdtp=function(R){var A=R.samples||[],g=new Uint8Array(4+A.length),c,m;for(c=0;c<A.length;c++)m=A[c].flags,g[c+4]=m.dependsOn<<4|m.isDependedOn<<2|m.hasRedundancy;return i.box(i.types.sdtp,g)},i.stbl=function(R){return i.box(i.types.stbl,i.stsd(R),i.box(i.types.stts,i.STTS),i.box(i.types.stsc,i.STSC),i.box(i.types.stsz,i.STSZ),i.box(i.types.stco,i.STCO))},i.avc1=function(R){var A=[],g=[],c,m,y;for(c=0;c<R.sps.length;c++)m=R.sps[c],y=m.byteLength,A.push(y>>>8&255),A.push(y&255),A=A.concat(Array.prototype.slice.call(m));for(c=0;c<R.pps.length;c++)m=R.pps[c],y=m.byteLength,g.push(y>>>8&255),g.push(y&255),g=g.concat(Array.prototype.slice.call(m));var S=i.box(i.types.avcC,new Uint8Array([1,A[3],A[4],A[5],255,224|R.sps.length].concat(A).concat([R.pps.length]).concat(g))),b=R.width,p=R.height,n=R.pixelRatio[0],e=R.pixelRatio[1];return i.box(i.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,b>>8&255,b&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),S,i.box(i.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),i.box(i.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255])))},i.esds=function(R){var A=R.config.length;return new Uint8Array([0,0,0,0,3,23+A,0,1,0,4,15+A,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([A]).concat(R.config).concat([6,1,2]))},i.mp4a=function(R){var A=R.samplerate;return i.box(i.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]),i.box(i.types.esds,i.esds(R)))},i.mp3=function(R){var A=R.samplerate;return i.box(i.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]))},i.stsd=function(R){return R.type==="audio"?!R.isAAC&&R.codec==="mp3"?i.box(i.types.stsd,i.STSD,i.mp3(R)):i.box(i.types.stsd,i.STSD,i.mp4a(R)):i.box(i.types.stsd,i.STSD,i.avc1(R))},i.tkhd=function(R){var A=R.id,g=R.duration*R.timescale,c=R.width,m=R.height,y=Math.floor(g/(O+1)),S=Math.floor(g%(O+1));return i.box(i.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,0,0,0,0,y>>24,y>>16&255,y>>8&255,y&255,S>>24,S>>16&255,S>>8&255,S&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,c>>8&255,c&255,0,0,m>>8&255,m&255,0,0]))},i.traf=function(R,A){var g=i.sdtp(R),c=R.id,m=Math.floor(A/(O+1)),y=Math.floor(A%(O+1));return i.box(i.types.traf,i.box(i.types.tfhd,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255])),i.box(i.types.tfdt,new Uint8Array([1,0,0,0,m>>24,m>>16&255,m>>8&255,m&255,y>>24,y>>16&255,y>>8&255,y&255])),i.trun(R,g.length+16+20+8+16+8+8),g)},i.trak=function(R){return R.duration=R.duration||4294967295,i.box(i.types.trak,i.tkhd(R),i.mdia(R))},i.trex=function(R){var A=R.id;return i.box(i.types.trex,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},i.trun=function(R,A){var g=R.samples||[],c=g.length,m=12+16*c,y=new Uint8Array(m),S,b,p,n,e,r;for(A+=8+m,y.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,c&255,A>>>24&255,A>>>16&255,A>>>8&255,A&255],0),S=0;S<c;S++)b=g[S],p=b.duration,n=b.size,e=b.flags,r=b.cts,y.set([p>>>24&255,p>>>16&255,p>>>8&255,p&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*S);return i.box(i.types.trun,y)},i.initSegment=function(R){i.types||i.init();var A=i.moov(R),g=new Uint8Array(i.FTYP.byteLength+A.byteLength);return g.set(i.FTYP),g.set(A,i.FTYP.byteLength),g},i}();T.types=void 0,T.HDLR_TYPES=void 0,T.STTS=void 0,T.STSC=void 0,T.STCO=void 0,T.STSZ=void 0,T.VMHD=void 0,T.SMHD=void 0,T.STSD=void 0,T.FTYP=void 0,T.DINF=void 0,P.default=T},"./src/remux/mp4-remuxer.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return r}),h.d(P,"normalizePts",function(){return t});var O=h("./src/polyfills/number.ts"),T=h("./src/remux/aac-helper.ts"),i=h("./src/remux/mp4-generator.ts"),C=h("./src/events.ts"),R=h("./src/errors.ts"),A=h("./src/utils/logger.ts"),g=h("./src/types/loader.ts"),c=h("./src/utils/timescale-conversion.ts");function m(){return m=Object.assign||function(o){for(var E=1;E<arguments.length;E++){var x=arguments[E];for(var f in x)Object.prototype.hasOwnProperty.call(x,f)&&(o[f]=x[f])}return o},m.apply(this,arguments)}var y=10*1e3,S=1024,b=1152,p=null,n=null,e=!1,r=function(){function o(x,f,u,d){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=x,this.config=f,this.typeSupported=u,this.ISGenerated=!1,p===null){var v=navigator.userAgent||"",L=v.match(/Chrome\/(\d+)/i);p=L?parseInt(L[1]):0}if(n===null){var D=navigator.userAgent.match(/Safari\/(\d+)/i);n=D?parseInt(D[1]):0}e=!!p&&p<75||!!n&&n<600}var E=o.prototype;return E.destroy=function(){},E.resetTimeStamp=function(f){A.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=f},E.resetNextTimestamp=function(){A.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},E.resetInitSegment=function(){A.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},E.getVideoStartPts=function(f){var u=!1,d=f.reduce(function(v,L){var D=L.pts-v;return D<-4294967296?(u=!0,t(v,L.pts)):D>0?v:L.pts},f[0].pts);return u&&A.logger.debug("PTS rollover detected"),d},E.remux=function(f,u,d,v,L,D,I,k){var w,_,F,U,W,V,X=L,Y=L,J=f.pid>-1,q=u.pid>-1,$=u.samples.length,ne=f.samples.length>0,ee=$>1,Z=(!J||ne)&&(!q||ee)||this.ISGenerated||I;if(Z){this.ISGenerated||(F=this.generateIS(f,u,L));var ie=this.isVideoContiguous,ae=-1;if(ee&&(ae=l(u.samples),!ie&&this.config.forceKeyFrameOnDiscontinuity))if(V=!0,ae>0){A.logger.warn("[mp4-remuxer]: Dropped "+ae+" out of "+$+" video samples due to a missing keyframe");var se=this.getVideoStartPts(u.samples);u.samples=u.samples.slice(ae),u.dropped+=ae,Y+=(u.samples[0].pts-se)/(u.timescale||9e4)}else ae===-1&&(A.logger.warn("[mp4-remuxer]: No keyframe found out of "+$+" video samples"),V=!1);if(this.ISGenerated){if(ne&&ee){var ue=this.getVideoStartPts(u.samples),fe=t(f.samples[0].pts,ue)-ue,de=fe/u.inputTimeScale;X+=Math.max(0,de),Y+=Math.max(0,-de)}if(ne){if(f.samplerate||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),F=this.generateIS(f,u,L)),_=this.remuxAudio(f,X,this.isAudioContiguous,D,q||ee||k===g.PlaylistLevelType.AUDIO?Y:void 0),ee){var he=_?_.endPTS-_.startPTS:0;u.inputTimeScale||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),F=this.generateIS(f,u,L)),w=this.remuxVideo(u,Y,ie,he)}}else ee&&(w=this.remuxVideo(u,Y,ie,0));w&&(w.firstKeyFrame=ae,w.independent=ae!==-1)}}return this.ISGenerated&&(d.samples.length&&(W=this.remuxID3(d,L)),v.samples.length&&(U=this.remuxText(v,L))),{audio:_,video:w,initSegment:F,independent:V,text:U,id3:W}},E.generateIS=function(f,u,d){var v=f.samples,L=u.samples,D=this.typeSupported,I={},k=!Object(O.isFiniteNumber)(this._initPTS),w="audio/mp4",_,F,U;if(k&&(_=F=1/0),f.config&&v.length&&(f.timescale=f.samplerate,f.isAAC||(D.mpeg?(w="audio/mpeg",f.codec=""):D.mp3&&(f.codec="mp3")),I.audio={id:"audio",container:w,codec:f.codec,initSegment:!f.isAAC&&D.mpeg?new Uint8Array(0):i.default.initSegment([f]),metadata:{channelCount:f.channelCount}},k&&(U=f.inputTimeScale,_=F=v[0].pts-Math.round(U*d))),u.sps&&u.pps&&L.length&&(u.timescale=u.inputTimeScale,I.video={id:"main",container:"video/mp4",codec:u.codec,initSegment:i.default.initSegment([u]),metadata:{width:u.width,height:u.height}},k)){U=u.inputTimeScale;var W=this.getVideoStartPts(L),V=Math.round(U*d);F=Math.min(F,t(L[0].dts,W)-V),_=Math.min(_,W-V)}if(Object.keys(I).length)return this.ISGenerated=!0,k&&(this._initPTS=_,this._initDTS=F),{tracks:I,initPTS:_,timescale:U}},E.remuxVideo=function(f,u,d,v){var L=f.inputTimeScale,D=f.samples,I=[],k=D.length,w=this._initPTS,_=this.nextAvcDts,F=8,U,W,V,X=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY,J=0,q=!1;if(!d||_===null){var $=u*L,ne=D[0].pts-t(D[0].dts,D[0].pts);_=$-ne}for(var ee=0;ee<k;ee++){var Z=D[ee];if(Z.pts=t(Z.pts-w,_),Z.dts=t(Z.dts-w,_),Z.dts>Z.pts){var ie=18e3;J=Math.max(Math.min(J,Z.pts-Z.dts),-1*ie)}Z.dts<D[ee>0?ee-1:ee].dts&&(q=!0)}q&&D.sort(function(He,Je){var Ke=He.dts-Je.dts,dt=He.pts-Je.pts;return Ke||dt}),W=D[0].dts,V=D[D.length-1].dts;var ae=Math.round((V-W)/(k-1));if(J<0){if(J<ae*-2){A.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(c.toMsFromMpegTsClock)(-ae,!0)+" ms");for(var se=J,ue=0;ue<k;ue++)D[ue].dts=se=Math.max(se,D[ue].pts-ae),D[ue].pts=Math.max(se,D[ue].pts)}else{A.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(c.toMsFromMpegTsClock)(J,!0)+" ms to overcome this issue");for(var fe=0;fe<k;fe++)D[fe].dts=D[fe].dts+J}W=D[0].dts}if(d){var de=W-_,he=de>ae,me=de<-1;if(he||me){he?A.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(de,!0)+" ms ("+de+"dts) hole between fragments detected, filling it"):A.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(-de,!0)+" ms ("+de+"dts) overlapping between fragments detected"),W=_;var pe=D[0].pts-de;D[0].dts=W,D[0].pts=pe,A.logger.log("Video: First PTS/DTS adjusted: "+Object(c.toMsFromMpegTsClock)(pe,!0)+"/"+Object(c.toMsFromMpegTsClock)(W,!0)+", delta: "+Object(c.toMsFromMpegTsClock)(de,!0)+" ms")}}e&&(W=Math.max(0,W));for(var ye=0,ge=0,xe=0;xe<k;xe++){for(var ce=D[xe],Me=ce.units,we=Me.length,Ie=0,be=0;be<we;be++)Ie+=Me[be].data.length;ge+=Ie,ye+=we,ce.length=Ie,ce.dts=Math.max(ce.dts,W),ce.pts=Math.max(ce.pts,ce.dts,0),X=Math.min(ce.pts,X),Y=Math.max(ce.pts,Y)}V=D[k-1].dts;var Se=ge+4*ye+8,Re;try{Re=new Uint8Array(Se)}catch{this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Se,reason:"fail allocating video mdat "+Se});return}var Ae=new DataView(Re.buffer);Ae.setUint32(0,Se),Re.set(i.default.types.mdat,4);for(var Te=0;Te<k;Te++){for(var De=D[Te],_e=De.units,Be=0,ke=0,Fe=_e.length;ke<Fe;ke++){var Ce=_e[ke],Oe=Ce.data,Ne=Ce.data.byteLength;Ae.setUint32(F,Ne),F+=4,Re.set(Oe,F),F+=Ne,Be+=4+Ne}if(Te<k-1)U=D[Te+1].dts-De.dts;else{var We=this.config,Ge=De.dts-D[Te>0?Te-1:Te].dts;if(We.stretchShortVideoTrack&&this.nextAudioPts!==null){var st=Math.floor(We.maxBufferHole*L),$e=(v?X+v*L:this.nextAudioPts)-De.pts;$e>st?(U=$e-Ge,U<0&&(U=Ge),A.logger.log("[mp4-remuxer]: It is approximately "+$e/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=Ge}else U=Ge}var ot=Math.round(De.pts-De.dts);I.push(new s(De.key,U,Be,ot))}if(I.length&&p&&p<70){var tt=I[0].flags;tt.dependsOn=2,tt.isNonSync=0}console.assert(U!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=_=V+U,this.isVideoContiguous=!0;var lt=i.default.moof(f.sequenceNumber++,W,m({},f,{samples:I})),rt="video",ut={data1:lt,data2:Re,startPTS:X/L,endPTS:(Y+U)/L,startDTS:W/L,endDTS:_/L,type:rt,hasAudio:!1,hasVideo:!0,nb:I.length,dropped:f.dropped};return f.samples=[],f.dropped=0,console.assert(Re.length,"MDAT length must not be zero"),ut},E.remuxAudio=function(f,u,d,v,L){var D=f.inputTimeScale,I=f.samplerate?f.samplerate:D,k=D/I,w=f.isAAC?S:b,_=w*k,F=this._initPTS,U=!f.isAAC&&this.typeSupported.mpeg,W=[],V=f.samples,X=U?0:8,Y=this.nextAudioPts||-1,J=u*D;if(this.isAudioContiguous=d=d||V.length&&Y>0&&(v&&Math.abs(J-Y)<9e3||Math.abs(t(V[0].pts-F,J)-Y)<20*_),V.forEach(function(Oe){Oe.pts=t(Oe.pts-F,J)}),!d||Y<0){if(V=V.filter(function(Oe){return Oe.pts>=0}),!V.length)return;L===0?Y=0:v?Y=Math.max(0,J):Y=V[0].pts}if(f.isAAC)for(var q=L!==void 0,$=this.config.maxAudioFramesDrift,ne=0,ee=Y;ne<V.length;ne++){var Z=V[ne],ie=Z.pts,ae=ie-ee,se=Math.abs(1e3*ae/D);if(ae<=-$*_&&q)ne===0&&(A.logger.warn("Audio frame @ "+(ie/D).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ae/D)+" ms."),this.nextAudioPts=Y=ee=ie);else if(ae>=$*_&&se<y&&q){var ue=Math.round(ae/_);ee=ie-ue*_,ee<0&&(ue--,ee+=_),ne===0&&(this.nextAudioPts=Y=ee),A.logger.warn("[mp4-remuxer]: Injecting "+ue+" audio frame @ "+(ee/D).toFixed(3)+"s due to "+Math.round(1e3*ae/D)+" ms gap.");for(var fe=0;fe<ue;fe++){var de=Math.max(ee,0),he=T.default.getSilentFrame(f.manifestCodec||f.codec,f.channelCount);he||(A.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),he=Z.unit.subarray()),V.splice(ne,0,{unit:he,pts:de}),ee+=_,ne++}}Z.pts=ee,ee+=_}for(var me=null,pe=null,ye,ge=0,xe=V.length;xe--;)ge+=V[xe].unit.byteLength;for(var ce=0,Me=V.length;ce<Me;ce++){var we=V[ce],Ie=we.unit,be=we.pts;if(pe!==null){var Se=W[ce-1];Se.duration=Math.round((be-pe)/k)}else if(d&&f.isAAC&&(be=Y),me=be,ge>0){ge+=X;try{ye=new Uint8Array(ge)}catch{this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ge,reason:"fail allocating audio mdat "+ge});return}if(!U){var Re=new DataView(ye.buffer);Re.setUint32(0,ge),ye.set(i.default.types.mdat,4)}}else return;ye.set(Ie,X);var Ae=Ie.byteLength;X+=Ae,W.push(new s(!0,w,Ae,0)),pe=be}var Te=W.length;if(!!Te){var De=W[W.length-1];this.nextAudioPts=Y=pe+k*De.duration;var _e=U?new Uint8Array(0):i.default.moof(f.sequenceNumber++,me/k,m({},f,{samples:W}));f.samples=[];var Be=me/D,ke=Y/D,Fe="audio",Ce={data1:_e,data2:ye,startPTS:Be,endPTS:ke,startDTS:Be,endDTS:ke,type:Fe,hasAudio:!0,hasVideo:!1,nb:Te};return this.isAudioContiguous=!0,console.assert(ye.length,"MDAT length must not be zero"),Ce}},E.remuxEmptyAudio=function(f,u,d,v){var L=f.inputTimeScale,D=f.samplerate?f.samplerate:L,I=L/D,k=this.nextAudioPts,w=(k!==null?k:v.startDTS*L)+this._initDTS,_=v.endDTS*L+this._initDTS,F=I*S,U=Math.ceil((_-w)/F),W=T.default.getSilentFrame(f.manifestCodec||f.codec,f.channelCount);if(A.logger.warn("[mp4-remuxer]: remux empty Audio"),!W){A.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var V=[],X=0;X<U;X++){var Y=w+X*F;V.push({unit:W,pts:Y,dts:Y})}return f.samples=V,this.remuxAudio(f,u,d,!1)},E.remuxID3=function(f,u){var d=f.samples.length;if(!!d){for(var v=f.inputTimeScale,L=this._initPTS,D=this._initDTS,I=0;I<d;I++){var k=f.samples[I];k.pts=t(k.pts-L,u*v)/v,k.dts=t(k.dts-D,u*v)/v}var w=f.samples;return f.samples=[],{samples:w}}},E.remuxText=function(f,u){var d=f.samples.length;if(!!d){for(var v=f.inputTimeScale,L=this._initPTS,D=0;D<d;D++){var I=f.samples[D];I.pts=t(I.pts-L,u*v)/v}f.samples.sort(function(w,_){return w.pts-_.pts});var k=f.samples;return f.samples=[],{samples:k}}},o}();function t(o,E){var x;if(E===null)return o;for(E<o?x=-8589934592:x=8589934592;Math.abs(o-E)>4294967296;)o+=x;return o}function l(o){for(var E=0;E<o.length;E++)if(o[E].key)return E;return-1}var s=function(E,x,f,u){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=x,this.size=f,this.cts=u,this.flags=new a(E)},a=function(E){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=E?2:1,this.isNonSync=E?0:1}},"./src/remux/passthrough-remuxer.ts":function(N,P,h){h.r(P);var O=h("./src/polyfills/number.ts"),T=h("./src/utils/mp4-tools.ts"),i=h("./src/loader/fragment.ts"),C=h("./src/utils/logger.ts"),R=function(){function c(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var m=c.prototype;return m.destroy=function(){},m.resetTimeStamp=function(S){this.initPTS=S,this.lastEndDTS=null},m.resetNextTimestamp=function(){this.lastEndDTS=null},m.resetInitSegment=function(S,b,p){this.audioCodec=b,this.videoCodec=p,this.generateInitSegment(S),this.emitInitSegment=!0},m.generateInitSegment=function(S){var b=this.audioCodec,p=this.videoCodec;if(!S||!S.byteLength){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=Object(T.parseInitSegment)(S);b||(b=g(n.audio,i.ElementaryStreamTypes.AUDIO)),p||(p=g(n.video,i.ElementaryStreamTypes.VIDEO));var e={};n.audio&&n.video?e.audiovideo={container:"video/mp4",codec:b+","+p,initSegment:S,id:"main"}:n.audio?e.audio={container:"audio/mp4",codec:b,initSegment:S,id:"audio"}:n.video?e.video={container:"video/mp4",codec:p,initSegment:S,id:"main"}:C.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},m.remux=function(S,b,p,n,e){var r=this.initPTS,t=this.lastEndDTS,l={audio:void 0,video:void 0,text:n,id3:p,initSegment:void 0};Object(O.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var s=b.samples;if(!s||!s.length)return l;var a={initPTS:void 0,timescale:1},o=this.initData;if((!o||!o.length)&&(this.generateInitSegment(s),o=this.initData),!o||!o.length)return C.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(a.tracks=this.initTracks,this.emitInitSegment=!1),Object(O.isFiniteNumber)(r)||(this.initPTS=a.initPTS=r=A(o,s,t));var E=Object(T.getDuration)(s,o),x=t,f=E+x;Object(T.offsetStartDTS)(o,s,r),E>0?this.lastEndDTS=f:(C.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var u=!!o.audio,d=!!o.video,v="";u&&(v+="audio"),d&&(v+="video");var L={data1:s,startPTS:x,startDTS:x,endPTS:f,endDTS:f,type:v,hasAudio:u,hasVideo:d,nb:1,dropped:0};return l.audio=L.type==="audio"?L:void 0,l.video=L.type!=="audio"?L:void 0,l.text=n,l.id3=p,l.initSegment=a,l},c}(),A=function(m,y,S){return Object(T.getStartDTS)(m,y)-S};function g(c,m){var y=c==null?void 0:c.codec;return y&&y.length>4?y:y==="hvc1"?"hvc1.1.c.L120.90":y==="av01"?"av01.0.04M.08":y==="avc1"||m===i.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}P.default=R},"./src/task-loop.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return O});var O=function(){function T(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var i=T.prototype;return i.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.onHandlerDestroyed=function(){},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(R){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,R),!0)},i.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},i.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},i.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},i.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},i.doTick=function(){},T}()},"./src/types/cmcd.ts":function(N,P,h){h.r(P),h.d(P,"CMCDVersion",function(){return O}),h.d(P,"CMCDObjectType",function(){return T}),h.d(P,"CMCDStreamingFormat",function(){return i}),h.d(P,"CMCDStreamType",function(){return C});var O=1,T;(function(R){R.MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o"})(T||(T={}));var i;(function(R){R.DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o"})(i||(i={}));var C;(function(R){R.VOD="v",R.LIVE="l"})(C||(C={}))},"./src/types/level.ts":function(N,P,h){h.r(P),h.d(P,"HlsSkip",function(){return i}),h.d(P,"getSkipValue",function(){return C}),h.d(P,"HlsUrlParameters",function(){return R}),h.d(P,"Level",function(){return A});function O(g,c){for(var m=0;m<c.length;m++){var y=c[m];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(g,y.key,y)}}function T(g,c,m){return c&&O(g.prototype,c),m&&O(g,m),g}var i;(function(g){g.No="",g.Yes="YES",g.v2="v2"})(i||(i={}));function C(g,c){var m=g.canSkipUntil,y=g.canSkipDateRanges,S=g.endSN,b=c!==void 0?c-S:0;return m&&b<m?y?i.v2:i.Yes:i.No}var R=function(){function g(m,y,S){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=m,this.part=y,this.skip=S}var c=g.prototype;return c.addDirectives=function(y){var S=new self.URL(y);return this.msn!==void 0&&S.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&S.searchParams.set("_HLS_part",this.part.toString()),this.skip&&S.searchParams.set("_HLS_skip",this.skip),S.toString()},g}(),A=function(){function g(c){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[c.url],this.attrs=c.attrs,this.bitrate=c.bitrate,c.details&&(this.details=c.details),this.id=c.id||0,this.name=c.name,this.width=c.width||0,this.height=c.height||0,this.audioCodec=c.audioCodec,this.videoCodec=c.videoCodec,this.unknownCodecs=c.unknownCodecs,this.codecSet=[c.videoCodec,c.audioCodec].filter(function(m){return m}).join(",").replace(/\.[^.,]+/g,"")}return T(g,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(m){var y=m%this.url.length;this._urlId!==y&&(this.details=void 0,this._urlId=y)}}]),g}()},"./src/types/loader.ts":function(N,P,h){h.r(P),h.d(P,"PlaylistContextType",function(){return O}),h.d(P,"PlaylistLevelType",function(){return T});var O;(function(i){i.MANIFEST="manifest",i.LEVEL="level",i.AUDIO_TRACK="audioTrack",i.SUBTITLE_TRACK="subtitleTrack"})(O||(O={}));var T;(function(i){i.MAIN="main",i.AUDIO="audio",i.SUBTITLE="subtitle"})(T||(T={}))},"./src/types/transmuxer.ts":function(N,P,h){h.r(P),h.d(P,"ChunkMetadata",function(){return O});var O=function(C,R,A,g,c,m){g===void 0&&(g=0),c===void 0&&(c=-1),m===void 0&&(m=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=T(),this.buffering={audio:T(),video:T(),audiovideo:T()},this.level=C,this.sn=R,this.id=A,this.size=g,this.part=c,this.partial=m};function T(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(N,P,h){h.r(P),h.d(P,"AttrList",function(){return i});var O=/^(\d+)x(\d+)$/,T=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,i=function(){function C(A){typeof A=="string"&&(A=C.parseAttrList(A));for(var g in A)A.hasOwnProperty(g)&&(this[g]=A[g])}var R=C.prototype;return R.decimalInteger=function(g){var c=parseInt(this[g],10);return c>Number.MAX_SAFE_INTEGER?1/0:c},R.hexadecimalInteger=function(g){if(this[g]){var c=(this[g]||"0x").slice(2);c=(c.length&1?"0":"")+c;for(var m=new Uint8Array(c.length/2),y=0;y<c.length/2;y++)m[y]=parseInt(c.slice(y*2,y*2+2),16);return m}else return null},R.hexadecimalIntegerAsNumber=function(g){var c=parseInt(this[g],16);return c>Number.MAX_SAFE_INTEGER?1/0:c},R.decimalFloatingPoint=function(g){return parseFloat(this[g])},R.optionalFloat=function(g,c){var m=this[g];return m?parseFloat(m):c},R.enumeratedString=function(g){return this[g]},R.bool=function(g){return this[g]==="YES"},R.decimalResolution=function(g){var c=O.exec(this[g]);if(c!==null)return{width:parseInt(c[1],10),height:parseInt(c[2],10)}},C.parseAttrList=function(g){var c,m={},y='"';for(T.lastIndex=0;(c=T.exec(g))!==null;){var S=c[2];S.indexOf(y)===0&&S.lastIndexOf(y)===S.length-1&&(S=S.slice(1,-1)),m[c[1]]=S}return m},C}()},"./src/utils/binary-search.ts":function(N,P,h){h.r(P);var O={search:function(i,C){for(var R=0,A=i.length-1,g=null,c=null;R<=A;){g=(R+A)/2|0,c=i[g];var m=C(c);if(m>0)R=g+1;else if(m<0)A=g-1;else return c}return null}};P.default=O},"./src/utils/buffer-helper.ts":function(N,P,h){h.r(P),h.d(P,"BufferHelper",function(){return i});var O=h("./src/utils/logger.ts"),T={length:0,start:function(){return 0},end:function(){return 0}},i=function(){function C(){}return C.isBuffered=function(A,g){try{if(A){for(var c=C.getBuffered(A),m=0;m<c.length;m++)if(g>=c.start(m)&&g<=c.end(m))return!0}}catch{}return!1},C.bufferInfo=function(A,g,c){try{if(A){var m=C.getBuffered(A),y=[],S;for(S=0;S<m.length;S++)y.push({start:m.start(S),end:m.end(S)});return this.bufferedInfo(y,g,c)}}catch{}return{len:0,start:g,end:g,nextStart:void 0}},C.bufferedInfo=function(A,g,c){g=Math.max(0,g),A.sort(function(a,o){var E=a.start-o.start;return E||o.end-a.end});var m=[];if(c)for(var y=0;y<A.length;y++){var S=m.length;if(S){var b=m[S-1].end;A[y].start-b<c?A[y].end>b&&(m[S-1].end=A[y].end):m.push(A[y])}else m.push(A[y])}else m=A;for(var p=0,n,e=g,r=g,t=0;t<m.length;t++){var l=m[t].start,s=m[t].end;if(g+c>=l&&g<s)e=l,r=s,p=r-g;else if(g+c<l){n=l;break}}return{len:p,start:e||0,end:r||0,nextStart:n}},C.getBuffered=function(A){try{return A.buffered}catch(g){return O.logger.log("failed to get media.buffered",g),T}},C}()},"./src/utils/cea-608-parser.ts":function(N,P,h){h.r(P),h.d(P,"Row",function(){return r}),h.d(P,"CaptionScreen",function(){return t});var O=h("./src/utils/logger.ts"),T={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},i=function(f){var u=f;return T.hasOwnProperty(f)&&(u=T[f]),String.fromCharCode(u)},C=15,R=100,A={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},g={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],S;(function(x){x[x.ERROR=0]="ERROR",x[x.TEXT=1]="TEXT",x[x.WARNING=2]="WARNING",x[x.INFO=2]="INFO",x[x.DEBUG=3]="DEBUG",x[x.DATA=3]="DATA"})(S||(S={}));var b=function(){function x(){this.time=null,this.verboseLevel=S.ERROR}var f=x.prototype;return f.log=function(d,v){this.verboseLevel>=d&&O.logger.log(this.time+" ["+d+"] "+v)},x}(),p=function(f){for(var u=[],d=0;d<f.length;d++)u.push(f[d].toString(16));return u},n=function(){function x(u,d,v,L,D){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=u||"white",this.underline=d||!1,this.italics=v||!1,this.background=L||"black",this.flash=D||!1}var f=x.prototype;return f.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},f.setStyles=function(d){for(var v=["foreground","underline","italics","background","flash"],L=0;L<v.length;L++){var D=v[L];d.hasOwnProperty(D)&&(this[D]=d[D])}},f.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},f.equals=function(d){return this.foreground===d.foreground&&this.underline===d.underline&&this.italics===d.italics&&this.background===d.background&&this.flash===d.flash},f.copy=function(d){this.foreground=d.foreground,this.underline=d.underline,this.italics=d.italics,this.background=d.background,this.flash=d.flash},f.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},x}(),e=function(){function x(u,d,v,L,D,I){this.uchar=void 0,this.penState=void 0,this.uchar=u||" ",this.penState=new n(d,v,L,D,I)}var f=x.prototype;return f.reset=function(){this.uchar=" ",this.penState.reset()},f.setChar=function(d,v){this.uchar=d,this.penState.copy(v)},f.setPenState=function(d){this.penState.copy(d)},f.equals=function(d){return this.uchar===d.uchar&&this.penState.equals(d.penState)},f.copy=function(d){this.uchar=d.uchar,this.penState.copy(d.penState)},f.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},x}(),r=function(){function x(u){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var d=0;d<R;d++)this.chars.push(new e);this.logger=u,this.pos=0,this.currPenState=new n}var f=x.prototype;return f.equals=function(d){for(var v=!0,L=0;L<R;L++)if(!this.chars[L].equals(d.chars[L])){v=!1;break}return v},f.copy=function(d){for(var v=0;v<R;v++)this.chars[v].copy(d.chars[v])},f.isEmpty=function(){for(var d=!0,v=0;v<R;v++)if(!this.chars[v].isEmpty()){d=!1;break}return d},f.setCursor=function(d){this.pos!==d&&(this.pos=d),this.pos<0?(this.logger.log(S.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>R&&(this.logger.log(S.DEBUG,"Too large cursor position "+this.pos),this.pos=R)},f.moveCursor=function(d){var v=this.pos+d;if(d>1)for(var L=this.pos+1;L<v+1;L++)this.chars[L].setPenState(this.currPenState);this.setCursor(v)},f.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},f.insertChar=function(d){d>=144&&this.backSpace();var v=i(d);if(this.pos>=R){this.logger.log(S.ERROR,"Cannot insert "+d.toString(16)+" ("+v+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(v,this.currPenState),this.moveCursor(1)},f.clearFromPos=function(d){var v;for(v=d;v<R;v++)this.chars[v].reset()},f.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},f.clearToEndOfRow=function(){this.clearFromPos(this.pos)},f.getTextString=function(){for(var d=[],v=!0,L=0;L<R;L++){var D=this.chars[L].uchar;D!==" "&&(v=!1),d.push(D)}return v?"":d.join("")},f.setPenStyles=function(d){this.currPenState.setStyles(d);var v=this.chars[this.pos];v.setPenState(this.currPenState)},x}(),t=function(){function x(u){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var d=0;d<C;d++)this.rows.push(new r(u));this.logger=u,this.currRow=C-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var f=x.prototype;return f.reset=function(){for(var d=0;d<C;d++)this.rows[d].clear();this.currRow=C-1},f.equals=function(d){for(var v=!0,L=0;L<C;L++)if(!this.rows[L].equals(d.rows[L])){v=!1;break}return v},f.copy=function(d){for(var v=0;v<C;v++)this.rows[v].copy(d.rows[v])},f.isEmpty=function(){for(var d=!0,v=0;v<C;v++)if(!this.rows[v].isEmpty()){d=!1;break}return d},f.backSpace=function(){var d=this.rows[this.currRow];d.backSpace()},f.clearToEndOfRow=function(){var d=this.rows[this.currRow];d.clearToEndOfRow()},f.insertChar=function(d){var v=this.rows[this.currRow];v.insertChar(d)},f.setPen=function(d){var v=this.rows[this.currRow];v.setPenStyles(d)},f.moveCursor=function(d){var v=this.rows[this.currRow];v.moveCursor(d)},f.setCursor=function(d){this.logger.log(S.INFO,"setCursor: "+d);var v=this.rows[this.currRow];v.setCursor(d)},f.setPAC=function(d){this.logger.log(S.INFO,"pacData = "+JSON.stringify(d));var v=d.row-1;if(this.nrRollUpRows&&v<this.nrRollUpRows-1&&(v=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==v){for(var L=0;L<C;L++)this.rows[L].clear();var D=this.currRow+1-this.nrRollUpRows,I=this.lastOutputScreen;if(I){var k=I.rows[D].cueStartTime,w=this.logger.time;if(k&&w!==null&&k<w)for(var _=0;_<this.nrRollUpRows;_++)this.rows[v-this.nrRollUpRows+_+1].copy(I.rows[D+_])}}this.currRow=v;var F=this.rows[this.currRow];if(d.indent!==null){var U=d.indent,W=Math.max(U-1,0);F.setCursor(d.indent),d.color=F.chars[W].penState.foreground}var V={foreground:d.color,underline:d.underline,italics:d.italics,background:"black",flash:!1};this.setPen(V)},f.setBkgData=function(d){this.logger.log(S.INFO,"bkgData = "+JSON.stringify(d)),this.backSpace(),this.setPen(d),this.insertChar(32)},f.setRollUpRows=function(d){this.nrRollUpRows=d},f.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(S.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(S.TEXT,this.getDisplayText());var d=this.currRow+1-this.nrRollUpRows,v=this.rows.splice(d,1)[0];v.clear(),this.rows.splice(this.currRow,0,v),this.logger.log(S.INFO,"Rolling up")},f.getDisplayText=function(d){d=d||!1;for(var v=[],L="",D=-1,I=0;I<C;I++){var k=this.rows[I].getTextString();k&&(D=I+1,d?v.push("Row "+D+": '"+k+"'"):v.push(k.trim()))}return v.length>0&&(d?L="["+v.join(" | ")+"]":L=v.join(`
`)),L},f.getTextAndFormat=function(){return this.rows},x}(),l=function(){function x(u,d,v){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=u,this.outputFilter=d,this.mode=null,this.verbose=0,this.displayedMemory=new t(v),this.nonDisplayedMemory=new t(v),this.lastOutputScreen=new t(v),this.currRollUpRow=this.displayedMemory.rows[C-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=v}var f=x.prototype;return f.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[C-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},f.getHandler=function(){return this.outputFilter},f.setHandler=function(d){this.outputFilter=d},f.setPAC=function(d){this.writeScreen.setPAC(d)},f.setBkgData=function(d){this.writeScreen.setBkgData(d)},f.setMode=function(d){d!==this.mode&&(this.mode=d,this.logger.log(S.INFO,"MODE="+d),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=d)},f.insertChars=function(d){for(var v=0;v<d.length;v++)this.writeScreen.insertChar(d[v]);var L=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(S.INFO,L+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(S.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},f.ccRCL=function(){this.logger.log(S.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},f.ccBS=function(){this.logger.log(S.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},f.ccAOF=function(){},f.ccAON=function(){},f.ccDER=function(){this.logger.log(S.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},f.ccRU=function(d){this.logger.log(S.INFO,"RU("+d+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(d)},f.ccFON=function(){this.logger.log(S.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},f.ccRDC=function(){this.logger.log(S.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},f.ccTR=function(){this.logger.log(S.INFO,"TR"),this.setMode("MODE_TEXT")},f.ccRTD=function(){this.logger.log(S.INFO,"RTD"),this.setMode("MODE_TEXT")},f.ccEDM=function(){this.logger.log(S.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},f.ccCR=function(){this.logger.log(S.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},f.ccENM=function(){this.logger.log(S.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},f.ccEOC=function(){if(this.logger.log(S.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var d=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=d,this.writeScreen=this.nonDisplayedMemory,this.logger.log(S.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},f.ccTO=function(d){this.logger.log(S.INFO,"TO("+d+") - Tab Offset"),this.writeScreen.moveCursor(d)},f.ccMIDROW=function(d){var v={flash:!1};if(v.underline=d%2===1,v.italics=d>=46,v.italics)v.foreground="white";else{var L=Math.floor(d/2)-16,D=["white","green","blue","cyan","red","yellow","magenta"];v.foreground=D[L]}this.logger.log(S.INFO,"MIDROW: "+JSON.stringify(v)),this.writeScreen.setPen(v)},f.outputDataUpdate=function(d){d===void 0&&(d=!1);var v=this.logger.time;v!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=v:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,v,this.lastOutputScreen),d&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:v),this.lastOutputScreen.copy(this.displayedMemory))},f.cueSplitAtTime=function(d){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,d,this.displayedMemory),this.cueStartTime=d))},x}(),s=function(){function x(u,d,v){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var L=new b;this.channels=[null,new l(u,d,L),new l(u+1,v,L)],this.cmdHistory=E(),this.logger=L}var f=x.prototype;return f.getHandler=function(d){return this.channels[d].getHandler()},f.setHandler=function(d,v){this.channels[d].setHandler(v)},f.addData=function(d,v){var L,D,I,k=!1;this.logger.time=d;for(var w=0;w<v.length;w+=2)if(D=v[w]&127,I=v[w+1]&127,!(D===0&&I===0)){if(this.logger.log(S.DATA,"["+p([v[w],v[w+1]])+"] -> ("+p([D,I])+")"),L=this.parseCmd(D,I),L||(L=this.parseMidrow(D,I)),L||(L=this.parsePAC(D,I)),L||(L=this.parseBackgroundAttributes(D,I)),!L&&(k=this.parseChars(D,I),k)){var _=this.currentChannel;if(_&&_>0){var F=this.channels[_];F.insertChars(k)}else this.logger.log(S.WARNING,"No channel found yet. TEXT-MODE?")}!L&&!k&&this.logger.log(S.WARNING,"Couldn't parse cleaned data "+p([D,I])+" orig: "+p([v[w],v[w+1]]))}},f.parseCmd=function(d,v){var L=this.cmdHistory,D=(d===20||d===28||d===21||d===29)&&v>=32&&v<=47,I=(d===23||d===31)&&v>=33&&v<=35;if(!(D||I))return!1;if(o(d,v,L))return a(null,null,L),this.logger.log(S.DEBUG,"Repeated command ("+p([d,v])+") is dropped"),!0;var k=d===20||d===21||d===23?1:2,w=this.channels[k];return d===20||d===21||d===28||d===29?v===32?w.ccRCL():v===33?w.ccBS():v===34?w.ccAOF():v===35?w.ccAON():v===36?w.ccDER():v===37?w.ccRU(2):v===38?w.ccRU(3):v===39?w.ccRU(4):v===40?w.ccFON():v===41?w.ccRDC():v===42?w.ccTR():v===43?w.ccRTD():v===44?w.ccEDM():v===45?w.ccCR():v===46?w.ccENM():v===47&&w.ccEOC():w.ccTO(v-32),a(d,v,L),this.currentChannel=k,!0},f.parseMidrow=function(d,v){var L=0;if((d===17||d===25)&&v>=32&&v<=47){if(d===17?L=1:L=2,L!==this.currentChannel)return this.logger.log(S.ERROR,"Mismatch channel in midrow parsing"),!1;var D=this.channels[L];return D?(D.ccMIDROW(v),this.logger.log(S.DEBUG,"MIDROW ("+p([d,v])+")"),!0):!1}return!1},f.parsePAC=function(d,v){var L,D=this.cmdHistory,I=(d>=17&&d<=23||d>=25&&d<=31)&&v>=64&&v<=127,k=(d===16||d===24)&&v>=64&&v<=95;if(!(I||k))return!1;if(o(d,v,D))return a(null,null,D),!0;var w=d<=23?1:2;v>=64&&v<=95?L=w===1?A[d]:c[d]:L=w===1?g[d]:m[d];var _=this.channels[w];return _?(_.setPAC(this.interpretPAC(L,v)),a(d,v,D),this.currentChannel=w,!0):!1},f.interpretPAC=function(d,v){var L,D={color:null,italics:!1,indent:null,underline:!1,row:d};return v>95?L=v-96:L=v-64,D.underline=(L&1)===1,L<=13?D.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(L/2)]:L<=15?(D.italics=!0,D.color="white"):D.indent=Math.floor((L-16)/2)*4,D},f.parseChars=function(d,v){var L,D=null,I=null;if(d>=25?(L=2,I=d-8):(L=1,I=d),I>=17&&I<=19){var k;I===17?k=v+80:I===18?k=v+112:k=v+144,this.logger.log(S.INFO,"Special char '"+i(k)+"' in channel "+L),D=[k]}else d>=32&&d<=127&&(D=v===0?[d]:[d,v]);if(D){var w=p(D);this.logger.log(S.DEBUG,"Char codes =  "+w.join(",")),a(d,v,this.cmdHistory)}return D},f.parseBackgroundAttributes=function(d,v){var L=(d===16||d===24)&&v>=32&&v<=47,D=(d===23||d===31)&&v>=45&&v<=47;if(!(L||D))return!1;var I,k={};d===16||d===24?(I=Math.floor((v-32)/2),k.background=y[I],v%2===1&&(k.background=k.background+"_semi")):v===45?k.background="transparent":(k.foreground="black",v===47&&(k.underline=!0));var w=d<=23?1:2,_=this.channels[w];return _.setBkgData(k),a(d,v,this.cmdHistory),!0},f.reset=function(){for(var d=0;d<Object.keys(this.channels).length;d++){var v=this.channels[d];v&&v.reset()}this.cmdHistory=E()},f.cueSplitAtTime=function(d){for(var v=0;v<this.channels.length;v++){var L=this.channels[v];L&&L.cueSplitAtTime(d)}},x}();function a(x,f,u){u.a=x,u.b=f}function o(x,f,u){return u.a===x&&u.b===f}function E(){return{a:null,b:null}}P.default=s},"./src/utils/codecs.ts":function(N,P,h){h.r(P),h.d(P,"isCodecType",function(){return T}),h.d(P,"isCodecSupportedInMp4",function(){return i});var O={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function T(C,R){var A=O[R];return!!A&&A[C.slice(0,4)]===!0}function i(C,R){return MediaSource.isTypeSupported((R||"video")+'/mp4;codecs="'+C+'"')}},"./src/utils/cues.ts":function(N,P,h){h.r(P);var O=h("./src/utils/vttparser.ts"),T=h("./src/utils/webvtt-parser.ts"),i=h("./src/utils/texttrack-utils.ts"),C=/\s/,R={newCue:function(g,c,m,y){for(var S=[],b,p,n,e,r,t=self.VTTCue||self.TextTrackCue,l=0;l<y.rows.length;l++)if(b=y.rows[l],n=!0,e=0,r="",!b.isEmpty()){for(var s=0;s<b.chars.length;s++)C.test(b.chars[s].uchar)&&n?e++:(r+=b.chars[s].uchar,n=!1);b.cueStartTime=c,c===m&&(m+=1e-4),e>=16?e--:e++;var a=Object(O.fixLineBreaks)(r.trim()),o=Object(T.generateCueId)(c,m,a);(!g||!g.cues||!g.cues.getCueById(o))&&(p=new t(c,m,a),p.id=o,p.line=l+1,p.align="left",p.position=10+Math.min(80,Math.floor(e*8/32)*10),S.push(p))}return g&&S.length&&(S.sort(function(E,x){return E.line==="auto"||x.line==="auto"?0:E.line>8&&x.line>8?x.line-E.line:E.line-x.line}),S.forEach(function(E){return Object(i.addCueToTrack)(g,E)})),S}};P.default=R},"./src/utils/discontinuities.ts":function(N,P,h){h.r(P),h.d(P,"findFirstFragWithCC",function(){return C}),h.d(P,"shouldAlignOnDiscontinuities",function(){return R}),h.d(P,"findDiscontinuousReferenceFrag",function(){return A}),h.d(P,"adjustSlidingStart",function(){return c}),h.d(P,"alignStream",function(){return m}),h.d(P,"alignPDT",function(){return S}),h.d(P,"alignFragmentByPDTDelta",function(){return b}),h.d(P,"alignMediaPlaylistByPDT",function(){return p});var O=h("./src/polyfills/number.ts"),T=h("./src/utils/logger.ts"),i=h("./src/controller/level-helper.ts");function C(n,e){for(var r=null,t=0,l=n.length;t<l;t++){var s=n[t];if(s&&s.cc===e){r=s;break}}return r}function R(n,e,r){return!!(e.details&&(r.endCC>r.startCC||n&&n.cc<r.startCC))}function A(n,e){var r=n.fragments,t=e.fragments;if(!t.length||!r.length){T.logger.log("No fragments to align");return}var l=C(r,t[0].cc);if(!l||l&&!l.startPTS){T.logger.log("No frag in previous level to align on");return}return l}function g(n,e){if(n){var r=n.start+e;n.start=n.startPTS=r,n.endPTS=r+n.duration}}function c(n,e){for(var r=e.fragments,t=0,l=r.length;t<l;t++)g(r[t],n);e.fragmentHint&&g(e.fragmentHint,n),e.alignedSliding=!0}function m(n,e,r){!e||(y(n,r,e),!r.alignedSliding&&e.details&&S(r,e.details),!r.alignedSliding&&e.details&&!r.skippedSegments&&Object(i.adjustSliding)(e.details,r))}function y(n,e,r){if(R(n,r,e)){var t=A(r.details,e);t&&Object(O.isFiniteNumber)(t.start)&&(T.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),c(t.start,e))}}function S(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var r=e.fragments[0].programDateTime,t=n.fragments[0].programDateTime,l=(t-r)/1e3+e.fragments[0].start;l&&Object(O.isFiniteNumber)(l)&&(T.logger.log("Adjusting PTS using programDateTime delta "+(t-r)+"ms, sliding:"+l.toFixed(3)+" "+n.url+" "),c(l,n))}}function b(n,e){var r=n.programDateTime;if(!!r){var t=(r-e)/1e3;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function p(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var r=e.fragments[0].programDateTime,t=e.fragments[0].start,l=r-t*1e3;n.fragments.forEach(function(s){b(s,l)}),n.fragmentHint&&b(n.fragmentHint,l),n.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(N,P,h){h.r(P);var O=h("./src/utils/ewma.ts"),T=function(){function i(R,A,g){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=g,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new O.default(R),this.fast_=new O.default(A)}var C=i.prototype;return C.update=function(A,g){var c=this.slow_,m=this.fast_;this.slow_.halfLife!==A&&(this.slow_=new O.default(A,c.getEstimate(),c.getTotalWeight())),this.fast_.halfLife!==g&&(this.fast_=new O.default(g,m.getEstimate(),m.getTotalWeight()))},C.sample=function(A,g){A=Math.max(A,this.minDelayMs_);var c=8*g,m=A/1e3,y=c/m;this.fast_.sample(m,y),this.slow_.sample(m,y)},C.canEstimate=function(){var A=this.fast_;return A&&A.getTotalWeight()>=this.minWeight_},C.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},C.destroy=function(){},i}();P.default=T},"./src/utils/ewma.ts":function(N,P,h){h.r(P);var O=function(){function T(C,R,A){R===void 0&&(R=0),A===void 0&&(A=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=C,this.alpha_=C?Math.exp(Math.log(.5)/C):0,this.estimate_=R,this.totalWeight_=A}var i=T.prototype;return i.sample=function(R,A){var g=Math.pow(this.alpha_,R);this.estimate_=A*(1-g)+g*this.estimate_,this.totalWeight_+=R},i.getTotalWeight=function(){return this.totalWeight_},i.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},T}();P.default=O},"./src/utils/fetch-loader.ts":function(N,P,h){h.r(P),h.d(P,"fetchSupported",function(){return b});var O=h("./src/polyfills/number.ts"),T=h("./src/loader/load-stats.ts"),i=h("./src/demux/chunk-cache.ts");function C(t,l){t.prototype=Object.create(l.prototype),t.prototype.constructor=t,m(t,l)}function R(t){var l=typeof Map=="function"?new Map:void 0;return R=function(a){if(a===null||!c(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof l!="undefined"){if(l.has(a))return l.get(a);l.set(a,o)}function o(){return A(a,arguments,y(this).constructor)}return o.prototype=Object.create(a.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),m(o,a)},R(t)}function A(t,l,s){return g()?A=Reflect.construct:A=function(o,E,x){var f=[null];f.push.apply(f,E);var u=Function.bind.apply(o,f),d=new u;return x&&m(d,x.prototype),d},A.apply(null,arguments)}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function c(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function m(t,l){return m=Object.setPrototypeOf||function(a,o){return a.__proto__=o,a},m(t,l)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},y(t)}function S(){return S=Object.assign||function(t){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])}return t},S.apply(this,arguments)}function b(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var p=function(){function t(s){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=s.fetchSetup||e,this.controller=new self.AbortController,this.stats=new T.LoadStats}var l=t.prototype;return l.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},l.abortInternal=function(){var a=this.response;(!a||!a.ok)&&(this.stats.aborted=!0,this.controller.abort())},l.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},l.load=function(a,o,E){var x=this,f=this.stats;if(f.loading.start)throw new Error("Loader can only be used once.");f.loading.start=self.performance.now();var u=n(a,this.controller.signal),d=E.onProgress,v=a.responseType==="arraybuffer",L=v?"byteLength":"length";this.context=a,this.config=o,this.callbacks=E,this.request=this.fetchSetup(a,u),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){x.abortInternal(),E.onTimeout(f,a,x.response)},o.timeout),self.fetch(this.request).then(function(D){if(x.response=x.loader=D,!D.ok){var I=D.status,k=D.statusText;throw new r(k||"fetch, bad network response",I,D)}return f.loading.first=Math.max(self.performance.now(),f.loading.start),f.total=parseInt(D.headers.get("Content-Length")||"0"),d&&Object(O.isFiniteNumber)(o.highWaterMark)?x.loadProgressively(D,f,a,o.highWaterMark,d):v?D.arrayBuffer():D.text()}).then(function(D){var I=x.response;self.clearTimeout(x.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first),f.loaded=f.total=D[L];var k={url:I.url,data:D};d&&!Object(O.isFiniteNumber)(o.highWaterMark)&&d(f,a,D,I),E.onSuccess(k,f,a,I)}).catch(function(D){if(self.clearTimeout(x.requestTimeout),!f.aborted){var I=D.code||0;E.onError({code:I,text:D.message},a,D.details)}})},l.getCacheAge=function(){var a=null;if(this.response){var o=this.response.headers.get("age");a=o?parseFloat(o):null}return a},l.loadProgressively=function(a,o,E,x,f){x===void 0&&(x=0);var u=new i.default,d=a.body.getReader(),v=function L(){return d.read().then(function(D){if(D.done)return u.dataLength&&f(o,E,u.flush(),a),Promise.resolve(new ArrayBuffer(0));var I=D.value,k=I.length;return o.loaded+=k,k<x||u.dataLength?(u.push(I),u.dataLength>=x&&f(o,E,u.flush(),a)):f(o,E,I,a),L()}).catch(function(){return Promise.reject()})};return v()},t}();function n(t,l){var s={method:"GET",mode:"cors",credentials:"same-origin",signal:l,headers:new self.Headers(S({},t.headers))};return t.rangeEnd&&s.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),s}function e(t,l){return new self.Request(t.url,l)}var r=function(t){C(l,t);function l(s,a,o){var E;return E=t.call(this,s)||this,E.code=void 0,E.details=void 0,E.code=a,E.details=o,E}return l}(R(Error));P.default=p},"./src/utils/imsc1-ttml-parser.ts":function(N,P,h){h.r(P),h.d(P,"IMSC1_CODEC",function(){return c}),h.d(P,"parseIMSC1",function(){return b});var O=h("./src/utils/mp4-tools.ts"),T=h("./src/utils/vttparser.ts"),i=h("./src/utils/vttcue.ts"),C=h("./src/demux/id3.ts"),R=h("./src/utils/timescale-conversion.ts"),A=h("./src/utils/webvtt-parser.ts");function g(){return g=Object.assign||function(x){for(var f=1;f<arguments.length;f++){var u=arguments[f];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(x[d]=u[d])}return x},g.apply(this,arguments)}var c="stpp.ttml.im1t",m=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,y=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,S={left:"start",center:"center",right:"end",start:"start",end:"end"};function b(x,f,u,d,v){var L=Object(O.findBox)(new Uint8Array(x),["mdat"]);if(L.length===0){v(new Error("Could not parse IMSC1 mdat"));return}var D=L[0],I=Object(C.utf8ArrayToStr)(new Uint8Array(x,D.start,D.end-D.start)),k=Object(R.toTimescaleFromScale)(f,1,u);try{d(p(I,k))}catch(w){v(w)}}function p(x,f){var u=new DOMParser,d=u.parseFromString(x,"text/xml"),v=d.getElementsByTagName("tt")[0];if(!v)throw new Error("Invalid ttml");var L={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},D=Object.keys(L).reduce(function(F,U){return F[U]=v.getAttribute("ttp:"+U)||L[U],F},{}),I=v.getAttribute("xml:space")!=="preserve",k=e(n(v,"styling","style")),w=e(n(v,"layout","region")),_=n(v,"body","[begin]");return[].map.call(_,function(F){var U=r(F,I);if(!U||!F.hasAttribute("begin"))return null;var W=a(F.getAttribute("begin"),D),V=a(F.getAttribute("dur"),D),X=a(F.getAttribute("end"),D);if(W===null)throw s(F);if(X===null){if(V===null)throw s(F);X=W+V}var Y=new i.default(W-f,X-f,U);Y.id=Object(A.generateCueId)(Y.startTime,Y.endTime,Y.text);var J=w[F.getAttribute("region")],q=k[F.getAttribute("style")];Y.position=10,Y.size=80;var $=t(J,q),ne=$.textAlign;if(ne){var ee=S[ne];ee&&(Y.lineAlign=ee),Y.align=ne}return g(Y,$),Y}).filter(function(F){return F!==null})}function n(x,f,u){var d=x.getElementsByTagName(f)[0];return d?[].slice.call(d.querySelectorAll(u)):[]}function e(x){return x.reduce(function(f,u){var d=u.getAttribute("xml:id");return d&&(f[d]=u),f},{})}function r(x,f){return[].slice.call(x.childNodes).reduce(function(u,d,v){var L;return d.nodeName==="br"&&v?u+`
`:(L=d.childNodes)!==null&&L!==void 0&&L.length?r(d,f):f?u+d.textContent.trim().replace(/\s+/g," "):u+d.textContent},"")}function t(x,f){var u="http://www.w3.org/ns/ttml#styling",d=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return d.reduce(function(v,L){var D=l(f,u,L)||l(x,u,L);return D&&(v[L]=D),v},{})}function l(x,f,u){return x.hasAttributeNS(f,u)?x.getAttributeNS(f,u):null}function s(x){return new Error("Could not parse ttml timestamp "+x)}function a(x,f){if(!x)return null;var u=Object(T.parseTimeStamp)(x);return u===null&&(m.test(x)?u=o(x,f):y.test(x)&&(u=E(x,f))),u}function o(x,f){var u=m.exec(x),d=(u[4]|0)+(u[5]|0)/f.subFrameRate;return(u[1]|0)*3600+(u[2]|0)*60+(u[3]|0)+d/f.frameRate}function E(x,f){var u=y.exec(x),d=Number(u[1]),v=u[2];switch(v){case"h":return d*3600;case"m":return d*60;case"ms":return d*1e3;case"f":return d/f.frameRate;case"t":return d/f.tickRate}return d}},"./src/utils/logger.ts":function(N,P,h){h.r(P),h.d(P,"enableLogs",function(){return A}),h.d(P,"logger",function(){return g});var O=function(){},T={trace:O,debug:O,log:O,warn:O,info:O,error:O},i=T;function C(c){var m=self.console[c];return m?m.bind(self.console,"["+c+"] >"):O}function R(c){for(var m=arguments.length,y=new Array(m>1?m-1:0),S=1;S<m;S++)y[S-1]=arguments[S];y.forEach(function(b){i[b]=c[b]?c[b].bind(c):C(b)})}function A(c){if(self.console&&c===!0||typeof c=="object"){R(c,"debug","log","info","warn","error");try{i.log()}catch{i=T}}else i=T}var g=i},"./src/utils/mediakeys-helper.ts":function(N,P,h){h.r(P),h.d(P,"KeySystems",function(){return O}),h.d(P,"requestMediaKeySystemAccess",function(){return T});var O;(function(i){i.WIDEVINE="com.widevine.alpha",i.PLAYREADY="com.microsoft.playready"})(O||(O={}));var T=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(N,P,h){h.r(P),h.d(P,"getMediaSource",function(){return O});function O(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(N,P,h){h.r(P),h.d(P,"bin2str",function(){return R}),h.d(P,"readUint16",function(){return A}),h.d(P,"readUint32",function(){return g}),h.d(P,"writeUint32",function(){return c}),h.d(P,"findBox",function(){return m}),h.d(P,"parseSegmentIndex",function(){return y}),h.d(P,"parseInitSegment",function(){return S}),h.d(P,"getStartDTS",function(){return b}),h.d(P,"getDuration",function(){return p}),h.d(P,"computeRawDurationFromSamples",function(){return n}),h.d(P,"offsetStartDTS",function(){return e}),h.d(P,"segmentValidRange",function(){return r}),h.d(P,"appendUint8Array",function(){return t});var O=h("./src/utils/typed-array.ts"),T=h("./src/loader/fragment.ts"),i=Math.pow(2,32)-1,C=[].push;function R(l){return String.fromCharCode.apply(null,l)}function A(l,s){"data"in l&&(s+=l.start,l=l.data);var a=l[s]<<8|l[s+1];return a<0?65536+a:a}function g(l,s){"data"in l&&(s+=l.start,l=l.data);var a=l[s]<<24|l[s+1]<<16|l[s+2]<<8|l[s+3];return a<0?4294967296+a:a}function c(l,s,a){"data"in l&&(s+=l.start,l=l.data),l[s]=a>>24,l[s+1]=a>>16&255,l[s+2]=a>>8&255,l[s+3]=a&255}function m(l,s){var a=[];if(!s.length)return a;var o,E,x;"data"in l?(o=l.data,E=l.start,x=l.end):(o=l,E=0,x=o.byteLength);for(var f=E;f<x;){var u=g(o,f),d=R(o.subarray(f+4,f+8)),v=u>1?f+u:x;if(d===s[0])if(s.length===1)a.push({data:o,start:f+8,end:v});else{var L=m({data:o,start:f+8,end:v},s.slice(1));L.length&&C.apply(a,L)}f=v}return a}function y(l){var s=m(l,["moov"]),a=s[0],o=a?a.end:null,E=m(l,["sidx"]);if(!E||!E[0])return null;var x=[],f=E[0],u=f.data[0],d=u===0?8:16,v=g(f,d);d+=4;var L=0,D=0;u===0?d+=8:d+=16,d+=2;var I=f.end+D,k=A(f,d);d+=2;for(var w=0;w<k;w++){var _=d,F=g(f,_);_+=4;var U=F&2147483647,W=(F&2147483648)>>>31;if(W===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var V=g(f,_);_+=4,x.push({referenceSize:U,subsegmentDuration:V,info:{duration:V/v,start:I,end:I+U-1}}),I+=U,_+=4,d=_}return{earliestPresentationTime:L,timescale:v,version:u,referencesCount:k,references:x,moovEndOffset:o}}function S(l){for(var s=[],a=m(l,["moov","trak"]),o=0;o<a.length;o++){var E=a[o],x=m(E,["tkhd"])[0];if(x){var f=x.data[x.start],u=f===0?12:20,d=g(x,u),v=m(E,["mdia","mdhd"])[0];if(v){f=v.data[v.start],u=f===0?12:20;var L=g(v,u),D=m(E,["mdia","hdlr"])[0];if(D){var I=R(D.data.subarray(D.start+8,D.start+12)),k={soun:T.ElementaryStreamTypes.AUDIO,vide:T.ElementaryStreamTypes.VIDEO}[I];if(k){var w=m(E,["mdia","minf","stbl","stsd"])[0],_=void 0;w&&(_=R(w.data.subarray(w.start+12,w.start+16))),s[d]={timescale:L,type:k},s[k]={timescale:L,id:d,codec:_}}}}}}var F=m(l,["moov","mvex","trex"]);return F.forEach(function(U){var W=g(U,4),V=s[W];V&&(V.default={duration:g(U,12),flags:g(U,20)})}),s}function b(l,s){return m(s,["moof","traf"]).reduce(function(a,o){var E=m(o,["tfdt"])[0],x=E.data[E.start],f=m(o,["tfhd"]).reduce(function(u,d){var v=g(d,4),L=l[v];if(L){var D=g(E,4);x===1&&(D*=Math.pow(2,32),D+=g(E,8));var I=L.timescale||9e4,k=D/I;if(isFinite(k)&&(u===null||k<u))return k}return u},null);return f!==null&&isFinite(f)&&(a===null||f<a)?f:a},null)||0}function p(l,s){for(var a=0,o=0,E=0,x=m(l,["moof","traf"]),f=0;f<x.length;f++){var u=x[f],d=m(u,["tfhd"])[0],v=g(d,4),L=s[v];if(!!L){var D=L.default,I=g(d,0)|(D==null?void 0:D.flags),k=D==null?void 0:D.duration;I&8&&(I&2?k=g(d,12):k=g(d,8));for(var w=L.timescale||9e4,_=m(u,["trun"]),F=0;F<_.length;F++){if(a=n(_[F]),!a&&k){var U=g(_[F],4);a=k*U}L.type===T.ElementaryStreamTypes.VIDEO?o+=a/w:L.type===T.ElementaryStreamTypes.AUDIO&&(E+=a/w)}}}if(o===0&&E===0){var W=y(l);if(W!=null&&W.references)return W.references.reduce(function(V,X){return V+X.info.duration||0},0)}return o||E}function n(l){var s=g(l,0),a=8;s&1&&(a+=4),s&4&&(a+=4);for(var o=0,E=g(l,4),x=0;x<E;x++){if(s&256){var f=g(l,a);o+=f,a+=4}s&512&&(a+=4),s&1024&&(a+=4),s&2048&&(a+=4)}return o}function e(l,s,a){m(s,["moof","traf"]).forEach(function(o){m(o,["tfhd"]).forEach(function(E){var x=g(E,4),f=l[x];if(!!f){var u=f.timescale||9e4;m(o,["tfdt"]).forEach(function(d){var v=d.data[d.start],L=g(d,4);if(v===0)c(d,4,L-a*u);else{L*=Math.pow(2,32),L+=g(d,8),L-=a*u,L=Math.max(L,0);var D=Math.floor(L/(i+1)),I=Math.floor(L%(i+1));c(d,4,D),c(d,8,I)}})}})})}function r(l){var s={valid:null,remainder:null},a=m(l,["moof"]);if(a){if(a.length<2)return s.remainder=l,s}else return s;var o=a[a.length-1];return s.valid=Object(O.sliceUint8)(l,0,o.start-8),s.remainder=Object(O.sliceUint8)(l,o.start-8),s}function t(l,s){var a=new Uint8Array(l.length+s.length);return a.set(l),a.set(s,l.length),a}},"./src/utils/output-filter.ts":function(N,P,h){h.r(P),h.d(P,"default",function(){return O});var O=function(){function T(C,R){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=C,this.trackName=R}var i=T.prototype;return i.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},i.newCue=function(R,A,g){(this.startTime===null||this.startTime>R)&&(this.startTime=R),this.endTime=A,this.screen=g,this.timelineController.createCaptionsTrack(this.trackName)},i.reset=function(){this.cueRanges=[],this.startTime=null},T}()},"./src/utils/texttrack-utils.ts":function(N,P,h){h.r(P),h.d(P,"sendAddTrackEvent",function(){return T}),h.d(P,"addCueToTrack",function(){return i}),h.d(P,"clearCurrentCues",function(){return C}),h.d(P,"removeCuesInRange",function(){return R}),h.d(P,"getCuesInRange",function(){return g});var O=h("./src/utils/logger.ts");function T(c,m){var y;try{y=new Event("addtrack")}catch{y=document.createEvent("Event"),y.initEvent("addtrack",!1,!1)}y.track=c,m.dispatchEvent(y)}function i(c,m){var y=c.mode;if(y==="disabled"&&(c.mode="hidden"),c.cues&&!c.cues.getCueById(m.id))try{if(c.addCue(m),!c.cues.getCueById(m.id))throw new Error("addCue is failed for: "+m)}catch(b){O.logger.debug("[texttrack-utils]: "+b);var S=new self.TextTrackCue(m.startTime,m.endTime,m.text);S.id=m.id,c.addCue(S)}y==="disabled"&&(c.mode=y)}function C(c){var m=c.mode;if(m==="disabled"&&(c.mode="hidden"),c.cues)for(var y=c.cues.length;y--;)c.removeCue(c.cues[y]);m==="disabled"&&(c.mode=m)}function R(c,m,y){var S=c.mode;if(S==="disabled"&&(c.mode="hidden"),c.cues&&c.cues.length>0)for(var b=g(c.cues,m,y),p=0;p<b.length;p++)c.removeCue(b[p]);S==="disabled"&&(c.mode=S)}function A(c,m){if(m<c[0].startTime)return 0;var y=c.length-1;if(m>c[y].endTime)return-1;for(var S=0,b=y;S<=b;){var p=Math.floor((b+S)/2);if(m<c[p].startTime)b=p-1;else if(m>c[p].startTime&&S<y)S=p+1;else return p}return c[S].startTime-m<m-c[b].startTime?S:b}function g(c,m,y){var S=[],b=A(c,m);if(b>-1)for(var p=b,n=c.length;p<n;p++){var e=c[p];if(e.startTime>=m&&e.endTime<=y)S.push(e);else if(e.startTime>y)return S}return S}},"./src/utils/time-ranges.ts":function(N,P,h){h.r(P);var O={toString:function(i){for(var C="",R=i.length,A=0;A<R;A++)C+="["+i.start(A).toFixed(3)+","+i.end(A).toFixed(3)+"]";return C}};P.default=O},"./src/utils/timescale-conversion.ts":function(N,P,h){h.r(P),h.d(P,"toTimescaleFromBase",function(){return T}),h.d(P,"toTimescaleFromScale",function(){return i}),h.d(P,"toMsFromMpegTsClock",function(){return C}),h.d(P,"toMpegTsClockFromTimescale",function(){return R});var O=9e4;function T(A,g,c,m){c===void 0&&(c=1),m===void 0&&(m=!1);var y=A*g*c;return m?Math.round(y):y}function i(A,g,c,m){return c===void 0&&(c=1),m===void 0&&(m=!1),T(A,g,1/c,m)}function C(A,g){return g===void 0&&(g=!1),T(A,1e3,1/O,g)}function R(A,g){return g===void 0&&(g=1),T(A,O,1/g)}},"./src/utils/typed-array.ts":function(N,P,h){h.r(P),h.d(P,"sliceUint8",function(){return O});function O(T,i,C){return Uint8Array.prototype.slice?T.slice(i,C):new Uint8Array(Array.prototype.slice.call(T,i,C))}},"./src/utils/vttcue.ts":function(N,P,h){h.r(P),P.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var O=["","lr","rl"],T=["start","middle","end","left","right"];function i(c,m){if(typeof m!="string"||!Array.isArray(c))return!1;var y=m.toLowerCase();return~c.indexOf(y)?y:!1}function C(c){return i(O,c)}function R(c){return i(T,c)}function A(c){for(var m=arguments.length,y=new Array(m>1?m-1:0),S=1;S<m;S++)y[S-1]=arguments[S];for(var b=1;b<arguments.length;b++){var p=arguments[b];for(var n in p)c[n]=p[n]}return c}function g(c,m,y){var S=this,b={enumerable:!0};S.hasBeenReset=!1;var p="",n=!1,e=c,r=m,t=y,l=null,s="",a=!0,o="auto",E="start",x=50,f="middle",u=50,d="middle";Object.defineProperty(S,"id",A({},b,{get:function(){return p},set:function(L){p=""+L}})),Object.defineProperty(S,"pauseOnExit",A({},b,{get:function(){return n},set:function(L){n=!!L}})),Object.defineProperty(S,"startTime",A({},b,{get:function(){return e},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");e=L,this.hasBeenReset=!0}})),Object.defineProperty(S,"endTime",A({},b,{get:function(){return r},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");r=L,this.hasBeenReset=!0}})),Object.defineProperty(S,"text",A({},b,{get:function(){return t},set:function(L){t=""+L,this.hasBeenReset=!0}})),Object.defineProperty(S,"region",A({},b,{get:function(){return l},set:function(L){l=L,this.hasBeenReset=!0}})),Object.defineProperty(S,"vertical",A({},b,{get:function(){return s},set:function(L){var D=C(L);if(D===!1)throw new SyntaxError("An invalid or illegal string was specified.");s=D,this.hasBeenReset=!0}})),Object.defineProperty(S,"snapToLines",A({},b,{get:function(){return a},set:function(L){a=!!L,this.hasBeenReset=!0}})),Object.defineProperty(S,"line",A({},b,{get:function(){return o},set:function(L){if(typeof L!="number"&&L!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");o=L,this.hasBeenReset=!0}})),Object.defineProperty(S,"lineAlign",A({},b,{get:function(){return E},set:function(L){var D=R(L);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");E=D,this.hasBeenReset=!0}})),Object.defineProperty(S,"position",A({},b,{get:function(){return x},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");x=L,this.hasBeenReset=!0}})),Object.defineProperty(S,"positionAlign",A({},b,{get:function(){return f},set:function(L){var D=R(L);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");f=D,this.hasBeenReset=!0}})),Object.defineProperty(S,"size",A({},b,{get:function(){return u},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");u=L,this.hasBeenReset=!0}})),Object.defineProperty(S,"align",A({},b,{get:function(){return d},set:function(L){var D=R(L);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");d=D,this.hasBeenReset=!0}})),S.displayState=void 0}return g.prototype.getCueAsHTML=function(){var c=self.WebVTT;return c.convertCueToDOMTree(self,this.text)},g}()},"./src/utils/vttparser.ts":function(N,P,h){h.r(P),h.d(P,"parseTimeStamp",function(){return i}),h.d(P,"fixLineBreaks",function(){return m}),h.d(P,"VTTParser",function(){return y});var O=h("./src/utils/vttcue.ts"),T=function(){function S(){}var b=S.prototype;return b.decode=function(n,e){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},S}();function i(S){function b(n,e,r,t){return(n|0)*3600+(e|0)*60+(r|0)+parseFloat(t||0)}var p=S.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return p?parseFloat(p[2])>59?b(p[2],p[3],0,p[4]):b(p[1],p[2],p[3],p[4]):null}var C=function(){function S(){this.values=Object.create(null)}var b=S.prototype;return b.set=function(n,e){!this.get(n)&&e!==""&&(this.values[n]=e)},b.get=function(n,e,r){return r?this.has(n)?this.values[n]:e[r]:this.has(n)?this.values[n]:e},b.has=function(n){return n in this.values},b.alt=function(n,e,r){for(var t=0;t<r.length;++t)if(e===r[t]){this.set(n,e);break}},b.integer=function(n,e){/^-?\d+$/.test(e)&&this.set(n,parseInt(e,10))},b.percent=function(n,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var r=parseFloat(e);if(r>=0&&r<=100)return this.set(n,r),!0}return!1},S}();function R(S,b,p,n){var e=n?S.split(n):[S];for(var r in e)if(typeof e[r]=="string"){var t=e[r].split(p);if(t.length===2){var l=t[0],s=t[1];b(l,s)}}}var A=new O.default(0,0,""),g=A.align==="middle"?"middle":"center";function c(S,b,p){var n=S;function e(){var l=i(S);if(l===null)throw new Error("Malformed timestamp: "+n);return S=S.replace(/^[^\sa-zA-Z-]+/,""),l}function r(l,s){var a=new C;R(l,function(x,f){var u;switch(x){case"region":for(var d=p.length-1;d>=0;d--)if(p[d].id===f){a.set(x,p[d].region);break}break;case"vertical":a.alt(x,f,["rl","lr"]);break;case"line":u=f.split(","),a.integer(x,u[0]),a.percent(x,u[0])&&a.set("snapToLines",!1),a.alt(x,u[0],["auto"]),u.length===2&&a.alt("lineAlign",u[1],["start",g,"end"]);break;case"position":u=f.split(","),a.percent(x,u[0]),u.length===2&&a.alt("positionAlign",u[1],["start",g,"end","line-left","line-right","auto"]);break;case"size":a.percent(x,f);break;case"align":a.alt(x,f,["start",g,"end","left","right"]);break}},/:/,/\s/),s.region=a.get("region",null),s.vertical=a.get("vertical","");var o=a.get("line","auto");o==="auto"&&A.line===-1&&(o=-1),s.line=o,s.lineAlign=a.get("lineAlign","start"),s.snapToLines=a.get("snapToLines",!0),s.size=a.get("size",100),s.align=a.get("align",g);var E=a.get("position","auto");E==="auto"&&A.position===50&&(E=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=E}function t(){S=S.replace(/^\s+/,"")}if(t(),b.startTime=e(),t(),S.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);S=S.substr(3),t(),b.endTime=e(),t(),r(S,b)}function m(S){return S.replace(/<br(?: \/)?>/gi,`
`)}var y=function(){function S(){this.state="INITIAL",this.buffer="",this.decoder=new T,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var b=S.prototype;return b.parse=function(n){var e=this;n&&(e.buffer+=e.decoder.decode(n,{stream:!0}));function r(){var E=e.buffer,x=0;for(E=m(E);x<E.length&&E[x]!=="\r"&&E[x]!==`
`;)++x;var f=E.substr(0,x);return E[x]==="\r"&&++x,E[x]===`
`&&++x,e.buffer=E.substr(x),f}function t(E){R(E,function(x,f){},/:/)}try{var l="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;l=r();var s=l.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var a=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(a?a=!1:l=r(),e.state){case"HEADER":/:/.test(l)?t(l):l||(e.state="ID");continue;case"NOTE":l||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){e.state="NOTE";break}if(!l)continue;if(e.cue=new O.default(0,0,""),e.state="CUE",l.indexOf("-->")===-1){e.cue.id=l;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{c(l,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var o=l.indexOf("-->")!==-1;if(!l||o&&(a=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=l}continue;case"BADCUE":l||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},b.flush=function(){var n=this;try{if((n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL"||n.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){n.onparsingerror&&n.onparsingerror(e)}return n.onflush&&n.onflush(),this},S}()},"./src/utils/webvtt-parser.ts":function(N,P,h){h.r(P),h.d(P,"generateCueId",function(){return y}),h.d(P,"parseWebVTT",function(){return b});var O=h("./src/polyfills/number.ts"),T=h("./src/utils/vttparser.ts"),i=h("./src/demux/id3.ts"),C=h("./src/utils/timescale-conversion.ts"),R=h("./src/remux/mp4-remuxer.ts"),A=/\r\n|\n\r|\n|\r/g,g=function(n,e,r){return r===void 0&&(r=0),n.substr(r,e.length)===e},c=function(n){var e=parseInt(n.substr(-3)),r=parseInt(n.substr(-6,2)),t=parseInt(n.substr(-9,2)),l=n.length>9?parseInt(n.substr(0,n.indexOf(":"))):0;if(!Object(O.isFiniteNumber)(e)||!Object(O.isFiniteNumber)(r)||!Object(O.isFiniteNumber)(t)||!Object(O.isFiniteNumber)(l))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return e+=1e3*r,e+=60*1e3*t,e+=60*60*1e3*l,e},m=function(n){for(var e=5381,r=n.length;r;)e=e*33^n.charCodeAt(--r);return(e>>>0).toString()};function y(p,n,e){return m(p.toString())+m(n.toString())+m(e)}var S=function(n,e,r){var t=n[e],l=n[t.prevCC];if(!l||!l.new&&t.new){n.ccOffset=n.presentationOffset=t.start,t.new=!1;return}for(;(s=l)!==null&&s!==void 0&&s.new;){var s;n.ccOffset+=t.start-l.start,t.new=!1,t=l,l=n[t.prevCC]}n.presentationOffset=r};function b(p,n,e,r,t,l,s,a){var o=new T.VTTParser,E=Object(i.utf8ArrayToStr)(new Uint8Array(p)).trim().replace(A,`
`).split(`
`),x=[],f=Object(C.toMpegTsClockFromTimescale)(n,e),u="00:00.000",d=0,v=0,L,D=!0,I=!1;o.oncue=function(k){var w=r[t],_=r.ccOffset,F=(d-f)/9e4;if(w!=null&&w.new&&(v!==void 0?_=r.ccOffset=w.start:S(r,t,F)),F&&(_=F-r.presentationOffset),I){var U=k.endTime-k.startTime,W=Object(R.normalizePts)((k.startTime+_-v)*9e4,l*9e4)/9e4;k.startTime=W,k.endTime=W+U}var V=k.text.trim();k.text=decodeURIComponent(encodeURIComponent(V)),k.id||(k.id=y(k.startTime,k.endTime,V)),k.endTime>0&&x.push(k)},o.onparsingerror=function(k){L=k},o.onflush=function(){if(L){a(L);return}s(x)},E.forEach(function(k){if(D)if(g(k,"X-TIMESTAMP-MAP=")){D=!1,I=!0,k.substr(16).split(",").forEach(function(w){g(w,"LOCAL:")?u=w.substr(6):g(w,"MPEGTS:")&&(d=parseInt(w.substr(7)))});try{v=c(u)/1e3}catch(w){I=!1,L=w}return}else k===""&&(D=!1);o.parse(k+`
`)}),o.flush()}},"./src/utils/xhr-loader.ts":function(N,P,h){h.r(P);var O=h("./src/utils/logger.ts"),T=h("./src/loader/load-stats.ts"),i=/^age:\s*[\d.]+\s*$/m,C=function(){function R(g){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=g?g.xhrSetup:null,this.stats=new T.LoadStats,this.retryDelay=0}var A=R.prototype;return A.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},A.abortInternal=function(){var c=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),c&&(c.onreadystatechange=null,c.onprogress=null,c.readyState!==4&&(this.stats.aborted=!0,c.abort()))},A.abort=function(){var c;this.abortInternal(),(c=this.callbacks)!==null&&c!==void 0&&c.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},A.load=function(c,m,y){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=c,this.config=m,this.callbacks=y,this.retryDelay=m.retryDelay,this.loadInternal()},A.loadInternal=function(){var c=this.config,m=this.context;if(!!c){var y=this.loader=new self.XMLHttpRequest,S=this.stats;S.loading.first=0,S.loaded=0;var b=this.xhrSetup;try{if(b)try{b(y,m.url)}catch{y.open("GET",m.url,!0),b(y,m.url)}y.readyState||y.open("GET",m.url,!0);var p=this.context.headers;if(p)for(var n in p)y.setRequestHeader(n,p[n])}catch(e){this.callbacks.onError({code:y.status,text:e.message},m,y);return}m.rangeEnd&&y.setRequestHeader("Range","bytes="+m.rangeStart+"-"+(m.rangeEnd-1)),y.onreadystatechange=this.readystatechange.bind(this),y.onprogress=this.loadprogress.bind(this),y.responseType=m.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),c.timeout),y.send()}},A.readystatechange=function(){var c=this.context,m=this.loader,y=this.stats;if(!(!c||!m)){var S=m.readyState,b=this.config;if(!y.aborted&&S>=2)if(self.clearTimeout(this.requestTimeout),y.loading.first===0&&(y.loading.first=Math.max(self.performance.now(),y.loading.start)),S===4){m.onreadystatechange=null,m.onprogress=null;var p=m.status;if(p>=200&&p<300){y.loading.end=Math.max(self.performance.now(),y.loading.first);var n,e;if(c.responseType==="arraybuffer"?(n=m.response,e=n.byteLength):(n=m.responseText,e=n.length),y.loaded=y.total=e,!this.callbacks)return;var r=this.callbacks.onProgress;if(r&&r(y,c,n,m),!this.callbacks)return;var t={url:m.responseURL,data:n};this.callbacks.onSuccess(t,y,c,m)}else y.retry>=b.maxRetry||p>=400&&p<499?(O.logger.error(p+" while loading "+c.url),this.callbacks.onError({code:p,text:m.statusText},c,m)):(O.logger.warn(p+" while loading "+c.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,b.maxRetryDelay),y.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),b.timeout)}},A.loadtimeout=function(){O.logger.warn("timeout while loading "+this.context.url);var c=this.callbacks;c&&(this.abortInternal(),c.onTimeout(this.stats,this.context,this.loader))},A.loadprogress=function(c){var m=this.stats;m.loaded=c.loaded,c.lengthComputable&&(m.total=c.total)},A.getCacheAge=function(){var c=null;if(this.loader&&i.test(this.loader.getAllResponseHeaders())){var m=this.loader.getResponseHeader("age");c=m?parseFloat(m):null}return c},R}();P.default=C}}).default})})(Tt);var Nt=xt(Tt.exports),bt={exports:{}};(function(Pe,Le){(function(N,P){Pe.exports=P()})(window,function(){return function(N){var P={};function h(O){if(P[O])return P[O].exports;var T=P[O]={i:O,l:!1,exports:{}};return N[O].call(T.exports,T,T.exports,h),T.l=!0,T.exports}return h.m=N,h.c=P,h.d=function(O,T,i){h.o(O,T)||Object.defineProperty(O,T,{enumerable:!0,get:i})},h.r=function(O){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})},h.t=function(O,T){if(1&T&&(O=h(O)),8&T||4&T&&typeof O=="object"&&O&&O.__esModule)return O;var i=Object.create(null);if(h.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:O}),2&T&&typeof O!="string")for(var C in O)h.d(i,C,function(R){return O[R]}.bind(null,C));return i},h.n=function(O){var T=O&&O.__esModule?function(){return O.default}:function(){return O};return h.d(T,"a",T),T},h.o=function(O,T){return Object.prototype.hasOwnProperty.call(O,T)},h.p="/",h(h.s=58)}([function(N,P,h){function O(m){return(O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(m)}var T=h(6),i=Object.prototype.toString;function C(m){return i.call(m)==="[object Array]"}function R(m){return m===void 0}function A(m){return m!==null&&O(m)==="object"}function g(m){return i.call(m)==="[object Function]"}function c(m,y){if(m!=null)if(O(m)!=="object"&&(m=[m]),C(m))for(var S=0,b=m.length;S<b;S++)y.call(null,m[S],S,m);else for(var p in m)Object.prototype.hasOwnProperty.call(m,p)&&y.call(null,m[p],p,m)}N.exports={isArray:C,isArrayBuffer:function(m){return i.call(m)==="[object ArrayBuffer]"},isBuffer:function(m){return m!==null&&!R(m)&&m.constructor!==null&&!R(m.constructor)&&typeof m.constructor.isBuffer=="function"&&m.constructor.isBuffer(m)},isFormData:function(m){return typeof FormData!="undefined"&&m instanceof FormData},isArrayBufferView:function(m){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(m):m&&m.buffer&&m.buffer instanceof ArrayBuffer},isString:function(m){return typeof m=="string"},isNumber:function(m){return typeof m=="number"},isObject:A,isUndefined:R,isDate:function(m){return i.call(m)==="[object Date]"},isFile:function(m){return i.call(m)==="[object File]"},isBlob:function(m){return i.call(m)==="[object Blob]"},isFunction:g,isStream:function(m){return A(m)&&g(m.pipe)},isURLSearchParams:function(m){return typeof URLSearchParams!="undefined"&&m instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:c,merge:function m(){var y={};function S(n,e){O(y[e])==="object"&&O(n)==="object"?y[e]=m(y[e],n):y[e]=n}for(var b=0,p=arguments.length;b<p;b++)c(arguments[b],S);return y},deepMerge:function m(){var y={};function S(n,e){O(y[e])==="object"&&O(n)==="object"?y[e]=m(y[e],n):O(n)==="object"?y[e]=m({},n):y[e]=n}for(var b=0,p=arguments.length;b<p;b++)c(arguments[b],S);return y},extend:function(m,y,S){return c(y,function(b,p){m[p]=S&&typeof b=="function"?T(b,S):b}),m},trim:function(m){return m.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(N,P,h){var O=h(14);N.exports=function(T){var i="",C=(T=T||{}).enableSubtitle,R=T.subtitle,A=T.current,g=T.airplay,c=T.pic,m=O.$escape,y=T.screenshot,S=T.preload,b=T.url;return C=R&&R.type==="webvtt",i+=`
<video
    class="dplayer-video `,A&&(i+="dplayer-video-current"),i+=`"
    webkit-playsinline
    `,g&&(i+=' x-webkit-airplay="allow" '),i+=`
    playsinline
    `,c&&(i+='poster="',i+=m(c),i+='"'),i+=`
    `,(y||C)&&(i+='crossorigin="anonymous"'),i+=`
    `,S&&(i+='preload="',i+=m(S),i+='"'),i+=`
    `,b&&(i+='src="',i+=m(b),i+='"'),i+=`
    >
    `,C&&(i+=`
    <track kind="metadata" default src="`,i+=m(R.url),i+=`"></track>
    `),i+=`
</video>`}},function(N,P,h){N.exports=h(41)},function(N,P,h){N.exports=function(O){var T=[];return T.toString=function(){return this.map(function(i){var C=function(R,A){var g=R[1]||"",c=R[3];if(!c)return g;if(A&&typeof btoa=="function"){var m=(S=c,b=btoa(unescape(encodeURIComponent(JSON.stringify(S)))),p="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(b),"/*# ".concat(p," */")),y=c.sources.map(function(n){return"/*# sourceURL=".concat(c.sourceRoot||"").concat(n," */")});return[g].concat(y).concat([m]).join(`
`)}var S,b,p;return[g].join(`
`)}(i,O);return i[2]?"@media ".concat(i[2]," {").concat(C,"}"):C}).join("")},T.i=function(i,C,R){typeof i=="string"&&(i=[[null,i,""]]);var A={};if(R)for(var g=0;g<this.length;g++){var c=this[g][0];c!=null&&(A[c]=!0)}for(var m=0;m<i.length;m++){var y=[].concat(i[m]);R&&A[y[0]]||(C&&(y[2]?y[2]="".concat(C," and ").concat(y[2]):y[2]=C),T.push(y))}},T}},function(N,P){function h(T){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(T)}var O;O=function(){return this}();try{O=O||new Function("return this")()}catch{(typeof window=="undefined"?"undefined":h(window))==="object"&&(O=window)}N.exports=O},function(N,P){var h,O,T=N.exports={};function i(){throw new Error("setTimeout has not been defined")}function C(){throw new Error("clearTimeout has not been defined")}function R(n){if(h===setTimeout)return setTimeout(n,0);if((h===i||!h)&&setTimeout)return h=setTimeout,setTimeout(n,0);try{return h(n,0)}catch{try{return h.call(null,n,0)}catch{return h.call(this,n,0)}}}(function(){try{h=typeof setTimeout=="function"?setTimeout:i}catch{h=i}try{O=typeof clearTimeout=="function"?clearTimeout:C}catch{O=C}})();var A,g=[],c=!1,m=-1;function y(){c&&A&&(c=!1,A.length?g=A.concat(g):m=-1,g.length&&S())}function S(){if(!c){var n=R(y);c=!0;for(var e=g.length;e;){for(A=g,g=[];++m<e;)A&&A[m].run();m=-1,e=g.length}A=null,c=!1,function(r){if(O===clearTimeout)return clearTimeout(r);if((O===C||!O)&&clearTimeout)return O=clearTimeout,clearTimeout(r);try{O(r)}catch{try{return O.call(null,r)}catch{return O.call(this,r)}}}(n)}}function b(n,e){this.fun=n,this.array=e}function p(){}T.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];g.push(new b(n,e)),g.length!==1||c||R(S)},b.prototype.run=function(){this.fun.apply(null,this.array)},T.title="browser",T.browser=!0,T.env={},T.argv=[],T.version="",T.versions={},T.on=p,T.addListener=p,T.once=p,T.off=p,T.removeListener=p,T.removeAllListeners=p,T.emit=p,T.prependListener=p,T.prependOnceListener=p,T.listeners=function(n){return[]},T.binding=function(n){throw new Error("process.binding is not supported")},T.cwd=function(){return"/"},T.chdir=function(n){throw new Error("process.chdir is not supported")},T.umask=function(){return 0}},function(N,P,h){N.exports=function(O,T){return function(){for(var i=new Array(arguments.length),C=0;C<i.length;C++)i[C]=arguments[C];return O.apply(T,i)}}},function(N,P,h){var O=h(0);function T(i){return encodeURIComponent(i).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}N.exports=function(i,C,R){if(!C)return i;var A;if(R)A=R(C);else if(O.isURLSearchParams(C))A=C.toString();else{var g=[];O.forEach(C,function(m,y){m!=null&&(O.isArray(m)?y+="[]":m=[m],O.forEach(m,function(S){O.isDate(S)?S=S.toISOString():O.isObject(S)&&(S=JSON.stringify(S)),g.push(T(y)+"="+T(S))}))}),A=g.join("&")}if(A){var c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+A}return i}},function(N,P,h){N.exports=function(O){return!(!O||!O.__CANCEL__)}},function(N,P,h){(function(O){var T=h(0),i=h(46),C={"Content-Type":"application/x-www-form-urlencoded"};function R(c,m){!T.isUndefined(c)&&T.isUndefined(c["Content-Type"])&&(c["Content-Type"]=m)}var A,g={adapter:((typeof XMLHttpRequest!="undefined"||O!==void 0&&Object.prototype.toString.call(O)==="[object process]")&&(A=h(10)),A),transformRequest:[function(c,m){return i(m,"Accept"),i(m,"Content-Type"),T.isFormData(c)||T.isArrayBuffer(c)||T.isBuffer(c)||T.isStream(c)||T.isFile(c)||T.isBlob(c)?c:T.isArrayBufferView(c)?c.buffer:T.isURLSearchParams(c)?(R(m,"application/x-www-form-urlencoded;charset=utf-8"),c.toString()):T.isObject(c)?(R(m,"application/json;charset=utf-8"),JSON.stringify(c)):c}],transformResponse:[function(c){if(typeof c=="string")try{c=JSON.parse(c)}catch{}return c}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(c){return c>=200&&c<300}};g.headers={common:{Accept:"application/json, text/plain, */*"}},T.forEach(["delete","get","head"],function(c){g.headers[c]={}}),T.forEach(["post","put","patch"],function(c){g.headers[c]=T.merge(C)}),N.exports=g}).call(this,h(5))},function(N,P,h){var O=h(0),T=h(47),i=h(7),C=h(49),R=h(52),A=h(53),g=h(11);N.exports=function(c){return new Promise(function(m,y){var S=c.data,b=c.headers;O.isFormData(S)&&delete b["Content-Type"];var p=new XMLHttpRequest;if(c.auth){var n=c.auth.username||"",e=c.auth.password||"";b.Authorization="Basic "+btoa(n+":"+e)}var r=C(c.baseURL,c.url);if(p.open(c.method.toUpperCase(),i(r,c.params,c.paramsSerializer),!0),p.timeout=c.timeout,p.onreadystatechange=function(){if(p&&p.readyState===4&&(p.status!==0||p.responseURL&&p.responseURL.indexOf("file:")===0)){var s="getAllResponseHeaders"in p?R(p.getAllResponseHeaders()):null,a={data:c.responseType&&c.responseType!=="text"?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:s,config:c,request:p};T(m,y,a),p=null}},p.onabort=function(){p&&(y(g("Request aborted",c,"ECONNABORTED",p)),p=null)},p.onerror=function(){y(g("Network Error",c,null,p)),p=null},p.ontimeout=function(){var s="timeout of "+c.timeout+"ms exceeded";c.timeoutErrorMessage&&(s=c.timeoutErrorMessage),y(g(s,c,"ECONNABORTED",p)),p=null},O.isStandardBrowserEnv()){var t=h(54),l=(c.withCredentials||A(r))&&c.xsrfCookieName?t.read(c.xsrfCookieName):void 0;l&&(b[c.xsrfHeaderName]=l)}if("setRequestHeader"in p&&O.forEach(b,function(s,a){S===void 0&&a.toLowerCase()==="content-type"?delete b[a]:p.setRequestHeader(a,s)}),O.isUndefined(c.withCredentials)||(p.withCredentials=!!c.withCredentials),c.responseType)try{p.responseType=c.responseType}catch(s){if(c.responseType!=="json")throw s}typeof c.onDownloadProgress=="function"&&p.addEventListener("progress",c.onDownloadProgress),typeof c.onUploadProgress=="function"&&p.upload&&p.upload.addEventListener("progress",c.onUploadProgress),c.cancelToken&&c.cancelToken.promise.then(function(s){p&&(p.abort(),y(s),p=null)}),S===void 0&&(S=null),p.send(S)})}},function(N,P,h){var O=h(48);N.exports=function(T,i,C,R,A){var g=new Error(T);return O(g,i,C,R,A)}},function(N,P,h){var O=h(0);N.exports=function(T,i){i=i||{};var C={},R=["url","method","params","data"],A=["headers","auth","proxy"],g=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];O.forEach(R,function(y){i[y]!==void 0&&(C[y]=i[y])}),O.forEach(A,function(y){O.isObject(i[y])?C[y]=O.deepMerge(T[y],i[y]):i[y]!==void 0?C[y]=i[y]:O.isObject(T[y])?C[y]=O.deepMerge(T[y]):T[y]!==void 0&&(C[y]=T[y])}),O.forEach(g,function(y){i[y]!==void 0?C[y]=i[y]:T[y]!==void 0&&(C[y]=T[y])});var c=R.concat(A).concat(g),m=Object.keys(i).filter(function(y){return c.indexOf(y)===-1});return O.forEach(m,function(y){i[y]!==void 0?C[y]=i[y]:T[y]!==void 0&&(C[y]=T[y])}),C}},function(N,P,h){function O(T){this.message=T}O.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},O.prototype.__CANCEL__=!0,N.exports=O},function(N,P,h){N.exports=h(57)},function(N,P,h){(function(O){var T=h(16);function i(n){return(i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}var C=setTimeout;function R(n){return Boolean(n&&n.length!==void 0)}function A(){}function g(n){if(!(this instanceof g))throw new TypeError("Promises must be constructed via new");if(typeof n!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],p(n,this)}function c(n,e){for(;n._state===3;)n=n._value;n._state!==0?(n._handled=!0,g._immediateFn(function(){var r=n._state===1?e.onFulfilled:e.onRejected;if(r!==null){var t;try{t=r(n._value)}catch(l){return void y(e.promise,l)}m(e.promise,t)}else(n._state===1?m:y)(e.promise,n._value)})):n._deferreds.push(e)}function m(n,e){try{if(e===n)throw new TypeError("A promise cannot be resolved with itself.");if(e&&(i(e)==="object"||typeof e=="function")){var r=e.then;if(e instanceof g)return n._state=3,n._value=e,void S(n);if(typeof r=="function")return void p((t=r,l=e,function(){t.apply(l,arguments)}),n)}n._state=1,n._value=e,S(n)}catch(s){y(n,s)}var t,l}function y(n,e){n._state=2,n._value=e,S(n)}function S(n){n._state===2&&n._deferreds.length===0&&g._immediateFn(function(){n._handled||g._unhandledRejectionFn(n._value)});for(var e=0,r=n._deferreds.length;e<r;e++)c(n,n._deferreds[e]);n._deferreds=null}function b(n,e,r){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.promise=r}function p(n,e){var r=!1;try{n(function(t){r||(r=!0,m(e,t))},function(t){r||(r=!0,y(e,t))})}catch(t){if(r)return;r=!0,y(e,t)}}g.prototype.catch=function(n){return this.then(null,n)},g.prototype.then=function(n,e){var r=new this.constructor(A);return c(this,new b(n,e,r)),r},g.prototype.finally=T.a,g.all=function(n){return new g(function(e,r){if(!R(n))return r(new TypeError("Promise.all accepts an array"));var t=Array.prototype.slice.call(n);if(t.length===0)return e([]);var l=t.length;function s(o,E){try{if(E&&(i(E)==="object"||typeof E=="function")){var x=E.then;if(typeof x=="function")return void x.call(E,function(f){s(o,f)},r)}t[o]=E,--l==0&&e(t)}catch(f){r(f)}}for(var a=0;a<t.length;a++)s(a,t[a])})},g.resolve=function(n){return n&&i(n)==="object"&&n.constructor===g?n:new g(function(e){e(n)})},g.reject=function(n){return new g(function(e,r){r(n)})},g.race=function(n){return new g(function(e,r){if(!R(n))return r(new TypeError("Promise.race accepts an array"));for(var t=0,l=n.length;t<l;t++)g.resolve(n[t]).then(e,r)})},g._immediateFn=typeof O=="function"&&function(n){O(n)}||function(n){C(n,0)},g._unhandledRejectionFn=function(n){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},P.a=g}).call(this,h(39).setImmediate)},function(N,P,h){P.a=function(O){var T=this.constructor;return this.then(function(i){return T.resolve(O()).then(function(){return i})},function(i){return T.resolve(O()).then(function(){return T.reject(i)})})}},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 16 32"><path d="M15.552 15.168q0.448 0.32 0.448 0.832 0 0.448-0.448 0.768l-13.696 8.512q-0.768 0.512-1.312 0.192t-0.544-1.28v-16.448q0-0.96 0.544-1.28t1.312 0.192z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 17 32"><path d="M14.080 4.8q2.88 0 2.88 2.048v18.24q0 2.112-2.88 2.112t-2.88-2.112v-18.24q0-2.048 2.88-2.048zM2.88 4.8q2.88 0 2.88 2.048v18.24q0 2.112-2.88 2.112t-2.88-2.112v-18.24q0-2.048 2.88-2.048z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 21 32"><path d="M13.728 6.272v19.456q0 0.448-0.352 0.8t-0.8 0.32-0.8-0.32l-5.952-5.952h-4.672q-0.48 0-0.8-0.352t-0.352-0.8v-6.848q0-0.48 0.352-0.8t0.8-0.352h4.672l5.952-5.952q0.32-0.32 0.8-0.32t0.8 0.32 0.352 0.8zM20.576 16q0 1.344-0.768 2.528t-2.016 1.664q-0.16 0.096-0.448 0.096-0.448 0-0.8-0.32t-0.32-0.832q0-0.384 0.192-0.64t0.544-0.448 0.608-0.384 0.512-0.64 0.192-1.024-0.192-1.024-0.512-0.64-0.608-0.384-0.544-0.448-0.192-0.64q0-0.48 0.32-0.832t0.8-0.32q0.288 0 0.448 0.096 1.248 0.48 2.016 1.664t0.768 2.528zM25.152 16q0 2.72-1.536 5.056t-4 3.36q-0.256 0.096-0.448 0.096-0.48 0-0.832-0.352t-0.32-0.8q0-0.704 0.672-1.056 1.024-0.512 1.376-0.8 1.312-0.96 2.048-2.4t0.736-3.104-0.736-3.104-2.048-2.4q-0.352-0.288-1.376-0.8-0.672-0.352-0.672-1.056 0-0.448 0.32-0.8t0.8-0.352q0.224 0 0.48 0.096 2.496 1.056 4 3.36t1.536 5.056z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 21 32"><path d="M13.728 6.272v19.456q0 0.448-0.352 0.8t-0.8 0.32-0.8-0.32l-5.952-5.952h-4.672q-0.48 0-0.8-0.352t-0.352-0.8v-6.848q0-0.48 0.352-0.8t0.8-0.352h4.672l5.952-5.952q0.32-0.32 0.8-0.32t0.8 0.32 0.352 0.8zM20.576 16q0 1.344-0.768 2.528t-2.016 1.664q-0.16 0.096-0.448 0.096-0.448 0-0.8-0.32t-0.32-0.832q0-0.384 0.192-0.64t0.544-0.448 0.608-0.384 0.512-0.64 0.192-1.024-0.192-1.024-0.512-0.64-0.608-0.384-0.544-0.448-0.192-0.64q0-0.48 0.32-0.832t0.8-0.32q0.288 0 0.448 0.096 1.248 0.48 2.016 1.664t0.768 2.528z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 21 32"><path d="M13.728 6.272v19.456q0 0.448-0.352 0.8t-0.8 0.32-0.8-0.32l-5.952-5.952h-4.672q-0.48 0-0.8-0.352t-0.352-0.8v-6.848q0-0.48 0.352-0.8t0.8-0.352h4.672l5.952-5.952q0.32-0.32 0.8-0.32t0.8 0.32 0.352 0.8z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 33"><path d="M6.667 28h-5.333c-0.8 0-1.333-0.533-1.333-1.333v-5.333c0-0.8 0.533-1.333 1.333-1.333s1.333 0.533 1.333 1.333v4h4c0.8 0 1.333 0.533 1.333 1.333s-0.533 1.333-1.333 1.333zM30.667 28h-5.333c-0.8 0-1.333-0.533-1.333-1.333s0.533-1.333 1.333-1.333h4v-4c0-0.8 0.533-1.333 1.333-1.333s1.333 0.533 1.333 1.333v5.333c0 0.8-0.533 1.333-1.333 1.333zM30.667 12c-0.8 0-1.333-0.533-1.333-1.333v-4h-4c-0.8 0-1.333-0.533-1.333-1.333s0.533-1.333 1.333-1.333h5.333c0.8 0 1.333 0.533 1.333 1.333v5.333c0 0.8-0.533 1.333-1.333 1.333zM1.333 12c-0.8 0-1.333-0.533-1.333-1.333v-5.333c0-0.8 0.533-1.333 1.333-1.333h5.333c0.8 0 1.333 0.533 1.333 1.333s-0.533 1.333-1.333 1.333h-4v4c0 0.8-0.533 1.333-1.333 1.333z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 33"><path d="M24.965 24.38h-18.132c-1.366 0-2.478-1.113-2.478-2.478v-11.806c0-1.364 1.111-2.478 2.478-2.478h18.132c1.366 0 2.478 1.113 2.478 2.478v11.806c0 1.364-1.11 2.478-2.478 2.478zM6.833 10.097v11.806h18.134l-0.002-11.806h-18.132zM2.478 28.928h5.952c0.684 0 1.238-0.554 1.238-1.239 0-0.684-0.554-1.238-1.238-1.238h-5.952v-5.802c0-0.684-0.554-1.239-1.238-1.239s-1.239 0.556-1.239 1.239v5.802c0 1.365 1.111 2.478 2.478 2.478zM30.761 19.412c-0.684 0-1.238 0.554-1.238 1.238v5.801h-5.951c-0.686 0-1.239 0.554-1.239 1.238 0 0.686 0.554 1.239 1.239 1.239h5.951c1.366 0 2.478-1.111 2.478-2.478v-5.801c0-0.683-0.554-1.238-1.239-1.238zM0 5.55v5.802c0 0.683 0.554 1.238 1.238 1.238s1.238-0.555 1.238-1.238v-5.802h5.952c0.684 0 1.238-0.554 1.238-1.238s-0.554-1.238-1.238-1.238h-5.951c-1.366-0.001-2.478 1.111-2.478 2.476zM32 11.35v-5.801c0-1.365-1.11-2.478-2.478-2.478h-5.951c-0.686 0-1.239 0.554-1.239 1.238s0.554 1.238 1.239 1.238h5.951v5.801c0 0.683 0.554 1.237 1.238 1.237 0.686 0.002 1.239-0.553 1.239-1.236z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 28"><path d="M28.633 17.104c0.035 0.21 0.026 0.463-0.026 0.76s-0.14 0.598-0.262 0.904c-0.122 0.306-0.271 0.581-0.445 0.825s-0.367 0.419-0.576 0.524c-0.209 0.105-0.393 0.157-0.55 0.157s-0.332-0.035-0.524-0.105c-0.175-0.052-0.393-0.1-0.655-0.144s-0.528-0.052-0.799-0.026c-0.271 0.026-0.541 0.083-0.812 0.17s-0.502 0.236-0.694 0.445c-0.419 0.437-0.664 0.934-0.734 1.493s0.009 1.092 0.236 1.598c0.175 0.349 0.148 0.699-0.079 1.048-0.105 0.14-0.271 0.284-0.498 0.432s-0.476 0.284-0.747 0.406-0.555 0.218-0.851 0.288c-0.297 0.070-0.559 0.105-0.786 0.105-0.157 0-0.306-0.061-0.445-0.183s-0.236-0.253-0.288-0.393h-0.026c-0.192-0.541-0.52-1.009-0.982-1.402s-1-0.589-1.611-0.589c-0.594 0-1.131 0.197-1.611 0.589s-0.816 0.851-1.009 1.375c-0.087 0.21-0.218 0.362-0.393 0.458s-0.367 0.144-0.576 0.144c-0.244 0-0.52-0.044-0.825-0.131s-0.611-0.197-0.917-0.327c-0.306-0.131-0.581-0.284-0.825-0.458s-0.428-0.349-0.55-0.524c-0.087-0.122-0.135-0.266-0.144-0.432s0.057-0.397 0.197-0.694c0.192-0.402 0.266-0.86 0.223-1.375s-0.266-0.991-0.668-1.428c-0.244-0.262-0.541-0.432-0.891-0.511s-0.681-0.109-0.995-0.092c-0.367 0.017-0.742 0.087-1.127 0.21-0.244 0.070-0.489 0.052-0.734-0.052-0.192-0.070-0.371-0.231-0.537-0.485s-0.314-0.533-0.445-0.838c-0.131-0.306-0.231-0.62-0.301-0.943s-0.087-0.59-0.052-0.799c0.052-0.384 0.227-0.629 0.524-0.734 0.524-0.21 0.995-0.555 1.415-1.035s0.629-1.017 0.629-1.611c0-0.611-0.21-1.144-0.629-1.598s-0.891-0.786-1.415-0.996c-0.157-0.052-0.288-0.179-0.393-0.38s-0.157-0.406-0.157-0.616c0-0.227 0.035-0.48 0.105-0.76s0.162-0.55 0.275-0.812 0.244-0.502 0.393-0.72c0.148-0.218 0.31-0.38 0.485-0.485 0.14-0.087 0.275-0.122 0.406-0.105s0.275 0.052 0.432 0.105c0.524 0.21 1.070 0.275 1.637 0.197s1.070-0.327 1.506-0.747c0.21-0.209 0.362-0.467 0.458-0.773s0.157-0.607 0.183-0.904c0.026-0.297 0.026-0.568 0-0.812s-0.048-0.419-0.065-0.524c-0.035-0.105-0.066-0.227-0.092-0.367s-0.013-0.262 0.039-0.367c0.105-0.244 0.293-0.458 0.563-0.642s0.563-0.336 0.878-0.458c0.314-0.122 0.62-0.214 0.917-0.275s0.533-0.092 0.707-0.092c0.227 0 0.406 0.074 0.537 0.223s0.223 0.301 0.275 0.458c0.192 0.471 0.507 0.886 0.943 1.244s0.952 0.537 1.546 0.537c0.611 0 1.153-0.17 1.624-0.511s0.803-0.773 0.996-1.297c0.070-0.14 0.179-0.284 0.327-0.432s0.301-0.223 0.458-0.223c0.244 0 0.511 0.035 0.799 0.105s0.572 0.166 0.851 0.288c0.279 0.122 0.537 0.279 0.773 0.472s0.423 0.402 0.563 0.629c0.087 0.14 0.113 0.293 0.079 0.458s-0.070 0.284-0.105 0.354c-0.227 0.506-0.297 1.039-0.21 1.598s0.341 1.048 0.76 1.467c0.419 0.419 0.934 0.651 1.546 0.694s1.179-0.057 1.703-0.301c0.14-0.087 0.31-0.122 0.511-0.105s0.371 0.096 0.511 0.236c0.262 0.244 0.493 0.616 0.694 1.113s0.336 1 0.406 1.506c0.035 0.297-0.013 0.528-0.144 0.694s-0.266 0.275-0.406 0.327c-0.542 0.192-1.004 0.528-1.388 1.009s-0.576 1.026-0.576 1.637c0 0.594 0.162 1.113 0.485 1.559s0.747 0.764 1.27 0.956c0.122 0.070 0.227 0.14 0.314 0.21 0.192 0.157 0.323 0.358 0.393 0.602v0zM16.451 19.462c0.786 0 1.528-0.149 2.227-0.445s1.305-0.707 1.821-1.231c0.515-0.524 0.921-1.131 1.218-1.821s0.445-1.428 0.445-2.214c0-0.786-0.148-1.524-0.445-2.214s-0.703-1.292-1.218-1.808c-0.515-0.515-1.122-0.921-1.821-1.218s-1.441-0.445-2.227-0.445c-0.786 0-1.524 0.148-2.214 0.445s-1.292 0.703-1.808 1.218c-0.515 0.515-0.921 1.118-1.218 1.808s-0.445 1.428-0.445 2.214c0 0.786 0.149 1.524 0.445 2.214s0.703 1.297 1.218 1.821c0.515 0.524 1.118 0.934 1.808 1.231s1.428 0.445 2.214 0.445v0z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M22 16l-10.105-10.6-1.895 1.987 8.211 8.613-8.211 8.612 1.895 1.988 8.211-8.613z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M27.128 0.38h-22.553c-2.336 0-4.229 1.825-4.229 4.076v16.273c0 2.251 1.893 4.076 4.229 4.076h4.229v-2.685h8.403l-8.784 8.072 1.566 1.44 7.429-6.827h9.71c2.335 0 4.229-1.825 4.229-4.076v-16.273c0-2.252-1.894-4.076-4.229-4.076zM28.538 19.403c0 1.5-1.262 2.717-2.819 2.717h-8.36l-0.076-0.070-0.076 0.070h-11.223c-1.557 0-2.819-1.217-2.819-2.717v-13.589c0-1.501 1.262-2.718 2.819-2.718h19.734c1.557 0 2.819-0.141 2.819 1.359v14.947zM9.206 10.557c-1.222 0-2.215 0.911-2.215 2.036s0.992 2.035 2.215 2.035c1.224 0 2.216-0.911 2.216-2.035s-0.992-2.036-2.216-2.036zM22.496 10.557c-1.224 0-2.215 0.911-2.215 2.036s0.991 2.035 2.215 2.035c1.224 0 2.215-0.911 2.215-2.035s-0.991-2.036-2.215-2.036zM15.852 10.557c-1.224 0-2.215 0.911-2.215 2.036s0.991 2.035 2.215 2.035c1.222 0 2.215-0.911 2.215-2.035s-0.992-2.036-2.215-2.036z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M27.090 0.131h-22.731c-2.354 0-4.262 1.839-4.262 4.109v16.401c0 2.269 1.908 4.109 4.262 4.109h4.262v-2.706h8.469l-8.853 8.135 1.579 1.451 7.487-6.88h9.787c2.353 0 4.262-1.84 4.262-4.109v-16.401c0-2.27-1.909-4.109-4.262-4.109v0zM28.511 19.304c0 1.512-1.272 2.738-2.841 2.738h-8.425l-0.076-0.070-0.076 0.070h-11.311c-1.569 0-2.841-1.226-2.841-2.738v-13.696c0-1.513 1.272-2.739 2.841-2.739h19.889c1.569 0 2.841-0.142 2.841 1.37v15.064z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M13.725 30l3.9-5.325-3.9-1.125v6.45zM0 17.5l11.050 3.35 13.6-11.55-10.55 12.425 11.8 3.65 6.1-23.375-32 15.5z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M19.357 2.88c1.749 0 3.366 0.316 4.851 0.946 1.485 0.632 2.768 1.474 3.845 2.533s1.922 2.279 2.532 3.661c0.611 1.383 0.915 2.829 0.915 4.334 0 1.425-0.304 2.847-0.915 4.271-0.611 1.425-1.587 2.767-2.928 4.028-0.855 0.813-1.811 1.607-2.869 2.38s-2.136 1.465-3.233 2.075c-1.099 0.61-2.198 1.098-3.296 1.465-1.098 0.366-2.115 0.549-3.051 0.549-1.343 0-2.441-0.438-3.296-1.311-0.854-0.876-1.281-2.41-1.281-4.608 0-0.366 0.020-0.773 0.060-1.221s0.062-0.895 0.062-1.343c0-0.773-0.183-1.353-0.55-1.738-0.366-0.387-0.793-0.58-1.281-0.58-0.652 0-1.21 0.295-1.678 0.886s-0.926 1.23-1.373 1.921c-0.447 0.693-0.905 1.334-1.372 1.923s-1.028 0.886-1.679 0.886c-0.529 0-1.048-0.427-1.556-1.282s-0.763-2.259-0.763-4.212c0-2.197 0.529-4.241 1.587-6.133s2.462-3.529 4.21-4.912c1.75-1.383 3.762-2.471 6.041-3.264 2.277-0.796 4.617-1.212 7.018-1.253zM7.334 15.817c0.569 0 1.047-0.204 1.434-0.611s0.579-0.875 0.579-1.404c0-0.569-0.193-1.047-0.579-1.434s-0.864-0.579-1.434-0.579c-0.529 0-0.987 0.193-1.373 0.579s-0.58 0.864-0.58 1.434c0 0.53 0.194 0.998 0.58 1.404 0.388 0.407 0.845 0.611 1.373 0.611zM12.216 11.79c0.691 0 1.292-0.254 1.8-0.763s0.762-1.107 0.762-1.8c0-0.732-0.255-1.343-0.762-1.831-0.509-0.489-1.109-0.732-1.8-0.732-0.732 0-1.342 0.244-1.831 0.732-0.488 0.488-0.732 1.098-0.732 1.831 0 0.693 0.244 1.292 0.732 1.8s1.099 0.763 1.831 0.763zM16.366 25.947c0.692 0 1.282-0.214 1.77-0.64s0.732-0.987 0.732-1.678-0.244-1.261-0.732-1.709c-0.489-0.448-1.078-0.671-1.77-0.671-0.65 0-1.21 0.223-1.678 0.671s-0.702 1.018-0.702 1.709c0 0.692 0.234 1.25 0.702 1.678s1.027 0.64 1.678 0.64zM19.113 9.592c0.651 0 1.129-0.203 1.433-0.611 0.305-0.406 0.459-0.874 0.459-1.404 0-0.488-0.154-0.947-0.459-1.373-0.304-0.427-0.782-0.641-1.433-0.641-0.529 0-1.008 0.193-1.434 0.58s-0.64 0.865-0.64 1.434c0 0.571 0.213 1.049 0.64 1.434 0.427 0.389 0.905 0.581 1.434 0.581zM24.848 12.826c0.57 0 1.067-0.213 1.495-0.64 0.427-0.427 0.64-0.947 0.64-1.556 0-0.57-0.214-1.068-0.64-1.495-0.428-0.427-0.927-0.64-1.495-0.64-0.611 0-1.129 0.213-1.555 0.64-0.428 0.427-0.642 0.926-0.642 1.495 0 0.611 0.213 1.129 0.642 1.556s0.947 0.64 1.555 0.64z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M16 23c-3.309 0-6-2.691-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6zM16 13c-2.206 0-4 1.794-4 4s1.794 4 4 4c2.206 0 4-1.794 4-4s-1.794-4-4-4zM27 28h-22c-1.654 0-3-1.346-3-3v-16c0-1.654 1.346-3 3-3h3c0.552 0 1 0.448 1 1s-0.448 1-1 1h-3c-0.551 0-1 0.449-1 1v16c0 0.552 0.449 1 1 1h22c0.552 0 1-0.448 1-1v-16c0-0.551-0.448-1-1-1h-11c-0.552 0-1-0.448-1-1s0.448-1 1-1h11c1.654 0 3 1.346 3 3v16c0 1.654-1.346 3-3 3zM24 10.5c0 0.828 0.672 1.5 1.5 1.5s1.5-0.672 1.5-1.5c0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5zM15 4c0 0.552-0.448 1-1 1h-4c-0.552 0-1-0.448-1-1v0c0-0.552 0.448-1 1-1h4c0.552 0 1 0.448 1 1v0z"></path></svg>'},function(N,P){N.exports='<svg viewBox="0 0 288 288" xmlns="http://www.w3.org/2000/svg"><path d="M288 90v96c0 20-16 36-36 36h-10c-16 0-16-24 0-24h10c7 0 12-5 12-12V90c0-7-5-12-12-12H36c-7 0-12 5-12 12v96c0 7 5 12 12 12h10c16 0 16 24 0 24H36c-20 0-36-16-36-36V90c0-20 16-36 36-36h216c20 0 36 16 36 36zm-120 62l48 68c14 20 1 38-20 38H92c-21 0-34-18-20-38l48-68c13-18 35-18 48 0z"></path></svg>'},function(N,P){N.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M26.667 5.333h-21.333c-0 0-0.001 0-0.001 0-1.472 0-2.666 1.194-2.666 2.666 0 0 0 0.001 0 0.001v-0 16c0 0 0 0.001 0 0.001 0 1.472 1.194 2.666 2.666 2.666 0 0 0.001 0 0.001 0h21.333c0 0 0.001 0 0.001 0 1.472 0 2.666-1.194 2.666-2.666 0-0 0-0.001 0-0.001v0-16c0-0 0-0.001 0-0.001 0-1.472-1.194-2.666-2.666-2.666-0 0-0.001 0-0.001 0h0zM5.333 16h5.333v2.667h-5.333v-2.667zM18.667 24h-13.333v-2.667h13.333v2.667zM26.667 24h-5.333v-2.667h5.333v2.667zM26.667 18.667h-13.333v-2.667h13.333v2.667z"></path></svg>'},function(N,P){N.exports='<svg version="1.1" viewBox="0 0 22 22"><svg x="7" y="1"><circle class="diplayer-loading-dot diplayer-loading-dot-0" cx="4" cy="4" r="2"></circle></svg><svg x="11" y="3"><circle class="diplayer-loading-dot diplayer-loading-dot-1" cx="4" cy="4" r="2"></circle></svg><svg x="13" y="7"><circle class="diplayer-loading-dot diplayer-loading-dot-2" cx="4" cy="4" r="2"></circle></svg><svg x="11" y="11"><circle class="diplayer-loading-dot diplayer-loading-dot-3" cx="4" cy="4" r="2"></circle></svg><svg x="7" y="13"><circle class="diplayer-loading-dot diplayer-loading-dot-4" cx="4" cy="4" r="2"></circle></svg><svg x="3" y="11"><circle class="diplayer-loading-dot diplayer-loading-dot-5" cx="4" cy="4" r="2"></circle></svg><svg x="1" y="7"><circle class="diplayer-loading-dot diplayer-loading-dot-6" cx="4" cy="4" r="2"></circle></svg><svg x="3" y="3"><circle class="diplayer-loading-dot diplayer-loading-dot-7" cx="4" cy="4" r="2"></circle></svg></svg>'},function(N,P,h){var O=h(14);N.exports=function(T){T=T||{};var i="",C=function(b){return i+=b},R=T.video,A=T.options,g=O.$escape,c=T.tran,m=T.icons,y=T.index,S=O.$each;return T.$value,T.$index,i+=`<div class="dplayer-mask"></div>
<div class="dplayer-video-wrap">
    `,C(h(1)(R)),i+=`
    `,A.logo&&(i+=`
    <div class="dplayer-logo">
        <img src="`,i+=g(A.logo),i+=`">
    </div>
    `),i+=`
    <div class="dplayer-danmaku"`,A.danmaku&&A.danmaku.bottm&&(i+=' style="margin-bottom:',i+=g(A.danmaku.bottm),i+='"'),i+=`>
        <div class="dplayer-danmaku-item dplayer-danmaku-item--demo"></div>
    </div>
    <div class="dplayer-subtitle"></div>
    <div class="dplayer-bezel">
        <span class="dplayer-bezel-icon"></span>
        `,A.danmaku&&(i+=`
        <span class="dplayer-danloading">`,i+=g(c("Danmaku is loading")),i+=`</span>
        `),i+=`
        <span class="diplayer-loading-icon">`,i+=m.loading,i+=`</span>
    </div>
</div>
<div class="dplayer-controller-mask"></div>
<div class="dplayer-controller">
    <div class="dplayer-icons dplayer-comment-box">
        <button class="dplayer-icon dplayer-comment-setting-icon" data-balloon="`,i+=g(c("Setting")),i+=`" data-balloon-pos="up">
            <span class="dplayer-icon-content">`,i+=m.pallette,i+=`</span>
        </button>
        <div class="dplayer-comment-setting-box">
            <div class="dplayer-comment-setting-color">
                <div class="dplayer-comment-setting-title">`,i+=g(c("Set danmaku color")),i+=`</div>
                <label>
                    <input type="radio" name="dplayer-danmaku-color-`,i+=g(y),i+=`" value="#fff" checked>
                    <span style="background: #fff;"></span>
                </label>
                <label>
                    <input type="radio" name="dplayer-danmaku-color-`,i+=g(y),i+=`" value="#e54256">
                    <span style="background: #e54256"></span>
                </label>
                <label>
                    <input type="radio" name="dplayer-danmaku-color-`,i+=g(y),i+=`" value="#ffe133">
                    <span style="background: #ffe133"></span>
                </label>
                <label>
                    <input type="radio" name="dplayer-danmaku-color-`,i+=g(y),i+=`" value="#64DD17">
                    <span style="background: #64DD17"></span>
                </label>
                <label>
                    <input type="radio" name="dplayer-danmaku-color-`,i+=g(y),i+=`" value="#39ccff">
                    <span style="background: #39ccff"></span>
                </label>
                <label>
                    <input type="radio" name="dplayer-danmaku-color-`,i+=g(y),i+=`" value="#D500F9">
                    <span style="background: #D500F9"></span>
                </label>
            </div>
            <div class="dplayer-comment-setting-type">
                <div class="dplayer-comment-setting-title">`,i+=g(c("Set danmaku type")),i+=`</div>
                <label>
                    <input type="radio" name="dplayer-danmaku-type-`,i+=g(y),i+=`" value="1">
                    <span>`,i+=g(c("Top")),i+=`</span>
                </label>
                <label>
                    <input type="radio" name="dplayer-danmaku-type-`,i+=g(y),i+=`" value="0" checked>
                    <span>`,i+=g(c("Rolling")),i+=`</span>
                </label>
                <label>
                    <input type="radio" name="dplayer-danmaku-type-`,i+=g(y),i+=`" value="2">
                    <span>`,i+=g(c("Bottom")),i+=`</span>
                </label>
            </div>
        </div>
        <input class="dplayer-comment-input" type="text" placeholder="`,i+=g(c("Input danmaku, hit Enter")),i+=`" maxlength="30">
        <button class="dplayer-icon dplayer-send-icon" data-balloon="`,i+=g(c("Send")),i+=`" data-balloon-pos="up">
            <span class="dplayer-icon-content">`,i+=m.send,i+=`</span>
        </button>
    </div>
    <div class="dplayer-icons dplayer-icons-left">
        <button class="dplayer-icon dplayer-play-icon">
            <span class="dplayer-icon-content">`,i+=m.play,i+=`</span>
        </button>
        <div class="dplayer-volume">
            <button class="dplayer-icon dplayer-volume-icon">
                <span class="dplayer-icon-content">`,i+=m.volumeDown,i+=`</span>
            </button>
            <div class="dplayer-volume-bar-wrap" data-balloon-pos="up">
                <div class="dplayer-volume-bar">
                    <div class="dplayer-volume-bar-inner" style="background: `,i+=g(A.theme),i+=`;">
                        <span class="dplayer-thumb" style="background: `,i+=g(A.theme),i+=`"></span>
                    </div>
                </div>
            </div>
        </div>
        <span class="dplayer-time">
            <span class="dplayer-ptime">0:00</span> /
            <span class="dplayer-dtime">0:00</span>
        </span>
        `,A.live&&(i+=`
        <span class="dplayer-live-badge"><span class="dplayer-live-dot" style="background: `,i+=g(A.theme),i+=';"></span>',i+=g(c("Live")),i+=`</span>
        `),i+=`
    </div>
    <div class="dplayer-icons dplayer-icons-right">
        `,A.video.quality&&(i+=`
        <div class="dplayer-quality">
            <button class="dplayer-icon dplayer-quality-icon">`,i+=g(A.video.quality[A.video.defaultQuality].name),i+=`</button>
            <div class="dplayer-quality-mask">
                <div class="dplayer-quality-list">
                `,S(A.video.quality,function(b,p){i+=`
                    <div class="dplayer-quality-item" data-index="`,i+=g(p),i+='">',i+=g(b.name),i+=`</div>
                `}),i+=`
                </div>
            </div>
        </div>
        `),i+=`
        `,A.screenshot&&(i+=`
        <div class="dplayer-icon dplayer-camera-icon" data-balloon="`,i+=g(c("Screenshot")),i+=`" data-balloon-pos="up">
            <span class="dplayer-icon-content">`,i+=m.camera,i+=`</span>
        </div>
        `),i+=`
        `,A.airplay&&(i+=`
        <div class="dplayer-icon dplayer-airplay-icon" data-balloon="`,i+=g(c("AirPlay")),i+=`" data-balloon-pos="up">
            <span class="dplayer-icon-content">`,i+=m.airplay,i+=`</span>
        </div>
        `),i+=`
        <div class="dplayer-comment">
            <button class="dplayer-icon dplayer-comment-icon" data-balloon="`,i+=g(c("Send danmaku")),i+=`" data-balloon-pos="up">
                <span class="dplayer-icon-content">`,i+=m.comment,i+=`</span>
            </button>
        </div>
        `,A.subtitle&&(i+=`
        <div class="dplayer-subtitle-btn">
            <button class="dplayer-icon dplayer-subtitle-icon" data-balloon="`,i+=g(c("Hide subtitle")),i+=`" data-balloon-pos="up">
                <span class="dplayer-icon-content">`,i+=m.subtitle,i+=`</span>
            </button>
        </div>
        `),i+=`
        <div class="dplayer-setting">
            <button class="dplayer-icon dplayer-setting-icon" data-balloon="`,i+=g(c("Setting")),i+=`" data-balloon-pos="up">
                <span class="dplayer-icon-content">`,i+=m.setting,i+=`</span>
            </button>
            <div class="dplayer-setting-box">
                <div class="dplayer-setting-origin-panel">
                    <div class="dplayer-setting-item dplayer-setting-speed">
                        <span class="dplayer-label">`,i+=g(c("Speed")),i+=`</span>
                        <div class="dplayer-toggle">`,i+=m.right,i+=`</div>
                    </div>
                    <div class="dplayer-setting-item dplayer-setting-loop">
                        <span class="dplayer-label">`,i+=g(c("Loop")),i+=`</span>
                        <div class="dplayer-toggle">
                            <input class="dplayer-toggle-setting-input" type="checkbox" name="dplayer-toggle">
                            <label for="dplayer-toggle"></label>
                        </div>
                    </div>
                    <div class="dplayer-setting-item dplayer-setting-showdan">
                        <span class="dplayer-label">`,i+=g(c("Show danmaku")),i+=`</span>
                        <div class="dplayer-toggle">
                            <input class="dplayer-showdan-setting-input" type="checkbox" name="dplayer-toggle-dan">
                            <label for="dplayer-toggle-dan"></label>
                        </div>
                    </div>
                    <div class="dplayer-setting-item dplayer-setting-danunlimit">
                        <span class="dplayer-label">`,i+=g(c("Unlimited danmaku")),i+=`</span>
                        <div class="dplayer-toggle">
                            <input class="dplayer-danunlimit-setting-input" type="checkbox" name="dplayer-toggle-danunlimit">
                            <label for="dplayer-toggle-danunlimit"></label>
                        </div>
                    </div>
                    <div class="dplayer-setting-item dplayer-setting-danmaku">
                        <span class="dplayer-label">`,i+=g(c("Opacity for danmaku")),i+=`</span>
                        <div class="dplayer-danmaku-bar-wrap">
                            <div class="dplayer-danmaku-bar">
                                <div class="dplayer-danmaku-bar-inner">
                                    <span class="dplayer-thumb"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dplayer-setting-speed-panel">
                    `,S(A.playbackSpeed,function(b,p){i+=`
                        <div class="dplayer-setting-speed-item" data-speed="`,i+=g(b),i+=`">
                            <span class="dplayer-label">`,i+=g(b===1?c("Normal"):b),i+=`</span>
                        </div>
                    `}),i+=`
                </div>
            </div>
        </div>
        <div class="dplayer-full">
            <button class="dplayer-icon dplayer-full-in-icon" data-balloon="`,i+=g(c("Web full screen")),i+=`" data-balloon-pos="up">
                <span class="dplayer-icon-content">`,i+=m.fullWeb,i+=`</span>
            </button>
            <button class="dplayer-icon dplayer-full-icon" data-balloon="`,i+=g(c("Full screen")),i+=`" data-balloon-pos="up">
                <span class="dplayer-icon-content">`,i+=m.full,i+=`</span>
            </button>
        </div>
    </div>
    <div class="dplayer-bar-wrap">
        <div class="dplayer-bar-time hidden">00:00</div>
        <div class="dplayer-bar-preview"></div>
        <div class="dplayer-bar">
            <div class="dplayer-loaded" style="width: 0;"></div>
            <div class="dplayer-played" style="width: 0; background: `,i+=g(A.theme),i+=`">
                <span class="dplayer-thumb" style="background: `,i+=g(A.theme),i+=`"></span>
            </div>
        </div>
    </div>
</div>
<div class="dplayer-info-panel dplayer-info-panel-hide">
    <div class="dplayer-info-panel-close">[x]</div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-version">
        <span class="dplayer-info-panel-item-title">Player version</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-fps">
        <span class="dplayer-info-panel-item-title">Player FPS</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-type">
        <span class="dplayer-info-panel-item-title">Video type</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-url">
        <span class="dplayer-info-panel-item-title">Video url</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-resolution">
        <span class="dplayer-info-panel-item-title">Video resolution</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-duration">
        <span class="dplayer-info-panel-item-title">Video duration</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    `,A.danmaku&&(i+=`
    <div class="dplayer-info-panel-item dplayer-info-panel-item-danmaku-id">
        <span class="dplayer-info-panel-item-title">Danmaku id</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-danmaku-api">
        <span class="dplayer-info-panel-item-title">Danmaku api</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-danmaku-amount">
        <span class="dplayer-info-panel-item-title">Danmaku amount</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    `),i+=`
</div>
<div class="dplayer-menu">
    `,S(A.contextmenu,function(b,p){i+=`
        <div class="dplayer-menu-item">
            <a`,b.link&&(i+=' target="_blank"'),i+=' href="',i+=g(b.link||"javascript:void(0);"),i+='">',i+=g(c(b.text)),i+=`</a>
        </div>
    `}),i+=`
</div>
<div class="dplayer-notice"></div>
<button class="dplayer-mobile-play">
    `,i+=m.play,i+=`
</button>`}},function(N,P,h){var O=h(36),T=h(37);typeof(T=T.__esModule?T.default:T)=="string"&&(T=[[N.i,T,""]]);var i={insert:"head",singleton:!1};O(T,i),N.exports=T.locals||{}},function(N,P,h){var O,T=function(){return O===void 0&&(O=Boolean(window&&document&&document.all&&!window.atob)),O},i=function(){var e={};return function(r){if(e[r]===void 0){var t=document.querySelector(r);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch{t=null}e[r]=t}return e[r]}}(),C=[];function R(e){for(var r=-1,t=0;t<C.length;t++)if(C[t].identifier===e){r=t;break}return r}function A(e,r){for(var t={},l=[],s=0;s<e.length;s++){var a=e[s],o=r.base?a[0]+r.base:a[0],E=t[o]||0,x="".concat(o," ").concat(E);t[o]=E+1;var f=R(x),u={css:a[1],media:a[2],sourceMap:a[3]};f!==-1?(C[f].references++,C[f].updater(u)):C.push({identifier:x,updater:n(u,r),references:1}),l.push(x)}return l}function g(e){var r=document.createElement("style"),t=e.attributes||{};if(t.nonce===void 0){var l=h.nc;l&&(t.nonce=l)}if(Object.keys(t).forEach(function(a){r.setAttribute(a,t[a])}),typeof e.insert=="function")e.insert(r);else{var s=i(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(r)}return r}var c,m=(c=[],function(e,r){return c[e]=r,c.filter(Boolean).join(`
`)});function y(e,r,t,l){var s=t?"":l.media?"@media ".concat(l.media," {").concat(l.css,"}"):l.css;if(e.styleSheet)e.styleSheet.cssText=m(r,s);else{var a=document.createTextNode(s),o=e.childNodes;o[r]&&e.removeChild(o[r]),o.length?e.insertBefore(a,o[r]):e.appendChild(a)}}function S(e,r,t){var l=t.css,s=t.media,a=t.sourceMap;if(s?e.setAttribute("media",s):e.removeAttribute("media"),a&&btoa&&(l+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=l;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(l))}}var b=null,p=0;function n(e,r){var t,l,s;if(r.singleton){var a=p++;t=b||(b=g(r)),l=y.bind(null,t,a,!1),s=y.bind(null,t,a,!0)}else t=g(r),l=S.bind(null,t,r),s=function(){(function(o){if(o.parentNode===null)return!1;o.parentNode.removeChild(o)})(t)};return l(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;l(e=o)}else s()}}N.exports=function(e,r){(r=r||{}).singleton||typeof r.singleton=="boolean"||(r.singleton=T());var t=A(e=e||[],r);return function(l){if(l=l||[],Object.prototype.toString.call(l)==="[object Array]"){for(var s=0;s<t.length;s++){var a=R(t[s]);C[a].references--}for(var o=A(l,r),E=0;E<t.length;E++){var x=R(t[E]);C[x].references===0&&(C[x].updater(),C.splice(x,1))}t=o}}}},function(N,P,h){var O=h(3),T=h(38);(P=O(!1)).i(T),P.push([N.i,'@-webkit-keyframes my-face{2%{transform:translateY(1.5px) rotate(1.5deg)}4%{transform:translateY(-1.5px) rotate(-.5deg)}6%{transform:translateY(1.5px) rotate(-1.5deg)}8%{transform:translateY(-1.5px) rotate(-1.5deg)}10%{transform:translateY(2.5px) rotate(1.5deg)}12%{transform:translateY(-.5px) rotate(1.5deg)}14%{transform:translateY(-1.5px) rotate(1.5deg)}16%{transform:translateY(-.5px) rotate(-1.5deg)}18%{transform:translateY(.5px) rotate(-1.5deg)}20%{transform:translateY(-1.5px) rotate(2.5deg)}22%{transform:translateY(.5px) rotate(-1.5deg)}24%{transform:translateY(1.5px) rotate(1.5deg)}26%{transform:translateY(.5px) rotate(.5deg)}28%{transform:translateY(.5px) rotate(1.5deg)}30%{transform:translateY(-.5px) rotate(2.5deg)}32%{transform:translateY(1.5px) rotate(-.5deg)}34%{transform:translateY(1.5px) rotate(-.5deg)}36%{transform:translateY(-1.5px) rotate(2.5deg)}38%{transform:translateY(1.5px) rotate(-1.5deg)}40%{transform:translateY(-.5px) rotate(2.5deg)}42%{transform:translateY(2.5px) rotate(-1.5deg)}44%{transform:translateY(1.5px) rotate(.5deg)}46%{transform:translateY(-1.5px) rotate(2.5deg)}48%{transform:translateY(-.5px) rotate(.5deg)}50%{transform:translateY(.5px) rotate(.5deg)}52%{transform:translateY(2.5px) rotate(2.5deg)}54%{transform:translateY(-1.5px) rotate(1.5deg)}56%{transform:translateY(2.5px) rotate(2.5deg)}58%{transform:translateY(.5px) rotate(2.5deg)}60%{transform:translateY(2.5px) rotate(2.5deg)}62%{transform:translateY(-.5px) rotate(2.5deg)}64%{transform:translateY(-.5px) rotate(1.5deg)}66%{transform:translateY(1.5px) rotate(-.5deg)}68%{transform:translateY(-1.5px) rotate(-.5deg)}70%{transform:translateY(1.5px) rotate(.5deg)}72%{transform:translateY(2.5px) rotate(1.5deg)}74%{transform:translateY(-.5px) rotate(.5deg)}76%{transform:translateY(-.5px) rotate(2.5deg)}78%{transform:translateY(-.5px) rotate(1.5deg)}80%{transform:translateY(1.5px) rotate(1.5deg)}82%{transform:translateY(-.5px) rotate(.5deg)}84%{transform:translateY(1.5px) rotate(2.5deg)}86%{transform:translateY(-1.5px) rotate(-1.5deg)}88%{transform:translateY(-.5px) rotate(2.5deg)}90%{transform:translateY(2.5px) rotate(-.5deg)}92%{transform:translateY(.5px) rotate(-.5deg)}94%{transform:translateY(2.5px) rotate(.5deg)}96%{transform:translateY(-.5px) rotate(1.5deg)}98%{transform:translateY(-1.5px) rotate(-.5deg)}0%,to{transform:translate(0) rotate(0deg)}}@keyframes my-face{2%{transform:translateY(1.5px) rotate(1.5deg)}4%{transform:translateY(-1.5px) rotate(-.5deg)}6%{transform:translateY(1.5px) rotate(-1.5deg)}8%{transform:translateY(-1.5px) rotate(-1.5deg)}10%{transform:translateY(2.5px) rotate(1.5deg)}12%{transform:translateY(-.5px) rotate(1.5deg)}14%{transform:translateY(-1.5px) rotate(1.5deg)}16%{transform:translateY(-.5px) rotate(-1.5deg)}18%{transform:translateY(.5px) rotate(-1.5deg)}20%{transform:translateY(-1.5px) rotate(2.5deg)}22%{transform:translateY(.5px) rotate(-1.5deg)}24%{transform:translateY(1.5px) rotate(1.5deg)}26%{transform:translateY(.5px) rotate(.5deg)}28%{transform:translateY(.5px) rotate(1.5deg)}30%{transform:translateY(-.5px) rotate(2.5deg)}32%{transform:translateY(1.5px) rotate(-.5deg)}34%{transform:translateY(1.5px) rotate(-.5deg)}36%{transform:translateY(-1.5px) rotate(2.5deg)}38%{transform:translateY(1.5px) rotate(-1.5deg)}40%{transform:translateY(-.5px) rotate(2.5deg)}42%{transform:translateY(2.5px) rotate(-1.5deg)}44%{transform:translateY(1.5px) rotate(.5deg)}46%{transform:translateY(-1.5px) rotate(2.5deg)}48%{transform:translateY(-.5px) rotate(.5deg)}50%{transform:translateY(.5px) rotate(.5deg)}52%{transform:translateY(2.5px) rotate(2.5deg)}54%{transform:translateY(-1.5px) rotate(1.5deg)}56%{transform:translateY(2.5px) rotate(2.5deg)}58%{transform:translateY(.5px) rotate(2.5deg)}60%{transform:translateY(2.5px) rotate(2.5deg)}62%{transform:translateY(-.5px) rotate(2.5deg)}64%{transform:translateY(-.5px) rotate(1.5deg)}66%{transform:translateY(1.5px) rotate(-.5deg)}68%{transform:translateY(-1.5px) rotate(-.5deg)}70%{transform:translateY(1.5px) rotate(.5deg)}72%{transform:translateY(2.5px) rotate(1.5deg)}74%{transform:translateY(-.5px) rotate(.5deg)}76%{transform:translateY(-.5px) rotate(2.5deg)}78%{transform:translateY(-.5px) rotate(1.5deg)}80%{transform:translateY(1.5px) rotate(1.5deg)}82%{transform:translateY(-.5px) rotate(.5deg)}84%{transform:translateY(1.5px) rotate(2.5deg)}86%{transform:translateY(-1.5px) rotate(-1.5deg)}88%{transform:translateY(-.5px) rotate(2.5deg)}90%{transform:translateY(2.5px) rotate(-.5deg)}92%{transform:translateY(.5px) rotate(-.5deg)}94%{transform:translateY(2.5px) rotate(.5deg)}96%{transform:translateY(-.5px) rotate(1.5deg)}98%{transform:translateY(-1.5px) rotate(-.5deg)}0%,to{transform:translate(0) rotate(0deg)}}.dplayer{position:relative;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;line-height:1}.dplayer *{box-sizing:content-box}.dplayer svg{width:100%;height:100%}.dplayer svg circle,.dplayer svg path{fill:#fff}.dplayer:-webkit-full-screen{width:100%;height:100%;background:#000;position:fixed;z-index:100000;left:0;top:0;margin:0;padding:0;transform:translate(0)}.dplayer:-webkit-full-screen .dplayer-danmaku .dplayer-danmaku-bottom.dplayer-danmaku-move,.dplayer:-webkit-full-screen .dplayer-danmaku .dplayer-danmaku-top.dplayer-danmaku-move{-webkit-animation:danmaku-center 6s linear;animation:danmaku-center 6s linear;-webkit-animation-play-state:inherit;animation-play-state:inherit}.dplayer:-webkit-full-screen .dplayer-danmaku .dplayer-danmaku-right.dplayer-danmaku-move{-webkit-animation:danmaku 8s linear;animation:danmaku 8s linear;-webkit-animation-play-state:inherit;animation-play-state:inherit}.dplayer.dplayer-live .dplayer-bar-wrap,.dplayer.dplayer-live.dplayer-no-danmaku .dplayer-setting,.dplayer.dplayer-live .dplayer-setting-loop,.dplayer.dplayer-live .dplayer-setting-speed,.dplayer.dplayer-live .dplayer-time,.dplayer.dplayer-no-danmaku .dplayer-controller .dplayer-icons .dplayer-comment,.dplayer.dplayer-no-danmaku .dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box .dplayer-setting-danmaku,.dplayer.dplayer-no-danmaku .dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box .dplayer-setting-danunlimit,.dplayer.dplayer-no-danmaku .dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box .dplayer-setting-showdan,.dplayer.dplayer-no-danmaku .dplayer-danmaku{display:none}.dplayer.dplayer-arrow .dplayer-danmaku{font-size:18px}.dplayer.dplayer-arrow .dplayer-icon{margin:0 -3px}.dplayer.dplayer-playing .dplayer-danmaku .dplayer-danmaku-move{-webkit-animation-play-state:running;animation-play-state:running}@media (min-width:900px){.dplayer.dplayer-playing .dplayer-controller,.dplayer.dplayer-playing .dplayer-controller-mask{opacity:0}.dplayer.dplayer-playing:hover .dplayer-controller,.dplayer.dplayer-playing:hover .dplayer-controller-mask{opacity:1}}.dplayer.dplayer-loading .dplayer-bezel .diplayer-loading-icon{display:block}.dplayer.dplayer-loading .dplayer-danmaku,.dplayer.dplayer-loading .dplayer-danmaku-move,.dplayer.dplayer-paused .dplayer-danmaku,.dplayer.dplayer-paused .dplayer-danmaku-move{-webkit-animation-play-state:paused;animation-play-state:paused}.dplayer.dplayer-hide-controller{cursor:none}.dplayer.dplayer-hide-controller .dplayer-controller,.dplayer.dplayer-hide-controller .dplayer-controller-mask{opacity:0;transform:translateY(100%)}.dplayer.dplayer-show-controller .dplayer-controller,.dplayer.dplayer-show-controller .dplayer-controller-mask{opacity:1}.dplayer.dplayer-fulled{position:fixed;z-index:100000;left:0;top:0;width:100%!important;height:100%!important}.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-airplay-icon,.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-camera-icon,.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-play-icon,.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-volume{display:none}.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-full .dplayer-full-in-icon{position:static;display:inline-block}.dplayer.dplayer-mobile .dplayer-bar-time,.dplayer.dplayer-mobile.dplayer-hide-controller .dplayer-mobile-play{display:none}.dplayer.dplayer-mobile .dplayer-mobile-play{display:block}.dplayer-web-fullscreen-fix{position:fixed;top:0;left:0;margin:0;padding:0}[data-balloon]:before{display:none}[data-balloon]:after{padding:.3em .7em;background:rgba(17,17,17,.7)}[data-balloon][data-balloon-pos=up]:after{margin-bottom:0}.dplayer-bezel{position:absolute;left:0;right:0;top:0;bottom:0;font-size:22px;color:#fff;pointer-events:none}.dplayer-bezel .dplayer-bezel-icon{position:absolute;top:50%;left:50%;margin:-26px 0 0 -26px;height:52px;width:52px;padding:12px;box-sizing:border-box;background:rgba(0,0,0,.5);border-radius:50%;opacity:0;pointer-events:none}.dplayer-bezel .dplayer-bezel-icon.dplayer-bezel-transition{-webkit-animation:bezel-hide .5s linear;animation:bezel-hide .5s linear}@-webkit-keyframes bezel-hide{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(2)}}@keyframes bezel-hide{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(2)}}.dplayer-bezel .dplayer-danloading{position:absolute;top:50%;margin-top:-7px;width:100%;text-align:center;font-size:14px;line-height:14px;-webkit-animation:my-face 5s ease-in-out infinite;animation:my-face 5s ease-in-out infinite}.dplayer-bezel .diplayer-loading-icon{display:none;position:absolute;top:50%;left:50%;margin:-18px 0 0 -18px;height:36px;width:36px;pointer-events:none}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-hide{display:none}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-dot{-webkit-animation:diplayer-loading-dot-fade .8s ease infinite;animation:diplayer-loading-dot-fade .8s ease infinite;opacity:0;transform-origin:4px 4px}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-dot.diplayer-loading-dot-7{-webkit-animation-delay:.7s;animation-delay:.7s}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-dot.diplayer-loading-dot-6{-webkit-animation-delay:.6s;animation-delay:.6s}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-dot.diplayer-loading-dot-5{-webkit-animation-delay:.5s;animation-delay:.5s}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-dot.diplayer-loading-dot-4{-webkit-animation-delay:.4s;animation-delay:.4s}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-dot.diplayer-loading-dot-3{-webkit-animation-delay:.3s;animation-delay:.3s}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-dot.diplayer-loading-dot-2{-webkit-animation-delay:.2s;animation-delay:.2s}.dplayer-bezel .diplayer-loading-icon .diplayer-loading-dot.diplayer-loading-dot-1{-webkit-animation-delay:.1s;animation-delay:.1s}@-webkit-keyframes diplayer-loading-dot-fade{0%{opacity:.7;transform:scale(1.2)}50%{opacity:.25;transform:scale(.9)}to{opacity:.25;transform:scale(.85)}}@keyframes diplayer-loading-dot-fade{0%{opacity:.7;transform:scale(1.2)}50%{opacity:.25;transform:scale(.9)}to{opacity:.25;transform:scale(.85)}}.dplayer-controller-mask{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAADGCAYAAAAT+OqFAAAAdklEQVQoz42QQQ7AIAgEF/T/D+kbq/RWAlnQyyazA4aoAB4FsBSA/bFjuF1EOL7VbrIrBuusmrt4ZZORfb6ehbWdnRHEIiITaEUKa5EJqUakRSaEYBJSCY2dEstQY7AuxahwXFrvZmWl2rh4JZ07z9dLtesfNj5q0FU3A5ObbwAAAABJRU5ErkJggg==) repeat-x bottom;height:98px;width:100%}.dplayer-controller,.dplayer-controller-mask{position:absolute;bottom:0;transition:all .3s ease}.dplayer-controller{left:0;right:0;height:41px;padding:0 20px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.dplayer-controller.dplayer-controller-comment .dplayer-icons{display:none}.dplayer-controller.dplayer-controller-comment .dplayer-icons.dplayer-comment-box{display:block}.dplayer-controller .dplayer-bar-wrap{padding:5px 0;cursor:pointer;position:absolute;bottom:33px;width:calc(100% - 40px);height:3px}.dplayer-controller .dplayer-bar-wrap:hover .dplayer-bar .dplayer-played .dplayer-thumb{transform:scale(1)}.dplayer-controller .dplayer-bar-wrap:hover .dplayer-highlight{display:block;width:8px;transform:translateX(-4px);top:4px;height:40%}.dplayer-controller .dplayer-bar-wrap .dplayer-highlight{z-index:12;position:absolute;top:5px;width:6px;height:20%;border-radius:6px;background-color:#fff;text-align:center;transform:translateX(-3px);transition:all .2s ease-in-out}.dplayer-controller .dplayer-bar-wrap .dplayer-highlight:hover .dplayer-highlight-text{display:block}.dplayer-controller .dplayer-bar-wrap .dplayer-highlight:hover~.dplayer-bar-preview,.dplayer-controller .dplayer-bar-wrap .dplayer-highlight:hover~.dplayer-bar-time{opacity:0}.dplayer-controller .dplayer-bar-wrap .dplayer-highlight .dplayer-highlight-text{display:none;position:absolute;left:50%;top:-24px;padding:5px 8px;background-color:rgba(0,0,0,.62);color:#fff;border-radius:4px;font-size:12px;white-space:nowrap;transform:translateX(-50%)}.dplayer-controller .dplayer-bar-wrap .dplayer-bar-preview{position:absolute;background:#fff;pointer-events:none;display:none;background-size:16000px 100%}.dplayer-controller .dplayer-bar-wrap .dplayer-bar-preview-canvas{position:absolute;width:100%;height:100%;z-index:1;pointer-events:none}.dplayer-controller .dplayer-bar-wrap .dplayer-bar-time{position:absolute;left:0;top:-20px;border-radius:4px;padding:5px 7px;background-color:rgba(0,0,0,.62);color:#fff;font-size:12px;text-align:center;opacity:1;transition:opacity .1s ease-in-out;word-wrap:normal;word-break:normal;z-index:2;pointer-events:none}.dplayer-controller .dplayer-bar-wrap .dplayer-bar-time.hidden{opacity:0}.dplayer-controller .dplayer-bar-wrap .dplayer-bar{position:relative;height:3px;width:100%;background:hsla(0,0%,100%,.2);cursor:pointer}.dplayer-controller .dplayer-bar-wrap .dplayer-bar .dplayer-loaded{background:hsla(0,0%,100%,.4);transition:all .5s ease}.dplayer-controller .dplayer-bar-wrap .dplayer-bar .dplayer-loaded,.dplayer-controller .dplayer-bar-wrap .dplayer-bar .dplayer-played{position:absolute;left:0;top:0;bottom:0;height:3px;will-change:width}.dplayer-controller .dplayer-bar-wrap .dplayer-bar .dplayer-played .dplayer-thumb{position:absolute;top:0;right:5px;margin-top:-4px;margin-right:-10px;height:11px;width:11px;border-radius:50%;cursor:pointer;transition:all .3s ease-in-out;transform:scale(0)}.dplayer-controller .dplayer-icons{height:38px;position:absolute;bottom:0}.dplayer-controller .dplayer-icons.dplayer-comment-box{display:none;position:absolute;transition:all .3s ease-in-out;z-index:2;height:38px;bottom:0;left:20px;right:20px;color:#fff}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-icon{padding:7px}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-icon{position:absolute;left:0;top:0}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-send-icon{position:absolute;right:0;top:0}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box{position:absolute;background:rgba(28,28,28,.9);bottom:41px;left:0;box-shadow:0 0 25px rgba(0,0,0,.3);border-radius:4px;padding:10px 10px 16px;font-size:14px;width:204px;transition:all .3s ease-in-out;transform:scale(0)}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box.dplayer-comment-setting-open{transform:scale(1)}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box input[type=radio]{display:none}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box label{cursor:pointer}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-title{font-size:13px;color:#fff;line-height:30px}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-type{font-size:0}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-type .dplayer-comment-setting-title{margin-bottom:6px}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-type label:nth-child(2) span{border-radius:4px 0 0 4px}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-type label:nth-child(4) span{border-radius:0 4px 4px 0}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-type span{width:33%;padding:4px 6px;line-height:16px;display:inline-block;font-size:12px;color:#fff;border:1px solid #fff;margin-right:-1px;box-sizing:border-box;text-align:center;cursor:pointer}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-type input:checked+span{background:#e4e4e6;color:#1c1c1c}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-color{font-size:0}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-color label{font-size:0;padding:6px;display:inline-block}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-color span{width:22px;height:22px;display:inline-block;border-radius:50%;box-sizing:border-box;cursor:pointer}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-color span:hover{-webkit-animation:my-face 5s ease-in-out infinite;animation:my-face 5s ease-in-out infinite}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input{outline:none;border:none;padding:8px 31px;font-size:14px;line-height:18px;text-align:center;border-radius:4px;background:none;margin:0;height:100%;box-sizing:border-box;width:100%;color:#fff}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input::-webkit-input-placeholder{color:#fff;opacity:.8}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input::-moz-placeholder{color:#fff;opacity:.8}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input:-ms-input-placeholder{color:#fff;opacity:.8}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input::-ms-input-placeholder{color:#fff;opacity:.8}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input::placeholder{color:#fff;opacity:.8}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input::-ms-clear{display:none}.dplayer-controller .dplayer-icons.dplayer-icons-left .dplayer-icon{padding:7px}.dplayer-controller .dplayer-icons.dplayer-icons-right{right:20px}.dplayer-controller .dplayer-icons.dplayer-icons-right .dplayer-icon{padding:8px}.dplayer-controller .dplayer-icons .dplayer-live-badge,.dplayer-controller .dplayer-icons .dplayer-time{line-height:38px;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);vertical-align:middle;font-size:13px;cursor:default}.dplayer-controller .dplayer-icons .dplayer-live-dot{display:inline-block;width:6px;height:6px;vertical-align:4%;margin-right:5px;content:"";border-radius:6px}.dplayer-controller .dplayer-icons .dplayer-icon{width:40px;height:100%;border:none;background-color:transparent;outline:none;cursor:pointer;vertical-align:middle;box-sizing:border-box;display:inline-block}.dplayer-controller .dplayer-icons .dplayer-icon .dplayer-icon-content{transition:all .2s ease-in-out;opacity:.8}.dplayer-controller .dplayer-icons .dplayer-icon:hover .dplayer-icon-content{opacity:1}.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-quality-icon{color:#fff;width:auto;line-height:22px;font-size:14px}.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-comment-icon{padding:10px 9px 9px}.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-setting-icon{padding-top:8.5px}.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-volume-icon{width:43px}.dplayer-controller .dplayer-icons .dplayer-volume{position:relative;display:inline-block;cursor:pointer;height:100%}.dplayer-controller .dplayer-icons .dplayer-volume:hover .dplayer-volume-bar-wrap .dplayer-volume-bar{width:45px}.dplayer-controller .dplayer-icons .dplayer-volume:hover .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner .dplayer-thumb{transform:scale(1)}.dplayer-controller .dplayer-icons .dplayer-volume.dplayer-volume-active .dplayer-volume-bar-wrap .dplayer-volume-bar{width:45px}.dplayer-controller .dplayer-icons .dplayer-volume.dplayer-volume-active .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner .dplayer-thumb{transform:scale(1)}.dplayer-controller .dplayer-icons .dplayer-volume .dplayer-volume-bar-wrap{display:inline-block;margin:0 10px 0 -5px;vertical-align:middle;height:100%}.dplayer-controller .dplayer-icons .dplayer-volume .dplayer-volume-bar-wrap .dplayer-volume-bar{position:relative;top:17px;width:0;height:3px;background:#aaa;transition:all .3s ease-in-out}.dplayer-controller .dplayer-icons .dplayer-volume .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner{position:absolute;bottom:0;left:0;height:100%;transition:all .1s ease;will-change:width}.dplayer-controller .dplayer-icons .dplayer-volume .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner .dplayer-thumb{position:absolute;top:0;right:5px;margin-top:-4px;margin-right:-10px;height:11px;width:11px;border-radius:50%;cursor:pointer;transition:all .3s ease-in-out;transform:scale(0)}.dplayer-controller .dplayer-icons .dplayer-setting,.dplayer-controller .dplayer-icons .dplayer-subtitle-btn{display:inline-block;height:100%}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box{position:absolute;right:0;bottom:50px;transform:scale(0);width:150px;border-radius:2px;background:rgba(28,28,28,.9);padding:7px 0;transition:all .3s ease-in-out;overflow:hidden;z-index:2}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box>div{display:none}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box>div.dplayer-setting-origin-panel{display:block}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box.dplayer-setting-box-open{transform:scale(1)}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box.dplayer-setting-box-narrow{width:70px;text-align:center}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box.dplayer-setting-box-speed .dplayer-setting-origin-panel{display:none}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-box.dplayer-setting-box-speed .dplayer-setting-speed-panel{display:block}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-item,.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-speed-item{height:30px;padding:5px 10px;box-sizing:border-box;cursor:pointer;position:relative}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-item:hover,.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-speed-item:hover{background-color:hsla(0,0%,100%,.1)}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku{padding:5px 0}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku .dplayer-label{padding:0 10px;display:inline}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku:hover .dplayer-label{display:none}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku:hover .dplayer-danmaku-bar-wrap{display:inline-block}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku.dplayer-setting-danmaku-active .dplayer-label{display:none}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku.dplayer-setting-danmaku-active .dplayer-danmaku-bar-wrap{display:inline-block}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku .dplayer-danmaku-bar-wrap{padding:0 10px;box-sizing:border-box;display:none;vertical-align:middle;height:100%;width:100%}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku .dplayer-danmaku-bar-wrap .dplayer-danmaku-bar{position:relative;top:8.5px;width:100%;height:3px;background:#fff;transition:all .3s ease-in-out}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku .dplayer-danmaku-bar-wrap .dplayer-danmaku-bar .dplayer-danmaku-bar-inner{position:absolute;bottom:0;left:0;height:100%;transition:all .1s ease;background:#aaa;will-change:width}.dplayer-controller .dplayer-icons .dplayer-setting .dplayer-setting-danmaku .dplayer-danmaku-bar-wrap .dplayer-danmaku-bar .dplayer-danmaku-bar-inner .dplayer-thumb{position:absolute;top:0;right:5px;margin-top:-4px;margin-right:-10px;height:11px;width:11px;border-radius:50%;cursor:pointer;transition:all .3s ease-in-out;background:#aaa}.dplayer-controller .dplayer-icons .dplayer-full{display:inline-block;height:100%;position:relative}.dplayer-controller .dplayer-icons .dplayer-full:hover .dplayer-full-in-icon{display:block}.dplayer-controller .dplayer-icons .dplayer-full .dplayer-full-in-icon{position:absolute;top:-30px;z-index:1;display:none}.dplayer-controller .dplayer-icons .dplayer-quality{position:relative;display:inline-block;height:100%;z-index:2}.dplayer-controller .dplayer-icons .dplayer-quality:hover .dplayer-quality-list,.dplayer-controller .dplayer-icons .dplayer-quality:hover .dplayer-quality-mask{display:block}.dplayer-controller .dplayer-icons .dplayer-quality .dplayer-quality-mask{display:none;position:absolute;bottom:38px;left:-18px;width:80px;padding-bottom:12px}.dplayer-controller .dplayer-icons .dplayer-quality .dplayer-quality-list{display:none;font-size:12px;width:80px;border-radius:2px;background:rgba(28,28,28,.9);padding:5px 0;transition:all .3s ease-in-out;overflow:hidden;color:#fff;text-align:center}.dplayer-controller .dplayer-icons .dplayer-quality .dplayer-quality-item{height:25px;box-sizing:border-box;cursor:pointer;line-height:25px}.dplayer-controller .dplayer-icons .dplayer-quality .dplayer-quality-item:hover{background-color:hsla(0,0%,100%,.1)}.dplayer-controller .dplayer-icons .dplayer-comment{display:inline-block;height:100%}.dplayer-controller .dplayer-icons .dplayer-label{color:#eee;font-size:13px;display:inline-block;vertical-align:middle;white-space:nowrap}.dplayer-controller .dplayer-icons .dplayer-toggle{width:32px;height:20px;text-align:center;font-size:0;vertical-align:middle;position:absolute;top:5px;right:10px}.dplayer-controller .dplayer-icons .dplayer-toggle input{max-height:0;max-width:0;display:none}.dplayer-controller .dplayer-icons .dplayer-toggle input+label{display:inline-block;position:relative;box-shadow:inset 0 0 0 0 #dfdfdf;border:1px solid #dfdfdf;height:20px;width:32px;border-radius:10px;box-sizing:border-box;cursor:pointer;transition:.2s ease-in-out}.dplayer-controller .dplayer-icons .dplayer-toggle input+label:after,.dplayer-controller .dplayer-icons .dplayer-toggle input+label:before{content:"";position:absolute;display:block;height:18px;width:18px;top:0;left:0;border-radius:15px;transition:.2s ease-in-out}.dplayer-controller .dplayer-icons .dplayer-toggle input+label:after{background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.4)}.dplayer-controller .dplayer-icons .dplayer-toggle input:checked+label{border-color:hsla(0,0%,100%,.5)}.dplayer-controller .dplayer-icons .dplayer-toggle input:checked+label:before{width:30px;background:hsla(0,0%,100%,.5)}.dplayer-controller .dplayer-icons .dplayer-toggle input:checked+label:after{left:12px}.dplayer-mobile-play{display:none;width:50px;height:50px;border:none;background-color:transparent;outline:none;cursor:pointer;box-sizing:border-box;bottom:0;opacity:.8;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}.dplayer-danmaku{position:absolute;left:0;right:0;top:0;bottom:0;font-size:22px;color:#fff}.dplayer-danmaku .dplayer-danmaku-item{display:inline-block;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;white-space:nowrap;text-shadow:.5px .5px .5px rgba(0,0,0,.5)}.dplayer-danmaku .dplayer-danmaku-item--demo{position:absolute;visibility:hidden}.dplayer-danmaku .dplayer-danmaku-right{position:absolute;right:0;transform:translateX(100%)}.dplayer-danmaku .dplayer-danmaku-right.dplayer-danmaku-move{will-change:transform;-webkit-animation:danmaku 5s linear;animation:danmaku 5s linear;-webkit-animation-play-state:paused;animation-play-state:paused}@-webkit-keyframes danmaku{0%{transform:translateX(100%)}}@keyframes danmaku{0%{transform:translateX(100%)}}.dplayer-danmaku .dplayer-danmaku-bottom,.dplayer-danmaku .dplayer-danmaku-top{position:absolute;width:100%;text-align:center;visibility:hidden}.dplayer-danmaku .dplayer-danmaku-bottom.dplayer-danmaku-move,.dplayer-danmaku .dplayer-danmaku-top.dplayer-danmaku-move{will-change:visibility;-webkit-animation:danmaku-center 4s linear;animation:danmaku-center 4s linear;-webkit-animation-play-state:paused;animation-play-state:paused}@-webkit-keyframes danmaku-center{0%{visibility:visible}to{visibility:visible}}@keyframes danmaku-center{0%{visibility:visible}to{visibility:visible}}.dplayer-logo{pointer-events:none;position:absolute;left:20px;top:20px;max-width:50px;max-height:50px}.dplayer-logo img{max-width:100%;max-height:100%;background:none}.dplayer-menu{position:absolute;width:170px;border-radius:2px;background:rgba(28,28,28,.85);padding:5px 0;overflow:hidden;z-index:3;display:none}.dplayer-menu.dplayer-menu-show{display:block}.dplayer-menu .dplayer-menu-item{height:30px;box-sizing:border-box;cursor:pointer}.dplayer-menu .dplayer-menu-item:hover{background-color:hsla(0,0%,100%,.1)}.dplayer-menu .dplayer-menu-item a{padding:0 10px;line-height:30px;color:#eee;font-size:13px;display:inline-block;vertical-align:middle;width:100%;box-sizing:border-box;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.dplayer-menu .dplayer-menu-item a:hover{text-decoration:none}.dplayer-notice{opacity:0;position:absolute;bottom:60px;left:20px;font-size:14px;border-radius:2px;background:rgba(28,28,28,.9);padding:7px 20px;transition:all .3s ease-in-out;overflow:hidden;color:#fff;pointer-events:none}.dplayer-subtitle{position:absolute;bottom:40px;width:90%;left:5%;text-align:center;color:#fff;text-shadow:.5px .5px .5px rgba(0,0,0,.5);font-size:20px}.dplayer-subtitle.dplayer-subtitle-hide{display:none}.dplayer-mask{position:absolute;top:0;bottom:0;left:0;right:0;z-index:1;display:none}.dplayer-mask.dplayer-mask-show{display:block}.dplayer-video-wrap{position:relative;background:#000;font-size:0;width:100%;height:100%}.dplayer-video-wrap .dplayer-video{width:100%;height:100%;display:none}.dplayer-video-wrap .dplayer-video-current{display:block}.dplayer-video-wrap .dplayer-video-prepare{display:none}.dplayer-info-panel{position:absolute;top:10px;left:10px;width:400px;background:rgba(28,28,28,.8);padding:10px;color:#fff;font-size:12px;border-radius:2px}.dplayer-info-panel-hide{display:none}.dplayer-info-panel .dplayer-info-panel-close{cursor:pointer;position:absolute;right:10px;top:10px}.dplayer-info-panel .dplayer-info-panel-item>span{display:inline-block;vertical-align:middle;line-height:15px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.dplayer-info-panel .dplayer-info-panel-item-title{width:100px;text-align:right;margin-right:10px}.dplayer-info-panel .dplayer-info-panel-item-data{width:260px}',""]),N.exports=P},function(N,P,h){(P=h(3)(!1)).push([N.i,':root{--balloon-border-radius:2px;--balloon-color:rgba(16,16,16,0.95);--balloon-text-color:#fff;--balloon-font-size:12px;--balloon-move:4px}button[aria-label][data-balloon-pos]{overflow:visible}[aria-label][data-balloon-pos]{position:relative;cursor:pointer}[aria-label][data-balloon-pos]:after{text-indent:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-weight:400;font-style:normal;text-shadow:none;font-size:var(--balloon-font-size);background:var(--balloon-color);border-radius:2px;color:var(--balloon-text-color);border-radius:var(--balloon-border-radius);content:attr(aria-label);padding:.5em 1em;white-space:nowrap}[aria-label][data-balloon-pos]:after,[aria-label][data-balloon-pos]:before{opacity:0;pointer-events:none;transition:all .18s ease-out .18s;position:absolute;z-index:10}[aria-label][data-balloon-pos]:before{width:0;height:0;border:5px solid transparent;border-top:5px solid var(--balloon-color);content:""}[aria-label][data-balloon-pos]:hover:after,[aria-label][data-balloon-pos]:hover:before,[aria-label][data-balloon-pos]:not([data-balloon-nofocus]):focus:after,[aria-label][data-balloon-pos]:not([data-balloon-nofocus]):focus:before,[aria-label][data-balloon-pos][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-visible]:before{opacity:1;pointer-events:none}[aria-label][data-balloon-pos].font-awesome:after{font-family:FontAwesome,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}[aria-label][data-balloon-pos][data-balloon-break]:after{white-space:pre}[aria-label][data-balloon-pos][data-balloon-break][data-balloon-length]:after{white-space:pre-line;word-break:break-word}[aria-label][data-balloon-pos][data-balloon-blunt]:after,[aria-label][data-balloon-pos][data-balloon-blunt]:before{transition:none}[aria-label][data-balloon-pos][data-balloon-pos=up]:after{margin-bottom:10px}[aria-label][data-balloon-pos][data-balloon-pos=up]:after,[aria-label][data-balloon-pos][data-balloon-pos=up]:before{bottom:100%;left:50%;transform:translate(-50%,var(--balloon-move));transform-origin:top}[aria-label][data-balloon-pos][data-balloon-pos=up]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=up]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=up][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=up][data-balloon-visible]:before{transform:translate(-50%)}[aria-label][data-balloon-pos][data-balloon-pos=up-left]:after{bottom:100%;left:0;margin-bottom:10px;transform:translateY(var(--balloon-move));transform-origin:top}[aria-label][data-balloon-pos][data-balloon-pos=up-left]:before{bottom:100%;left:5px;transform:translateY(var(--balloon-move));transform-origin:top}[aria-label][data-balloon-pos][data-balloon-pos=up-left]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=up-left]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=up-left][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=up-left][data-balloon-visible]:before{transform:translate(0)}[aria-label][data-balloon-pos][data-balloon-pos=up-right]:after{bottom:100%;right:0;margin-bottom:10px;transform:translateY(var(--balloon-move));transform-origin:top}[aria-label][data-balloon-pos][data-balloon-pos=up-right]:before{bottom:100%;right:5px;transform:translateY(var(--balloon-move));transform-origin:top}[aria-label][data-balloon-pos][data-balloon-pos=up-right]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=up-right]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=up-right][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=up-right][data-balloon-visible]:before{transform:translate(0)}[aria-label][data-balloon-pos][data-balloon-pos=down]:after{left:50%;margin-top:10px;top:100%;transform:translate(-50%,calc(var(--balloon-move)*-1))}[aria-label][data-balloon-pos][data-balloon-pos=down]:before{width:0;height:0;border:5px solid transparent;border-bottom:5px solid var(--balloon-color);left:50%;top:100%;transform:translate(-50%,calc(var(--balloon-move)*-1))}[aria-label][data-balloon-pos][data-balloon-pos=down]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=down]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=down][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=down][data-balloon-visible]:before{transform:translate(-50%)}[aria-label][data-balloon-pos][data-balloon-pos=down-left]:after{left:0;margin-top:10px;top:100%;transform:translateY(calc(var(--balloon-move)*-1))}[aria-label][data-balloon-pos][data-balloon-pos=down-left]:before{width:0;height:0;border:5px solid transparent;border-bottom:5px solid var(--balloon-color);left:5px;top:100%;transform:translateY(calc(var(--balloon-move)*-1))}[aria-label][data-balloon-pos][data-balloon-pos=down-left]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=down-left]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=down-left][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=down-left][data-balloon-visible]:before{transform:translate(0)}[aria-label][data-balloon-pos][data-balloon-pos=down-right]:after{right:0;margin-top:10px;top:100%;transform:translateY(calc(var(--balloon-move)*-1))}[aria-label][data-balloon-pos][data-balloon-pos=down-right]:before{width:0;height:0;border:5px solid transparent;border-bottom:5px solid var(--balloon-color);right:5px;top:100%;transform:translateY(calc(var(--balloon-move)*-1))}[aria-label][data-balloon-pos][data-balloon-pos=down-right]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=down-right]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=down-right][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=down-right][data-balloon-visible]:before{transform:translate(0)}[aria-label][data-balloon-pos][data-balloon-pos=left]:after{margin-right:10px;right:100%;top:50%;transform:translate(var(--balloon-move),-50%)}[aria-label][data-balloon-pos][data-balloon-pos=left]:before{width:0;height:0;border:5px solid transparent;border-left:5px solid var(--balloon-color);right:100%;top:50%;transform:translate(var(--balloon-move),-50%)}[aria-label][data-balloon-pos][data-balloon-pos=left]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=left]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=left][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=left][data-balloon-visible]:before{transform:translateY(-50%)}[aria-label][data-balloon-pos][data-balloon-pos=right]:after{left:100%;margin-left:10px;top:50%;transform:translate(calc(var(--balloon-move)*-1),-50%)}[aria-label][data-balloon-pos][data-balloon-pos=right]:before{width:0;height:0;border:5px solid transparent;border-right:5px solid var(--balloon-color);left:100%;top:50%;transform:translate(calc(var(--balloon-move)*-1),-50%)}[aria-label][data-balloon-pos][data-balloon-pos=right]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=right]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=right][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=right][data-balloon-visible]:before{transform:translateY(-50%)}[aria-label][data-balloon-pos][data-balloon-length=small]:after{white-space:normal;width:80px}[aria-label][data-balloon-pos][data-balloon-length=medium]:after{white-space:normal;width:150px}[aria-label][data-balloon-pos][data-balloon-length=large]:after{white-space:normal;width:260px}[aria-label][data-balloon-pos][data-balloon-length=xlarge]:after{white-space:normal;width:380px}@media screen and (max-width:768px){[aria-label][data-balloon-pos][data-balloon-length=xlarge]:after{white-space:normal;width:90vw}}[aria-label][data-balloon-pos][data-balloon-length=fit]:after{white-space:normal;width:100%}',""]),N.exports=P},function(N,P,h){var O=Function.prototype.apply;function T(i,C){this._id=i,this._clearFn=C}P.setTimeout=function(){return new T(O.call(setTimeout,window,arguments),clearTimeout)},P.setInterval=function(){return new T(O.call(setInterval,window,arguments),clearInterval)},P.clearTimeout=P.clearInterval=function(i){i&&i.close()},T.prototype.unref=T.prototype.ref=function(){},T.prototype.close=function(){this._clearFn.call(window,this._id)},P.enroll=function(i,C){clearTimeout(i._idleTimeoutId),i._idleTimeout=C},P.unenroll=function(i){clearTimeout(i._idleTimeoutId),i._idleTimeout=-1},P._unrefActive=P.active=function(i){clearTimeout(i._idleTimeoutId);var C=i._idleTimeout;C>=0&&(i._idleTimeoutId=setTimeout(function(){i._onTimeout&&i._onTimeout()},C))},h(40),P.setImmediate=setImmediate,P.clearImmediate=clearImmediate},function(N,P,h){(function(O,T){(function(i,C){if(!i.setImmediate){var R,A,g,c,m,y=1,S={},b=!1,p=i.document,n=Object.getPrototypeOf&&Object.getPrototypeOf(i);n=n&&n.setTimeout?n:i,{}.toString.call(i.process)==="[object process]"?R=function(t){T.nextTick(function(){r(t)})}:function(){if(i.postMessage&&!i.importScripts){var t=!0,l=i.onmessage;return i.onmessage=function(){t=!1},i.postMessage("","*"),i.onmessage=l,t}}()?(c="setImmediate$"+Math.random()+"$",m=function(t){t.source===i&&typeof t.data=="string"&&t.data.indexOf(c)===0&&r(+t.data.slice(c.length))},i.addEventListener?i.addEventListener("message",m,!1):i.attachEvent("onmessage",m),R=function(t){i.postMessage(c+t,"*")}):i.MessageChannel?((g=new MessageChannel).port1.onmessage=function(t){r(t.data)},R=function(t){g.port2.postMessage(t)}):p&&"onreadystatechange"in p.createElement("script")?(A=p.documentElement,R=function(t){var l=p.createElement("script");l.onreadystatechange=function(){r(t),l.onreadystatechange=null,A.removeChild(l),l=null},A.appendChild(l)}):R=function(t){setTimeout(r,0,t)},n.setImmediate=function(t){typeof t!="function"&&(t=new Function(""+t));for(var l=new Array(arguments.length-1),s=0;s<l.length;s++)l[s]=arguments[s+1];var a={callback:t,args:l};return S[y]=a,R(y),y++},n.clearImmediate=e}function e(t){delete S[t]}function r(t){if(b)setTimeout(r,0,t);else{var l=S[t];if(l){b=!0;try{(function(s){var a=s.callback,o=s.args;switch(o.length){case 0:a();break;case 1:a(o[0]);break;case 2:a(o[0],o[1]);break;case 3:a(o[0],o[1],o[2]);break;default:a.apply(C,o)}})(l)}finally{e(t),b=!1}}}}})(typeof self=="undefined"?O===void 0?this:O:self)}).call(this,h(4),h(5))},function(N,P,h){var O=h(0),T=h(6),i=h(42),C=h(12);function R(g){var c=new i(g),m=T(i.prototype.request,c);return O.extend(m,i.prototype,c),O.extend(m,c),m}var A=R(h(9));A.Axios=i,A.create=function(g){return R(C(A.defaults,g))},A.Cancel=h(13),A.CancelToken=h(55),A.isCancel=h(8),A.all=function(g){return Promise.all(g)},A.spread=h(56),N.exports=A,N.exports.default=A},function(N,P,h){var O=h(0),T=h(7),i=h(43),C=h(44),R=h(12);function A(g){this.defaults=g,this.interceptors={request:new i,response:new i}}A.prototype.request=function(g){typeof g=="string"?(g=arguments[1]||{}).url=arguments[0]:g=g||{},(g=R(this.defaults,g)).method?g.method=g.method.toLowerCase():this.defaults.method?g.method=this.defaults.method.toLowerCase():g.method="get";var c=[C,void 0],m=Promise.resolve(g);for(this.interceptors.request.forEach(function(y){c.unshift(y.fulfilled,y.rejected)}),this.interceptors.response.forEach(function(y){c.push(y.fulfilled,y.rejected)});c.length;)m=m.then(c.shift(),c.shift());return m},A.prototype.getUri=function(g){return g=R(this.defaults,g),T(g.url,g.params,g.paramsSerializer).replace(/^\?/,"")},O.forEach(["delete","get","head","options"],function(g){A.prototype[g]=function(c,m){return this.request(O.merge(m||{},{method:g,url:c}))}}),O.forEach(["post","put","patch"],function(g){A.prototype[g]=function(c,m,y){return this.request(O.merge(y||{},{method:g,url:c,data:m}))}}),N.exports=A},function(N,P,h){var O=h(0);function T(){this.handlers=[]}T.prototype.use=function(i,C){return this.handlers.push({fulfilled:i,rejected:C}),this.handlers.length-1},T.prototype.eject=function(i){this.handlers[i]&&(this.handlers[i]=null)},T.prototype.forEach=function(i){O.forEach(this.handlers,function(C){C!==null&&i(C)})},N.exports=T},function(N,P,h){var O=h(0),T=h(45),i=h(8),C=h(9);function R(A){A.cancelToken&&A.cancelToken.throwIfRequested()}N.exports=function(A){return R(A),A.headers=A.headers||{},A.data=T(A.data,A.headers,A.transformRequest),A.headers=O.merge(A.headers.common||{},A.headers[A.method]||{},A.headers),O.forEach(["delete","get","head","post","put","patch","common"],function(g){delete A.headers[g]}),(A.adapter||C.adapter)(A).then(function(g){return R(A),g.data=T(g.data,g.headers,A.transformResponse),g},function(g){return i(g)||(R(A),g&&g.response&&(g.response.data=T(g.response.data,g.response.headers,A.transformResponse))),Promise.reject(g)})}},function(N,P,h){var O=h(0);N.exports=function(T,i,C){return O.forEach(C,function(R){T=R(T,i)}),T}},function(N,P,h){var O=h(0);N.exports=function(T,i){O.forEach(T,function(C,R){R!==i&&R.toUpperCase()===i.toUpperCase()&&(T[i]=C,delete T[R])})}},function(N,P,h){var O=h(11);N.exports=function(T,i,C){var R=C.config.validateStatus;!R||R(C.status)?T(C):i(O("Request failed with status code "+C.status,C.config,null,C.request,C))}},function(N,P,h){N.exports=function(O,T,i,C,R){return O.config=T,i&&(O.code=i),O.request=C,O.response=R,O.isAxiosError=!0,O.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},O}},function(N,P,h){var O=h(50),T=h(51);N.exports=function(i,C){return i&&!O(C)?T(i,C):C}},function(N,P,h){N.exports=function(O){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(O)}},function(N,P,h){N.exports=function(O,T){return T?O.replace(/\/+$/,"")+"/"+T.replace(/^\/+/,""):O}},function(N,P,h){var O=h(0),T=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];N.exports=function(i){var C,R,A,g={};return i&&O.forEach(i.split(`
`),function(c){if(A=c.indexOf(":"),C=O.trim(c.substr(0,A)).toLowerCase(),R=O.trim(c.substr(A+1)),C){if(g[C]&&T.indexOf(C)>=0)return;g[C]=C==="set-cookie"?(g[C]?g[C]:[]).concat([R]):g[C]?g[C]+", "+R:R}}),g}},function(N,P,h){var O=h(0);N.exports=O.isStandardBrowserEnv()?function(){var T,i=/(msie|trident)/i.test(navigator.userAgent),C=document.createElement("a");function R(A){var g=A;return i&&(C.setAttribute("href",g),g=C.href),C.setAttribute("href",g),{href:C.href,protocol:C.protocol?C.protocol.replace(/:$/,""):"",host:C.host,search:C.search?C.search.replace(/^\?/,""):"",hash:C.hash?C.hash.replace(/^#/,""):"",hostname:C.hostname,port:C.port,pathname:C.pathname.charAt(0)==="/"?C.pathname:"/"+C.pathname}}return T=R(window.location.href),function(A){var g=O.isString(A)?R(A):A;return g.protocol===T.protocol&&g.host===T.host}}():function(){return!0}},function(N,P,h){var O=h(0);N.exports=O.isStandardBrowserEnv()?{write:function(T,i,C,R,A,g){var c=[];c.push(T+"="+encodeURIComponent(i)),O.isNumber(C)&&c.push("expires="+new Date(C).toGMTString()),O.isString(R)&&c.push("path="+R),O.isString(A)&&c.push("domain="+A),g===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(T){var i=document.cookie.match(new RegExp("(^|;\\s*)("+T+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(T){this.write(T,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(N,P,h){var O=h(13);function T(i){if(typeof i!="function")throw new TypeError("executor must be a function.");var C;this.promise=new Promise(function(A){C=A});var R=this;i(function(A){R.reason||(R.reason=new O(A),C(R.reason))})}T.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},T.source=function(){var i;return{token:new T(function(C){i=C}),cancel:i}},N.exports=T},function(N,P,h){N.exports=function(O){return function(T){return O.apply(null,T)}}},function(N,P,h){(function(O){var T=typeof self!="undefined"?self:typeof window!="undefined"?window:O!==void 0?O:{},i=Object.create(T),C=/["&'<>]/;i.$escape=function(R){return function(A){var g=""+A,c=C.exec(g);if(!c)return A;var m="",y=void 0,S=void 0,b=void 0;for(y=c.index,S=0;y<g.length;y++){switch(g.charCodeAt(y)){case 34:b="&#34;";break;case 38:b="&#38;";break;case 39:b="&#39;";break;case 60:b="&#60;";break;case 62:b="&#62;";break;default:continue}S!==y&&(m+=g.substring(S,y)),S=y+1,m+=b}return S!==y?m+g.substring(S,y):m}(function A(g){return typeof g!="string"&&(g=g==null?"":typeof g=="function"?A(g.call(g)):JSON.stringify(g)),g}(R))},i.$each=function(R,A){if(Array.isArray(R))for(var g=0,c=R.length;g<c;g++)A(R[g],g);else for(var m in R)A(R[m],m)},N.exports=i}).call(this,h(4))},function(N,P,h){h.r(P),h(35);var O=h(15),T=/mobile/i.test(window.navigator.userAgent),i={secondToTime:function(K){if((K=K||0)===0||K===1/0||K.toString()==="NaN")return"00:00";var G=Math.floor(K/3600),j=Math.floor((K-3600*G)/60),M=Math.floor(K-3600*G-60*j);return(G>0?[G,j,M]:[j,M]).map(function(B){return B<10?"0"+B:""+B}).join(":")},getElementViewLeft:function(K){var G=K.offsetLeft,j=K.offsetParent,M=document.body.scrollLeft+document.documentElement.scrollLeft;if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)for(;j!==null&&j!==K;)G+=j.offsetLeft,j=j.offsetParent;else for(;j!==null;)G+=j.offsetLeft,j=j.offsetParent;return G-M},getBoundingClientRectViewLeft:function(K){var G=window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0);if(K.getBoundingClientRect){if(typeof this.getBoundingClientRectViewLeft.offset!="number"){var j=document.createElement("div");j.style.cssText="position:absolute;top:0;left:0;",document.body.appendChild(j),this.getBoundingClientRectViewLeft.offset=-j.getBoundingClientRect().top-G,document.body.removeChild(j),j=null}var M=K.getBoundingClientRect(),B=this.getBoundingClientRectViewLeft.offset;return M.left+B}return this.getElementViewLeft(K)},getScrollPosition:function(){return{left:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,top:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}},setScrollPosition:function(K){var G=K.left,j=G===void 0?0:G,M=K.top,B=M===void 0?0:M;this.isFirefox?(document.documentElement.scrollLeft=j,document.documentElement.scrollTop=B):window.scrollTo(j,B)},isMobile:T,isSafari:/Safari/i.test(window.navigator.userAgent),isFirefox:/firefox/i.test(window.navigator.userAgent),isChrome:/chrome/i.test(window.navigator.userAgent),storage:{set:function(K,G){localStorage.setItem(K,G)},get:function(K){return localStorage.getItem(K)}},nameMap:{dragStart:T?"touchstart":"mousedown",dragMove:T?"touchmove":"mousemove",dragEnd:T?"touchend":"mouseup"},color2Number:function(K){return K[0]==="#"&&(K=K.substr(1)),K.length===3&&(K="".concat(K[0]).concat(K[0]).concat(K[1]).concat(K[1]).concat(K[2]).concat(K[2])),parseInt(K,16)+0&16777215},number2Color:function(K){return"#"+("00000"+K.toString(16)).slice(-6)},number2Type:function(K){switch(K){case 0:return"right";case 1:return"top";case 2:return"bottom";default:return"right"}}},C=h(2),R=h.n(C),A={send:function(K){R.a.post(K.url,K.data).then(function(G){var j=G.data;j&&j.code===0?K.success&&K.success(j):K.error&&K.error(j&&j.msg)}).catch(function(G){console.error(G),K.error&&K.error()})},read:function(K){R.a.get(K.url).then(function(G){var j=G.data;j&&j.code===0?K.success&&K.success(j.data.map(function(M){return{time:M[0],type:M[1],color:M[2],author:M[3],text:M[4]}})):K.error&&K.error(j&&j.msg)}).catch(function(G){console.error(G),K.error&&K.error()})}};function g(K){return(g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(G){return typeof G}:function(G){return G&&typeof Symbol=="function"&&G.constructor===Symbol&&G!==Symbol.prototype?"symbol":typeof G})(K)}var c=function(K){var G={container:K.element||document.getElementsByClassName("dplayer")[0],live:!1,autoplay:!1,theme:"#b7daff",loop:!1,lang:(navigator.language||navigator.browserLanguage).toLowerCase(),screenshot:!1,airplay:!0,hotkey:!0,preload:"metadata",volume:.7,playbackSpeed:[.5,.75,1,1.25,1.5,2],apiBackend:A,video:{},contextmenu:[],mutex:!0,pluginOptions:{hls:{},flv:{},dash:{},webtorrent:{}}};for(var j in G)G.hasOwnProperty(j)&&!K.hasOwnProperty(j)&&(K[j]=G[j]);return K.video&&!K.video.type&&(K.video.type="auto"),g(K.danmaku)==="object"&&K.danmaku&&!K.danmaku.user&&(K.danmaku.user="DIYgod"),K.subtitle&&(!K.subtitle.type&&(K.subtitle.type="webvtt"),!K.subtitle.fontSize&&(K.subtitle.fontSize="20px"),!K.subtitle.bottom&&(K.subtitle.bottom="40px"),!K.subtitle.color&&(K.subtitle.color="#fff")),K.video.quality&&(K.video.url=K.video.quality[K.video.defaultQuality].url),K.lang&&(K.lang=K.lang.toLowerCase()),K.contextmenu=K.contextmenu.concat([{text:"Video info",click:function(M){M.infoPanel.triggle()}},{text:"About author",link:"https://diygod.me"},{text:"DPlayer v".concat("1.26.0"),link:"https://github.com/MoePlayer/DPlayer"}]),K},m={"zh-cn":{"Danmaku is loading":"\u5F39\u5E55\u52A0\u8F7D\u4E2D",Top:"\u9876\u90E8",Bottom:"\u5E95\u90E8",Rolling:"\u6EDA\u52A8","Input danmaku, hit Enter":"\u8F93\u5165\u5F39\u5E55\uFF0C\u56DE\u8F66\u53D1\u9001","About author":"\u5173\u4E8E\u4F5C\u8005","DPlayer feedback":"\u64AD\u653E\u5668\u610F\u89C1\u53CD\u9988","About DPlayer":"\u5173\u4E8E DPlayer \u64AD\u653E\u5668",Loop:"\u6D17\u8111\u5FAA\u73AF",Speed:"\u901F\u5EA6","Opacity for danmaku":"\u5F39\u5E55\u900F\u660E\u5EA6",Normal:"\u6B63\u5E38","Please input danmaku content!":"\u8981\u8F93\u5165\u5F39\u5E55\u5185\u5BB9\u554A\u5582\uFF01","Set danmaku color":"\u8BBE\u7F6E\u5F39\u5E55\u989C\u8272","Set danmaku type":"\u8BBE\u7F6E\u5F39\u5E55\u7C7B\u578B","Show danmaku":"\u663E\u793A\u5F39\u5E55","Video load failed":"\u89C6\u9891\u52A0\u8F7D\u5931\u8D25","Danmaku load failed":"\u5F39\u5E55\u52A0\u8F7D\u5931\u8D25","Danmaku send failed":"\u5F39\u5E55\u53D1\u9001\u5931\u8D25","Switching to":"\u6B63\u5728\u5207\u6362\u81F3","Switched to":"\u5DF2\u7ECF\u5207\u6362\u81F3",quality:"\u753B\u8D28",FF:"\u5FEB\u8FDB",REW:"\u5FEB\u9000","Unlimited danmaku":"\u6D77\u91CF\u5F39\u5E55","Send danmaku":"\u53D1\u9001\u5F39\u5E55",Setting:"\u8BBE\u7F6E","Full screen":"\u5168\u5C4F","Web full screen":"\u9875\u9762\u5168\u5C4F",Send:"\u53D1\u9001",Screenshot:"\u622A\u56FE",AirPlay:"\u65E0\u7EBF\u6295\u5C4F",s:"\u79D2","Show subtitle":"\u663E\u793A\u5B57\u5E55","Hide subtitle":"\u9690\u85CF\u5B57\u5E55",Volume:"\u97F3\u91CF",Live:"\u76F4\u64AD","Video info":"\u89C6\u9891\u7EDF\u8BA1\u4FE1\u606F"},"zh-tw":{"Danmaku is loading":"\u5F48\u5E55\u8F09\u5165\u4E2D",Top:"\u9802\u90E8",Bottom:"\u5E95\u90E8",Rolling:"\u6EFE\u52D5","Input danmaku, hit Enter":"\u8F38\u5165\u5F48\u5E55\uFF0CEnter \u767C\u9001","About author":"\u95DC\u65BC\u4F5C\u8005","DPlayer feedback":"\u64AD\u653E\u5668\u610F\u898B\u56DE\u994B","About DPlayer":"\u95DC\u65BC DPlayer \u64AD\u653E\u5668",Loop:"\u5FAA\u74B0\u64AD\u653E",Speed:"\u901F\u5EA6","Opacity for danmaku":"\u5F48\u5E55\u900F\u660E\u5EA6",Normal:"\u6B63\u5E38","Please input danmaku content!":"\u8ACB\u8F38\u5165\u5F48\u5E55\u5167\u5BB9\u554A\uFF01","Set danmaku color":"\u8A2D\u5B9A\u5F48\u5E55\u984F\u8272","Set danmaku type":"\u8A2D\u5B9A\u5F48\u5E55\u985E\u578B","Show danmaku":"\u986F\u793A\u5F48\u5E55","Video load failed":"\u5F71\u7247\u8F09\u5165\u5931\u6557","Danmaku load failed":"\u5F48\u5E55\u8F09\u5165\u5931\u6557","Danmaku send failed":"\u5F48\u5E55\u767C\u9001\u5931\u6557","Switching to":"\u6B63\u5728\u5207\u63DB\u81F3","Switched to":"\u5DF2\u7D93\u5207\u63DB\u81F3",quality:"\u756B\u8CEA",FF:"\u5FEB\u9032",REW:"\u5FEB\u9000","Unlimited danmaku":"\u5DE8\u91CF\u5F48\u5E55","Send danmaku":"\u767C\u9001\u5F48\u5E55",Setting:"\u8A2D\u5B9A","Full screen":"\u5168\u87A2\u5E55","Web full screen":"\u9801\u9762\u5168\u87A2\u5E55",Send:"\u767C\u9001",Screenshot:"\u622A\u5716",AirPlay:"\u7121\u7DDA\u6295\u5C4F",s:"\u79D2","Show subtitle":"\u986F\u793A\u5B57\u5E55","Hide subtitle":"\u96B1\u85CF\u5B57\u5E55",Volume:"\u97F3\u91CF",Live:"\u76F4\u64AD","Video info":"\u5F71\u7247\u7D71\u8A08\u8A0A\u606F"}},y=function(K){var G=this;this.lang=K,this.tran=function(j){return m[G.lang]&&m[G.lang][j]?m[G.lang][j]:j}},S=h(17),b=h.n(S),p=h(18),n=h.n(p),e=h(19),r=h.n(e),t=h(20),l=h.n(t),s=h(21),a=h.n(s),o=h(22),E=h.n(o),x=h(23),f=h.n(x),u=h(24),d=h.n(u),v=h(25),L=h.n(v),D=h(26),I=h.n(D),k=h(27),w=h.n(k),_=h(28),F=h.n(_),U=h(29),W=h.n(U),V=h(30),X=h.n(V),Y=h(31),J=h.n(Y),q=h(32),$=h.n(q),ne=h(33),ee=h.n(ne),Z={play:b.a,pause:n.a,volumeUp:r.a,volumeDown:l.a,volumeOff:a.a,full:E.a,fullWeb:f.a,setting:d.a,right:L.a,comment:I.a,commentOff:w.a,send:F.a,pallette:W.a,camera:X.a,subtitle:$.a,loading:ee.a,airplay:J.a},ie=h(34),ae=h.n(ie);function se(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var ue=function(){function K(M){(function(B,H){if(!(B instanceof H))throw new TypeError("Cannot call a class as a function")})(this,K),this.container=M.container,this.options=M.options,this.index=M.index,this.tran=M.tran,this.init()}var G,j;return G=K,(j=[{key:"init",value:function(){this.container.innerHTML=ae()({options:this.options,index:this.index,tran:this.tran,icons:Z,mobile:i.isMobile,video:{current:!0,pic:this.options.video.pic,screenshot:this.options.screenshot,airplay:this.options.airplay,preload:this.options.preload,url:this.options.video.url,subtitle:this.options.subtitle}}),this.volumeBar=this.container.querySelector(".dplayer-volume-bar-inner"),this.volumeBarWrap=this.container.querySelector(".dplayer-volume-bar"),this.volumeBarWrapWrap=this.container.querySelector(".dplayer-volume-bar-wrap"),this.volumeButton=this.container.querySelector(".dplayer-volume"),this.volumeButtonIcon=this.container.querySelector(".dplayer-volume-icon"),this.volumeIcon=this.container.querySelector(".dplayer-volume-icon .dplayer-icon-content"),this.playedBar=this.container.querySelector(".dplayer-played"),this.loadedBar=this.container.querySelector(".dplayer-loaded"),this.playedBarWrap=this.container.querySelector(".dplayer-bar-wrap"),this.playedBarTime=this.container.querySelector(".dplayer-bar-time"),this.danmaku=this.container.querySelector(".dplayer-danmaku"),this.danmakuLoading=this.container.querySelector(".dplayer-danloading"),this.video=this.container.querySelector(".dplayer-video-current"),this.bezel=this.container.querySelector(".dplayer-bezel-icon"),this.playButton=this.container.querySelector(".dplayer-play-icon"),this.mobilePlayButton=this.container.querySelector(".dplayer-mobile-play"),this.videoWrap=this.container.querySelector(".dplayer-video-wrap"),this.controllerMask=this.container.querySelector(".dplayer-controller-mask"),this.ptime=this.container.querySelector(".dplayer-ptime"),this.settingButton=this.container.querySelector(".dplayer-setting-icon"),this.settingBox=this.container.querySelector(".dplayer-setting-box"),this.mask=this.container.querySelector(".dplayer-mask"),this.loop=this.container.querySelector(".dplayer-setting-loop"),this.loopToggle=this.container.querySelector(".dplayer-setting-loop .dplayer-toggle-setting-input"),this.showDanmaku=this.container.querySelector(".dplayer-setting-showdan"),this.showDanmakuToggle=this.container.querySelector(".dplayer-showdan-setting-input"),this.unlimitDanmaku=this.container.querySelector(".dplayer-setting-danunlimit"),this.unlimitDanmakuToggle=this.container.querySelector(".dplayer-danunlimit-setting-input"),this.speed=this.container.querySelector(".dplayer-setting-speed"),this.speedItem=this.container.querySelectorAll(".dplayer-setting-speed-item"),this.danmakuOpacityBar=this.container.querySelector(".dplayer-danmaku-bar-inner"),this.danmakuOpacityBarWrap=this.container.querySelector(".dplayer-danmaku-bar"),this.danmakuOpacityBarWrapWrap=this.container.querySelector(".dplayer-danmaku-bar-wrap"),this.danmakuOpacityBox=this.container.querySelector(".dplayer-setting-danmaku"),this.dtime=this.container.querySelector(".dplayer-dtime"),this.controller=this.container.querySelector(".dplayer-controller"),this.commentInput=this.container.querySelector(".dplayer-comment-input"),this.commentButton=this.container.querySelector(".dplayer-comment-icon"),this.commentSettingBox=this.container.querySelector(".dplayer-comment-setting-box"),this.commentSettingButton=this.container.querySelector(".dplayer-comment-setting-icon"),this.commentSettingFill=this.container.querySelector(".dplayer-comment-setting-icon path"),this.commentSendButton=this.container.querySelector(".dplayer-send-icon"),this.commentSendFill=this.container.querySelector(".dplayer-send-icon path"),this.commentColorSettingBox=this.container.querySelector(".dplayer-comment-setting-color"),this.browserFullButton=this.container.querySelector(".dplayer-full-icon"),this.webFullButton=this.container.querySelector(".dplayer-full-in-icon"),this.menu=this.container.querySelector(".dplayer-menu"),this.menuItem=this.container.querySelectorAll(".dplayer-menu-item"),this.qualityList=this.container.querySelector(".dplayer-quality-list"),this.camareButton=this.container.querySelector(".dplayer-camera-icon"),this.airplayButton=this.container.querySelector(".dplayer-airplay-icon"),this.subtitleButton=this.container.querySelector(".dplayer-subtitle-icon"),this.subtitleButtonInner=this.container.querySelector(".dplayer-subtitle-icon .dplayer-icon-content"),this.subtitle=this.container.querySelector(".dplayer-subtitle"),this.qualityButton=this.container.querySelector(".dplayer-quality-icon"),this.barPreview=this.container.querySelector(".dplayer-bar-preview"),this.barWrap=this.container.querySelector(".dplayer-bar-wrap"),this.notice=this.container.querySelector(".dplayer-notice"),this.infoPanel=this.container.querySelector(".dplayer-info-panel"),this.infoPanelClose=this.container.querySelector(".dplayer-info-panel-close"),this.infoVersion=this.container.querySelector(".dplayer-info-panel-item-version .dplayer-info-panel-item-data"),this.infoFPS=this.container.querySelector(".dplayer-info-panel-item-fps .dplayer-info-panel-item-data"),this.infoType=this.container.querySelector(".dplayer-info-panel-item-type .dplayer-info-panel-item-data"),this.infoUrl=this.container.querySelector(".dplayer-info-panel-item-url .dplayer-info-panel-item-data"),this.infoResolution=this.container.querySelector(".dplayer-info-panel-item-resolution .dplayer-info-panel-item-data"),this.infoDuration=this.container.querySelector(".dplayer-info-panel-item-duration .dplayer-info-panel-item-data"),this.infoDanmakuId=this.container.querySelector(".dplayer-info-panel-item-danmaku-id .dplayer-info-panel-item-data"),this.infoDanmakuApi=this.container.querySelector(".dplayer-info-panel-item-danmaku-api .dplayer-info-panel-item-data"),this.infoDanmakuAmount=this.container.querySelector(".dplayer-info-panel-item-danmaku-amount .dplayer-info-panel-item-data")}}])&&se(G.prototype,j),K}();function fe(K){return(fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(G){return typeof G}:function(G){return G&&typeof Symbol=="function"&&G.constructor===Symbol&&G!==Symbol.prototype?"symbol":typeof G})(K)}function de(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var he=function(){function K(M){(function(B,H){if(!(B instanceof H))throw new TypeError("Cannot call a class as a function")})(this,K),this.options=M,this.container=this.options.container,this.danTunnel={right:{},top:{},bottom:{}},this.danIndex=0,this.dan=[],this.showing=!0,this._opacity=this.options.opacity,this.events=this.options.events,this.unlimited=this.options.unlimited,this._measure(""),this.load()}var G,j;return G=K,(j=[{key:"load",value:function(){var M,B=this;M=this.options.api.maximum?"".concat(this.options.api.address,"v3/?id=").concat(this.options.api.id,"&max=").concat(this.options.api.maximum):"".concat(this.options.api.address,"v3/?id=").concat(this.options.api.id);var H=(this.options.api.addition||[]).slice(0);H.push(M),this.events&&this.events.trigger("danmaku_load_start",H),this._readAllEndpoints(H,function(z){B.dan=[].concat.apply([],z).sort(function(Q,te){return Q.time-te.time}),window.requestAnimationFrame(function(){B.frame()}),B.options.callback(),B.events&&B.events.trigger("danmaku_load_end")})}},{key:"reload",value:function(M){this.options.api=M,this.dan=[],this.clear(),this.load()}},{key:"_readAllEndpoints",value:function(M,B){for(var H=this,z=[],Q=0,te=function(Ee){H.options.apiBackend.read({url:M[Ee],success:function(ve){z[Ee]=ve,++Q===M.length&&B(z)},error:function(ve){H.options.error(ve||H.options.tran("Danmaku load failed")),z[Ee]=[],++Q===M.length&&B(z)}})},re=0;re<M.length;++re)te(re)}},{key:"send",value:function(M,B){var H=this,z={token:this.options.api.token,id:this.options.api.id,author:this.options.api.user,time:this.options.time(),text:M.text,color:M.color,type:M.type};this.options.apiBackend.send({url:this.options.api.address+"v3/",data:z,success:B,error:function(te){H.options.error(te||H.options.tran("Danmaku send failed"))}}),this.dan.splice(this.danIndex,0,z),this.danIndex++;var Q={text:this.htmlEncode(z.text),color:z.color,type:z.type,border:"2px solid ".concat(this.options.borderColor)};this.draw(Q),this.events&&this.events.trigger("danmaku_send",z)}},{key:"frame",value:function(){var M=this;if(this.dan.length&&!this.paused&&this.showing){for(var B=this.dan[this.danIndex],H=[];B&&this.options.time()>parseFloat(B.time);)H.push(B),B=this.dan[++this.danIndex];this.draw(H)}window.requestAnimationFrame(function(){M.frame()})}},{key:"opacity",value:function(M){if(M!==void 0){for(var B=this.container.getElementsByClassName("dplayer-danmaku-item"),H=0;H<B.length;H++)B[H].style.opacity=M;this._opacity=M,this.events&&this.events.trigger("danmaku_opacity",this._opacity)}return this._opacity}},{key:"draw",value:function(M){var B=this;if(this.showing){var H=this.options.height,z=this.container.offsetWidth,Q=this.container.offsetHeight,te=parseInt(Q/H),re=function(oe){var le=oe.offsetWidth||parseInt(oe.style.width),Ye=oe.getBoundingClientRect().right||B.container.getBoundingClientRect().right+le;return B.container.getBoundingClientRect().right-Ye},Ee=function(oe){return(z+oe)/5},ve=function(oe,le,Ye){for(var Ue=z/Ee(Ye),St=function(je){var Xe=B.danTunnel[le][je+""];if(!Xe||!Xe.length)return B.danTunnel[le][je+""]=[oe],oe.addEventListener("animationend",function(){B.danTunnel[le][je+""].splice(0,1)}),{v:je%te};if(le!=="right")return"continue";for(var qe=0;qe<Xe.length;qe++){var gt=re(Xe[qe])-10;if(gt<=z-Ue*Ee(parseInt(Xe[qe].style.width))||gt<=0)break;if(qe===Xe.length-1)return B.danTunnel[le][je+""].push(oe),oe.addEventListener("animationend",function(){B.danTunnel[le][je+""].splice(0,1)}),{v:je%te}}},ct=0;B.unlimited||ct<te;ct++){var ft=St(ct);switch(ft){case"continue":continue;default:if(fe(ft)==="object")return ft.v}}return-1};Object.prototype.toString.call(M)!=="[object Array]"&&(M=[M]);for(var Ze=document.createDocumentFragment(),Ve=function(oe){M[oe].type=i.number2Type(M[oe].type),M[oe].color||(M[oe].color=16777215);var le=document.createElement("div");le.classList.add("dplayer-danmaku-item"),le.classList.add("dplayer-danmaku-".concat(M[oe].type)),M[oe].border?le.innerHTML='<span style="border:'.concat(M[oe].border,'">').concat(M[oe].text,"</span>"):le.innerHTML=M[oe].text,le.style.opacity=B._opacity,le.style.color=i.number2Color(M[oe].color),le.addEventListener("animationend",function(){B.container.removeChild(le)});var Ye=B._measure(M[oe].text),Ue=void 0;switch(M[oe].type){case"right":(Ue=ve(le,M[oe].type,Ye))>=0&&(le.style.width=Ye+1+"px",le.style.top=H*Ue+"px",le.style.transform="translateX(-".concat(z,"px)"));break;case"top":(Ue=ve(le,M[oe].type))>=0&&(le.style.top=H*Ue+"px");break;case"bottom":(Ue=ve(le,M[oe].type))>=0&&(le.style.bottom=H*Ue+"px");break;default:console.error("Can't handled danmaku type: ".concat(M[oe].type))}Ue>=0&&(le.classList.add("dplayer-danmaku-move"),Ze.appendChild(le))},ze=0;ze<M.length;ze++)Ve(ze);return this.container.appendChild(Ze),Ze}}},{key:"play",value:function(){this.paused=!1}},{key:"pause",value:function(){this.paused=!0}},{key:"_measure",value:function(M){if(!this.context){var B=getComputedStyle(this.container.getElementsByClassName("dplayer-danmaku-item")[0],null);this.context=document.createElement("canvas").getContext("2d"),this.context.font=B.getPropertyValue("font")}return this.context.measureText(M).width}},{key:"seek",value:function(){this.clear();for(var M=0;M<this.dan.length;M++){if(this.dan[M].time>=this.options.time()){this.danIndex=M;break}this.danIndex=this.dan.length}}},{key:"clear",value:function(){this.danTunnel={right:{},top:{},bottom:{}},this.danIndex=0,this.options.container.innerHTML="",this.events&&this.events.trigger("danmaku_clear")}},{key:"htmlEncode",value:function(M){return M.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2f;")}},{key:"resize",value:function(){for(var M=this.container.offsetWidth,B=this.container.getElementsByClassName("dplayer-danmaku-item"),H=0;H<B.length;H++)B[H].style.transform="translateX(-".concat(M,"px)")}},{key:"hide",value:function(){this.showing=!1,this.pause(),this.clear(),this.events&&this.events.trigger("danmaku_hide")}},{key:"show",value:function(){this.seek(),this.showing=!0,this.play(),this.events&&this.events.trigger("danmaku_show")}},{key:"unlimit",value:function(M){this.unlimited=M}}])&&de(G.prototype,j),K}();function me(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var pe=function(){function K(){(function(M,B){if(!(M instanceof B))throw new TypeError("Cannot call a class as a function")})(this,K),this.events={},this.videoEvents=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],this.playerEvents=["screenshot","thumbnails_show","thumbnails_hide","danmaku_show","danmaku_hide","danmaku_clear","danmaku_loaded","danmaku_send","danmaku_opacity","contextmenu_show","contextmenu_hide","notice_show","notice_hide","quality_start","quality_end","destroy","resize","fullscreen","fullscreen_cancel","webfullscreen","webfullscreen_cancel","subtitle_show","subtitle_hide","subtitle_change"]}var G,j;return G=K,(j=[{key:"on",value:function(M,B){this.type(M)&&typeof B=="function"&&(this.events[M]||(this.events[M]=[]),this.events[M].push(B))}},{key:"trigger",value:function(M,B){if(this.events[M]&&this.events[M].length)for(var H=0;H<this.events[M].length;H++)this.events[M][H](B)}},{key:"type",value:function(M){return this.playerEvents.indexOf(M)!==-1?"player":this.videoEvents.indexOf(M)!==-1?"video":(console.error("Unknown event name: ".concat(M)),null)}}])&&me(G.prototype,j),K}();function ye(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var ge=function(){function K(M){var B=this;(function(Q,te){if(!(Q instanceof te))throw new TypeError("Cannot call a class as a function")})(this,K),this.player=M,this.lastScrollPosition={left:0,top:0},this.player.events.on("webfullscreen",function(){B.player.resize()}),this.player.events.on("webfullscreen_cancel",function(){B.player.resize(),i.setScrollPosition(B.lastScrollPosition)});var H=function(){B.player.resize(),B.isFullScreen("browser")?B.player.events.trigger("fullscreen"):(i.setScrollPosition(B.lastScrollPosition),B.player.events.trigger("fullscreen_cancel"))},z=function(){var Q=document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;Q&&Q!==B.player.container||(B.player.resize(),Q?B.player.events.trigger("fullscreen"):(i.setScrollPosition(B.lastScrollPosition),B.player.events.trigger("fullscreen_cancel")))};/Firefox/.test(navigator.userAgent)?(document.addEventListener("mozfullscreenchange",z),document.addEventListener("fullscreenchange",z)):(this.player.container.addEventListener("fullscreenchange",H),this.player.container.addEventListener("webkitfullscreenchange",H),document.addEventListener("msfullscreenchange",z),document.addEventListener("MSFullscreenChange",z))}var G,j;return G=K,(j=[{key:"isFullScreen",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"browser";switch(M){case"browser":return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;case"web":return this.player.container.classList.contains("dplayer-fulled")}}},{key:"request",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"browser",B=M==="browser"?"web":"browser",H=this.isFullScreen(B);switch(H||(this.lastScrollPosition=i.getScrollPosition()),M){case"browser":this.player.container.requestFullscreen?this.player.container.requestFullscreen():this.player.container.mozRequestFullScreen?this.player.container.mozRequestFullScreen():this.player.container.webkitRequestFullscreen?this.player.container.webkitRequestFullscreen():this.player.video.webkitEnterFullscreen?this.player.video.webkitEnterFullscreen():this.player.video.webkitEnterFullScreen?this.player.video.webkitEnterFullScreen():this.player.container.msRequestFullscreen&&this.player.container.msRequestFullscreen();break;case"web":this.player.container.classList.add("dplayer-fulled"),document.body.classList.add("dplayer-web-fullscreen-fix"),this.player.events.trigger("webfullscreen")}H&&this.cancel(B)}},{key:"cancel",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"browser";switch(M){case"browser":document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitCancelFullscreen?document.webkitCancelFullscreen():document.msCancelFullScreen?document.msCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();break;case"web":this.player.container.classList.remove("dplayer-fulled"),document.body.classList.remove("dplayer-web-fullscreen-fix"),this.player.events.trigger("webfullscreen_cancel")}}},{key:"toggle",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"browser";this.isFullScreen(M)?this.cancel(M):this.request(M)}}])&&ye(G.prototype,j),K}();function xe(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var ce=function(){function K(M){(function(B,H){if(!(B instanceof H))throw new TypeError("Cannot call a class as a function")})(this,K),this.storageName={opacity:"dplayer-danmaku-opacity",volume:"dplayer-volume",unlimited:"dplayer-danmaku-unlimited",danmaku:"dplayer-danmaku-show",subtitle:"dplayer-subtitle-show"},this.default={opacity:.7,volume:M.options.hasOwnProperty("volume")?M.options.volume:.7,unlimited:(M.options.danmaku&&M.options.danmaku.unlimited?1:0)||0,danmaku:1,subtitle:1},this.data={},this.init()}var G,j;return G=K,(j=[{key:"init",value:function(){for(var M in this.storageName){var B=this.storageName[M];this.data[M]=parseFloat(i.storage.get(B)||this.default[M])}}},{key:"get",value:function(M){return this.data[M]}},{key:"set",value:function(M,B){this.data[M]=B,i.storage.set(this.storageName[M],B)}}])&&xe(G.prototype,j),K}();function Me(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var we=function(){function K(M,B,H,z){(function(Q,te){if(!(Q instanceof te))throw new TypeError("Cannot call a class as a function")})(this,K),this.container=M,this.video=B,this.options=H,this.events=z,this.init()}var G,j;return G=K,(j=[{key:"init",value:function(){var M=this;if(this.container.style.fontSize=this.options.fontSize,this.container.style.bottom=this.options.bottom,this.container.style.color=this.options.color,this.video.textTracks&&this.video.textTracks[0]){var B=this.video.textTracks[0];B.oncuechange=function(){var H=B.activeCues[0];if(M.container.innerHTML="",H){var z=document.createElement("div");z.appendChild(H.getCueAsHTML());var Q=z.innerHTML.split(/\r?\n/).map(function(te){return"<p>".concat(te,"</p>")}).join("");M.container.innerHTML=Q}M.events.trigger("subtitle_change")}}}},{key:"show",value:function(){this.container.classList.remove("dplayer-subtitle-hide"),this.events.trigger("subtitle_show")}},{key:"hide",value:function(){this.container.classList.add("dplayer-subtitle-hide"),this.events.trigger("subtitle_hide")}},{key:"toggle",value:function(){this.container.classList.contains("dplayer-subtitle-hide")?this.show():this.hide()}}])&&Me(G.prototype,j),K}();function Ie(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var be=function(){function K(M){(function(B,H){if(!(B instanceof H))throw new TypeError("Cannot call a class as a function")})(this,K),this.elements={},this.elements.volume=M.volumeBar,this.elements.played=M.playedBar,this.elements.loaded=M.loadedBar,this.elements.danmaku=M.danmakuOpacityBar}var G,j;return G=K,(j=[{key:"set",value:function(M,B,H){B=Math.max(B,0),B=Math.min(B,1),this.elements[M].style[H]=100*B+"%"}},{key:"get",value:function(M){return parseFloat(this.elements[M].style.width)/100}}])&&Ie(G.prototype,j),K}();function Se(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var Re=function(){function K(M){(function(B,H){if(!(B instanceof H))throw new TypeError("Cannot call a class as a function")})(this,K),this.player=M,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(B){window.setTimeout(B,1e3/60)},this.types=["loading","info","fps"],this.init()}var G,j;return G=K,(j=[{key:"init",value:function(){var M=this;this.types.map(function(B){return B!=="fps"&&M["init".concat(B,"Checker")](),B})}},{key:"initloadingChecker",value:function(){var M=this,B=0,H=0,z=!1;this.loadingChecker=setInterval(function(){M.enableloadingChecker&&(H=M.player.video.currentTime,z||H!==B||M.player.video.paused||(M.player.container.classList.add("dplayer-loading"),z=!0),z&&H>B&&!M.player.video.paused&&(M.player.container.classList.remove("dplayer-loading"),z=!1),B=H)},100)}},{key:"initfpsChecker",value:function(){var M=this;window.requestAnimationFrame(function(){if(M.enablefpsChecker)if(M.initfpsChecker(),M.fpsStart){M.fpsIndex++;var B=new Date;B-M.fpsStart>1e3&&(M.player.infoPanel.fps(M.fpsIndex/(B-M.fpsStart)*1e3),M.fpsStart=new Date,M.fpsIndex=0)}else M.fpsStart=new Date,M.fpsIndex=0;else M.fpsStart=0,M.fpsIndex=0})}},{key:"initinfoChecker",value:function(){var M=this;this.infoChecker=setInterval(function(){M.enableinfoChecker&&M.player.infoPanel.update()},1e3)}},{key:"enable",value:function(M){this["enable".concat(M,"Checker")]=!0,M==="fps"&&this.initfpsChecker()}},{key:"disable",value:function(M){this["enable".concat(M,"Checker")]=!1}},{key:"destroy",value:function(){var M=this;this.types.map(function(B){return M["enable".concat(B,"Checker")]=!1,M["".concat(B,"Checker")]&&clearInterval(M["".concat(B,"Checker")]),B})}}])&&Se(G.prototype,j),K}();function Ae(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var Te=function(){function K(M){var B=this;(function(H,z){if(!(H instanceof z))throw new TypeError("Cannot call a class as a function")})(this,K),this.container=M,this.container.addEventListener("animationend",function(){B.container.classList.remove("dplayer-bezel-transition")})}var G,j;return G=K,(j=[{key:"switch",value:function(M){this.container.innerHTML=M,this.container.classList.add("dplayer-bezel-transition")}}])&&Ae(G.prototype,j),K}();function De(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var _e=function(){function K(M){(function(B,H){if(!(B instanceof H))throw new TypeError("Cannot call a class as a function")})(this,K),this.container=M.container,this.barWidth=M.barWidth,this.container.style.backgroundImage="url('".concat(M.url,"')"),this.events=M.events}var G,j;return G=K,(j=[{key:"resize",value:function(M,B,H){this.container.style.width="".concat(M,"px"),this.container.style.height="".concat(B,"px"),this.container.style.top="".concat(2-B,"px"),this.barWidth=H}},{key:"show",value:function(){this.container.style.display="block",this.events&&this.events.trigger("thumbnails_show")}},{key:"move",value:function(M){this.container.style.backgroundPosition="-".concat(160*(Math.ceil(M/this.barWidth*100)-1),"px 0"),this.container.style.left="".concat(Math.min(Math.max(M-this.container.offsetWidth/2,-10),this.barWidth-150),"px")}},{key:"hide",value:function(){this.container.style.display="none",this.events&&this.events.trigger("thumbnails_hide")}}])&&De(G.prototype,j),K}();function Be(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var ke=function(){function K(M){var B=this;(function(H,z){if(!(H instanceof z))throw new TypeError("Cannot call a class as a function")})(this,K),this.player=M,this.autoHideTimer=0,i.isMobile||(this.player.container.addEventListener("mousemove",function(){B.setAutoHide()}),this.player.container.addEventListener("click",function(){B.setAutoHide()}),this.player.on("play",function(){B.setAutoHide()}),this.player.on("pause",function(){B.setAutoHide()})),this.initPlayButton(),this.initThumbnails(),this.initPlayedBar(),this.initFullButton(),this.initQualityButton(),this.initScreenshotButton(),this.initSubtitleButton(),this.initHighlights(),i.isSafari&&this.initAirplayButton(),i.isMobile||this.initVolumeButton()}var G,j;return G=K,(j=[{key:"initPlayButton",value:function(){var M=this;this.player.template.playButton.addEventListener("click",function(){M.player.toggle()}),this.player.template.mobilePlayButton.addEventListener("click",function(){M.player.toggle()}),i.isMobile?(this.player.template.videoWrap.addEventListener("click",function(){M.toggle()}),this.player.template.controllerMask.addEventListener("click",function(){M.toggle()})):(this.player.template.videoWrap.addEventListener("click",function(){M.player.toggle()}),this.player.template.controllerMask.addEventListener("click",function(){M.player.toggle()}))}},{key:"initHighlights",value:function(){var M=this;this.player.on("durationchange",function(){if(M.player.video.duration!==1&&M.player.video.duration!==1/0&&M.player.options.highlight){var B=document.querySelectorAll(".dplayer-highlight");[].slice.call(B,0).forEach(function(Q){M.player.template.playedBarWrap.removeChild(Q)});for(var H=0;H<M.player.options.highlight.length;H++)if(M.player.options.highlight[H].text&&M.player.options.highlight[H].time){var z=document.createElement("div");z.classList.add("dplayer-highlight"),z.style.left=M.player.options.highlight[H].time/M.player.video.duration*100+"%",z.innerHTML='<span class="dplayer-highlight-text">'+M.player.options.highlight[H].text+"</span>",M.player.template.playedBarWrap.insertBefore(z,M.player.template.playedBarTime)}}})}},{key:"initThumbnails",value:function(){var M=this;this.player.options.video.thumbnails&&(this.thumbnails=new _e({container:this.player.template.barPreview,barWidth:this.player.template.barWrap.offsetWidth,url:this.player.options.video.thumbnails,events:this.player.events}),this.player.on("loadedmetadata",function(){M.thumbnails.resize(160,M.player.video.videoHeight/M.player.video.videoWidth*160,M.player.template.barWrap.offsetWidth)}))}},{key:"initPlayedBar",value:function(){var M=this,B=function(z){var Q=((z.clientX||z.changedTouches[0].clientX)-i.getBoundingClientRectViewLeft(M.player.template.playedBarWrap))/M.player.template.playedBarWrap.clientWidth;Q=Math.max(Q,0),Q=Math.min(Q,1),M.player.bar.set("played",Q,"width"),M.player.template.ptime.innerHTML=i.secondToTime(Q*M.player.video.duration)},H=function z(Q){document.removeEventListener(i.nameMap.dragEnd,z),document.removeEventListener(i.nameMap.dragMove,B);var te=((Q.clientX||Q.changedTouches[0].clientX)-i.getBoundingClientRectViewLeft(M.player.template.playedBarWrap))/M.player.template.playedBarWrap.clientWidth;te=Math.max(te,0),te=Math.min(te,1),M.player.bar.set("played",te,"width"),M.player.seek(M.player.bar.get("played")*M.player.video.duration),M.player.timer.enable("progress")};this.player.template.playedBarWrap.addEventListener(i.nameMap.dragStart,function(){M.player.timer.disable("progress"),document.addEventListener(i.nameMap.dragMove,B),document.addEventListener(i.nameMap.dragEnd,H)}),this.player.template.playedBarWrap.addEventListener(i.nameMap.dragMove,function(z){if(M.player.video.duration){var Q=M.player.template.playedBarWrap.getBoundingClientRect().left,te=(z.clientX||z.changedTouches[0].clientX)-Q;if(te<0||te>M.player.template.playedBarWrap.offsetWidth)return;var re=M.player.video.duration*(te/M.player.template.playedBarWrap.offsetWidth);i.isMobile&&M.thumbnails&&M.thumbnails.show(),M.thumbnails&&M.thumbnails.move(te),M.player.template.playedBarTime.style.left="".concat(te-(re>=3600?25:20),"px"),M.player.template.playedBarTime.innerText=i.secondToTime(re),M.player.template.playedBarTime.classList.remove("hidden")}}),this.player.template.playedBarWrap.addEventListener(i.nameMap.dragEnd,function(){i.isMobile&&M.thumbnails&&M.thumbnails.hide()}),i.isMobile||(this.player.template.playedBarWrap.addEventListener("mouseenter",function(){M.player.video.duration&&(M.thumbnails&&M.thumbnails.show(),M.player.template.playedBarTime.classList.remove("hidden"))}),this.player.template.playedBarWrap.addEventListener("mouseleave",function(){M.player.video.duration&&(M.thumbnails&&M.thumbnails.hide(),M.player.template.playedBarTime.classList.add("hidden"))}))}},{key:"initFullButton",value:function(){var M=this;this.player.template.browserFullButton.addEventListener("click",function(){M.player.fullScreen.toggle("browser")}),this.player.template.webFullButton.addEventListener("click",function(){M.player.fullScreen.toggle("web")})}},{key:"initVolumeButton",value:function(){var M=this,B=function(z){var Q=z||window.event,te=((Q.clientX||Q.changedTouches[0].clientX)-i.getBoundingClientRectViewLeft(M.player.template.volumeBarWrap)-5.5)/35;M.player.volume(te)},H=function z(){document.removeEventListener(i.nameMap.dragEnd,z),document.removeEventListener(i.nameMap.dragMove,B),M.player.template.volumeButton.classList.remove("dplayer-volume-active")};this.player.template.volumeBarWrapWrap.addEventListener("click",function(z){var Q=z||window.event,te=((Q.clientX||Q.changedTouches[0].clientX)-i.getBoundingClientRectViewLeft(M.player.template.volumeBarWrap)-5.5)/35;M.player.volume(te)}),this.player.template.volumeBarWrapWrap.addEventListener(i.nameMap.dragStart,function(){document.addEventListener(i.nameMap.dragMove,B),document.addEventListener(i.nameMap.dragEnd,H),M.player.template.volumeButton.classList.add("dplayer-volume-active")}),this.player.template.volumeButtonIcon.addEventListener("click",function(){M.player.video.muted?(M.player.video.muted=!1,M.player.switchVolumeIcon(),M.player.bar.set("volume",M.player.volume(),"width")):(M.player.video.muted=!0,M.player.template.volumeIcon.innerHTML=Z.volumeOff,M.player.bar.set("volume",0,"width"))})}},{key:"initQualityButton",value:function(){var M=this;this.player.options.video.quality&&this.player.template.qualityList.addEventListener("click",function(B){B.target.classList.contains("dplayer-quality-item")&&M.player.switchQuality(B.target.dataset.index)})}},{key:"initScreenshotButton",value:function(){var M=this;this.player.options.screenshot&&this.player.template.camareButton.addEventListener("click",function(){var B,H=document.createElement("canvas");H.width=M.player.video.videoWidth,H.height=M.player.video.videoHeight,H.getContext("2d").drawImage(M.player.video,0,0,H.width,H.height),H.toBlob(function(z){B=URL.createObjectURL(z);var Q=document.createElement("a");Q.href=B,Q.download="DPlayer.png",Q.style.display="none",document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),URL.revokeObjectURL(B)}),M.player.events.trigger("screenshot",B)})}},{key:"initAirplayButton",value:function(){this.player.options.airplay&&(window.WebKitPlaybackTargetAvailabilityEvent?this.player.video.addEventListener("webkitplaybacktargetavailabilitychanged",function(M){switch(M.availability){case"available":this.template.airplayButton.disable=!1;break;default:this.template.airplayButton.disable=!0}this.template.airplayButton.addEventListener("click",function(){this.video.webkitShowPlaybackTargetPicker()}.bind(this))}.bind(this.player)):this.player.template.airplayButton.style.display="none")}},{key:"initSubtitleButton",value:function(){var M=this;this.player.options.subtitle&&(this.player.events.on("subtitle_show",function(){M.player.template.subtitleButton.dataset.balloon=M.player.tran("Hide subtitle"),M.player.template.subtitleButtonInner.style.opacity="",M.player.user.set("subtitle",1)}),this.player.events.on("subtitle_hide",function(){M.player.template.subtitleButton.dataset.balloon=M.player.tran("Show subtitle"),M.player.template.subtitleButtonInner.style.opacity="0.4",M.player.user.set("subtitle",0)}),this.player.template.subtitleButton.addEventListener("click",function(){M.player.subtitle.toggle()}))}},{key:"setAutoHide",value:function(){var M=this;this.show(),clearTimeout(this.autoHideTimer),this.autoHideTimer=setTimeout(function(){!M.player.video.played.length||M.player.paused||M.disableAutoHide||M.hide()},3e3)}},{key:"show",value:function(){this.player.container.classList.remove("dplayer-hide-controller")}},{key:"hide",value:function(){this.player.container.classList.add("dplayer-hide-controller"),this.player.setting.hide(),this.player.comment&&this.player.comment.hide()}},{key:"isShow",value:function(){return!this.player.container.classList.contains("dplayer-hide-controller")}},{key:"toggle",value:function(){this.isShow()?this.hide():this.show()}},{key:"destroy",value:function(){clearTimeout(this.autoHideTimer)}}])&&Be(G.prototype,j),K}();function Fe(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var Ce=function(){function K(M){var B=this;(function(re,Ee){if(!(re instanceof Ee))throw new TypeError("Cannot call a class as a function")})(this,K),this.player=M,this.player.template.mask.addEventListener("click",function(){B.hide()}),this.player.template.settingButton.addEventListener("click",function(){B.show()}),this.loop=this.player.options.loop,this.player.template.loopToggle.checked=this.loop,this.player.template.loop.addEventListener("click",function(){B.player.template.loopToggle.checked=!B.player.template.loopToggle.checked,B.player.template.loopToggle.checked?B.loop=!0:B.loop=!1,B.hide()}),this.showDanmaku=this.player.user.get("danmaku"),this.showDanmaku||this.player.danmaku&&this.player.danmaku.hide(),this.player.template.showDanmakuToggle.checked=this.showDanmaku,this.player.template.showDanmaku.addEventListener("click",function(){B.player.template.showDanmakuToggle.checked=!B.player.template.showDanmakuToggle.checked,B.player.template.showDanmakuToggle.checked?(B.showDanmaku=!0,B.player.danmaku.show()):(B.showDanmaku=!1,B.player.danmaku.hide()),B.player.user.set("danmaku",B.showDanmaku?1:0),B.hide()}),this.unlimitDanmaku=this.player.user.get("unlimited"),this.player.template.unlimitDanmakuToggle.checked=this.unlimitDanmaku,this.player.template.unlimitDanmaku.addEventListener("click",function(){B.player.template.unlimitDanmakuToggle.checked=!B.player.template.unlimitDanmakuToggle.checked,B.player.template.unlimitDanmakuToggle.checked?(B.unlimitDanmaku=!0,B.player.danmaku.unlimit(!0)):(B.unlimitDanmaku=!1,B.player.danmaku.unlimit(!1)),B.player.user.set("unlimited",B.unlimitDanmaku?1:0),B.hide()}),this.player.template.speed.addEventListener("click",function(){B.player.template.settingBox.classList.add("dplayer-setting-box-narrow"),B.player.template.settingBox.classList.add("dplayer-setting-box-speed")});for(var H=function(re){B.player.template.speedItem[re].addEventListener("click",function(){B.player.speed(B.player.template.speedItem[re].dataset.speed),B.hide()})},z=0;z<this.player.template.speedItem.length;z++)H(z);if(this.player.danmaku){this.player.on("danmaku_opacity",function(re){B.player.bar.set("danmaku",re,"width"),B.player.user.set("opacity",re)}),this.player.danmaku.opacity(this.player.user.get("opacity"));var Q=function(re){var Ee=re||window.event,ve=((Ee.clientX||Ee.changedTouches[0].clientX)-i.getBoundingClientRectViewLeft(B.player.template.danmakuOpacityBarWrap))/130;ve=Math.max(ve,0),ve=Math.min(ve,1),B.player.danmaku.opacity(ve)},te=function re(){document.removeEventListener(i.nameMap.dragEnd,re),document.removeEventListener(i.nameMap.dragMove,Q),B.player.template.danmakuOpacityBox.classList.remove("dplayer-setting-danmaku-active")};this.player.template.danmakuOpacityBarWrapWrap.addEventListener("click",function(re){var Ee=re||window.event,ve=((Ee.clientX||Ee.changedTouches[0].clientX)-i.getBoundingClientRectViewLeft(B.player.template.danmakuOpacityBarWrap))/130;ve=Math.max(ve,0),ve=Math.min(ve,1),B.player.danmaku.opacity(ve)}),this.player.template.danmakuOpacityBarWrapWrap.addEventListener(i.nameMap.dragStart,function(){document.addEventListener(i.nameMap.dragMove,Q),document.addEventListener(i.nameMap.dragEnd,te),B.player.template.danmakuOpacityBox.classList.add("dplayer-setting-danmaku-active")})}}var G,j;return G=K,(j=[{key:"hide",value:function(){var M=this;this.player.template.settingBox.classList.remove("dplayer-setting-box-open"),this.player.template.mask.classList.remove("dplayer-mask-show"),setTimeout(function(){M.player.template.settingBox.classList.remove("dplayer-setting-box-narrow"),M.player.template.settingBox.classList.remove("dplayer-setting-box-speed")},300),this.player.controller.disableAutoHide=!1}},{key:"show",value:function(){this.player.template.settingBox.classList.add("dplayer-setting-box-open"),this.player.template.mask.classList.add("dplayer-mask-show"),this.player.controller.disableAutoHide=!0}}])&&Fe(G.prototype,j),K}();function Oe(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var Ne=function(){function K(M){var B=this;(function(H,z){if(!(H instanceof z))throw new TypeError("Cannot call a class as a function")})(this,K),this.player=M,this.player.template.mask.addEventListener("click",function(){B.hide()}),this.player.template.commentButton.addEventListener("click",function(){B.show()}),this.player.template.commentSettingButton.addEventListener("click",function(){B.toggleSetting()}),this.player.template.commentColorSettingBox.addEventListener("click",function(){if(B.player.template.commentColorSettingBox.querySelector("input:checked+span")){var H=B.player.template.commentColorSettingBox.querySelector("input:checked").value;B.player.template.commentSettingFill.style.fill=H,B.player.template.commentInput.style.color=H,B.player.template.commentSendFill.style.fill=H}}),this.player.template.commentInput.addEventListener("click",function(){B.hideSetting()}),this.player.template.commentInput.addEventListener("keydown",function(H){(H||window.event).keyCode===13&&B.send()}),this.player.template.commentSendButton.addEventListener("click",function(){B.send()})}var G,j;return G=K,(j=[{key:"show",value:function(){this.player.controller.disableAutoHide=!0,this.player.template.controller.classList.add("dplayer-controller-comment"),this.player.template.mask.classList.add("dplayer-mask-show"),this.player.container.classList.add("dplayer-show-controller"),this.player.template.commentInput.focus()}},{key:"hide",value:function(){this.player.template.controller.classList.remove("dplayer-controller-comment"),this.player.template.mask.classList.remove("dplayer-mask-show"),this.player.container.classList.remove("dplayer-show-controller"),this.player.controller.disableAutoHide=!1,this.hideSetting()}},{key:"showSetting",value:function(){this.player.template.commentSettingBox.classList.add("dplayer-comment-setting-open")}},{key:"hideSetting",value:function(){this.player.template.commentSettingBox.classList.remove("dplayer-comment-setting-open")}},{key:"toggleSetting",value:function(){this.player.template.commentSettingBox.classList.contains("dplayer-comment-setting-open")?this.hideSetting():this.showSetting()}},{key:"send",value:function(){var M=this;this.player.template.commentInput.blur(),this.player.template.commentInput.value.replace(/^\s+|\s+$/g,"")?this.player.danmaku.send({text:this.player.template.commentInput.value,color:i.color2Number(this.player.container.querySelector(".dplayer-comment-setting-color input:checked").value),type:parseInt(this.player.container.querySelector(".dplayer-comment-setting-type input:checked").value)},function(){M.player.template.commentInput.value="",M.hide()}):this.player.notice(this.player.tran("Please input danmaku content!"))}}])&&Oe(G.prototype,j),K}(),We=function K(G){(function(j,M){if(!(j instanceof M))throw new TypeError("Cannot call a class as a function")})(this,K),G.options.hotkey&&document.addEventListener("keydown",function(j){if(G.focus){var M=document.activeElement.tagName.toUpperCase(),B=document.activeElement.getAttribute("contenteditable");if(M!=="INPUT"&&M!=="TEXTAREA"&&B!==""&&B!=="true"){var H,z=j||window.event;switch(z.keyCode){case 32:z.preventDefault(),G.toggle();break;case 37:if(z.preventDefault(),G.options.live)break;G.seek(G.video.currentTime-5),G.controller.setAutoHide();break;case 39:if(z.preventDefault(),G.options.live)break;G.seek(G.video.currentTime+5),G.controller.setAutoHide();break;case 38:z.preventDefault(),H=G.volume()+.1,G.volume(H);break;case 40:z.preventDefault(),H=G.volume()-.1,G.volume(H)}}}}),document.addEventListener("keydown",function(j){switch((j||window.event).keyCode){case 27:G.fullScreen.isFullScreen("web")&&G.fullScreen.cancel("web")}})};function Ge(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var st=function(){function K(M){var B=this;(function(H,z){if(!(H instanceof z))throw new TypeError("Cannot call a class as a function")})(this,K),this.player=M,this.shown=!1,Array.prototype.slice.call(this.player.template.menuItem).forEach(function(H,z){B.player.options.contextmenu[z].click&&H.addEventListener("click",function(){B.player.options.contextmenu[z].click(B.player),B.hide()})}),this.player.container.addEventListener("contextmenu",function(H){if(B.shown)B.hide();else{var z=H||window.event;z.preventDefault();var Q=B.player.container.getBoundingClientRect();B.show(z.clientX-Q.left,z.clientY-Q.top),B.player.template.mask.addEventListener("click",function(){B.hide()})}})}var G,j;return G=K,(j=[{key:"show",value:function(M,B){this.player.template.menu.classList.add("dplayer-menu-show");var H=this.player.container.getBoundingClientRect();M+this.player.template.menu.offsetWidth>=H.width?(this.player.template.menu.style.right=H.width-M+"px",this.player.template.menu.style.left="initial"):(this.player.template.menu.style.left=M+"px",this.player.template.menu.style.right="initial"),B+this.player.template.menu.offsetHeight>=H.height?(this.player.template.menu.style.bottom=H.height-B+"px",this.player.template.menu.style.top="initial"):(this.player.template.menu.style.top=B+"px",this.player.template.menu.style.bottom="initial"),this.player.template.mask.classList.add("dplayer-mask-show"),this.shown=!0,this.player.events.trigger("contextmenu_show")}},{key:"hide",value:function(){this.player.template.mask.classList.remove("dplayer-mask-show"),this.player.template.menu.classList.remove("dplayer-menu-show"),this.shown=!1,this.player.events.trigger("contextmenu_hide")}}])&&Ge(G.prototype,j),K}();function $e(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var ot=function(){function K(M){var B=this;(function(H,z){if(!(H instanceof z))throw new TypeError("Cannot call a class as a function")})(this,K),this.container=M.template.infoPanel,this.template=M.template,this.video=M.video,this.player=M,this.template.infoPanelClose.addEventListener("click",function(){B.hide()})}var G,j;return G=K,(j=[{key:"show",value:function(){this.beginTime=Date.now(),this.update(),this.player.timer.enable("info"),this.player.timer.enable("fps"),this.container.classList.remove("dplayer-info-panel-hide")}},{key:"hide",value:function(){this.player.timer.disable("info"),this.player.timer.disable("fps"),this.container.classList.add("dplayer-info-panel-hide")}},{key:"triggle",value:function(){this.container.classList.contains("dplayer-info-panel-hide")?this.show():this.hide()}},{key:"update",value:function(){this.template.infoVersion.innerHTML="v".concat("1.26.0"," ").concat("63275c8"),this.template.infoType.innerHTML=this.player.type,this.template.infoUrl.innerHTML=this.player.options.video.url,this.template.infoResolution.innerHTML="".concat(this.player.video.videoWidth," x ").concat(this.player.video.videoHeight),this.template.infoDuration.innerHTML=this.player.video.duration,this.player.options.danmaku&&(this.template.infoDanmakuId.innerHTML=this.player.options.danmaku.id,this.template.infoDanmakuApi.innerHTML=this.player.options.danmaku.api,this.template.infoDanmakuAmount.innerHTML=this.player.danmaku.dan.length)}},{key:"fps",value:function(M){this.template.infoFPS.innerHTML="".concat(M.toFixed(1))}}])&&$e(G.prototype,j),K}(),tt=h(1),lt=h.n(tt);function rt(K,G){var j=Object.keys(K);if(Object.getOwnPropertySymbols){var M=Object.getOwnPropertySymbols(K);G&&(M=M.filter(function(B){return Object.getOwnPropertyDescriptor(K,B).enumerable})),j.push.apply(j,M)}return j}function ut(K,G,j){return G in K?Object.defineProperty(K,G,{value:j,enumerable:!0,configurable:!0,writable:!0}):K[G]=j,K}function He(K,G){for(var j=0;j<G.length;j++){var M=G[j];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(K,M.key,M)}}var Je=0,Ke=[],dt=function(){function K(B){var H=this;(function(z,Q){if(!(z instanceof Q))throw new TypeError("Cannot call a class as a function")})(this,K),this.options=c(function(z){for(var Q=1;Q<arguments.length;Q++){var te=arguments[Q]!=null?arguments[Q]:{};Q%2?rt(Object(te),!0).forEach(function(re){ut(z,re,te[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(te)):rt(Object(te)).forEach(function(re){Object.defineProperty(z,re,Object.getOwnPropertyDescriptor(te,re))})}return z}({preload:B.video.type==="webtorrent"?"none":"metadata"},B)),this.options.video.quality&&(this.qualityIndex=this.options.video.defaultQuality,this.quality=this.options.video.quality[this.options.video.defaultQuality]),this.tran=new y(this.options.lang).tran,this.events=new pe,this.user=new ce(this),this.container=this.options.container,this.container.classList.add("dplayer"),this.options.danmaku||this.container.classList.add("dplayer-no-danmaku"),this.options.live&&this.container.classList.add("dplayer-live"),i.isMobile&&this.container.classList.add("dplayer-mobile"),this.arrow=this.container.offsetWidth<=500,this.arrow&&this.container.classList.add("dplayer-arrow"),this.template=new ue({container:this.container,options:this.options,index:Je,tran:this.tran}),this.video=this.template.video,this.bar=new be(this.template),this.bezel=new Te(this.template.bezel),this.fullScreen=new ge(this),this.controller=new ke(this),this.options.danmaku&&(this.danmaku=new he({container:this.template.danmaku,opacity:this.user.get("opacity"),callback:function(){setTimeout(function(){H.template.danmakuLoading.style.display="none",H.options.autoplay&&H.play()},0)},error:function(z){H.notice(z)},apiBackend:this.options.apiBackend,borderColor:this.options.theme,height:this.arrow?24:30,time:function(){return H.video.currentTime},unlimited:this.user.get("unlimited"),api:{id:this.options.danmaku.id,address:this.options.danmaku.api,token:this.options.danmaku.token,maximum:this.options.danmaku.maximum,addition:this.options.danmaku.addition,user:this.options.danmaku.user},events:this.events,tran:function(z){return H.tran(z)}}),this.comment=new Ne(this)),this.setting=new Ce(this),this.plugins={},document.addEventListener("click",function(){H.focus=!1},!0),this.container.addEventListener("click",function(){H.focus=!0},!0),this.paused=!0,this.timer=new Re(this),this.hotkey=new We(this),this.contextmenu=new st(this),this.initVideo(this.video,this.quality&&this.quality.type||this.options.video.type),this.infoPanel=new ot(this),!this.danmaku&&this.options.autoplay&&this.play(),Je++,Ke.push(this)}var G,j,M;return G=K,M=[{key:"version",get:function(){return"1.26.0"}}],(j=[{key:"seek",value:function(B){B=Math.max(B,0),this.video.duration&&(B=Math.min(B,this.video.duration)),this.video.currentTime<B?this.notice("".concat(this.tran("FF")," ").concat((B-this.video.currentTime).toFixed(0)," ").concat(this.tran("s"))):this.video.currentTime>B&&this.notice("".concat(this.tran("REW")," ").concat((this.video.currentTime-B).toFixed(0)," ").concat(this.tran("s"))),this.video.currentTime=B,this.danmaku&&this.danmaku.seek(),this.bar.set("played",B/this.video.duration,"width"),this.template.ptime.innerHTML=i.secondToTime(B)}},{key:"play",value:function(B){var H=this;if(this.paused=!1,this.video.paused&&!i.isMobile&&this.bezel.switch(Z.play),this.template.playButton.innerHTML=Z.pause,this.template.mobilePlayButton.innerHTML=Z.pause,B||O.a.resolve(this.video.play()).catch(function(){H.pause()}).then(function(){}),this.timer.enable("loading"),this.container.classList.remove("dplayer-paused"),this.container.classList.add("dplayer-playing"),this.danmaku&&this.danmaku.play(),this.options.mutex)for(var z=0;z<Ke.length;z++)this!==Ke[z]&&Ke[z].pause()}},{key:"pause",value:function(B){this.paused=!0,this.container.classList.remove("dplayer-loading"),this.video.paused||i.isMobile||this.bezel.switch(Z.pause),this.template.playButton.innerHTML=Z.play,this.template.mobilePlayButton.innerHTML=Z.play,B||this.video.pause(),this.timer.disable("loading"),this.container.classList.remove("dplayer-playing"),this.container.classList.add("dplayer-paused"),this.danmaku&&this.danmaku.pause()}},{key:"switchVolumeIcon",value:function(){this.volume()>=.95?this.template.volumeIcon.innerHTML=Z.volumeUp:this.volume()>0?this.template.volumeIcon.innerHTML=Z.volumeDown:this.template.volumeIcon.innerHTML=Z.volumeOff}},{key:"volume",value:function(B,H,z){if(B=parseFloat(B),!isNaN(B)){B=Math.max(B,0),B=Math.min(B,1),this.bar.set("volume",B,"width");var Q="".concat((100*B).toFixed(0),"%");this.template.volumeBarWrapWrap.dataset.balloon=Q,H||this.user.set("volume",B),z||this.notice("".concat(this.tran("Volume")," ").concat((100*B).toFixed(0),"%")),this.video.volume=B,this.video.muted&&(this.video.muted=!1),this.switchVolumeIcon()}return this.video.volume}},{key:"toggle",value:function(){this.video.paused?this.play():this.pause()}},{key:"on",value:function(B,H){this.events.on(B,H)}},{key:"switchVideo",value:function(B,H){this.pause(),this.video.poster=B.pic?B.pic:"",this.video.src=B.url,this.initMSE(this.video,B.type||"auto"),H&&(this.template.danmakuLoading.style.display="block",this.bar.set("played",0,"width"),this.bar.set("loaded",0,"width"),this.template.ptime.innerHTML="00:00",this.template.danmaku.innerHTML="",this.danmaku&&this.danmaku.reload({id:H.id,address:H.api,token:H.token,maximum:H.maximum,addition:H.addition,user:H.user}))}},{key:"initMSE",value:function(B,H){var z=this;if(this.type=H,this.options.video.customType&&this.options.video.customType[H])Object.prototype.toString.call(this.options.video.customType[H])==="[object Function]"?this.options.video.customType[H](this.video,this):console.error("Illegal customType: ".concat(H));else switch(this.type==="auto"&&(/m3u8(#|\?|$)/i.exec(B.src)?this.type="hls":/.flv(#|\?|$)/i.exec(B.src)?this.type="flv":/.mpd(#|\?|$)/i.exec(B.src)?this.type="dash":this.type="normal"),this.type==="hls"&&(B.canPlayType("application/x-mpegURL")||B.canPlayType("application/vnd.apple.mpegURL"))&&(this.type="normal"),this.type){case"hls":if(window.Hls)if(window.Hls.isSupported()){var Q=this.options.pluginOptions.hls,te=new window.Hls(Q);this.plugins.hls=te,te.loadSource(B.src),te.attachMedia(B),this.events.on("destroy",function(){te.destroy(),delete z.plugins.hls})}else this.notice("Error: Hls is not supported.");else this.notice("Error: Can't find Hls.");break;case"flv":if(window.flvjs)if(window.flvjs.isSupported()){var re=window.flvjs.createPlayer(Object.assign(this.options.pluginOptions.flv.mediaDataSource||{},{type:"flv",url:B.src}),this.options.pluginOptions.flv.config);this.plugins.flvjs=re,re.attachMediaElement(B),re.load(),this.events.on("destroy",function(){re.unload(),re.detachMediaElement(),re.destroy(),delete z.plugins.flvjs})}else this.notice("Error: flvjs is not supported.");else this.notice("Error: Can't find flvjs.");break;case"dash":if(window.dashjs){var Ee=window.dashjs.MediaPlayer().create().initialize(B,B.src,!1),ve=this.options.pluginOptions.dash;Ee.updateSettings(ve),this.plugins.dash=Ee,this.events.on("destroy",function(){window.dashjs.MediaPlayer().reset(),delete z.plugins.dash})}else this.notice("Error: Can't find dashjs.");break;case"webtorrent":if(window.WebTorrent)if(window.WebTorrent.WEBRTC_SUPPORT){this.container.classList.add("dplayer-loading");var Ze=this.options.pluginOptions.webtorrent,Ve=new window.WebTorrent(Ze);this.plugins.webtorrent=Ve;var ze=B.src;B.src="",B.preload="metadata",B.addEventListener("durationchange",function(){return z.container.classList.remove("dplayer-loading")},{once:!0}),Ve.add(ze,function(oe){oe.files.find(function(le){return le.name.endsWith(".mp4")}).renderTo(z.video,{autoplay:z.options.autoplay,controls:!1})}),this.events.on("destroy",function(){Ve.remove(ze),Ve.destroy(),delete z.plugins.webtorrent})}else this.notice("Error: Webtorrent is not supported.");else this.notice("Error: Can't find Webtorrent.")}}},{key:"initVideo",value:function(B,H){var z=this;this.initMSE(B,H),this.on("durationchange",function(){B.duration!==1&&B.duration!==1/0&&(z.template.dtime.innerHTML=i.secondToTime(B.duration))}),this.on("progress",function(){var re=B.buffered.length?B.buffered.end(B.buffered.length-1)/B.duration:0;z.bar.set("loaded",re,"width")}),this.on("error",function(){z.video.error&&z.tran&&z.notice&&z.type!=="webtorrent"&&z.notice(z.tran("Video load failed"),-1)}),this.on("ended",function(){z.bar.set("played",1,"width"),z.setting.loop?(z.seek(0),z.play()):z.pause(),z.danmaku&&(z.danmaku.danIndex=0)}),this.on("play",function(){z.paused&&z.play(!0)}),this.on("pause",function(){z.paused||z.pause(!0)}),this.on("timeupdate",function(){z.bar.set("played",z.video.currentTime/z.video.duration,"width");var re=i.secondToTime(z.video.currentTime);z.template.ptime.innerHTML!==re&&(z.template.ptime.innerHTML=re)});for(var Q=function(re){B.addEventListener(z.events.videoEvents[re],function(){z.events.trigger(z.events.videoEvents[re])})},te=0;te<this.events.videoEvents.length;te++)Q(te);this.volume(this.user.get("volume"),!0,!0),this.options.subtitle&&(this.subtitle=new we(this.template.subtitle,this.video,this.options.subtitle,this.events),this.user.get("subtitle")||this.subtitle.hide())}},{key:"switchQuality",value:function(B){var H=this;if(B=typeof B=="string"?parseInt(B):B,this.qualityIndex!==B&&!this.switchingQuality){this.qualityIndex=B,this.switchingQuality=!0,this.quality=this.options.video.quality[B],this.template.qualityButton.innerHTML=this.quality.name;var z=this.video.paused;this.video.pause();var Q=lt()({current:!1,pic:null,screenshot:this.options.screenshot,preload:"auto",url:this.quality.url,subtitle:this.options.subtitle}),te=new DOMParser().parseFromString(Q,"text/html").body.firstChild;this.template.videoWrap.insertBefore(te,this.template.videoWrap.getElementsByTagName("div")[0]),this.prevVideo=this.video,this.video=te,this.initVideo(this.video,this.quality.type||this.options.video.type),this.seek(this.prevVideo.currentTime),this.notice("".concat(this.tran("Switching to")," ").concat(this.quality.name," ").concat(this.tran("quality")),-1),this.events.trigger("quality_start",this.quality),this.on("canplay",function(){if(H.prevVideo){if(H.video.currentTime!==H.prevVideo.currentTime)return void H.seek(H.prevVideo.currentTime);H.template.videoWrap.removeChild(H.prevVideo),H.video.classList.add("dplayer-video-current"),z||H.video.play(),H.prevVideo=null,H.notice("".concat(H.tran("Switched to")," ").concat(H.quality.name," ").concat(H.tran("quality"))),H.switchingQuality=!1,H.events.trigger("quality_end")}})}}},{key:"notice",value:function(B){var H=this,z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2e3,Q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.8;this.template.notice.innerHTML=B,this.template.notice.style.opacity=Q,this.noticeTime&&clearTimeout(this.noticeTime),this.events.trigger("notice_show",B),z>0&&(this.noticeTime=setTimeout(function(){H.template.notice.style.opacity=0,H.events.trigger("notice_hide")},z))}},{key:"resize",value:function(){this.danmaku&&this.danmaku.resize(),this.controller.thumbnails&&this.controller.thumbnails.resize(160,this.video.videoHeight/this.video.videoWidth*160,this.template.barWrap.offsetWidth),this.events.trigger("resize")}},{key:"speed",value:function(B){this.video.playbackRate=B}},{key:"destroy",value:function(){Ke.splice(Ke.indexOf(this),1),this.pause(),this.controller.destroy(),this.timer.destroy(),this.video.src="",this.container.innerHTML="",this.events.trigger("destroy")}}])&&He(G.prototype,j),M&&He(G,M),K}();console.log(`
`.concat(" %c DPlayer v","1.26.0"," ").concat("63275c8"," %c http://dplayer.js.org ",`
`,`
`),"color: #fadfa3; background: #030307; padding:5px 0;","background: #fadfa3; padding:5px 0;"),P.default=dt}]).default})})(bt);var Kt=xt(bt.exports);const Wt=pt({__name:"Dplayer",props:["url"],setup(Pe){const Le=Pe,N=vt(null);return At(()=>{Dt(()=>{new Kt({autoplay:!1,container:N.value,preload:"metadata",video:{url:Le.url,type:"customHls",customType:{customHls:function(P,h){const O=new Nt;O.loadSource(P.src),O.attachMedia(P)}}}})})}),(P,h)=>(Qe(),et("div",{id:"dplayer",ref_key:"dplayer",ref:N},null,512))}});function yt(Pe){let Le=Pe.split("$$$"),N=[];for(const P in Le){let h=Le[P].split("#");for(const O in h){let T=h[O].split("$");N.push({name:T[0],value:T[1]})}}return N}const jt={class:"play"},Gt={class:"anthology"},Yt=pt({__name:"Play",setup(Pe){const Le=Ot(),N=vt({url:"",name:"",director:"",actor:"",description:""}),P=vt();Rt(()=>{fetch(Bt+"/play/"+Le.params.id).then(O=>O.json()).then(O=>{N.value=O,P.value=yt(N.value.url)[0].value})});function h(O){return typeof O.value!="undefined"}return(O,T)=>{const i=Wt,C=Ut,R=kt,A=Ft;return Qe(),et("div",jt,[nt(i,{url:P.value},null,8,["url"]),nt(C,{name:N.value.name,director:N.value.director,actor:N.value.actor,description:N.value.description},null,8,["name","director","actor","description"]),it("div",Gt,[nt(A,null,{default:ht(()=>[(Qe(!0),et(mt,null,It(Et(yt)(N.value.url),g=>(Qe(),et(mt,null,[h(g)?(Qe(),Ct(R,{key:0,onClick:c=>P.value=g.value},{default:ht(()=>[Pt(at(g.name),1)]),_:2},1032,["onClick"])):Mt("",!0)],64))),256))]),_:1})])])}}});export{Yt as default};
